<!DOCTYPE html>
<html lang="en">vvv
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile College Climb</title> A is.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
            position:color: #ef4444;
            justify-content: space-between;             align-items: center; 17, 23, 0.95);             z-index: 1000;color: rgba(187, 134, 252, 0.1);c            transition: all 0.3s ease;a(0, 0, 0, 0.3);-            border-bottom: 1px solid rgba(160, 123, 204, 0.1);b            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);g        }cc-logo-section {l            display: flex;g        [data-theme="dark"] .cc-navbar {d            background: rgba(13, 17, 23, 0.95);
            border-bottom-color: rgba(187, 134, link 0.1);             box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);         } o        .cc-logo-section {e            display: flex;             align-items: center;:            gap: 1rem;ius: 12px;l            cursor: pointer;;%            text-decoration: none;0.3s ease;         } r        .cc-logo {over {i            width: 50px;cale(1.1) rotate(5deg);             height: 50px;e            border-radius: 12px;t            overflow: hidden;;            transition: transform 0.3s ease;:        }   height: 100%;k            object-fit: contain;e        .cc-logo:hover {r            transform: scale(1.1) rotate(5deg);         }cc-brand-text {             display: flex;g        .cc-logo img {tion: column;0            width: 100%;             height: 100%;1;r            object-fit: contain;         }0        .cc-brand-text h1 {         .cc-brand-text {.4rem;x            display: flex;00;.            flex-direction: column;ry);1            gap: 0;ight: 1;0            line-height: 1;,        }          .cc-brand-text h1 {             font-size: 1.4rem;v            font-weight: 700;             color: var(--text-primary);o            line-height: 1;r            margin: 0;:        })         .cc-brand-text h2 {             font-size: 1.4rem;             font-weight: 700;er;o            color: var(--text-primary);             line-height: 1;             margin: 0;         }* Theme Toggle Button */m        .cc-theme-toggle {;        .cc-nav-right { var(--gradient);ursor: pointer;;
            --text-primary: #f0f6f: center;             gap: 1rem;x;c;
            --text-secondary: #8b949e;
            --accent-color: #bb86   visibilifc;
            --gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }   --text-secondary: #66666.cc-profile6;
            --accent-color: #a07bcc;
        * { --gradient: linear-gradient(135deg, #2a357a 0%, #a07bcc 100%);
            margin: 0;0 8px 32px r, 255, 255, 0.6);e        }   margin-bottom: 1regba(42, 53, 122, 0.12);
            padding: 0;dius: 16px;ba(0,0,0,0.4);
            box-sizing: border-box;1;
        }   --warning-color: #f59e0b;
            --danger-color: #ef4444;
            opacity: 0.6;
            cursor: not-allowed;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--primary-bg);
            transition: all 0.3s ease;
            overflow-x: hidden;d;
        }   --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
        /* Starry Background */86fc;
        .starry-bg {nt: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
         * Enhanced Statistics with Real Data */
        .stats-overview {            top: 0;
           ofile-name {id; left: 0;
            width: 100 2.5rem;mns: repeat(auto-fit, minma%;
            height: 100: 700;%;
            z-index: -1;
            position: relative;
            z-index: 2;            transition: opacity 0.3s ease;
        }card {
        body {
        [data-theme="dark"] .starry-bg {erif;
            opacity: 1;: 1.6;
        }   color: var(--text-primary);
            background: var(--primary-bg);
        .star {nsition: all 0.3s ease;
            border: 1px solid rgba(1
            position: relative;le 3s infinite ease-in-out;
        /* Profile Content G */
            positiontent {: fixed;
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }   background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
        /* Navigation Bar */em;
        .cc-navbar { fln {ex;
            position: fixed; space-between;
            top: 0;tems: center;
            pa            left: 0; 1000;
            width: 100%;all 0.3s ease;
            background: solid rgba(255, 255, 255, 0.95);, 204, 0.1);
            transition: all 0.3s ease;
        }   height: 8px;            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center; 17, 23, 0.95);
            z-index: 1000;color: rgba(187, 134, 252, 0.1);
            transition: all 0.3s ease;a(0, 0, 0, 0.3);
         
        .section-title {            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }cc-logo-section {
            display: flex;
        [data-theme="dark"] .cc-navbar {
            text-decoration: none;0.3s ease;
        }
            align-items: center;
            gap: 0.5rem;
        }stat-icon {
            width: 60px;
        .form-group {0px;
            margin-bottom: 1.5rem;
        }   background: var(--gradient);
            display: flex;

        .cc-logo {over {
            width: 50px;cale(1.1) rotate(5deg);
            height: 50px;imary);
            border-radius: 0.5rem; rgba(160, 123, 204, 0.3 12px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }   height: 100%;
         form-input {flex;
            width: 100%; c        .cc-logo:hover {
            transform: scale(1.1) rotate(5deg);
        }cc-brand-text {
            display: flex;
        .cc-logo img {tion: column;
            width: 100%;
            height: 100%;1;
            object-fit: contain;
        }
        .cc-brand-text h1 {
        .cc-brand-text {.4rem;
            display: flex;00;
            flex-direction: columncent-color;ry);
            gap: 0;ight: 1;
            line-height: 1;
        }eight:

        .cc-brand-text h1 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            font-weight: 500;
        .form-select {tom: 1rem;            margin: 0;
        }

        .   background-repeat: no-repeat;
            background-pos            font-size: 1.4rem;
            font-weigh-size: 1rem;nt: 700;er;
            color: var(--text-primary);
            line-height: 1;
            margin: 0;
        }* Theme Toggle Button */
            padding: 0.75re        .cc-theme-toggle {
        .cc-nav-right { ;;var(--gradient);
            display: flex; 12
            align-items: center;
            gap: 1rze: 1remem;x;
        }   height: 44px;
            cursor: pointer;
        /* Theme Toggle Button */
        .cc-theme-toggle ar(--gradient);
            border: none;
            border-radius: 50%;s ease;
            width: 44px;.2rem;
            height: 44px;
            cursor: pointer;
            display: flex;over {
            align-items: center;) rotate(180deg);
            color: white;
        }match-header {
            display: flex;
        .btn-primary:hover { space-between;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

            justify-con{tent: center;);
            color: white;
            transition: all 0.3s ease;
            font-size:x  1.2rem;ntainer */
        }   display: flex;
            align-items: cen            position: relative;
        .cc-theme-toggle:hover {
            transform: scavar(--le(1.1) rotate(180deg);
            box-shadow: var(--shadow);
        }cc-profile-button {
            display: flex;radient
        /* Profile Dropd;own Container */
        .cc-profile-dropdown {
            position: relative;
        }   padding: 0.3rerem;m;
            border-radius: 50%;
        /* Profile Button */0.3s ease;
        .cc-profile-button {sparent;
            display: flex;
            align-items: center;
         
        /* Questionnaire Sectio            cursor: pointer;
            padding: 0.3rem;over .cc-user-avatar {
            border-radius: 50%;08);
            transition: all 0.3s ease;(160, 123, 204, 0.2);
         
        .questionnaire-gri            border: none;
            position: relative;ve .cc-user-avatar {
        }   transform: scale(0.95);
        }
        .   margin-top: 1rem;
        }   border: 1px solid rgba(160, 123, 204, 0.1);
            transition: all 0.3s ease;            transform: scale(1.08);
            box-shadow: 0 0 ve;0 3px rgba(160, 123, 204, 0.2);
        }   width: 44px;
            height: 44px;
        .cc-profile-button:active .cc-user-avatar {
            transform: scale(0.95);
        }   border: 3px solir (--accent-color);d var(--accent-color);
            transition: all 0.35px s ease;
        /* User Avatar */er;
        .cc-user-avatar { 2px 8px rgba(160, 123, 204, 0.2);
            width: 44px;
            height: 44px;
            margin-top: 0.5rem;
            border-radius: 50%;-user-avatar {
            border: 3px solid var(--accent-color);252, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            align-items: center;
            gap: 0.5rem;.        }cc-profile-text {
            display: none !important;
        [data-theme="dark"] .cc-user-avatar {
            transition: all 0.3s ease;
            cursor: pointer;
        }   align-items: center;
            justify-content: center;
            display: none !important;
        /* Profile Text - Hidden completely */
        .cc-profile-text {
            display: none !important;
        }cc-dropdown-menu {
            position: absolute;
        /* Dropdown Chevron - Hidden */
        .cc-dropdown-chevron {
         
        .school-details {        }   box-shadow: 0 10px 40px rgba(42, 53, 122, 0.15), 0 0 0 1px rgba(160, 123, 204, 0.1);
            border-radius: 20px;
        /* Dropdown Menu */m;
        .cc-dropdown-menu {x;
            background: var(--primary-bg);cale(0.9);
            box-shadow: 0 10px 40px rgba(42, 53, 122, 0.15), 0 0 0 1px rgba(160, 123, 204, 0.1);
        /* Success/Error Messages */
        .message {tail {
            padding: 1rem 1.5rem;
            border-radius: 12px;ce-between;
            margin-bottom: 1.5rem;
            font-weight: 500;;
            display: none;
        }
        .detail-label {
        .message.success {ext-secondary);
            min-width: 280pa(x;blur(20px);
            max-width: 320pccx;
            opacity: 0;
            visibility: hidden;-dropdown-menu {
            transformr (--text-: translateY(-15px) scale(0.9);
            transform-origin: top right; 252, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);1px rgba(187, 134, 252, 0.15);
            border: 1px solid rgcolor);ba(160, 123, 204, 0.15);
            backdrop-filter:  rgba(239, 68, 68, 0.2);blur(20px);
        }cc-dropdown-menu.sho-primary-bgw {
            opacity: 1;
        [data-theme="dark"] .cc-dropdown-menu {
            background: rgba(22hadow);, 27, 34, 0.98);
            border-color: rgba(187, 134, 252, 0.2);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(187, 134, 252, 0.15);
        }* Add arrow pointer to dropdown */
        .cc-dropdown-menu::before {
        .cc-dropdown-menu.show {
         loading::after {: 2rem;
            content: ''            visibility: visible;
            transform: translateY(0) scale(1);
        }   width: 12px;
            height: 12px;
        /* Add arrow pointer to dropdown */
        .   height: 20px;
            margin: -10px 0 0 -10px            content: '';m: none;
            position: absolute;
            top: -6px; us: 50%;rotate(45deg);
            right: 16px;
            width: 12px;
            top: 0;
            bottom: 0;
        @keyframes spin {            background: var(--primary-bg);.98);
            border: 1px solid rgba(360deg); }160, 123, 204, 0.15);
            border-bottoranslatem: none;
            border-right: none;
            transform: rotate(45deg); */
        }cc-dropdown-header {
            padding: 1.25rem;
        [data-theme="dark 0;rem;"] .cc-dropdown-menu::before {, 0.1);
            background: rgba(22, 27, 34, 0.98);
            border-color: rgba(187, 134, 252, 0.2);
        }   border-radius: 14px;
            text-align: center;
        /* Welcome Header in Dropdown { */
        .   flex-direction: row;
        }            padding: 1.25rem;cc-dropdown-header {
            border-bottom: 2px solid rgba(160, 123, 204, 0.1);
            margin-bottom: 0.75rem;, 45, 0.6);
            background: var(--secondary-bg);
            top: -50%;
            left: -50%;
            width: 200%;t {            text-align: center;
        }   font-size: 0.8rem;
            color: var(--textl-gradient(circle, r-secondary);
        [data-theme="dark"] .cc-dropdown-header {
            border-bottom-color: rg160, 123, 2ba(187, 134, 252, 0.15);
            background: rgba(33, 38, 45, 0.6);
        }   font-weight: 600;
        }
        .   margin: 0 auto;
            display: flex;            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;);
            flex-wrap: wrap;
            letter-spacing: 0.5px;p: text;
        }   background-clip: text;
            margin-bottom: 0.3rem;
        .cc-dropdown-name {
            font-size: 1.25rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-backgroun-gradient);d-clip: text;
            border-radius: 12px;
            overflow: hidden;            background-clip: text;
            margin-bottom: 0.3rem;s;
        }   white-space: nowrap;
            padding: 0 0.5rem;
        .cc-dropdown-email {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.3rem;
            overflow: hidden;
         timeline-date {
        .footer-text { 0.9rem;            white-space: nowrap;
            padding: 0 0.5rem;1rem;
        }   color: var(--text-primary);
            text-decoration: none;
        /* Dropdown Links */0.25s ease;
        .cc-dropdown-link {12px;
            display: flex;00;
            align-items: center;
            gap: 1rem;tom: 0.3rem;
            display: flex;ext-primary);
            gap: 1rem;tom: 0.5rem;
        }
            text-decoration: none;
            transition: al{onl 0.25s ease;
            border-radius: 12px;e {
            font-weighs: center;t: 600;
            font-size: 0.95rem;
            margin-bottom: 0.3rem;
            position: relative;
            overflow: hidden;
        }   width: 0;
            background: var(--gradient);
        .cc-dropdown-link::before {
            content: '';width 0.3s ease;
            position: absolute;
            left: 0;
            transform: translateY(-5px) scale(1.1);
            background: rgba(255, 255, 2            bottom: 0;: var(--secondary-bg);
            width: 0;: translateX(4px);
            background: s: 24px;var(--gradient);
            opacity: 0.1;
            transition: width 0.3s ease;
        }data-theme 24px;olid rgb="dark"] .cc-dropdown-link:hover {
            backgroundx;: rgba(33, 38, 45, 0.8);
        .cc-dropdown-nvert(1);link:hover {
            background: var(--secondary-bg);
            transform: translateX(4px); {
            color: var(--accent-color);
        }media (max-width: 1024px) {
            .profile-content {
        .cc-dropdown-link:hover::before {
            width: 4px;translateX(2px) scale(0.98);
        }
            align-items: center;

        [data-theme="dark"] .cc-dropdown-link:hover {
            background: rgba(33, 38, 45, 0.8);
        }   width: 28pxus: 12px;;
            text-align: center;
        .cc-dropdown-link:active {0.3s ease;
            transform: translateX(2px) scale(0.98);
        }
        .task-item:hover {
        @media (max-width: 768p        .cc-dropdown-link-icon {5);
            font-size: 1.3rem;ccent-colo
            width: 28px;
            text-align: center;
            }-checkbox {            transition: transform 0.3s ease;
        }   height: 2px;
            background: linear-gradient(90deg, transparent, rgba(160, 123, 204, 0.2), transparent);
        .cc-dropdown-link:hover .cc-dropdown-link-icon {
            transform: scale(1.15);
        }
            k-content {
            .logo {;
        .cc-dropdown-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(160, 123, 204, 0.2), transparent);
            font-weight: 600;
            .brand-text h1, .brand-text h2 {
        }   font-weight: 700 !important;
        }
        [data-theme="dark"] .cc-dropdown-divider {
            background: linear {
                padding: 1rem;r-gradient(90deg, transparent, rgba(187, 134, 252, 0.2), transparent);
        }   background: rgba(239, 68, 68, 0.1) !important;
        .cc-logout-link {
            color: var(--danger-color) !important;
            .profile-header {
            font-weight: 700 !important;or) !important;

        .cc-logout-link:hover {
            background: rgba(239, 68, 68lor);, 0.1) !important;
        }   width: 44px;
            height: 44px;
        .cc-logout-link:hover::before {
            background: var(--danger-color) !important;
        }   k-priority.low { background: var(--success-color); }
            .profile-name            animation: cc-spin 1s linear infinite;
        /* Loading State */
        .cc-profile-loading {
            width: 140px;
            .profile-email {
                font-size: 1rem;
            border-radius: 50%;
            border: 3px solid var(--secondary-bg);
            border-top-coion {lor: var(--accent-color);
            animation: cc-spin 1s linear infinite;{
        }   box-shadow: 0 0 0 3px rgba(160, 123, 204, 0.4);
            border-color: var(--accent-color);
        @keyframes cc-spin {
                gap: 1rem;
            }        }data-theme="dark"] .cc-profile-dropdown.open .cc-user-avatar {
            box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.5);
        /* Active state indicator */
                grid-template-columns: 1fr;);
            }troke-width: 8;
            
            border-color: var(--accent-color);
        }  ============================================ */

        [       gap: 1.5rem;cent-color);data-theme="dark"] .cc-profile-dropdown.open .cc-user-avatar {
            box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.5);
        }   top: 0;
            left: 0;
        /   ia (max
            .navbar 
                padding: 0.75rem;0.3s ease;
            }osi-left: auto;
            margin-right: auto;
            min-height: calc(100vh - 200px);
        }   opacity: 1;rte(-50%, -50
        }
        /* Profile Header */
        .profile-header {
            .profile-container {centage" id="progressText">0%</div>
                padding: 0.75rem;
                margin-top: 70px;
            }olor: var(--text-secondary);
            font-weight: 500;
            .profile-header {
                padding: 1.5rem 1rem;
                margin-bottom: 1.5rem;
            }-widget {
            position: fixed;
            .profile-photo {
                width: 100px;
                height: 100px;
            }eight: 600px;
            background: var(--primary-bg);
            .profile-name {24px;
                font-size: 1.5rem;ow);
            }order: 1px solid rgba(160, 123, 204, 0.1);
            z-index: 1000;
            .section-title {lateY(100vh);
                font-size: 1.2rem;ubic-bezier(0.4, 0, 0.2, 1);
            }verflow: hidden;
            
            .btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;0);
            }
        }
        .chat-header {
        /* Animations */var(--gradient);
        .fade-in-up {ite;
            opacity: 0;5rem;
            transform: translateY(30px);
            transition: all 0.6s ease;ween;
        }   align-items: center;
        }
        .fade-in-up.visible {
            opacity: 1;
            transform: translateY(0);
        }   display: flex;
            align-items: center;
        /* File Upload Styling */
        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }   height: 8px;
            background: var(--success-color);
        .file-upload-input {0%;
            position: absolute; infinite;
            left: -9999px;
        }
        @keyframes pulse {
        .file-upload-button {y: 1; }
            background: var(--accent-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }   font-size: 1.5rem;
            cursor: pointer;
        .file-upload-button:hover {.2s ease;
            background: #8b5fbf;
            transform: translateY(-2px);
        }chat-close:hover {
    </style>transform: rotate(90deg);
</head> }
<body data-theme="dark">
    <div class="starry-bg" id="starryBg"></div>
            height: 400px;
    <!-- Navigation --> auto;
    <nav class="cc-navbar">;
        <a href="index.html" class="cc-logo-section">
            <div class="cc-logo">n;
                <img id="navbarLogo" src="images/whiteclearcc.png" alt="College Climb Logo">
            </div>
            <div class="cc-brand-text">
                <h1>College</h1>
                <h2>Climb</h2>
            </div>g: 1rem;
        </a>border-radius: 16px;
        <div class="cc-nav-right">
            <button class="cc-theme-toggle" id="themeToggle">‚òÄÔ∏è</button>
            <div class="cc-profile-dropdown" id="profileDropdown">
                <button class="cc-profile-button" id="profileButton">
                    <div class="cc-profile-loading" id="profileLoading"></div>
                    <img id="navUserAvatar" class="cc-user-avatar" src="images/default-avatar.svg" alt="Profile" style="display: none;">
                </button>
                <div class="cc-dropdown-menu" id="dropdownMenu">
                    <div class="cc-dropdown-header" id="dropdownHeader">
                        <div class="cc-dropdown-welcome">Welcome Back</div>
                        <div class="cc-dropdown-name" id="dropdownName">Loading...</div>
                        <div class="cc-dropdown-email" id="dropdownEmail"></div>
                    </div>r(--secondary-bg);
                    <a href="profile.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">üë§</span>
            background: var(--gradient);
                    </a>m-left-radius: 4px;
                    <a href="myapp.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">üìö</span>
                        <span>My Applications</span>
                    </a>rem;
                    <a href="dashboard.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">üìä</span>
                        <span>Dashboard</span>
                    </a> center;
                    <a href="testprep.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">üìö</span>
                        <span>Test Prep</span>
                    </a>
                    <a href="essaycoach.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">‚úçÔ∏è</span>
                        <span>Essay Coach</span>
                    </a>var(--secondary-bg);
                    <a href="settings.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">‚öôÔ∏è</span>
                        <span>Settings</span>
                    </a>all 0.3s ease;
                    <div class="cc-dropdown-divider"></div>
                    <a href="#" class="cc-dropdown-link cc-logout-link" id="logoutBtn">
                        <span class="cc-dropdown-link-icon">üö™</span>
                        <span>Logout</span>r);
                    </a>0 0 0 3px rgba(160, 123, 204, 0.1);
                </div>
            </div>
        </div>send {
    </nav>  width: 44px;
            height: 44px;
    <!-- Main Profile Container -->
    <div class="profile-container">ent);
        <!-- Profile Header -->
        <div class="profile-header fade-in-up">
            <div class="profile-photo-container">
                <img id="profilePhoto" src="images/default-avatar.svg" alt="Profile Photo" class="profile-photo">
                <button class="profile-photo-upload" onclick="document.getElementById('photoUpload').click()" type="button">
                    üì∑ntent: center;
                </button>ll 0.3s ease;
                <input type="file" id="photoUpload" class="file-upload-input" accept="image/*" style="display: none;">
            </div>
            t-send:hover {
            <!-- Add visible upload button as well -->
            <div style="margin-top: 1rem; margin-bottom: 1rem;">
                <button class="btn btn-secondary" onclick="document.getElementById('photoUpload').click()" type="button">
                    üì∑ Change Profile Photo
                </button>
            </div>: not-allowed;
            transform: none;
            <h1 class="profile-name" id="profileName">Loading...</h1>
            <p class="profile-email" id="profileEmail">Loading...</p>
        </div>t Toggle Button */
        .chat-toggle {
        <!-- Success/Error Messages -->
        <div id="successMessage" class="message success">
            ‚úÖ Profile updated successfully!
        </div>dth: 60px;
        <div id="errorMessage" class="message error">
            ‚ùå Something went wrong. Please try again.
        </div>ckground: var (--gradient);
            color: white;
        <!-- Profile Content -->
        <div class="profile-content fade-in-up">
            <!-- Personal Information -->
            <div class="profile-section">
                <h2 class="section-title">üë§ Personal Information</h2>
                sition: all 0.3s ease;
                <!-- Profile Photo Upload Section -->
                <div class="form-group">
                    <label class="form-label">Profile Photo</label>
                    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                        <div style="position: relative;">
                            <img id="profilePhotoPreview" src="images/default-avatar.svg" alt="Profile Preview" 
                                 style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent-color);">
                        </div>);
                        <div>
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('photoUpload').click()">
                                üì∑ Choose Photo
                            </button>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                Supported: JPG, PNG, GIF, WebP (Max 10MB)
                            </p>
                        </div>rgba(160, 123, 204, 0.3);
                    </div> 50%;
                    <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                </div> spin 1s ease-in-out infinite;
                
                <form id="personalInfoForm">
                    <div class="form-group">
                        <label class="form-label" for="displayName">Display Name</label>
                        <input type="text" id="displayName" class="form-input" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="phoneNumber">Phone Number</label>
                        <input type="tel" id="phoneNumber" class="form-input" placeholder="(555) 123-4567">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="dateOfBirth">Date of Birth</label>
                        <input type="date" id="dateOfBirth" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="location">Location</label>
                        <input type="text" id="location" class="form-input" placeholder="City, State">
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
                </form> var(--primary-bg);
            </div>-radius: 8px;
            border: 1px solid rgba(160, 123, 204, 0.1);
            <!-- Academic Information -->
            <div class="profile-section">
                <h2 class="section-title">üéì Academic Information</h2>
                <form id="academicInfoForm">
                    <div class="form-group">
                        <label class="form-label" for="currentGrade">Current Grade Level</label>
                        <select id="currentGrade" class="form-input form-select">
                            <option value="">Select Grade</option>
                            <option value="9">9th Grade (Freshman)</option>
                            <option value="10">10th Grade (Sophomore)</option>
                            <option value="11">11th Grade (Junior)</option>
                            <option value="12">12th Grade (Senior)</option>
                            <option value="college">College Student</option>
                            <option value="graduate">Graduate Student</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="currentSchool">Current School</label>
                        <input type="text" id="currentSchool" class="form-input" placeholder="School name">
                    </div>r;
                    <div class="form-group">
                        <label class="form-label" for="gpa">GPA</label>
                        <input type="number" id="gpa" class="form-input" step="0.01" min="0" max="4.0" placeholder="3.50">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="graduationYear">Expected Graduation Year</label>
                        <input type="number" id="graduationYear" class="form-input" min="2024" max="2030" placeholder="2025">
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
                </form>tion: line-through;
            </div>y: 0.7;
        </div>

        <!-- Current Questionnaire Data Display -->
        <div class="profile-section questionnaire-full fade-in-up" id="currentQuestionnaireDisplay" style="display: none;">
            <h2 class="section-title">üìã Your College Profile Summary</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                Here's a summary of your college preferences and information. You can update this data in the section below.
            </p>ground: var(--accent-color);
            <div id="questionnaireDataDisplay" class="questionnaire-grid">
                <!-- Data will be populated by JavaScript -->
            </div>ize: 0.85rem;
        </div>nt-weight: 600;
            margin-right: 0.5rem;
        <!-- Questionnaire Section -->
        <div class="profile-section questionnaire-full fade-in-up">
            <h2 class="section-title">üìã Update College Questionnaire</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                Fill out or update your college preferences to get personalized recommendations and AI assistance.
            </p>
            <form id="questionnaireForm">
                <div class="questionnaire-grid">
                    <!-- Basic Information -->
                    <div class="question-group">
                        <label class="form-label" for="currentGradeLevel">Current Grade Level</label>
                        <select id="currentGradeLevel" class="form-input form-select">
                            <option value="">Select your current grade</option>
                            <option value="9th">9th Grade (Freshman)</option>
                            <option value="10th">10th Grade (Sophomore)</option>
                            <option value="11th">11th Grade (Junior)</option>
                            <option value="12th">12th Grade (Senior)</option>
                            <option value="gap-year">Gap Year</option>
                            <option value="college">College Student</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
            font-size: 1.5rem;
                    <div class="question-group">
                        <label class="form-label" for="expectedGraduation">Expected High School Graduation Year</label>
                        <select id="expectedGraduation" class="form-input form-select">
        position: absolute;
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                                     left: -50%;t: auto;
                            <option value="2030">2030</option>
                        </select> 68, 68, 0.05);
                    </div>

                    <!-- Academic Performance -->
                    <div class="question-group">or);
                        <label class="form-label" for="currentGPA">Current GPA (if known)</label>
                        <select id="currentGPA" class="form-input form-select">
                            <option value="">Select GPA range</option>
                            <option value="4.0+">4.0+ (A+)</option>
                            <option value="3.7-3.99">3.7-3.99 (A-/A)</option>
                            <option value="3.3-3.69">3.3-3.69 (B+/A-)</option>
                            <option value="3.0-3.29">3.0-3.29 (B)</option>
                            <option value="2.7-2.99">2.7-2.99 (B-)</option>
                            <option value="2.3-2.69">2.3-2.69 (C+/B-)</option>
                            <option value="2.0-2.29">2.0-2.29 (C)</option>
                            <option value="below-2.0">Below 2.0</option>
                            <option value="not-sure">Not sure/Don't know</option>
                        </select>
                    </div>
            height: 100%;
                    <div class="question-group">
                        <label class="form-label" for="satScore" style="font-size: 0.85rem; margin-bottom: 0.25rem;">SAT Score</label>
                        <select id="satScore" class="form-input form-select">
                            <option value="">Not taken/Don't know</option>
                            <option value="1600">1600 (Perfect)</option>
                            <option value="1500-1590">1500-1590</option>
                            <option value="1400-1490">1400-1490</option>
                            <option value="1300-1390">1300-1390</option>
                            <option value="1200-1290">1200-1290</option>
                            <option value="1100-1190">1100-1190</option>
                            <option value="1000-1090">1000-1090</option>
                            <option value="900-990">900-990</option>
                            <option value="below-900">Below 900</option>
                        </select>
                    </div>0 0 9999px rgba(0, 0, 0, 0.7);
                    <div class="question-group">
                        <label class="form-label" for="actScore" style="font-size: 0.85rem; margin-bottom: 0.25rem;">ACT Score</label>
                        <select id="actScore" class="form-input form-select">
                            <option value="">Not taken/Don't know</option>
                            <option value="36">36 (Perfect)</option>
                            <option value="34-35">34-35</option>
                            <option value="32-33">32-33</option>
                            <option value="30-31">30-31</option>
                            <option value="28-29">28-29</option>
                            <option value="26-27">26-27</option>
                            <option value="24-25">24-25</option>
                            <option value="22-23">22-23</option>
                            <option value="20-21">20-21</option>
                            <option value="below-20">Below 20</option>
                        </select>
                    </div>
        [data-theme="dark"] .tour-tooltip {
                    <!-- College Preferences -->
                    <div class="question-group">
                        <label class="form-label">What types of colleges interest you most?</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">px); }
                                <input type="checkbox" id="public-universities" name="collegeTypes" value="public-universities">
                                <label for="public-universities">Public Universities</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="private-universities" name="collegeTypes" value="private-universities">
                                <label for="private-universities">Private Universities</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="liberal-arts-colleges" name="collegeTypes" value="liberal-arts-colleges">
                                <label for="liberal-arts-colleges">Liberal Arts Colleges</label>
                            </div>ndary);
                            <div class="checkbox-item">
                                <input type="checkbox" id="community-colleges" name="collegeTypes" value="community-colleges">
                                <label for="community-colleges">Community Colleges</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="historically-black" name="collegeTypes" value="historically-black">
                                <label for="historically-black">Historically Black Colleges (HBCUs)</label>
                            </div>-between;
                            <div class="checkbox-item">
                                <input type="checkbox" id="women-colleges" name="collegeTypes" value="women-colleges">
                                <label for="women-colleges">Women's Colleges</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="technical-schools" name="collegeTypes" value="technical-schools">
                                <label for="technical-schools">Technical/Trade Schools</label>
                            </div>
                        </div>on */
                    </div> {
            position: fixed;
                    <div class="question-group">
                        <label class="form-label" for="collegeSize">Preferred College Size</label>
                        <select id="collegeSize" class="form-input form-select">
                            <option value="">No preference</option>
                            <option value="very-small">Very Small (Under 1,000 students)</option>
                            <option value="small">Small (1,000-5,000 students)</option>
                            <option value="medium">Medium (5,000-15,000 students)</option>
                            <option value="large">Large (15,000-30,000 students)</option>
                            <option value="very-large">Very Large (30,000+ students)</option>
                        </select>
                    </div>ansform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
                    <div class="question-group">
                        <label class="form-label" for="locationPreference">Location Preference</label>
                        <select id="locationPreference" class="form-input form-select">
                            <option value="">No preference</option>
                            <option value="hometown">Close to home (within 2 hours)</option>
                            <option value="in-state">Anywhere in my state</option>
                            <option value="regional">Regional (neighboring states)</option>
                            <option value="national">Anywhere in the US</option>
                            <option value="international">Open to international schools</option>
                        </select>
                    </div>m;
            margin-bottom: 1rem;
                    <div class="question-group"> alternate;
                        <label class="form-label" for="campusSetting">Campus Setting Preference</label>
                        <select id="campusSetting" class="form-input form-select">
                            <option value="">No preference</option>
                            <option value="urban">Urban (in a city)</option>
                            <option value="suburban">Suburban</option>
                            <option value="small-town">Small town</option>
                            <option value="rural">Rural</option>
                        </select>
                    </div>d;
            width: 10px;
                    <!-- Academic Interests -->
                    <div class="question-group">
                        <label class="form-label">Academic Areas of Interest</label>
                        <div class="checkbox-group">ards;
                            <div class="checkbox-item">
                                <input type="checkbox" id="agriculture" name="academicInterests" value="agriculture">
                                <label for="agriculture">Agriculture & Natural Resources</label>
                            </div>
                            <div class="checkbox-item">deg);
                                <input type="checkbox" id="architecture" name="academicInterests" value="architecture">
                                <label for="architecture">Architecture & Planning</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="arts" name="academicInterests" value="arts">
                                <label for="arts">Arts & Design</label>
                            </div>dient(135deg, #f59e0b 0%, #ef4444 100%);
                            <div class="checkbox-item">
                                <input type="checkbox" id="business" name="academicInterests" value="business">
                                <label for="business">Business & Entrepreneurship</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="communications" name="academicInterests" value="communications">
                                <label for="communications">Communications & Media</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="computer-science" name="academicInterests" value="computer-science">
                                <label for="computer-science">Computer Science & IT</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="education" name="academicInterests" value="education">
                                <label for="education">Education</label>
                            </div>;
            height: 200%;
                                <input type="checkbox" id="engineering" name="academicInterests" value="engineering">
                                <label for="engineering">Engineering</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="health-sciences" name="academicInterests" value="health-sciences">
                                <label for="health-sciences">Health Sciences & Medicine</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="humanities" name="academicInterests" value="humanities">
                                <label for="humanities">Humanities & Literature</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="languages" name="academicInterests" value="languages">
                                <label for="languages">Languages & Linguistics</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="law" name="academicInterests" value="law">
                                <label for="law">Law & Legal Studies</label>
                            </div>
                          dial-grclass="cadient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
                                <label for="mathematics">Mathematics & Statistics</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="physical-sciences" name="academicInterests" value="physical-sciences">
            }                     background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #a07bcc 100%);
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="psychology" name="academicInterests" value="psychology">
                                <label for="psychology">Psychology</label>
                            </div>
                            <div class="checkbox-item">cent-color), var(--success-color));
                                <input type="checkbox" id="social-sciences" name="academicInterests" value="social-sciences">
                                <label for="social-sciences">Social Sciences</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theology" name="academicInterests" value="theology">
                                <label for="theology">Theology & Religious Studies</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="undecided" name="academicInterests" value="undecided">
                                <label for="undecided">Undecided/Exploring</label>
                            </div>
                        </div>p {
                    </div> 1rem;
        }
                    <!-- Career Goals -->
                    <div class="question-group">
                        <label class="form-label">Career Goals & Interests</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="entrepreneur" name="careerGoals" value="entrepreneur">
                                <label for="entrepreneur">Start my own business</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="corporate" name="careerGoals" value="corporate">
                                <label for="corporate">Work in corporate America</label>
                            </div>(160, 123, 204, 0.2);
                            <div class="checkbox-item">
                                <input type="checkbox" id="nonprofit" name="careerGoals" value="nonprofit">
                                <label for="nonprofit">Work for a nonprofit</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="government" name="careerGoals" value="government">
                                <label for="government">Government service</label>
                            </div>ient);
                            <div class="checkbox-item">
                                <input type="checkbox" id="research" name="careerGoals" value="research">
                                <label for="research">Research & Academia</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="healthcare" name="careerGoals" value="healthcare">
                                <label for="healthcare">Healthcare professional</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="education-career" name="careerGoals" value="education-career">
                                <label for="education-career">Teaching/Education</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="arts-career" name="careerGoals" value="arts-career">
                                <label for="arts-career">Creative arts</label>
                            </div> repeat(auto-fit, minmax(250px, 1fr));
                            <div class="checkbox-item">
                                <input type="checkbox" id="unsure-career" name="careerGoals" value="unsure-career">
                                <label for="unsure-career">Still exploring options</label>
                            </div>
                        </div>
                    </div>r(--secondary-bg);
            padding: 1.5rem;
                    <!-- Extracurricular Activities -->
                    <div class="question-group">, 0.1);
                        <label class="form-label">Extracurricular Activities & Interests</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="varsity-sports" name="extracurriculars" value="varsity-sports">
                                <label for="varsity-sports">Varsity Sports</label>
                            </div>cent-color);
                            <div class="checkbox-item">
                                <input type="checkbox" id="club-sports" name="extracurriculars" value="club-sports">
                                <label for="club-sports">Club/Intramural Sports</label>
                            </div>{
                            <div class="checkbox-item">
                                <input type="checkbox" id="performing-arts" name="extracurriculars" value="performing-arts">
                                <label for="performing-arts">Performing Arts (Theater, Music, Dance)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="visual-arts" name="extracurriculars" value="visual-arts">
                                <label for="visual-arts">Visual Arts</label>
                            </div> repeat(7, 1fr);
                            <div class="checkbox-item">
                                <input type="checkbox" id="student-government" name="extracurriculars" value="student-government">
                                <label for="student-government">Student Government/Leadership</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="academic-clubs" name="extracurriculars" value="academic-clubs">
                                <label for="academic-clubs">Academic Clubs & Competitions</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="volunteer-work" name="extracurriculars" value="volunteer-work">
                                <label for="volunteer-work">Volunteer Work & Community Service</label>
                            </div>r;
                            <div class="checkbox-item">
                                <input type="checkbox" id="part-time-job" name="extracurriculars" value="part-time-job">
                                <label for="part-time-job">Part-time Job/Work Experience</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="research-projects" name="extracurriculars" value="research-projects">
                                <label for="research-projects">Research Projects</label>
                            </div>nt-color);
                            <div class="checkbox-item">
                                <input type="checkbox" id="internships" name="extracurriculars" value="internships">
                                <label for="internships">Internships</label>
                            </div>
                        </div>line {
                    </div>ba(239, 68, 68, 0.1);
            border: 2px solid var(--danger-color);
                    <!-- Financial Considerations -->
          @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
                                  }   box-shadow: 
                0 25px      <50px rgba(42, 53, 122, 0.15),
        @keyframes rotate { rgba(160, 123, 204, 0.2),
            0% { transform: rotate(0deg); }, 255, 0.2);
            100% { transform: rotonate(360deg); }
        }   position: relative;
            overflow: hidden;
        .profile-photo-container {(255, 255, 255, 0.1);
            position: relative;
            display: inline-block;
            margin  </div>-bottom: 1.5rem;
            align-items: center;z-index: 2;;
        }   position: absolute;
            top: 0;
        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;t(circle at 20% 80%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
            border: 4px solid rgba(255, 255, 255, 0.3);(255, 255, 255, 0.1) 0%, transparent 50%),
            transition: all 0.3s ease; at 40% 40%,box" id="merit-schol rgba(160, 123, 204, 0.3) 0%, transparent 50%);
            cursor: pointer;none;
        }

        .profile-photo:hov      <input type="checkbox" id="athletic-scholarships" name="financialAid" value="athletic-scholarships">
                                <label for="athletic-scholarships">Interested in athletic scholarships</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="work-study" name="financialAid" value="work-study">
                                <label for="work-study">Open to work-study programs</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="student-loans" name="financialAid" value="student-loans">
            transform: scale(1.05);, 5vw, 3.5rem);
            border-color: rgba(255, 255, 255, 0.6);
        }   margin-bottom: 1rem;
            position: rev>endinglative;
        .profile-photo-upload-warning-color);
                    <!-- Special Considerations -->
                    <div class="question-group">
                        <label class="form-label">Special Considerations</label>
                        <div class="che
            position: absolute;20px rgba(0, 0, 0, 0.3);
            bottom: 5px;ng: -0  <input type="checkbox" id="first-generation" name="specialConsiderations" value="first-generation">
                                <label for="first-generation">First-generation college student</label>
                            </div>
                            <div class="checkbox-item">
                                <input
            right: 5px;:        <label 1.1;
            background: var(--accent-color);
            color: white;
            border: none;p {
            border-radius: 50%;"learning-differences">Learning differences support needed</label>
                            </div>);
                            <div class="checkbox-item">
                                <input type="checkbox" id="religious-affiliation" name="specialConsiderations" value="religious-affiliation">
                                <label for="religious-affiliation">Prefer religiously affiliated schools</label>
                            </div>(--accent-color);
                            <div class="checkbox-item">
                                <input type="checkbox" id="lgbtq-friendly" name="specialConsiderations" value="lgbtq-friendly">
                                <label for="lgbtq-friendly">LGBTQ+ friendly campus important</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="diverse-campus" name="specialConsiderations" value="diverse-campus">
                                <label for="diverse-campus">Diverse campus community important</label>
                            </div>ient);
                        </div>
                    </div>em 0.75rem;
                </div>ius: 20px;
            font-size: 0.75rem;
                <!-- Additional Questions -->
                <div class="form-group" style="margin-top: 2rem;">
                    <label class="form-label" for="collegeWorries">What worries you most about the college application process?</label>
                    <textarea id="collegeWorries" class="form-input form-textarea" 
                              placeholder="Share any concerns or anxieties you have about applying to college..."></textarea>
                </div> {
            position: fixed;
                <div class="form-group">
                    <label class="form-label" for="additionalInfo">Additional Information</label>
                    <textarea id="additionalInfo" class="form-input form-textarea" 
                              placeholder="Anything else you'd like us to know about your college preferences or goals?"></textarea>
                </div>
            z-index: 100;
                <div style="text-align: center; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary">üíæ Update Questionnaire</button>
                    <button type="button" class="btn btn-secondary" onclick="resetQuestionnaire()">üîÑ Reset to Defaults</button>
                </div>ions {
            </form>tom: 1rem;
        </div>  right: 1rem;
            }
        <!-- Account Management -->
        <div class="profile-section fade-in-up" style="margin-top: 2rem;">
            <h2 class="section-title">‚öôÔ∏è Account Management</h2>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="changePassword()">üîê Change Password</button>
                <button class="btn btn-secondary" onclick="downloadData()">üì• Download My Data</button>
                <button class="btn btn-danger" onclick="deleteAccount()">üóëÔ∏è Delete Account</button>
            </div>tooltip {
        </div>  max-width: 90%;
    </div>      left: 5% !important;
                right: 5%;
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">
                <img src="images/whiteclearcc.png" alt="College Climb Logo">
            </div>
            <div class="footer-text">
                &copy; 2025 College Climb. All rights reserved. Empowering students to reach new heights.
            </div>id-template-columns: 1fr;
            <div class="footer-socials">
                <a href="https://instagram.com/" target="_blank" aria-label="Instagram">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram">
                </a> 0.25rem;
                <a href="https://x.com/" target="_blank" aria-label="X (Twitter)">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg" alt="X">
                </a>card-actions {
                <a href="https://tiktok.com/" target="_blank" aria-label="TikTok">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok">
                </a>
                <a href="https://youtube.com/" target="_blank" aria-label="YouTube">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/youtube.svg" alt="YouTube">
                </a>
            </div>
        </div>
    </footer>k-action-btn {
            width: 60px;
    <!-- Firebase & JavaScript -->
    <script type="module"> 50%;
        // Import Firebase modulesient);
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut, updatePassword, deleteUser, EmailAuthProvider, reauthenticateWithCredential } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-storage.js';
            box-shadow: 0 4px 20px rgba(160, 123, 204, 0.4);
        // Firebase configurationease;
        const firebaseConfig = {
            apiKey: "AIzaSyDqL5ZoTKp36sk8J5TxuHn_y6ji4i9h20s",
            authDomain: "collegeclimb-ai.firebaseapp.com",
            projectId: "collegeclimb-ai",
            storageBucket: "collegeclimb-ai.firebasestorage.app",
            messagingSenderId: "187139654658",
            appId: "1:187139654658:web:4a6cf4c43095f03212931b",
            measurementId: "G-E0B2RQM9XS"60, 123, 204, 0.6);
        };

        // Initialize Firebase */
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
            max-width: 400px;
        console.log('üî• Firebase initialized successfully');
            background: var(--primary-bg);
        // Global variables16px;
        let currentUser = null;hadow);
        let currentUserData = null;var(--accent-color);
            z-index: 1001;
        // Auth state managementX(120%);
        onAuthStateChanged(auth, async (user) => { 0, 0.2, 1);
            console.log('üë§ Auth state changed:', user ? `User: ${user.email}` : 'No user');
            
            if (user) {how {
                currentUser = user;);
                updateAuthUI(user);
                await loadUserProfile(user);
                await loadUserData(user.uid);
                lay: flex;
                // Test storage connection
                setTimeout(testStorageConnection, 1000);
            } else {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
            }idth: 40px;
        }); height: 40px;
            border-radius: 50%;
        // Update navbar UI(--gradient);
        function updateAuthUI(user) {
            const navUserAvatar = document.getElementById('navUserAvatar');
            const profileLoading = document.getElementById('profileLoading');
            const dropdownName = document.getElementById('dropdownName');
            const dropdownEmail = document.getElementById('dropdownEmail');
        }
            if (user) {
                // Hide loading spinner
                if (profileLoading) profileLoading.style.display = 'none';
            color: var(--text-primary);
                // Show avatar5rem;
                if (navUserAvatar) {
                    if (currentUserData && currentUserData.profilePhotoURL) {
                        navUserAvatar.src = currentUserData.profilePhotoURL;
                    }: 0.9rem;
                    navUserAvatar.style.display = 'block';
                }

                // Update dropdown header
                if (dropdownName) {
                    dropdownName.textContent = (currentUserData && currentUserData.name)
                        ? currentUserData.name
                        : user.displayName || user.email.split('@')[0];
                }n-top: 4rem;
                if (dropdownEmail) {
                    dropdownEmail.textContent = user.email;
                }low: hidden;
            } else {
                // Show loading
                if (profileLoading) profileLoading.style.display = 'block';
                if (navUserAvatar) navUserAvatar.style.display = 'none';
            }osition: absolute;
        }   top: -50%;
            left: -50%;
        // Dropdown toggle functionality
        const profileButton = document.getElementById('profileButton');
        const profileDropdown = document.getElementById('profileDropdown');ransparent 70%);
        const dropdownMenu = document.getElementById('dropdownMenu');
        }
        if (profileButton && dropdownMenu) {
            profileButton.addEventListener('click', (e) => {
                e.stopPropagation();deg); }
                dropdownMenu.classList.toggle('show');
                profileDropdown.classList.toggle('open');
            });
        .footer-content {
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!profileDropdown.contains(e.target)) {
                    dropdownMenu.classList.remove('show');
                    profileDropdown.classList.remove('open');
                }2rem;
            });x-wrap: wrap;
            padding: 0 2rem;
            // Close dropdown when clicking a link
            dropdownMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    dropdownMenu.classList.remove('show');
                    profileDropdown.classList.remove('open');
                }); 60px;
            });th: 60px;
        }   border-radius: 12px;
            overflow: hidden;
        // Load user profile data
        async function loadUserProfile(user) {
            try {ogo img {
                const profileName = document.getElementById('profileName');
                const profileEmail = document.getElementById('profileEmail');
                ct-fit: contain;
                if (profileEmail) profileEmail.textContent = user.email;
                if (profileName) profileName.textContent = user.displayName || user.email.split('@')[0];
            } catch (error) {
                console.error('‚ùå Error loading user profile:', error);
            }ont-size: 1.1rem;
        }   opacity: 0.9;
            flex: 1;
        // Load user data from Firestore
        async function loadUserData(userId) {
            try {
                const userDoc = await getDoc(doc(db, 'users', userId));
                socials {
                if (userDoc.exists()) {
                    currentUserData = userDoc.data();
                    populateFormFields(currentUserData);
                } else {
                    // Create default user document
                    currentUserData = {
                        email: currentUser.email,
                        name: currentUser.displayName || '',
                        createdAt: new Date()
                    };px;
                    await setDoc(doc(db, 'users', userId), currentUserData);
                }r-radius: 50%;
                // Always update navbar/dropdown after loading user data
                updateAuthUI(currentUser);
            } catch (error) {
                console.error('‚ùå Error loading user data:', error);
                showMessage('Error loading profile data. Please refresh the page.', 'error');
            }ransform: translateY(-5px) scale(1.1);
        }   background: rgba(255, 255, 255, 0.3);
        }
        // Populate form fields with user data
        function populateFormFields(userData) {
            // Personal Information
            if (userData.name) document.getElementById('displayName').value = userData.name;
            if (userData.phone) document.getElementById('phoneNumber').value = userData.phone;
            if (userData.dateOfBirth) document.getElementById('dateOfBirth').value = userData.dateOfBirth;
            if (userData.location) document.getElementById('location').value = userData.location;
        /* Responsive Design */
            // Academic Information{
            if (userData.currentGrade) document.getElementById('currentGrade').value = userData.currentGrade;
            if (userData.currentSchool) document.getElementById('currentSchool').value = userData.currentSchool;
            if (userData.gpa) document.getElementById('gpa').value = userData.gpa;
            if (userData.graduationYear) document.getElementById('graduationYear').value = userData.graduationYear;
            .school-grid {
            // Profile Photo - Update all photo elements
            if (userData.profilePhotoURL) {
                const photoElements = [
                    document.getElementById('profilePhoto'),
                    document.getElementById('profilePhotoPreview'),
                    document.getElementById('navUserAvatar')
                ];dding: 0.75rem 1rem;
                
                photoElements.forEach(element => {
                    if (element) {
                        element.src = userData.profilePhotoURL;
                        if (element.id === 'navUserAvatar') {
                            element.style.display = 'block';
                        }
                    }-text h1,
                });nd-text h2 {
            }   font-size: 1.2rem;
            }
            // Update profile name display
            if (userData.name) {
                document.getElementById('profileName').textContent = userData.name;
            }   height: 38px;
                font-size: 1rem;
            // Questionnaire data
            if (userData.questionnaire) {
                populateQuestionnaire(userData.questionnaire);
            }   width: 40px;
        }       height: 40px;
            }
        // Populate questionnaire fields - ENHANCED VERSION
        function populateQuestionnaire(questionnaire) {
            console.log('üìã Populating questionnaire with data:', questionnaire);
                right: -0.5rem;
            // Single select fields from questions.html
            const questionFields = {
                'currentGradeLevel': questionnaire.currentGradeLevel,
                'expectedGraduation': questionnaire.expectedGraduation || questionnaire.graduationYear,
                'currentGPA': questionnaire.currentGPA || questionnaire.unweightedGPA,
                'satScore': questionnaire.satScore,.expectedGraduation || questionnaire.graduationYear,.expectedGraduation || questionnaire.graduationYear,
                'actScore': questionnaire.actScore,GPA || questionnaire.unweightedGPA,GPA || questionnaire.unweightedGPA,
                'collegeSize': questionnaire.collegeSize,
                'locationPreference': questionnaire.locationPreference,
                'campusSetting': questionnaire.campusSetting,
                'budgetRange': questionnaire.budgetRangetionPreference,tionPreference,
            };  'campusSetting': questionnaire.campusSetting,  'campusSetting': questionnaire.campusSetting,elcome-section {
                'budgetRange': questionnaire.budgetRange    'budgetRange': questionnaire.budgetRange    padding: 2rem 1.5rem;
            // Populate single select fields
            Object.entries(questionFields).forEach(([fieldId, value]) => {
                if (value) {le select fieldsle select fields{
                    const element = document.getElementById(fieldId); => { => {
                    if (element) {
                        element.value = value;etElementById(fieldId);etElementById(fieldId);
                        console.log(`‚úÖ Populated ${fieldId} with:`, value);
                    }   element.value = value;   element.value = value;d {
                }       console.log(`‚úÖ Populated ${fieldId} with:`, value);       console.log(`‚úÖ Populated ${fieldId} with:`, value);adding: 2rem;
            });     }     }
                }                }
            // Handle questionnaire data that needs mapping to profile fields
            if (questionnaire.applicationTimeline) {
                const element = document.getElementById('expectedGraduation');
                if (element && !element.value) {e && !questionnaire.expectedGraduation) {e && !questionnaire.expectedGraduation) {
                    // Try to extract year from application timelineduation');duation');
                    const yearMatch = questionnaire.applicationTimeline.match(/\d{4}/);
                    if (yearMatch) {= questionnaire.applicationTimeline.match(/\d{4}/);= questionnaire.applicationTimeline.match(/\d{4}/);
                        element.value = yearMatch[0];
                    }   element.value = yearMatch[0];   element.value = yearMatch[0]; 20px;
                }       console.log('‚úÖ Mapped timeline to graduation year:', yearMatch[0]);       console.log('‚úÖ Mapped timeline to graduation year:', yearMatch[0]);
            }       }       }
                }                }            .timeline-item {
            // Map intended major to academic interests
            if (questionnaire.intendedMajor) {
                const majorToInterestMap = {NG (from questions.html testScores field)NG (from questions.html testScores field)
                    'Computer Science': 'computer-science',naire.testScores === 'string') {naire.testScores === 'string') {
                    'Engineering': 'engineering',cores:', questionnaire.testScores);cores:', questionnaire.testScores);
                    'Business': 'business',
                    'Medicine/Pre-Med': 'health-sciences',
                    'Biology': 'physical-sciences',Scores.match(/SAT:?\s*(\d+)/i);Scores.match(/SAT:?\s*(\d+)/i);
                    'Psychology': 'psychology',
                    'English': 'humanities',t(satMatch[1]);t(satMatch[1]);
                    'Mathematics': 'mathematics',etElementById('satScore');etElementById('satScore');
                    'Physics': 'physical-sciences',alue) {alue) {
                    'Chemistry': 'physical-sciences',
                    'Economics': 'social-sciences',nge = '1600';nge = '1600';
                    'Political Science': 'social-sciences', = '1500-1590'; = '1500-1590';
                    'Art': 'arts',atScore >= 1400) satRange = '1400-1490';atScore >= 1400) satRange = '1400-1490';
                    'Music': 'arts',Score >= 1300) satRange = '1300-1390';Score >= 1300) satRange = '1300-1390';rem;
                    'History': 'humanities'= 1200) satRange = '1200-1290';= 1200) satRange = '1200-1290';
                };      else if (satScore >= 1100) satRange = '1100-1190';      else if (satScore >= 1100) satRange = '1100-1190';
                        else if (satScore >= 1000) satRange = '1000-1090';        else if (satScore >= 1000) satRange = '1000-1090';logo {
                const mappedInterest = majorToInterestMap[questionnaire.intendedMajor];
                if (mappedInterest) { = 'below-900'; = 'below-900';
                    const checkbox = document.querySelector(`input[name="academicInterests"][value="${mappedInterest}"]`);
                    if (checkbox) {value = satRange;value = satRange;
                        checkbox.checked = true;T ${satScore} to range:`, satRange);T ${satScore} to range:`, satRange);
                    }-text h2 {
                }ont-size: 1.1rem;
            }      
                // Extract ACT score                // Extract ACT score
            // Handle test scores from questions.htmlores.match(/ACT:?\s*(\d+)/i);ores.match(/ACT:?\s*(\d+)/i);
            if (questionnaire.testScores) {
                // Parse test scores string like "SAT: 1450, ACT: 32"
                const satMatch = questionnaire.testScores.match(/SAT:?\s*(\d+)/i);
                const actMatch = questionnaire.testScores.match(/ACT:?\s*(\d+)/i);
                        let actRange = '';        let actRange = '';dropdown-menu::before {
                if (satMatch) {Score >= 36) actRange = '36';Score >= 36) actRange = '36';
                    const satScore = parseInt(satMatch[1]); '34-35'; '34-35';
                    const satElement = document.getElementById('satScore');
                    if (satElement && !satElement.value) {= '30-31';= '30-31';
                        // Map score to range28) actRange = '28-29';28) actRange = '28-29';
                        if (satScore >= 1600) satElement.value = '1600';
                        else if (satScore >= 1500) satElement.value = '1500-1590';
                        else if (satScore >= 1400) satElement.value = '1400-1490';
                        else if (satScore >= 1300) satElement.value = '1300-1390';
                        else if (satScore >= 1200) satElement.value = '1200-1290';
                        else if (satScore >= 1100) satElement.value = '1100-1190';
                        else if (satScore >= 1000) satElement.value = '1000-1090';
                        else if (satScore >= 900) satElement.value = '900-990';nge);nge);
                        else satElement.value = 'below-900';
                    }-accent-color);
                }: 4px;
                
                if (actMatch) {major to academic interestsmajor to academic interests
                    const actScore = parseInt(actMatch[1]);
                    const actElement = document.getElementById('actScore');endedMajor);endedMajor);
                    if (actElement && !actElement.value) {
                        // Map score to range
                        if (actScore >= 36) actElement.value = '36';
                        else if (actScore >= 34) actElement.value = '34-35';
                        else if (actScore >= 32) actElement.value = '32-33';
                        else if (actScore >= 30) actElement.value = '30-31';
                        else if (actScore >= 28) actElement.value = '28-29';
                        else if (actScore >= 26) actElement.value = '26-27';
                        else if (actScore >= 24) actElement.value = '24-25';
                        else if (actScore >= 22) actElement.value = '22-23';
                        else if (actScore >= 20) actElement.value = '20-21';
                        else actElement.value = 'below-20';
                    }Economics': 'social-sciences',Economics': 'social-sciences',s="cc-logo">
                }   'Political Science': 'social-sciences',   'Political Science': 'social-sciences',img id="ccNavbarLogo" src="images/whiteclearcc.png" alt="College Climb Logo">
            }       'Art': 'arts',       'Art': 'arts',/div>
                    'Music': 'arts',                    'Music': 'arts',            <div class="cc-brand-text">
            // Checkbox groups from profile form
            const checkboxGroups = [
                'collegeTypes', 'academicInterests', 'careerGoals', 'extracurriculars', 
                'financialAid', 'specialConsiderations'
            ];    
                const mappedInterest = majorToInterestMap[questionnaire.intendedMajor];    const mappedInterest = majorToInterestMap[questionnaire.intendedMajor]; Right Side Navigation -->
            checkboxGroups.forEach(group => {
                if (questionnaire[group] && Array.isArray(questionnaire[group])) {nterests"][value="${mappedInterest}"]`);nterests"][value="${mappedInterest}"]`);
                    questionnaire[group].forEach(value => {ia-label="Toggle theme">
                        const checkbox = document.querySelector(`input[name="${group}"][value="${value}"]`);
                        if (checkbox) {Auto-selected academic interest: ${mappedInterest}`);Auto-selected academic interest: ${mappedInterest}`);
                            checkbox.checked = true;
                            console.log(`‚úÖ Checked ${group}:`, value);
                        }ccProfileDropdown">
                    });
                } Checkbox groups (from both questions.html and profile.html) Checkbox groups (from both questions.html and profile.html)   <!-- Loading state initially -->
            });st checkboxGroups = [st checkboxGroups = [     <div class="cc-profile-loading" id="ccProfileLoading"></div>
                'collegeTypes',                 'collegeTypes',                     
            // Textarea fieldsests', ests', le content (hidden initially) -->
            if (questionnaire.collegeWorries) {
                const element = document.getElementById('collegeWorries');
                if (element) element.value = questionnaire.collegeWorries;
            }   'specialConsiderations'   'specialConsiderations'   </div>
            ];];
            if (questionnaire.additionalInfo) {
                const element = document.getElementById('additionalInfo');
                if (element) element.value = questionnaire.additionalInfo;oup])) {oup])) {
            }       console.log(`‚úÖ Processing ${group}:`, questionnaire[group]);       console.log(`‚úÖ Processing ${group}:`, questionnaire[group]);       <div class="cc-dropdown-header" id="ccDropdownHeader">
                    questionnaire[group].forEach(value => {                    questionnaire[group].forEach(value => {                        <div class="cc-dropdown-welcome">Hello,</div>
            console.log('üìã Questionnaire population completed');input[name="${group}"][value="${value}"]`);input[name="${group}"][value="${value}"]`);ownName">Guest</div>
                        if (checkbox) {                        if (checkbox) {                        <div class="cc-dropdown-email" id="ccDropdownEmail"></div>
            // Also display the questionnaire data in read-only view
            displayQuestionnaireData(questionnaire);
        }           });           });           <!-- Navigation Links -->
                }                }                    <a href="dashboard.html" class="cc-dropdown-link">
        // Display questionnaire data in read-only format
        function displayQuestionnaireData(questionnaire) {
            const displayContainer = document.getElementById('questionnaireDataDisplay');
            const displaySection = document.getElementById('currentQuestionnaireDisplay');
                const element = document.getElementById('collegeWorries');                const element = document.getElementById('collegeWorries');                    <a href="testprep.html" class="cc-dropdown-link">
            if (!questionnaire || Object.keys(questionnaire).length === 0) {
                if (displaySection) displaySection.style.display = 'none';
                return;
            }f (questionnaire.additionalInfo) {f (questionnaire.additionalInfo) {
                const element = document.getElementById('additionalInfo');                const element = document.getElementById('additionalInfo');                    <a href="essaycoach.html" class="cc-dropdown-link">
            if (displaySection) displaySection.style.display = 'block';fo;fo;
            if (!displayContainer) return;
                    </a>
            const data = [];e summarye summary
            displayQuestionnaireData(questionnaire);            displayQuestionnaireData(questionnaire);                    <a href="scholarship.html" class="cc-dropdown-link">
            // Basic Infonk-icon">üí∞</span>
            if (questionnaire.currentGradeLevel) {n complete');n complete');
                data.push({ label: 'Current Grade', value: questionnaire.currentGradeLevel });
            }
            if (questionnaire.expectedGraduation || questionnaire.graduationYear) {
                data.push({ label: 'Expected Graduation', value: questionnaire.expectedGraduation || questionnaire.graduationYear });
            }onst displayContainer = document.getElementById('questionnaireDataDisplay');onst displayContainer = document.getElementById('questionnaireDataDisplay');           <span>Documents</span>
            if (questionnaire.applicationTimeline) {ntById('currentQuestionnaireDisplay');ntById('currentQuestionnaireDisplay');
                data.push({ label: 'Application Timeline', value: questionnaire.applicationTimeline });
            }f (!questionnaire || Object.keys(questionnaire).length === 0) {f (!questionnaire || Object.keys(questionnaire).length === 0) {       <a href="profile.html" class="cc-dropdown-link">
                if (displaySection) displaySection.style.display = 'none';                if (displaySection) displaySection.style.display = 'none';                        <span class="cc-dropdown-link-icon">üë§</span>
            // Academic Performance
            if (questionnaire.currentGPA || questionnaire.unweightedGPA) {
                data.push({ label: 'GPA', value: questionnaire.currentGPA || questionnaire.unweightedGPA });
            }f (displaySection) displaySection.style.display = 'block';f (displaySection) displaySection.style.display = 'block';       <!-- Divider -->
            if (questionnaire.weightedGPA) {der"></div>
                data.push({ label: 'Weighted GPA', value: questionnaire.weightedGPA });
            }onst data = [];onst data = [];       <!-- Logout -->
            if (questionnaire.testScores) {
                data.push({ label: 'Test Scores', value: questionnaire.testScores });
            }f (questionnaire.currentGradeLevel) {f (questionnaire.currentGradeLevel) {           <span>Logout</span>
            if (questionnaire.satScore) {nt Grade', value: questionnaire.currentGradeLevel });nt Grade', value: questionnaire.currentGradeLevel });
                data.push({ label: 'SAT Score', value: questionnaire.satScore });
            }f (questionnaire.expectedGraduation || questionnaire.graduationYear) {f (questionnaire.expectedGraduation || questionnaire.graduationYear) {/div>
            if (questionnaire.actScore) {ted Graduation', value: questionnaire.expectedGraduation || questionnaire.graduationYear });ted Graduation', value: questionnaire.expectedGraduation || questionnaire.graduationYear });
                data.push({ label: 'ACT Score', value: questionnaire.actScore });
            }f (questionnaire.applicationTimeline) {f (questionnaire.applicationTimeline) {
                data.push({ label: 'Application Timeline', value: questionnaire.applicationTimeline });                data.push({ label: 'Application Timeline', value: questionnaire.applicationTimeline });    <!-- Loading Overlay -->
            // College Preferences0; width: 100%; height: 100%; background: rgba(42, 53, 122, 0.95); backdrop-filter: blur(10px); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease;">
            if (questionnaire.collegeSize) {
                data.push({ label: 'Preferred College Size', value: questionnaire.collegeSize });
            }f (questionnaire.currentGPA || questionnaire.unweightedGPA) {f (questionnaire.currentGPA || questionnaire.unweightedGPA) {h2 style="color: white; font-size: 1.5rem; margin-bottom: 0.5rem;">Loading Your Dashboard</h2>
            if (questionnaire.locationPreference) {estionnaire.currentGPA || questionnaire.unweightedGPA });estionnaire.currentGPA || questionnaire.unweightedGPA });8); font-size: 1rem;" id="loadingStatusText">Preparing your personalized experience...</p>
                data.push({ label: 'Location Preference', value: questionnaire.locationPreference });
            }f (questionnaire.weightedGPA) {f (questionnaire.weightedGPA) {
            if (questionnaire.campusSetting) {PA', value: questionnaire.weightedGPA });PA', value: questionnaire.weightedGPA });
                data.push({ label: 'Campus Setting', value: questionnaire.campusSetting });
            }f (questionnaire.testScores) {f (questionnaire.testScores) {rames spin {
            if (questionnaire.budgetRange) {res', value: questionnaire.testScores });res', value: questionnaire.testScores });}
                data.push({ label: 'Budget Range', value: questionnaire.budgetRange });
            }f (questionnaire.satScore) {f (questionnaire.satScore) {
                data.push({ label: 'SAT Score', value: questionnaire.satScore });                data.push({ label: 'SAT Score', value: questionnaire.satScore });        #dashboardLoadingOverlay.fade-out {
            // Interests
            if (questionnaire.intendedMajor) {
                data.push({ label: 'Intended Major', value: questionnaire.intendedMajor });
            }
            if (questionnaire.targetSchools && questionnaire.targetSchools.length > 0) {
                data.push({ label: 'Target Schools', value: questionnaire.targetSchools.join(', ') });
            }f (questionnaire.collegeSize) {f (questionnaire.collegeSize) {questionnairePromptModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); z-index: 10000; align-items: center; justify-content: center;">
                data.push({ label: 'Preferred College Size', value: questionnaire.collegeSize });                data.push({ label: 'Preferred College Size', value: questionnaire.collegeSize });        <div style="background: white; border-radius: 20px; padding: 3rem; max-width: 500px; margin: 2rem; text-align: center; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
            // Checkbox arrays</div>
            if (questionnaire.collegeTypes && questionnaire.collegeTypes.length > 0) {
                data.push({ label: 'College Types', value: questionnaire.collegeTypes.map(v => v.replace(/-/g, ' ')).join(', ') }); 2-3 minutes!</p>
            }div style="display: flex; gap: 1rem; justify-content: center;">
            if (questionnaire.academicInterests && questionnaire.academicInterests.length > 0) {t-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s;">
                data.push({ label: 'Academic Interests', value: questionnaire.academicInterests.map(v => v.replace(/-/g, ' ')).join(', ') });
            }   </button>
            if (questionnaire.careerGoals && questionnaire.careerGoals.length > 0) {size: 1rem; cursor: pointer; transition: background 0.2s;">
                data.push({ label: 'Career Goals', value: questionnaire.careerGoals.map(v => v.replace(/-/g, ' ')).join(', ') });
            }   </button>
            if (questionnaire.extracurriculars && questionnaire.extracurriculars.length > 0) {
                data.push({ label: 'Extracurriculars', value: questionnaire.extracurriculars.map(v => v.replace(/-/g, ' ')).join(', ') });
            }f (questionnaire.intendedMajor) {f (questionnaire.intendedMajor) {
            if (questionnaire.financialAid && questionnaire.financialAid.length > 0) {r });r });
                data.push({ label: 'Financial Aid', value: questionnaire.financialAid.map(v => v.replace(/-/g, ' ')).join(', ') });
            }f (questionnaire.targetSchools && questionnaire.targetSchools.length > 0) {f (questionnaire.targetSchools && questionnaire.targetSchools.length > 0) {tourWelcomeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); z-index: 10000; align-items: center; justify-content: center;">
            if (questionnaire.specialConsiderations && questionnaire.specialConsiderations.length > 0) {ext-align: center; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: modalPop 0.3s ease;">
                data.push({ label: 'Special Considerations', value: questionnaire.specialConsiderations.map(v => v.replace(/-/g, ' ')).join(', ') });
            }margin-bottom: 1rem; font-size: 1.8rem;">Welcome to Your Dashboard!</h2>
            // Checkbox arrays            // Checkbox arrays            <p style="color: #666; margin-bottom: 2rem; line-height: 1.6;">Let us show you around! This quick tour will help you discover all the powerful features available to help with your college applications.</p>
            // Text areasaire.collegeTypes && questionnaire.collegeTypes.length > 0) {aire.collegeTypes && questionnaire.collegeTypes.length > 0) {isplay: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            if (questionnaire.collegeWorries) {es', value: questionnaire.collegeTypes.map(v => v.replace(/-/g, ' ')).join(', ') });es', value: questionnaire.collegeTypes.map(v => v.replace(/-/g, ' ')).join(', ') });odal()" style="background: linear-gradient(135deg, #2a357a 0%, #a07bcc 100%); color: white; border: none; padding: 1rem 2rem; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 12px rgba(160, 123, 204, 0.3);">
                data.push({ label: 'College Worries', value: questionnaire.collegeWorries, isLong: true });
            }f (questionnaire.academicInterests && questionnaire.academicInterests.length > 0) {f (questionnaire.academicInterests && questionnaire.academicInterests.length > 0) {   </button>
            if (questionnaire.additionalInfo) {terests', value: questionnaire.academicInterests.map(v => v.replace(/-/g, ' ')).join(', ') });terests', value: questionnaire.academicInterests.map(v => v.replace(/-/g, ' ')).join(', ') });al()" style="background: #f0f0f0; color: #666; border: none; padding: 1rem 2rem; border-radius: 12px; font-size: 1rem; cursor: pointer; transition: background 0.2s;">
                data.push({ label: 'Additional Info', value: questionnaire.additionalInfo, isLong: true });
            }f (questionnaire.careerGoals && questionnaire.careerGoals.length > 0) {f (questionnaire.careerGoals && questionnaire.careerGoals.length > 0) {   </button>
                data.push({ label: 'Career Goals', value: questionnaire.careerGoals.map(v => v.replace(/-/g, ' ')).join(', ') });                data.push({ label: 'Career Goals', value: questionnaire.careerGoals.map(v => v.replace(/-/g, ' ')).join(', ') });            </div>
            // Application status
            if (questionnaire.applicationStarted) {uestionnaire.extracurriculars.length > 0) {uestionnaire.extracurriculars.length > 0) {
                data.push({ label: 'Application Started', value: questionnaire.applicationStarted }); v.replace(/-/g, ' ')).join(', ') }); v.replace(/-/g, ' ')).join(', ') });
            }
            if (questionnaire.essayStarted) { questionnaire.financialAid.length > 0) { questionnaire.financialAid.length > 0) {
                data.push({ label: 'Essay Started', value: questionnaire.essayStarted });(v => v.replace(/-/g, ' ')).join(', ') });(v => v.replace(/-/g, ' ')).join(', ') });
            }00% { transform: scale(1); opacity: 1; }
            if (questionnaire.resumeStarted) {tions && questionnaire.specialConsiderations.length > 0) {tions && questionnaire.specialConsiderations.length > 0) {
                data.push({ label: 'Resume Started', value: questionnaire.resumeStarted });nsiderations.map(v => v.replace(/-/g, ' ')).join(', ') });nsiderations.map(v => v.replace(/-/g, ' ')).join(', ') });
            }
    <!-- Main Dashboard -->
            // Build HTML-container" style="opacity: 0; transition: opacity 0.5s ease;">
            let html = '';ire.collegeWorries) {ire.collegeWorries) {-->
            data.forEach(item => { 'College Worries', value: questionnaire.collegeWorries, isLong: true }); 'College Worries', value: questionnaire.collegeWorries, isLong: true });id="alertBanner">
                if (item.isLong) {
                    html += `.additionalInfo) {.additionalInfo) { fa-exclamation-triangle"></i>
                        <div class="question-group" style="grid-column: 1 / -1;">onalInfo, isLong: true });onalInfo, isLong: true });
                            <div class="form-label">${item.label}</div>
                            <div style="padding: 1rem; background: var(--primary-bg); border-radius: 8px; white-space: pre-wrap; color: var(--text-primary);">
                                ${item.value}
                            </div>icationStarted) {icationStarted) {
                        </div>bel: 'Application Started', value: questionnaire.applicationStarted });bel: 'Application Started', value: questionnaire.applicationStarted });
                    `;
                } else {naire.essayStarted) {naire.essayStarted) {tion -->
                    html += `abel: 'Essay Started', value: questionnaire.essayStarted });abel: 'Essay Started', value: questionnaire.essayStarted });ection">
                        <div class="question-group">
                            <div class="form-label">${item.label}</div>
                            <div style="padding: 0.75rem; background: var(--primary-bg); border-radius: 8px; color: var(--text-primary); text-transform: capitalize;">
                                ${item.value}
                            </div>
                        </div>
                    `; ''; '';="stat-card" onclick="showApplicationTracker()">
                }forEach(item => {forEach(item => {div class="stat-header">
            }); if (item.isLong) { if (item.isLong) {     <div class="stat-icon"><i class="fas fa-graduation-cap"></i></div>
                    html += `                    html += `                    <div class="stat-trend">
            displayContainer.innerHTML = html;roup" style="grid-column: 1 / -1;">roup" style="grid-column: 1 / -1;">-up"></i>
        }                   <div class="form-label">${item.label}</div>                   <div class="form-label">${item.label}</div>               <span id="applicationsTrend">+2 this week</span>
                            <div style="padding: 1rem; background: var(--primary-bg); border-radius: 8px; white-space: pre-wrap; color: var(--text-primary);">                            <div style="padding: 1rem; background: var(--primary-bg); border-radius: 8px; white-space: pre-wrap; color: var(--text-primary);">                    </div>
        // Update the questionnaire form handler to merge with existing data
        document.getElementById('questionnaireForm').addEventListener('submit', async (e) => {
            e.preventDefault();label">College Applications</div>
                    `;        `;    <div class="stat-description">
            try { else { else {   Track your application progress across all target schools
                const questionnaireData = {
                    // Single select fieldsn-group">n-group">
                    currentGradeLevel: document.getElementById('currentGradeLevel').value,
                    expectedGraduation: document.getElementById('expectedGraduation').value,der-radius: 8px; color: var(--text-primary); text-transform: capitalize;">der-radius: 8px; color: var(--text-primary); text-transform: capitalize;">
                    currentGPA: document.getElementById('currentGPA').value,
                    satScore: document.getElementById('satScore').value,
                    actScore: document.getElementById('actScore').value,
                    collegeSize: document.getElementById('collegeSize').value,
                    locationPreference: document.getElementById('locationPreference').value,
                    campusSetting: document.getElementById('campusSetting').value,
                    budgetRange: document.getElementById('budgetRange').value,
                    ontainer.innerHTML = html;ontainer.innerHTML = html; class="stat-value" id="essaysCount">0</div>
                    // Checkbox groups
                    collegeTypes: Array.from(document.querySelectorAll('input[name="collegeTypes"]:checked')).map(cb => cb.value),
                    academicInterests: Array.from(document.querySelectorAll('input[name="academicInterests"]:checked')).map(cb => cb.value),
                    careerGoals: Array.from(document.querySelectorAll('input[name="careerGoals"]:checked')).map(cb => cb.value),
                    extracurriculars: Array.from(document.querySelectorAll('input[name="extracurriculars"]:checked')).map(cb => cb.value),
                    financialAid: Array.from(document.querySelectorAll('input[name="financialAid"]:checked')).map(cb => cb.value),
                    specialConsiderations: Array.from(document.querySelectorAll('input[name="specialConsiderations"]:checked')).map(cb => cb.value),
                    t questionnaireData = {t questionnaireData = { class="stat-header">
                    // Textarea fieldsieldsieldscon"><i class="fas fa-trophy"></i></div>
                    collegeWorries: document.getElementById('collegeWorries').value,value,value,
                    additionalInfo: document.getElementById('additionalInfo').value,).value,).value,
                    currentGPA: document.getElementById('currentGPA').value,currentGPA: document.getElementById('currentGPA').value,    <span id="scholarshipTrend">$5K potential</span>
                    // Metadataocument.getElementById('satScore').value,ocument.getElementById('satScore').value,
                    updatedAt: new Date().toISOString(),ctScore').value,ctScore').value,
                    updatedFrom: 'profile'getElementById('collegeSize').value,getElementById('collegeSize').value,="scholarshipAmount">$0</div>
                };  locationPreference: document.getElementById('locationPreference').value,  locationPreference: document.getElementById('locationPreference').value,iv class="stat-label">Scholarship Value</div>
                    campusSetting: document.getElementById('campusSetting').value,                    campusSetting: document.getElementById('campusSetting').value,                <div class="stat-description">
        width: 45px;5;
        height: 45px;ative;
        cursor: pointer;
                const existingQuestionnaire = existingData.questionnaire || {};ame="collegeTypes"]:checked')).map(cb => cb.value),ame="collegeTypes"]:checked')).map(cb => cb.value),
                    academicInterests: Array.from(document.querySelectorAll('input[name="academicInterests"]:checked')).map(cb => cb.value),                    academicInterests: Array.from(document.querySelectorAll('input[name="academicInterests"]:checked')).map(cb => cb.value),            <div class="stat-card" onclick="showProgressAnalytics()">
                // Merge the data, with profile updates taking precedenceput[name="careerGoals"]:checked')).map(cb => cb.value),put[name="careerGoals"]:checked')).map(cb => cb.value),
                const mergedQuestionnaire = { ...existingQuestionnaire, ...questionnaireData };rriculars"]:checked')).map(cb => cb.value),rriculars"]:checked')).map(cb => cb.value),
                    financialAid: Array.from(document.querySelectorAll('input[name="financialAid"]:checked')).map(cb => cb.value),                    financialAid: Array.from(document.querySelectorAll('input[name="financialAid"]:checked')).map(cb => cb.value),                    <div class="stat-trend">
                await updateDoc(doc(db, 'users', currentUser.uid), {SelectorAll('input[name="specialConsiderations"]:checked')).map(cb => cb.value),SelectorAll('input[name="specialConsiderations"]:checked')).map(cb => cb.value),
                    questionnaire: mergedQuestionnaire,
                    questionnaireUpdated: new Date(),
                    profileQuestionnaireCompleted: trueById('collegeWorries').value,ById('collegeWorries').value,
                }); additionalInfo: document.getElementById('additionalInfo').value, additionalInfo: document.getElementById('additionalInfo').value,v class="stat-value" id="overallProgress">0%</div>
                                                        <div class="stat-label">Overall Progress</div>
                // Update currentUserData for immediate use
                if (!currentUserData.questionnaire) currentUserData.questionnaire = {};
                Object.assign(currentUserData.questionnaire, mergedQuestionnaire);
                };                };            </div>
                // Refresh the display
                displayQuestionnaireData(mergedQuestionnaire);reserve questions.html datareserve questions.html data
                const currentDoc = await getDoc(doc(db, 'users', currentUser.uid));                const currentDoc = await getDoc(doc(db, 'users', currentUser.uid));        <!-- AI School Matching Section -->
                showMessage('Questionnaire updated successfully!', 'success'); {}; {};
                const existingQuestionnaire = existingData.questionnaire || {};                const existingQuestionnaire = existingData.questionnaire || {};            <div class="match-header">
                // Scroll to the top to show the updated summary
                document.getElementById('currentQuestionnaireDisplay').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (error) {uestionnaire = { ...existingQuestionnaire, ...questionnaireData };uestionnaire = { ...existingQuestionnaire, ...questionnaireData }; Recommendations
                console.error('‚ùå Error updating questionnaire:', error);
                showMessage('Failed to update questionnaire. Please try again.', 'error');
            }       questionnaire: mergedQuestionnaire,       questionnaire: mergedQuestionnaire,       <i class="fas fa-robot"></i>
        });         questionnaireUpdated: new Date(),         questionnaireUpdated: new Date(),         Powered by AI
                    profileQuestionnaireCompleted: true                    profileQuestionnaireCompleted: true                </div>
        // Profile photo upload handler
        document.getElementById('photoUpload').addEventListener('change', async (e) => {
            const file = e.target.files[0];or immediate useor immediate useted by JavaScript -->
            if (!file) return;erData.questionnaire) currentUserData.questionnaire = {};erData.questionnaire) currentUserData.questionnaire = {};
                Object.assign(currentUserData.questionnaire, mergedQuestionnaire);                Object.assign(currentUserData.questionnaire, mergedQuestionnaire);            <div style="text-align: center; margin-top: 2rem;">
            // Validate file typedisplay: inline-flex;">
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {stionnaire);stionnaire);
                showMessage('Please upload a valid image file (JPG, PNG, GIF, or WebP)', 'error');
                e.target.value = ''; // Reset file inputsage('Questionnaire updated successfully!', 'success');sage('Questionnaire updated successfully!', 'success');
                return;
            }                // Scroll to the top to show the updated summary                // Scroll to the top to show the updated summary        <!-- Main Dashboard Grid -->
rentQuestionnaireDisplay').scrollIntoView({ behavior: 'smooth', block: 'start' });rentQuestionnaireDisplay').scrollIntoView({ behavior: 'smooth', block: 'start' });
            // Validate file size (10MB max)
            if (file.size > 10 * 1024 * 1024) {
                showMessage('Image size must be less than 10MB', 'error');sage('Failed to update questionnaire. Please try again.', 'error');sage('Failed to update questionnaire. Please try again.', 'error');ass="panel-header">
                e.target.value = ''; // Reset file input       <h2 class="panel-title">
                return;        });        });                        <i class="fas fa-calendar-alt"></i>
            }

            try {) => {) => {
                // Update all upload buttons to show loading statet.files[0];t.files[0];eLoading" style="text-align: center; padding: 2rem; display: none;">
                const uploadButtons = document.querySelectorAll('.profile-photo-upload, button:contains("Choose Photo")');
                uploadButtons.forEach(btn => {
                    btn.disabled = true;lidate file typelidate file type/div>
                    if (btn.classList.contains('profile-photo-upload')) {            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];                <div class="timeline" id="applicationTimeline">
                        btn.textContent = '‚è≥';ype)) {ype)) {l be populated by JavaScript -->
                    } else {
                        btn.textContent = '‚è≥ Uploading...';return;return;v>
                    }
                });

                console.log('üì§ Starting photo upload...');
showMessage('Image size must be less than 10MB', 'error');showMessage('Image size must be less than 10MB', 'error');<div class="streak-tracker" id="streakTracker" style="display: none;">
                // Delete old photo if exists
                if (currentUserData?.profilePhotoURL) {
                    try {
                        const oldPhotoRef = ref(storage, currentUserData.profilePhotoURL);{{        <p>Keep logging in daily to maintain your streak</p>
                        await deleteObject(oldPhotoRef);
                        console.log('‚úÖ Old photo deleted');hoto-upload');hoto-upload');
                    } catch (err) {
                        console.log('‚ÑπÔ∏è No old photo to delete or already deleted');
                    } uploadBtn.textContent = '‚è≥'; uploadBtn.textContent = '‚è≥';v class="task-section">
                }}}    <div class="panel-header">

                // Create unique filenameenceenceas fa-pen"></i>
                const timestamp = Date.now();tos/${currentUser.uid}/${Date.now()}_${file.name}`);tos/${currentUser.uid}/${Date.now()}_${file.name}`);
                const filename = `${timestamp}_${file.name.replace(/[^a-zA-Z0-9.]/g, '_')}`;
                const storageRef = ref(storage, `profile-photos/${currentUser.uid}/${filename}`);
                nsole.log('üì§ Uploading photo to Firebase Storage...');nsole.log('üì§ Uploading photo to Firebase Storage...');  <div class="word-counter-widget">
                // Upload file with metadataconst snapshot = await uploadBytes(storageRef, file);const snapshot = await uploadBytes(storageRef, file);        <div class="word-counter-header">
                const metadata = {essfully');essfully');r(--text-secondary); font-size: 0.9rem;">Words Written Today</span>
                    contentType: file.type,t: 700; color: var(--accent-color);" id="wordsToday">0</span>
                    customMetadata: {
                        uploadedBy: currentUser.uid,shot.ref);shot.ref);
                        uploadedAt: new Date().toISOString()loadURL);loadURL);id="wordProgressFill" style="width: 0%"></div>
                    }
                };date Firestore with new photo URLdate Firestore with new photo URL   <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-secondary);">
it updateDoc(doc(db, 'users', currentUser.uid), {it updateDoc(doc(db, 'users', currentUser.uid), {         <span>Goal: <strong id="wordGoal">500</strong> words/day</span>
                const snapshot = await uploadBytes(storageRef, file, metadata);    profilePhotoURL: downloadURL,    profilePhotoURL: downloadURL,            <span id="wordPercentage">0%</span>
                console.log('‚úÖ Photo uploaded successfully');new Date()new Date()
                ne-flex; justify-content: center;">
                // Get download URL            ‚úçÔ∏è Write Essays
                const downloadURL = await getDownloadURL(snapshot.ref);ts immediatelyts immediately
                console.log('‚úÖ Download URL obtained:', downloadURL);nts = [nts = [
                ofilePhoto'),ofilePhoto'),
                // Update FirestoreilePhotoPreview'),ilePhotoPreview'),
                await updateDoc(doc(db, 'users', currentUser.uid), {   document.getElementById('navUserAvatar')   document.getElementById('navUserAvatar')!-- Task Management -->
                    profilePhotoURL: downloadURL,];];<div class="task-section">
                    profilePhotoPath: snapshot.ref.fullPath,
                    profilePhotoUpdated: new Date().forEach(element => {.forEach(element => {lass="panel-title">
                });
                
                console.log('‚úÖ Firestore updated with new photo URL');        if (element.id === 'navUserAvatar') {        if (element.id === 'navUserAvatar') {        </h3>
display = 'block';display = 'block';
                // Update ALL photo elements on the page
                const photoElements = {y JavaScript -->
                    'profilePhoto': downloadURL,
                    'profilePhotoPreview': downloadURL,
                    'navUserAvatar': downloadURL/ Update currentUserData/ Update currentUserData
                };   currentUserData.profilePhotoURL = downloadURL;   currentUserData.profilePhotoURL = downloadURL;   <!-- Progress Overview -->
                               <div class="task-section">
                Object.entries(photoElements).forEach(([id, url]) => {                // Re-enable upload button                // Re-enable upload button                    <div class="panel-header">
                    const element = document.getElementById(id);n) {n) {class="panel-title">
                    if (element) {alse;alse;fa-chart-pie"></i>
                        element.src = url;
                        if (id === 'navUserAvatar') {
                            element.style.display = 'block';
                        } successfully!', 'success'); successfully!', 'success');
                        console.log(`‚úÖ Updated ${id}`);
                    }o:', error);o:', error);ircle-bg" cx="70" cy="70" r="60"></circle>
                });ge('Failed to upload photo. Please try again.', 'error');ge('Failed to upload photo. Please try again.', 'error');   <circle class="progress-circle-fill" cx="70" cy="70" r="60" 
                                             stroke-dasharray="377" stroke-dashoffset="377" id="progressCircle"></circle>
                // Update currentUserData       // Re-enable upload button       // Re-enable upload button               </svg>
                currentUserData.profilePhotoURL = downloadURL;                const uploadBtn = document.querySelector('.profile-photo-upload');                const uploadBtn = document.querySelector('.profile-photo-upload');                        <div class="progress-text">
                currentUserData.profilePhotoPath = snapshot.ref.fullPath;>
                abel">Complete</div>
                // Reset file input
                e.target.value = '';
                
                // Show success message       Keep going! You're making great progress.
                showMessage('Profile photo updated successfully!', 'success');
                        // Utility functions        // Utility functions                </div>
            } catch (error) {
                console.error('‚ùå Error uploading photo:', error);rrorMessage' : 'successMessage');rrorMessage' : 'successMessage');
                
                let errorMessage = 'Failed to upload photo. ';                messageEl.textContent = text;                messageEl.textContent = text;                    <div class="panel-header">
                if (error.code === 'storage/unauthorized') {
                    errorMessage += 'You don\'t have permission to upload files.';
                } else if (error.code === 'storage/canceled') {
                    errorMessage += 'Upload was canceled.';);); </h3>
                } else if (error.code === 'storage/unknown') {       </div>
                    errorMessage += 'An unknown error occurred. Please check your internet connection.';        }        }                    <div id="aiInsights" style="display: flex; flex-direction: column; gap: 1rem;">
                } else {pulated here -->
                    errorMessage += 'Please try again.';
                }
                estionnaire to default values?')) {estionnaire to default values?')) {
                showMessage(errorMessage, 'error');
                e.target.value = ''; // Reset file inputQuestionnaire reset. Don\'t forget to save your changes!', 'success');Questionnaire reset. Don\'t forget to save your changes!', 'success');ask-section">
                
            } finally {
                // Re-enable all upload buttonsas fa-calculator"></i>
                const uploadButtons = document.querySelectorAll('.profile-photo-upload, button:contains("Uploading")');ndow.changePassword = async function() {ndow.changePassword = async function() {                  Quick EFC Estimate
                uploadButtons.forEach(btn => {            const currentPassword = prompt('Enter your current password:');            const currentPassword = prompt('Enter your current password:');                        </h3>
                    btn.disabled = false;
                    if (btn.classList.contains('profile-photo-upload')) {
                        btn.textContent = 'üì∑';ters):');ters):');
                    } else {ength < 6) {ength < 6) {yIncome">Family Income ($)</label>
                        btn.textContent = 'üì∑ Choose Photo';alert('Password must be at least 6 characters long.');alert('Password must be at least 6 characters long.');            <input type="number" id="familyIncome" placeholder="75000" min="0">
                    }
                });
            }
        });familySize" placeholder="4" min="1" max="10">
d);d);
        // Utility functionsthenticateWithCredential(currentUser, credential);thenticateWithCredential(currentUser, credential);utton class="btn btn-primary" onclick="calculateEFC()" style="width: 100%;">
        function showMessage(text, type) {entUser, newPassword);entUser, newPassword);ected Contribution
            const messageEl = document.getElementById(type === 'error' ? 'errorMessage' : 'successMessage');showMessage('Password updated successfully!', 'success');showMessage('Password updated successfully!', 'success');        </button>
            if (messageEl) {
                messageEl.textContent = text;('‚ùå Error changing password:', error);('‚ùå Error changing password:', error);
                messageEl.style.display = 'block';ck your current password.', 'error');ck your current password.', 'error');
                setTimeout(() => {
                    messageEl.style.display = 'none';- Document Tracker -->
                }, 5000);sk-section">
            }        window.downloadData = async function() {        window.downloadData = async function() {                    <div class="panel-header">
        }

        // Global functions for account management
        window.resetQuestionnaire = function() {                                                        </h3>
            if (confirm('Are you sure you want to reset your questionnaire to default values?')) {{ type: 'application/json' });{ type: 'application/json' });
                document.getElementById('questionnaireForm').reset();eateObjectURL(blob);eateObjectURL(blob);entTracker">
                showMessage('Questionnaire reset. Don\'t forget to save your changes!', 'success');                const a = document.createElement('a');                const a = document.createElement('a');                        <!-- Document items will be populated here -->
            }.href = url;.href = url;   </div>
        };on`;on`;

        window.changePassword = async function() {URL.revokeObjectURL(url);URL.revokeObjectURL(url);
            const currentPassword = prompt('Enter your current password:');
            if (!currentPassword) return;ss');ss');
tch (error) {tch (error) {ction Buttons -->
            const newPassword = prompt('Enter your new password (minimum 6 characters):'); downloading data:', error); downloading data:', error);
            if (!newPassword || newPassword.length < 6) {d data. Please try again.', 'error');d data. Please try again.', 'error');ck="startTour()" title="Take Tour">
                alert('Password must be at least 6 characters long.');fas fa-question"></i>
                return;
            }
= async function() {= async function() {calendar"></i>
            try {account deletion:');account deletion:');
                const credential = EmailAuthProvider.credential(currentUser.email, currentPassword);
                await reauthenticateWithCredential(currentUser, credential);ale"></i>
                await updatePassword(currentUser, newPassword);  const password = prompt('Enter your password to confirm:');  const password = prompt('Enter your password to confirm:');button>
                showMessage('Password updated successfully!', 'success');            if (!password) return;            if (!password) return;    </div>
            } catch (error) {
                console.error('‚ùå Error changing password:', error);
                showMessage('Failed to change password. Please check your current password.', 'error');l = EmailAuthProvider.credential(currentUser.email, password);l = EmailAuthProvider.credential(currentUser.email, password);d="tourOverlay" onclick="closeAllModals()"></div>
            }                await reauthenticateWithCredential(currentUser, credential);                await reauthenticateWithCredential(currentUser, credential);    <div class="tour-spotlight" id="tourSpotlight" style="display: none;"></div>
        };r-tooltip" id="tourTooltip" style="display: none;" onclick="event.stopPropagation()">
om Firestoreom Firestore
        window.downloadData = async function() {
            try {
                const userData = await getDoc(doc(db, 'users', currentUser.uid));
                const data = userData.data();
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });ert('Account deleted successfully. You will be redirected to the home page.');ert('Account deleted successfully. You will be redirected to the home page.');utton class="btn btn-primary" onclick="nextTourStep()">Next</button>
                const url = URL.createObjectURL(blob);                window.location.href = 'index.html';                window.location.href = 'index.html';            </div>
                const a = document.createElement('a');
                a.href = url;                console.error('‚ùå Error deleting account:', error);                console.error('‚ùå Error deleting account:', error);    </div>
                a.download = `college-climb-data-${new Date().toISOString().split('T')[0]}.json`;lete account. Please check your password.', 'error');lete account. Please check your password.', 'error');
                a.click();
                URL.revokeObjectURL(url);        };        };    <div class="celebration-modal" id="celebrationModal" onclick="event.stopPropagation()">
                
                showMessage('Data downloaded successfully!', 'success');
            } catch (error) {        document.getElementById('personalInfoForm').addEventListener('submit', async (e) => {        document.getElementById('personalInfoForm').addEventListener('submit', async (e) => {        <p id="celebrationMessage" style="color: var(--text-secondary); margin-bottom: 1.5rem;">You've reached a milestone!</p>
                console.error('‚ùå Error downloading data:', error);mary" onclick="closeCelebration()">Awesome!</button>
                showMessage('Failed to download data. Please try again.', 'error');
            }            try {            try {
        };
ument.getElementById('displayName').value,ument.getElementById('displayName').value,id="chatWidget">
        window.deleteAccount = async function() {
            const confirmation = prompt('Type "DELETE" to confirm account deletion:');
            if (confirmation !== 'DELETE') return;       location: document.getElementById('location').value,       location: document.getElementById('location').value,   <i class="fas fa-robot"></i>
         personalInfoUpdated: new Date()         personalInfoUpdated: new Date()     AI College Counselor
            const password = prompt('Enter your password to confirm:');                };                };                <div class="online-indicator"></div>
            if (!password) return;

            try {
                const credential = EmailAuthProvider.credential(currentUser.email, password);                // Update currentUserData                // Update currentUserData            </button>
                await reauthenticateWithCredential(currentUser, credential);bject.assign(currentUserData, personalData);bject.assign(currentUserData, personalData);
                
                // Delete user data from Firestore
                await deleteDoc(doc(db, 'users', currentUser.uid));name;name;
                ay?
                // Delete user account
                await deleteUser(currentUser);
                
                alert('Account deleted successfully. You will be redirected to the home page.');                showMessage('Personal information updated successfully!', 'success');                showMessage('Personal information updated successfully!', 'success');        <div class="chat-input-container">
                window.location.href = 'index.html';
            } catch (error) {                console.error('‚ùå Error updating personal info:', error);                console.error('‚ùå Error updating personal info:', error);                   placeholder="Ask about deadlines, essays, scholarships..." 
                console.error('‚ùå Error deleting account:', error);date personal information. Please try again.', 'error');date personal information. Please try again.', 'error');KeyPress(event)">
                showMessage('Failed to delete account. Please check your password.', 'error');
            }        });        });                <i class="fas fa-paper-plane"></i>
        };
 Handler Handler
        // Personal Info Form Handlerbmit', async (e) => {bmit', async (e) => {
        document.getElementById('personalInfoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
 try { try { class="chat-toggle" id="chatToggle" onclick="toggleChat()">
            try {                const academicData = {                const academicData = {        <i class="fas fa-comments"></i>
                const personalData = {e: document.getElementById('currentGrade').value,e: document.getElementById('currentGrade').value,
                    name: document.getElementById('displayName').value,
                    phone: document.getElementById('phoneNumber').value,nt.getElementById('gpa').value,nt.getElementById('gpa').value,-->
                    dateOfBirth: document.getElementById('dateOfBirth').value,   graduationYear: document.getElementById('graduationYear').value,   graduationYear: document.getElementById('graduationYear').value,otification" id="notification">
                    location: document.getElementById('location').value,ted: new Date()ted: new Date()tent">
                    personalInfoUpdated: new Date()
                };
uid), academicData);uid), academicData);
                await updateDoc(doc(db, 'users', currentUser.uid), personalData);xt">
     // Update currentUserData     // Update currentUserData     <h4 id="notificationTitle">Notification</h4>
                // Update currentUserData                Object.assign(currentUserData, academicData);                Object.assign(currentUserData, academicData);                <p id="notificationMessage">This is a notification message</p>
                Object.assign(currentUserData, personalData);
ss');ss');
                // Update profile name display
                document.getElementById('profileName').textContent = personalData.name;;;
ge('Failed to update academic information. Please try again.', 'error');ge('Failed to update academic information. Please try again.', 'error');
                // Update navbar
                updateAuthUI(currentUser);

                showMessage('Personal information updated successfully!', 'success');
            } catch (error) {ElementById('logoutBtn').addEventListener('click', async (e) => {ElementById('logoutBtn').addEventListener('click', async (e) => {
                console.error('‚ùå Error updating personal info:', error);
                showMessage('Failed to update personal information. Please try again.', 'error');
            }
        });   window.location.href = 'index.html';   window.location.href = 'index.html';div class="footer-socials">
ram">
        // Academic Info Form Handler;;mple-icons/simple-icons/icons/instagram.svg" alt="Instagram">
        document.getElementById('academicInfoForm').addEventListener('submit', async (e) => { } }     </a>
            e.preventDefault();        });        });                <a href="https://x.com/" target="_blank" rel="noopener" aria-label="X (Twitter)">

            try {
                const academicData = {themeToggle').addEventListener('click', () => {themeToggle').addEventListener('click', () => {tiktok.com/" target="_blank" rel="noopener" aria-label="TikTok">
                    currentGrade: document.getElementById('currentGrade').value,ody;ody;://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok">
                    currentSchool: document.getElementById('currentSchool').value,'themeToggle');'themeToggle');
                    gpa: document.getElementById('gpa').value,heme;heme;ref="https://youtube.com/" target="_blank" rel="noopener" aria-label="YouTube">
                    graduationYear: document.getElementById('graduationYear').value, 'dark') { 'dark') {net/gh/simple-icons/simple-icons/icons/youtube.svg" alt="YouTube">
                    academicInfoUpdated: new Date()   newTheme = 'light';   newTheme = 'light';   </a>
                };       body.setAttribute('data-theme', 'light');       body.setAttribute('data-theme', 'light');   </div>
                themeToggle.textContent = 'üåô';                themeToggle.textContent = 'üåô';        </div>
                await updateDoc(doc(db, 'users', currentUser.uid), academicData);

                // Update currentUserData
                Object.assign(currentUserData, academicData);

                showMessage('Academic information updated successfully!', 'success');            localStorage.setItem('theme', newTheme);            localStorage.setItem('theme', newTheme);        import logger from './js/logger.js';
            } catch (error) {me); // <-- Add this lineme); // <-- Add this line
                console.error('‚ùå Error updating academic info:', error);
                showMessage('Failed to update academic information. Please try again.', 'error');
            }e) {e) {'https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js';
        });            const logoImg = document.getElementById('navbarLogo');            const logoImg = document.getElementById('navbarLogo');        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js';
, orderBy, serverTimestamp, deleteDoc, updateDoc, onSnapshot, increment } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js';
        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async (e) => {iteclearcc.png';iteclearcc.png';
            e.preventDefault();
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('‚ùå Error signing out:', error);e loade load8",
            } savedTheme = localStorage.getItem('theme') || 'dark'; savedTheme = localStorage.getItem('theme') || 'dark';ppId: "1:187139654658:web:4a6cf4c43095f03212931b",
        });ocument.body.setAttribute('data-theme', savedTheme);ocument.body.setAttribute('data-theme', savedTheme);   measurementId: "G-E0B2RQM9XS"
        document.getElementById('themeToggle').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';        document.getElementById('themeToggle').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';        };
        // Theme toggle functionalitygo(savedTheme); // <-- Add this linego(savedTheme); // <-- Add this line
        document.getElementById('themeToggle').addEventListener('click', () => {        // Initialize Firebase
            const body = document.body;kgroundkgroundzeApp(firebaseConfig);
            const themeToggle = document.getElementById('themeToggle');
            let newTheme;= document.getElementById('starryBg');= document.getElementById('starryBg');tore(app);
            if (body.getAttribute('data-theme') === 'dark') {
                newTheme = 'light';
                body.setAttribute('data-theme', 'light');            for (let i = 0; i < numberOfStars; i++) {            for (let i = 0; i < numberOfStars; i++) {        window.auth = auth;
                themeToggle.textContent = 'üåô';
            } else {
                newTheme = 'dark';om() * 100 + '%';om() * 100 + '%';
                body.setAttribute('data-theme', 'dark');;;
                themeToggle.textContent = '‚òÄÔ∏è';tar.style.width = Math.random() * 3 + 1 + 'px';tar.style.width = Math.random() * 3 + 1 + 'px';g('üî• Enhanced Firebase Dashboard initialized');
            } star.style.height = star.style.width; star.style.height = star.style.width;
            localStorage.setItem('theme', newTheme);nimationDelay = Math.random() * 3 + 's';nimationDelay = Math.random() * 3 + 's';===========================
            updateNavbarLogo(newTheme); // <-- Add this line                starryBg.appendChild(star);                starryBg.appendChild(star);        // NAVBAR FUNCTIONALITY
        });
        }        }
        function updateNavbarLogo(theme) {
            const logoImg = document.getElementById('navbarLogo');        createStars();        createStars();
            if (!logoImg) return;
            if (theme === 'dark') {
                logoImg.src = 'images/whiteclearcc.png';erverOptions = {erverOptions = { savedTheme = localStorage.getItem('theme') || 'dark';
            } else {
                logoImg.src = 'images/blackcc.png';
            }
        }

        // Initialize theme and logo on page loads.forEach(entry => {s.forEach(entry => {utton(theme) {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.body.setAttribute('data-theme', savedTheme);
        document.getElementById('themeToggle').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';   }   }   themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        updateNavbarLogo(savedTheme); // <-- Add this line   });   });   }
serverOptions);serverOptions);
        // Create starry background
        function createStars() { document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el)); document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el)); function updateLogo(theme) {



















































</html></body>    </script>        }            }                showMessage('Storage service unavailable. Please refresh the page.', 'error');                console.error('‚ùå Firebase Storage connection failed:', error);            } catch (error) {                console.log('‚úÖ Firebase Storage connection successful');                await deleteObject(testRef);                await uploadBytes(testRef, testBlob);                const testBlob = new Blob(['test'], { type: 'text/plain' });                const testRef = ref(storage, 'test-connection.txt');            try {        async function testStorageConnection() {        // Test Firebase Storage connection        console.log('‚úÖ Profile page initialized successfully');        document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el));        }, observerOptions);            });                }                    entry.target.classList.add('visible');                if (entry.isIntersecting) {                       entries.forEach(entry => {        const observer = new IntersectionObserver((entries) => {        };            rootMargin: '0px 0px -50px 0px'            threshold: 0.1,        const observerOptions = {        // Scroll animations        createStars();        }            }                starryBg.appendChild(star);                star.style.animationDelay = Math.random() * 3 + 's';                star.style.height = star.style.width;                star.style.width = Math.random() * 3 + 1 + 'px';                star.style.top = Math.random() * 100 + '%';                star.style.left = Math.random() * 100 + '%';                star.className = 'star';                const star = document.createElement('div');            for (let i = 0; i < numberOfStars; i++) {            const numberOfStars = 100;            const starryBg = document.getElementById('starryBg');


















</html></body>    </script>        }            }                showMessage('Storage service unavailable. Please refresh the page.', 'error');                console.error('‚ùå Firebase Storage connection failed:', error);            } catch (error) {                console.log('‚úÖ Firebase Storage connection successful');                await deleteObject(testRef);                await uploadBytes(testRef, testBlob);                const testBlob = new Blob(['test'], { type: 'text/plain' });                const testRef = ref(storage, 'test-connection.txt');            try {        async function testStorageConnection() {        // Test Firebase Storage connection        console.log('‚úÖ Profile page initialized successfully');


















</html></body>    </script>        }            }                showMessage('Storage service unavailable. Please refresh the page.', 'error');                console.error('‚ùå Firebase Storage connection failed:', error);            } catch (error) {                console.log('‚úÖ Firebase Storage connection successful');                await deleteObject(testRef);                await uploadBytes(testRef, testBlob);                const testBlob = new Blob(['test'], { type: 'text/plain' });                const testRef = ref(storage, 'test-connection.txt');            try {        async function testStorageConnection() {        // Test Firebase Storage connection        console.log('‚úÖ Profile page initialized successfully');            const logo = document.getElementById('ccNavbarLogo');
            if (logo) {
                logo.src = theme === 'dark' ? 'images/whiteclearcc.png' : 'images/blackcc.png';
            }
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
            updateLogo(newTheme);
        }

        // Dropdown Management
        function toggleDropdown() {
            const dropdown = document.getElementById('ccDropdownMenu');
            const container = document.getElementById('ccProfileDropdown');
            
            if (dropdown && container) {
                const isOpen = dropdown.classList.contains('show');
                if (isOpen) {
                    closeDropdown();
                } el            display: flex;px;
                    openDropdown();
                }
            }
        }

        function openDropdown() {
            const dropdown = document.getElementById('ccDropdownMenu');
            const container = document.getElementById('ccProfileDropdown');
            
            if (dropdown && container) {
                dropdown.classList.add('show');
                container.classList.add('open');
            }
        }

        function closeDropdown() {
            const dropdown = document.getElementById('ccDropdownMenu');
            const container = document.getElementById('ccProfileDropdown');
            
            if (dropdown && container) {
                dropdown.classList.remove('show');
                container.classList.remove('open');
            }
        }

        // Load User Data from Firestore
        async function loadNavbarUserData(userId) {
            try {
                const userDoc = await getDoc(doc(db, 'users', userId));
                
                if (userDoc.exists()) {
                    currentUserData = userDoc.data();
                    updateNavbarUI(auth.currentUser);
                } else {
                    currentUserData = {
                        email: auth.currentUser.email,
                        name: auth.currentUser.displayName || ''
                    };
                    updateNavbarUI(auth.currentUser);
                }
            } catch (error) {
                console.error('Error loading navbar user data:', error);
                currentUserData = {
                    email: auth.currentUser.email,
                    name: auth.currentUser.displayName || ''
                };
                updateNavbarUI(auth.currentUser);
            }
        }

        // Update Navbar UI with User Info
        function updateNavbarUI(user) {
            const profileLoading = document.getElementById('ccProfileLoading');
            const profileContent = document.getElementById('ccProfileContent');
            const userAvatar = document.getElementById('ccUserAvatar');
            const profileName = document.getElementById('ccProfileName');
            const dropdownName = document.getElementById('ccDropdownName');
            const dropdownEmail = document.getElementById('ccDropdownEmail');

            if (!user) {
                if (!window.location.pathname.includes('login.html') && 
                    !window.location.pathname.includes('signup.html') &&
                    !window.location.pathname.includes('index.html') &&
                    !window.location.pathname.includes('about.html') &&
                    !window.location.pathname.includes('pricing.html')) {
                    window.location.href = 'login.html';
                }
                return;
            }

            if (profileLoading) profileLoading.style.display = 'none';
            if (profileContent) profileContent.style.display = 'flex';

            if (userAvatar && currentUserData?.profilePhotoURL) {
                userAvatar.src = currentUserData.profilePhotoURL;
            } else if (userAvatar) {
                userAvatar.src = 'images/default-avatar.svg';
            }

            const displayName = currentUserData?.name || user.displayName || user.email.split('@')[0];
            if (profileName) profileName.textContent = displayName;
            if (dropdownName) dropdownName.textContent = displayName;

            if (dropdownEmail) dropdownEmail.textContent = user.email;
        }

        // Logout Function
        async function handleLogout(e) {
            e.preventDefault();
            closeDropdown();
            
            try {
                await signOut(auth);
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Error signing out:', error);
                alert('Error signing out. Please try again.');
            }
        }

        // Event Listeners
        function initEventListeners() {
            const themeToggle = document.getElementById('ccThemeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleTheme);
            }

            const profileButton = document.getElementById('ccProfileButton');
            if (profileButton) {
                profileButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleDropdown();
                });
            }

            const logoutBtn = document.getElementById('ccLogoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }

            document.addEventListener('click', (e) => {
                const dropdown = document.getElementById('ccProfileDropdown');
                if (dropdown && !dropdown.contains(e.target)) {
                    closeDropdown();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeDropdown();
                }
            });
        }

        // Initialize Navbar
        function initNavbar() {
            logger.log('üéØ Initializing College Climb Navbar...');
            
            initTheme();
            
            initEventListeners();
            
            logger.log('‚úÖ Navbar initialized successfully!');
        }

        // Export for global access
        window.CollegeClimbNavbar = {
            toggleTheme,
            openDropdown,
            closeDropdown,
            refresh: () => {
                if (auth.currentUser) {
                    loadNavbarUserData(auth.currentUser.uid);
                }
            }
        };

        // ============================================
        // DASHBOARD FUNCTIONALITY
        // ============================================

        // School database with comprehensive data
        window.schoolDatabase = {
            'Harvard University': {
                acceptance_rate: 3.4,
                avg_gpa: 4.18,
                avg_sat: 1520,
                avg_act: 34,
                tuition: 54269,
                location: 'Cambridge, MA',
                type: 'Private',
                ranking: 2,
                deadline: '2025-01-01'
            },
            'Stanford University': {
                acceptance_rate: 3.9,
                avg_gpa: 4.16,
                avg_sat: 1505,
                avg_act: 33,
                tuition: 56169,
                location: 'Stanford, CA',
                type: 'Private',
                ranking: 3,
                deadline: '2025-01-01'
            },
            'MIT': {
                acceptance_rate: 6.7,
                avg_gpa: 4.17,
                avg_sat: 1535,
                avg_act: 35,
                tuition: 53790,
                location: 'Cambridge, MA',
                type: 'Private',
                ranking: 1,
                deadline: '2025-01-01'
            },
            'UC Berkeley': {
                acceptance_rate: 14.5,
                avg_gpa: 4.0,
                avg_sat: 1415,
                avg_act: 31,
                tuition: 14312,
                location: 'Berkeley, CA',
                type: 'Public',
                ranking: 4,
                deadline: '2024-11-30'
            },
            'Yale University': {
                acceptance_rate: 4.6,
                avg_gpa: 4.14,
                avg_sat: 1515,
                avg_act: 34,
                tuition: 59950,
                location: 'New Haven, CT',
                type: 'Private',
                ranking: 5,
                deadline: '2025-01-01'
            }
        };

        // Function to fetch college data from API if not in database
        async function getCollegeData(collegeName) {
            if (window.schoolDatabase[collegeName]) {
                return window.schoolDatabase[collegeName];
            }

            try {
                const response = await fetch(`/api/college-search?name=${encodeURIComponent(collegeName)}&per_page=1`);

                if (!response.ok) {
                    logger.warn(`Failed to fetch data for ${collegeName}`);
                    return null;
                }

                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    const college = data.results[0];

                    const collegeData = {
                        acceptance_rate: college.admissionRate ? (college.admissionRate * 100) : 10.0,
                        avg_sat: college.avgSAT || 1200,
                        avg_act: college.avgACT || 25,
                        tuition: college.outOfStateTuition || college.inStateTuition || 50000,
                        location: `${college.city}, ${college.state}`,
                        type: college.inStateTuition && college.outOfStateTuition && (college.inStateTuition < college.outOfStateTuition) ? 'Public' : 'Private',
                        deadline: '2025-01-01',
                        website: college.website
                    };

                    window.schoolDatabase[collegeName] = collegeData;
                    logger.log(`‚úÖ Fetched and cached data for ${collegeName}`);

                    return collegeData;
                }
            } catch (error) {
                logger.error('Error fetching college data:', error);
            }

            return {
                acceptance_rate: 10.0,
                avg_gpa: 3.8,
                avg_sat: 1200,
                avg_act: 25,
                tuition: 50000,
                location: 'Unknown',
                type: 'Unknown',
                deadline: '2025-01-01'
            };
        }

        window.getCollegeData = getCollegeData;

        // Offline Detection
        let isOnline = navigator.onLine;
        let offlineBanner = null;

        function showOfflineBanner() {
            if (offlineBanner) return;

            offlineBanner = document.createElement('div');
            offlineBanner.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                color: white;
                padding: 1rem 2rem;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
                z-index: 9998;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                font-weight: 500;
                animation: slideDown 0.3s ease;
            `;
            offlineBanner.innerHTML = `
                <i class="fas fa-wifi-slash"></i>
                <span>You're offline. Some features may not work.</span>
            `;

            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(offlineBanner);
        }

        function hideOfflineBanner() {
            if (offlineBanner) {
                offlineBanner.remove();
                offlineBanner = null;
            }
        }

        window.addEventListener('online', () => {
            isOnline = true;
            hideOfflineBanner();
            showNotification('Success', 'You\'re back online!', 'success');
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            showOfflineBanner();
        });

        if (!isOnline) {
            showOfflineBanner();
        }

        // Auth state management
        onAuthStateChanged(auth, async (user) => {
            logger.log('üë§ Auth state changed:', user ? `User: ${user.email}` : 'No user');

            if (user) {
                document.body.classList.add("logged-in");
                window.currentUser = user;
                await loadUserData(user);
                await loadNavbarUserData(user.uid);
                await initializeDashboard();
            } else {
                document.body.classList.remove("logged-in");
                window.location.href = 'login.html';
            }
        });

        // Load comprehensive user data
        async function loadUserData(user) {
            try {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                
                if (userDoc.exists()) {
                    window.userData = userDoc.data();
                    logger.log('üìä User data loaded:', window.userData);
                    updateWelcomeMessage();
                } else {
                    window.userData = {
                        email: user.email,
                        name: user.displayName || user.email.split('@')[0],
                        createdAt: serverTimestamp(),
                        lastLogin: serverTimestamp()
                    };
                    await setDoc(doc(db, 'users', user.uid), window.userData);
                }
            } catch (error) {
                console.error('‚ùå Error loading user data:', error);
                showNotification('Error', 'Failed to load user data. Please refresh the page.', 'error');
            }
        }

        // Update loading status
        function updateLoadingStatus(message) {
            const statusText = document.getElementById('loadingStatusText');
            if (statusText) {
                statusText.textContent = message;
            }
        }

        // Hide loading overlay
        function hideLoadingOverlay() {
            const overlay = document.getElementById('dashboardLoadingOverlay');
            const container = document.querySelector('.dashboard-container');

            if (overlay) {
                overlay.classList.add('fade-out');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 500);
            }

            if (container) {
                container.style.opacity = '1';
            }
        }

        // Check if user has completed questionnaire
        async function checkQuestionnaireCompletion() {
            console.log('üìã Questionnaire popup disabled by design');
            return true;
        }

        // Navigate to questionnaire
        function goToQuestionnaire() {
            window.location.href = 'questions.html';
        }

        // Navigate to profile
        function goToProfile() {
            window.location.href = 'profile.html';
        }

        // Dismiss questionnaire prompt permanently
        async function dismissQuestionnairePrompt() {
            const modal = document.getElementById('questionnairePromptModal');
            if (modal) {
                modal.style.display = 'none';
            }

            if (window.currentUser) {
                try {
                    await updateDoc(doc(db, 'users', window.currentUser.uid), {
                        questionnairePromptDismissed: true,
                        questionnairePromptDismissedAt: new Date()
                    });
                    console.log('‚úÖ Questionnaire prompt permanently dismissed in Firebase');
                } catch (error) {
                    console.error('Error saving questionnaire prompt dismissal:', error);
                }
            }
        }

        window.goToQuestionnaire = goToQuestionnaire;
        window.goToProfile = goToProfile;
        window.dismissQuestionnairePrompt = dismissQuestionnairePrompt;

        // Initialize dashboard with real data
        async function initializeDashboard() {
            try {
                updateLoadingStatus('Loading your data...');

                await loadApplicationData();

                updateLoadingStatus('Calculating your progress...');

                await calculateRealStats();

                updateLoadingStatus('Generating recommendations...');

                generateSchoolRecommendations();
                createApplicationTimeline();

                updateLoadingStatus('Loading your tasks...');

                loadTasks();
                updateProgressCircle();
                checkDeadlineAlerts();
                generateAIInsights();

                updateLoadingStatus('Almost ready...');

                setTimeout(() => {
                    updateStreakTracker().catch(err => console.error('Streak tracker error:', err));
                    updateWordCounter().catch(err => console.error('Word counter error:', err));
                    updateDocumentTracker().catch(err => console.error('Document tracker error:', err));
                }, 1000);

                setTimeout(() => {
                    hideLoadingOverlay();
                }, 1500);

            } catch (error) {
                console.error('‚ùå Error initializing dashboard:', error);
                hideLoadingOverlay();
                showNotification('Error', 'Failed to load dashboard data. Please refresh the page.', 'error');
            }
        }

        // Load real application data
        async function loadApplicationData() {
            try {
                const userId = window.currentUser.uid;
                
                const targetSchools = window.userData?.questionnaire?.targetSchools || [];
                
                if (targetSchools.length === 0) {
                    await createDefaultApplications(userId);
                }
                
                const appsQuery = query(
                    collection(db, 'applications'),
                    where('userId', '==', userId)
                );
                
                const querySnapshot = await getDocs(appsQuery);
                window.applicationData = [];
                
                querySnapshot.forEach((doc) => {
                    window.applicationData.push({ id: doc.id, ...doc.data() });
                });
                
                logger.log('üìã Application data loaded:', window.applicationData);
                
            } catch (error) {
                console.error('‚ùå Error loading application data:', error);
            }
        }

        // Create applications based on user's target schools
        async function createDefaultApplications(userId) {
            const targetSchools = window.userData?.questionnaire?.targetSchools || [
                'Harvard University', 'Stanford University', 'MIT', 'UC Berkeley', 'Yale University'
            ];
            
            const statusOptions = ['not-started', 'in-progress', 'submitted', 'completed'];
            
            for (const schoolName of targetSchools) {
                const schoolData = window.schoolDatabase[schoolName] || {
                    deadline: '2025-01-01',
                    acceptance_rate: 10.0,
                    avg_gpa: 3.8
                };
                
                const randomStatus = statusOptions[Math.floor(Math.random() * statusOptions.length)];
                
                await addDoc(collection(db, 'applications'), {
                    userId: userId,
                    schoolName: schoolName,
                    deadline: schoolData.deadline,
                    status: randomStatus,
                    createdAt: serverTimestamp(),
                    essayCount: Math.floor(Math.random() * 5) + 1,
                    supplementsComplete: Math.random() > 0.5,
                    recommendationsCount: Math.floor(Math.random() * 4),
                    lastUpdated: serverTimestamp()
                });
            }
            
            logger.log('üìù Created default applications for target schools');
        }

        // Calculate real statistics from user data
        async function calculateRealStats() {
            try {
                const userId = window.currentUser.uid;
                
                const applicationCount = window.applicationData?.length || 0;
                document.getElementById('applicationsCount').textContent = applicationCount;
                
                let essayCount = 0;
                if (window.applicationData) {
                    essayCount = window.applicationData.reduce((total, app) => {
                        return total + (app.essayCount || 0);
                    }, 0);
                }
                if (window.userData?.questionnaire?.essayText || window.userData?.questionnaire?.essayFileURL) {
                    essayCount += 1;
                }
                document.getElementById('essaysCount').textContent = essayCount;
                
                const scholarshipValue = calculateScholarshipPotential();
                document.getElementById('scholarshipAmount').textContent = `$${Math.round(scholarshipValue / 1000)}K`;
                
                const overallProgress = calculateOverallProgress();
                document.getElementById('overallProgress').textContent = `${overallProgress}%`;
                
                updateTrends();
                
                logger.log('üìä Real stats calculated and displayed');
                
            } catch (error) {
                console.error('‚ùå Error calculating stats:', error);
            }
        }

        // Calculate scholarship potential based on user profile
        function calculateScholarshipPotential() {
            let baseAmount = 5000;
            
            const questionnaire = window.userData?.questionnaire;
            if (!questionnaire) return baseAmount;
            
            const gpa = parseFloat(questionnaire.unweightedGPA || window.userData.gpa || 3.0);
            if (gpa >= 3.8) baseAmount += 15000;
            else if (gpa >= 3.5) baseAmount += 10000;
            else if (gpa >= 3.0) baseAmount += 5000;
            
            const satScore = extractSATScore(questionnaire.testScores);
            const actScore = extractACTScore(questionnaire.testScores);
            
            if (satScore >= 1450 || actScore >= 32) baseAmount += 20000;
            else if (satScore >= 1350 || actScore >= 29) baseAmount += 12000;
            else if (satScore >= 1250 || actScore >= 26) baseAmount += 8000;
            
            if (questionnaire.financialAid?.includes('need-aid')) {
                baseAmount += 25000;
            }
            
            if (questionnaire.specialConsiderations?.includes('first-generation')) {
                baseAmount += 10000;
            }
            
            if (questionnaire.extracurriculars?.includes('student-government')) {
                baseAmount += 5000;
            }
            
            return Math.min(baseAmount, 75000);
        }

        // Calculate overall progress
        function calculateOverallProgress() {
            if (!window.applicationData || window.applicationData.length === 0) {
                return 0;
            }
            
            let totalTasks = 0;
            let completedTasks = 0;
            
            window.applicationData.forEach(app => {
                totalTasks += 5;
                
                if (app.status === 'submitted' || app.status === 'completed') {
                    completedTasks += 5;
                } else if (app.status === 'in-progress') {
                    completedTasks += 2;
                } else if (app.status === 'not-started') {
                    completedTasks += 0;
                }
            });
            
            totalTasks += 1;
            if (window.userData?.questionnaire) {
                completedTasks += 1;
            }
            
            return Math.round((completedTasks / totalTasks) * 100);
        }

        // Generate AI-powered school recommendations
        function generateSchoolRecommendations() {
            const schoolGrid = document.getElementById('schoolGrid');
            schoolGrid.innerHTML = '';
            
            const userProfile = window.userData?.questionnaire || {};
            const userGPA = parseFloat(userProfile.unweightedGPA || 3.5);
            const userSAT = extractSATScore(userProfile.testScores) || 1200;
            
            const targetSchools = userProfile.targetSchools || Object.keys(window.schoolDatabase).slice(0, 5);
            
            targetSchools.forEach(schoolName => {
                const school = window.schoolDatabase[schoolName];
                if (!school) {
                    console.warn(`School not found in database: ${schoolName}`);
                    return;
                }
                
                const matchPercentage = calculateMatchPercentage(userGPA, userSAT, school);
                
                const schoolCard = createSchoolCard(schoolName, school, matchPercentage);
                schoolGrid.appendChild(schoolCard);
            });
        }

        // Calculate how well user matches with school
        function calculateMatchPercentage(userGPA, userSAT, school) {
            let score = 0;
            
            const gpaRatio = userGPA / school.avg_gpa;
            score += Math.min(gpaRatio * 40, 40);
            
            const satRatio = userSAT / school.avg_sat;
            score += Math.min(satRatio * 35, 35);
            
            if (school.acceptance_rate > 10) score += 25;
            else if (school.acceptance_rate > 5) score += 15;
            else score += 10;
            
            return Math.min(Math.round(score), 95);
        }

        // Create school card element
        function createSchoolCard(schoolName, school, matchPercentage) {
            const card = document.createElement('div');
            card.className = 'school-card';
            card.style.cursor = 'pointer';
            card.style.position = 'relative';

            let matchColor = '#ef4444';
            let matchLabel = 'Reach';
            if (matchPercentage >= 75) {
                matchColor = '#10b981';
                matchLabel = 'Safety';
            } else if (matchPercentage >= 60) {
                matchColor = '#f59e0b';
                matchLabel = 'Target';
            }

            card.innerHTML = `
                <div class="match-percentage" style="background-color: ${matchColor}">
                    ${matchPercentage}%
                    <div style="font-size: 0.7rem; margin-top: 0.1rem;">${matchLabel}</div>
                </div>
                <h3 class="school-name">${schoolName}</h3>
                <div class="school-details">
                    <div class="school-detail">
                        <span class="detail-label">Acceptance Rate</span>
                        <span class="detail-value">${school.acceptance_rate}%</span>
                    </div>
                    <div class="school-detail">
                        <span class="detail-label">Avg GPA</span>
                        <span class="detail-value">${school.avg_gpa}</span>
                    </div>
                    <div class="school-detail">
                        <span class="detail-label">Avg SAT</span>
                        <span class="detail-value">${school.avg_sat}</span>
                    </div>
                    <div class="school-detail">
                        <span class="detail-label">Location</span>
                        <span class="detail-value">${school.location}</span>
                    </div>
                    <div class="school-detail">
                        <span class="detail-label">Deadline</span>
                        <span class="detail-value">${new Date(school.deadline).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
                    </div>
                </div>
                <div class="school-card-actions" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(160, 123, 204, 0.1); display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button class="btn btn-primary view-profile-btn" style="flex: 1; padding: 0.6rem 1rem; font-size: 0.85rem;">
                        View Profile
                    </button>
                    <button class="btn btn-secondary add-to-list-btn" style="padding: 0.6rem 1rem; font-size: 0.85rem;">
                        ‚ûï Add
                    </button>
                </div>
            `;

            const viewProfileBtn = card.querySelector('.view-profile-btn');
            const addToListBtn = card.querySelector('.add-to-list-btn');

            viewProfileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                openCollegeProfile(schoolName);
            });

            addToListBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                addToApplicationList(schoolName);
            });

            card.addEventListener('click', () => showSchoolDetails(schoolName, school, matchPercentage));
            return card;
        }

        // Create application timeline
        async function createApplicationTimeline() {
            const timeline = document.getElementById('applicationTimeline');
            const loadingEl = document.getElementById('timelineLoading');

            if (!timeline) {
                console.error('‚ùå Timeline element not found');
                return;
            }

            timeline.innerHTML = '';
            if (loadingEl) loadingEl.style.display = 'block';

            try {
                const targetSchools = window.userData?.questionnaire?.targetSchools || [];
                
                if (!targetSchools || targetSchools.length === 0) {
                    if (loadingEl) loadingEl.style.display = 'none';
                    timeline.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            <i class="fas fa-calendar-plus" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <p style="font-size: 1.1rem;">No target schools yet!</p>
                            <p style="margin-top: 0.5rem;">Add schools in your profile to see your personalized timeline.</p>
                            <a href="profile.html" class="btn btn-primary" style="margin-top: 1rem; text-decoration: none; display: inline-flex;">
                                üìù Update Profile
                            </a>
                        </div>
                    `;
                    return;
                }

                const timelineItems = [];

                for (const schoolName of targetSchools) {
                    let schoolData = window.schoolDatabase[schoolName];
                    
                    if (!schoolData) {
                        schoolData = await getCollegeData(schoolName);
                    }

                    if (!schoolData) {
                        console.warn(`‚ö†Ô∏è Could not load data for ${schoolName}`);
                        continue;
                    }

                    const deadline = new Date(schoolData.deadline);
                    const now = new Date();
                    const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));

                    const milestones = [
                        {
                            date: new Date(deadline.getTime() - (60 * 24 * 60 * 60 * 1000)),
                            title: `Start ${schoolName} Application`,
                            description: 'Begin working on your application materials',
                            tasks: [
                                { id: `${schoolName}-start`, text: 'Create account on college portal', completed: false },
                                { id: `${schoolName}-requirements`, text: 'Review all application requirements', completed: false },
                                { id: `${schoolName}-essay-topics`, text: 'Read essay prompts and brainstorm ideas', completed: false }
                            ],
                            status: daysUntil > 60 ? 'upcoming' : daysUntil > 0 ? 'in-progress' : 'overdue'
                        },
                        {
                            date: new Date(deadline.getTime() - (30 * 24 * 60 * 60 * 1000)),
                            title: `${schoolName} Essays & Writing`,
                            description: 'Complete all required essays and personal statements',
                            tasks: [
                                { id: `${schoolName}-personal-statement`, text: 'Draft personal statement', completed: false },
                                { id: `${schoolName}-supplements`, text: 'Write supplemental essays', completed: false },
                                { id: `${schoolName}-essay-review`, text: 'Get essays reviewed and edited', completed: false }
                            ],
                            status: daysUntil > 30 ? 'upcoming' : daysUntil > 0 ? 'in-progress' : 'overdue'
                        },
                        {
                            date: deadline,
                            title: `${schoolName} Submission Deadline`,
                            description: `Final deadline: ${deadline.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`,
                            tasks: [
                                { id: `${schoolName}-submit`, text: 'Submit application before deadline', completed: false },
                                { id: `${schoolName}-confirm`, text: 'Verify submission confirmation email', completed: false },
                                { id: `${schoolName}-portal`, text: 'Check application portal for missing items', completed: false }
                            ],
                            status: daysUntil > 0 ? 'deadline' : 'overdue',
                            isDeadline: true
                        }
                    ];

                    timelineItems.push(...milestones.map(m => ({
                        ...m,
                        school: schoolName,
                        daysUntil: Math.ceil((m.date - now) / (1000 * 60 * 60 * 24))
                    })));
                }

                timelineItems.sort((a, b) => a.date - b.date);
                const savedTasks = await loadTimelineTasks();

                timelineItems.slice(0, 12).forEach((item, index) => {
                    if (savedTasks[item.school]) {
                        item.tasks = item.tasks.map(task => ({
                            ...task,
                            completed: savedTasks[item.school][task.id] || false
                        }));
                    }

                    const timelineItem = createEnhancedTimelineItem(item, index);
                    timeline.appendChild(timelineItem);
                });

                if (loadingEl) loadingEl.style.display = 'none';

            } catch (error) {
                console.error('‚ùå Error creating timeline:', error);
                if (loadingEl) loadingEl.style.display = 'none';
                timeline.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--danger-color);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <p>Failed to load timeline. Please refresh the page.</p>
                    </div>
                `;
            }
        }

        function createEnhancedTimelineItem(event, index) {
            const item = document.createElement('div');
            item.className = 'timeline-item';

            let statusColor = event.isDeadline ? 'var(--danger-color)' :
                            event.status === 'in-progress' ? 'var(--warning-color)' : 'var(--info-color)';
            let statusIcon = event.isDeadline ? 'fas fa-flag-checkered' :
                           event.status === 'in-progress' ? 'fas fa-tasks' : 'fas fa-clock';

            const completedTasks = event.tasks.filter(t => t.completed).length;
            const totalTasks = event.tasks.length;
            const completionPercentage = Math.round((completedTasks / totalTasks) * 100);
            const isFullyCompleted = completedTasks === totalTasks;

            const tasksHTML = event.tasks.map(task => `
                <div class="timeline-task ${task.completed ? 'completed' : ''}" data-task-id="${task.id}" data-school="${event.school}">
                    <input type="checkbox"
                           class="timeline-task-checkbox"
                           ${task.completed ? 'checked' : ''}
                           onchange="toggleTimelineTask('${event.school}', '${task.id}', this.checked)">
                    <span class="timeline-task-text">${task.text}</span>
                </div>
            `).join('');

            item.innerHTML = `
                <div class="timeline-content ${isFullyCompleted ? 'completed' : ''}">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <span class="timeline-school-tag">
                            <i class="fas fa-university"></i>
                            ${event.school}
                        </span>
                        ${event.daysUntil >= 0 ?
                            `<span style="font-size: 0.85rem; color: ${event.daysUntil <= 7 ? 'var(--danger-color)' : 'var(--text-secondary)'}; font-weight: 600;">
                                ${event.daysUntil} days left
                            </span>` :
                            `<span style="font-size: 0.85rem; color: var(--danger-color); font-weight: 600;">
                                Overdue
                            </span>`
                        }
                    </div>
                    <div class="timeline-date">${event.date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</div>
                    <div class="timeline-title">${event.title}</div>
                    <div class="timeline-description">${event.description}</div>
                    <div style="margin-top: 1rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.85rem; color: var(--text-secondary); font-weight: 600;">Tasks to Complete:</span>
                        <span style="font-size: 0.85rem; color: ${isFullyCompleted ? 'var(--success-color)' : 'var(--accent-color)'}; font-weight: 700;">
                            ${completedTasks}/${totalTasks} Complete (${completionPercentage}%)
                        </span>
                    </div>
                    <div class="timeline-checklist">
                        ${tasksHTML}
                    </div>
                </div>
                <div class="timeline-icon" style="background: ${statusColor}">
                    <i class="${statusIcon}"></i>
                </div>
            `;

            return item;
        }

        async function loadTimelineTasks() {
            try {
                const userId = window.currentUser.uid;
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
                return userData?.timelineTasks || {};
            } catch (error) {
                console.error('Error loading timeline tasks:', error);
                return {};
            }
        }

        window.toggleTimelineTask = async function(school, taskId, completed) {
            try {
                const userId = window.currentUser.uid;
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
                const timelineTasks = userData?.timelineTasks || {};

                if (!timelineTasks[school]) {
                    timelineTasks[school] = {};
                }

                timelineTasks[school][taskId] = completed;

                await updateDoc(doc(db, 'users', userId), {
                    timelineTasks: timelineTasks,
                    lastTimelineUpdate: new Date()
                });

                const taskElement = document.querySelector(`[data-task-id="${taskId}"][data-school="${school}"]`);
                if (taskElement) {
                    if (completed) {
                        taskElement.classList.add('completed');
                    } else {
                        taskElement.classList.remove('completed');
                    }
                }

                const timelineContent = taskElement.closest('.timeline-content');
                const allTasks = timelineContent.querySelectorAll('.timeline-task');
                const allCompleted = Array.from(allTasks).every(t => t.classList.contains('completed'));

                if (allCompleted) {
                    timelineContent.classList.add('completed');
                    showNotification('Great Progress!', 'All tasks completed for this milestone!', 'success');
                } else {
                    timelineContent.classList.remove('completed');
                }

                updateProgressCircle();

            } catch (error) {
                console.error('Error toggling timeline task:', error);
                showNotification('Error', 'Failed to update task. Please try again.', 'error');
            }
        };

        // Load and display tasks
        function loadTasks() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            const tasks = generatePersonalizedTasks();
            
            tasks.forEach(task => {
                const taskItem = createTaskItem(task);
                taskList.appendChild(taskItem);
            });
        }

        // Generate personalized tasks based on user data
        function generatePersonalizedTasks() {
            const tasks = [];
            const questionnaire = window.userData?.questionnaire || {};
            const applications = window.applicationData || [];
            
            if (applications.some(app => app.status === 'not-started')) {
                tasks.push({
                    title: 'Complete college applications',
                    due: 'Due in 15 days',
                    priority: 'high',
                    completed: false
                });
            }
            
            if (!questionnaire.essayText && !questionnaire.essayFileURL) {
                tasks.push({
                    title: 'Write personal statement',
                    due: 'Due in 10 days',
                tasks.push({re.resumeStarted || questionnaire.resumeStarted === 'no') {
                    due: 'Due in 7 days', for applications',
                    priority: 'medium',
                }); completed: false
            }
                    due: 'Due in 30 days', application',naire.resumeStarted === 'no') {
                    priority: 'high',m() > 0.5 letters',
                    completed: falseesume for applications',
                });stionnaire.financialAid?.includes('need-aid')) {
            }       priority: 'medium',
                    completed: false
            tasks.push({
                title: 'Schedule college interviews',
                due: 'Due in 25 days',
                priority: 'low',
                completed: Math.random() > 0.7 letters',
            }); due: 'Due in 20 days',
                priority: 'medium',
            return tasks.slice(0, 5);m() > 0.5
        }   });
            
        // Create task item elementcialAid?.includes('need-aid')) {
        function createTaskItem(task) {
            const item = document.createElement('div');,
            item.className = 'task-item';,
            if (task.completed) item.classList.add('completed');
                    completed: false
            item.innerHTML = `
                <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} 
                       onchange="toggleTask(this)">
                <div class="task-content">
                    <div class="task-title" style="${task.completed ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${task.title}</div>
                    <div class="task-due">${task.due}</div>
                </div>ty: 'low',
                <div class="task-priority ${task.priority}"></div>
            `;;
            
            return item;.slice(0, 5);
        }

        // Update progress circle with real data
        function updateProgressCircle() {
            const progress = calculateOverallProgress();
            const circumference = 2 * Math.PI * 60;
            const offset = circumference - (progress / 100) * circumference;
            
            const progressCircle = document.getElementById('progressCircle');
            const progressText = document.getElementById('progressText');eted ? 'checked' : ''} 
                       onchange="toggleTask(this)">
            if (progressCircle && progressText) {
                progressCircle.style.strokeDashoffset = offset;eted ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${task.title}</div>
                progressText.textContent = `${progress}%`;>
                </div>
                setTimeout(() => {riority ${task.priority}"></div>
                    progressCircle.style.transition = 'stroke-dashoffset 2s ease-in-out';
                }, 500);
            }eturn item;
        }

        // AI Insights Generation with real data
        async function generateAIInsights() {
            const insightsContainer = document.getElementById('aiInsights');
            if (!insightsContainer) { Math.PI * 60;
                console.warn('‚ö†Ô∏è AI Insights container not found');mference;
                return;
            }onst progressCircle = document.getElementById('progressCircle');
            const progressText = document.getElementById('progressText');
            insightsContainer.innerHTML = '<div class="loading"></div>';
            if (progressCircle && progressText) {
            try {rogressCircle.style.strokeDashoffset = offset;
                const insights = [];tent = `${progress}%`;
                const now = new Date();
                const targetSchools = window.userData?.questionnaire?.targetSchools || [];
                const userName = window.userData?.name || window.userData?.firstName || 'there';
                }, 500);
                insights.push({
                    icon: 'üëã',
                    text: `Welcome ${userName}! Here are your personalized insights.`,
                    type: 'positive'
                });ion generateAIInsights() {
            const insightsContainer = document.getElementById('aiInsights');
                let hasDeadlines = false;
                for (const schoolName of targetSchools) {t found');
                    let school = window.schoolDatabase?.[schoolName];
                    
                    if (!school) {
                        school = await getCollegeData(schoolName);div>';
                    }
            try {
                    if (school) {[];
                        const deadline = new Date(school.deadline);
                        const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
                const userName = window.userData?.name || window.userData?.firstName || 'there';
                        if (daysUntil > 0 && daysUntil <= 30) {
                            hasDeadlines = true;
                            insights.push({
                                icon: '‚è∞',ame}! Here are your personalized insights.`,
                                text: `${schoolName} deadline in ${daysUntil} days! ${daysUntil <= 7 ? 'Urgent action needed.' : 'Start preparing now.'}`,
                                type: daysUntil <= 7 ? 'urgent' : 'warning'
                            });
                        }adlines = false;
                    }const schoolName of targetSchools) {
                }   let school = window.schoolDatabase?.[schoolName];
                    
                const userGPA = parseFloat(window.userData?.questionnaire?.unweightedGPA || window.userData?.gpa || 0);
                if (userGPA >= 3.8) {t getCollegeData(schoolName);
                    insights.push({
                        icon: 'üåü',
                        text: `Your ${userGPA.toFixed(2)} GPA is excellent! You're competitive for highly selective schools.`,
                        type: 'positive' new Date(school.deadline);
                    }); const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
                } else if (userGPA >= 3.5) {
                    insights.push({il > 0 && daysUntil <= 30) {
                        icon: 'üìö',lines = true;
                        text: `Your ${userGPA.toFixed(2)} GPA is strong. Apply to a mix of reach and target schools.`,
                        type: 'normal''‚è∞',
                    });         text: `${schoolName} deadline in ${daysUntil} days! ${daysUntil <= 7 ? 'Urgent action needed.' : 'Start preparing now.'}`,
                } else if (userGPA > 0) {sUntil <= 7 ? 'urgent' : 'warning'
                    insights.push({
                        icon: 'üí™',
                        text: `GPA: ${userGPA.toFixed(2)}. Emphasize your strengths in extracurriculars and essays!`,
                        type: 'normal'
                    });
                }onst userGPA = parseFloat(window.userData?.questionnaire?.unweightedGPA || window.userData?.gpa || 0);
                if (userGPA >= 3.8) {
                const progress = calculateOverallProgress();
                if (progress >= 75) {
                    insights.push({ ${userGPA.toFixed(2)} GPA is excellent! You're competitive for highly selective schools.`,
                        icon: 'üöÄ',tive'
                        text: `${progress}% complete! You're on track. Keep up the momentum!`,
                        type: 'positive'5) {
                    });ights.push({
                } else if (progress >= 50) {
                    insights.push({ ${userGPA.toFixed(2)} GPA is strong. Apply to a mix of reach and target schools.`,
                        icon: '‚è≥',mal'
                        text: `${progress}% done. Good progress! Stay focused on timeline tasks.`,
                        type: 'normal') {
                    });ights.push({
                } else if (progress > 0) {
                    insights.push({ ${userGPA.toFixed(2)}. Emphasize your strengths in extracurriculars and essays!`,
                        icon: '‚ö°',mal'
                        text: `${progress}% complete. Time to accelerate! Focus on timeline tasks.`,
                        type: 'urgent'
                    });
                }onst progress = calculateOverallProgress();
                if (progress >= 75) {
                const questionnaire = window.userData?.questionnaire || {};
                if (!questionnaire.intendedMajor) {
                    insights.push({ogress}% complete! You're on track. Keep up the momentum!`,
                        icon: 'üìù',tive'
                        text: 'Add your intended major to get better school recommendations.',
                        type: 'normal' 50) {
                    });ights.push({
                }       icon: '‚è≥',
                        text: `${progress}% done. Good progress! Stay focused on timeline tasks.`,
                if (targetSchools.length === 0) {
                    insights.push({
                        icon: 'üè´', > 0) {
                        text: 'Add target schools to start tracking deadlines and building your timeline!',
                        type: 'urgent'
                    }); text: `${progress}% complete. Time to accelerate! Focus on timeline tasks.`,
                } else if (targetSchools.length < 5) {
                    insights.push({
                        icon: 'üìã',
                        text: `You have ${targetSchools.length} schools. Consider adding more (8-12 recommended).`,
                        type: 'normal'window.userData?.questionnaire || {};
                    });estionnaire.intendedMajor) {
                }   insights.push({
                        icon: 'üìù',
                insightsContainer.innerHTML = insights.slice(0, 6).map(insight => `ndations.',
                    <div class="insight-card ${insight.type}">
                        <div class="insight-icon">${insight.icon}</div>
                        <div class="insight-text">${insight.text}</div>
                    </div>
                `).join('');hools.length === 0) {
                    insights.push({
            } catch (error) { 'üè´',
                console.error('‚ùå Error generating insights:', error);eadlines and building your timeline!',
                insightsContainer.innerHTML = `
                    <div class="insight-card">
                        <div class="insight-icon">‚ö†Ô∏è</div>
                        <div class="insight-text">Unable to load insights. Please refresh the page.</div>
                    </div>on: 'üìã',
                `;      text: `You have ${targetSchools.length} schools. Consider adding more (8-12 recommended).`,
            }           type: 'normal'
        }           });
                        border: 3px solid white;
        // College Profile Navigation
        window.openCollegeProfile = function(schoolName) {ce(0, 6).map(insight => `
            sessionStorage.setItem('selectedCollege', schoolName);
            window.location.href = `collegesearch.html?college=${encodeURIComponent(schoolName)}`;
        };              <div class="insight-text">${insight.text}</div>
                    </div>
        // Add School to Application List
        window.addToApplicationList = async function(schoolName) {
            try {ch (error) {
                const userId = window.currentUser.uid;ghts:', error);
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
                const questionnaire = userData?.questionnaire || {};
                        <div class="insight-text">Unable to load insights. Please refresh the page.</div>
                let targetSchools = questionnaire.targetSchools || [];
                `;
                if (targetSchools.includes(schoolName)) {
                    showNotification('Already Added', `${schoolName} is already in your application list!`, 'info');
                    return;
                }e Profile Navigation
        window.openCollegeProfile = function(schoolName) {
                targetSchools.push(schoolName);lege', schoolName);
            window.location.href = `collegesearch.html?college=${encodeURIComponent(schoolName)}`;
                await updateDoc(doc(db, 'users', userId), {
                    'questionnaire.targetSchools': targetSchools,
                    lastUpdated: new Date()
                });oApplicationList = async function(schoolName) {
            try {
                if (!window.userData.questionnaire) window.userData.questionnaire = {};
                window.userData.questionnaire.targetSchools = targetSchools;
                const userData = userDoc.data();
                showNotification('School Added!', `${schoolName has been added to your application list!`, 'success');

                setTimeout(() => {= questionnaire.targetSchools || [];
                    createApplicationTimeline();
                }, 1000);tSchools.includes(schoolName)) {
                    showNotification('Already Added', `${schoolName} is already in your application list!`, 'info');
            } catch (error) {
                console.error('Error adding school:', error);
                showNotification('Error', 'Failed to add school. Please try again.', 'error');
            }   targetSchools.push(schoolName);
        };
                await updateDoc(doc(db, 'users', userId), {
        // Check for upcoming deadlines and show alertsetSchools,
        function checkDeadlineAlerts() {e()
            if (!window.applicationData) return;
            
            const now = new Date();a.questionnaire) window.userData.questionnaire = {};
            const urgentDeadlines = window.applicationData.filter(app => {s;
                const deadline = new Date(app.deadline);
                const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24)); application list!`, 'success');
                return daysUntil <= 7 && daysUntil > 0 && app.status !== 'submitted';
            }); setTimeout(() => {
                    createApplicationTimeline();
            if (urgentDeadlines.length > 0) {
                const alertBanner = document.getElementById('alertBanner');
                const alertText = document.getElementById('alertText');
                console.error('Error adding school:', error);
                const school = urgentDeadlines[0];to add school. Please try again.', 'error');
                const deadline = new Date(school.deadline);
                const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
                
                alertText.textContent = `${school.schoolName} application due in ${daysUntil} day${daysUntil !== 1 ? 's' : ''}!`;
                alertBanner.classList.add('show');
            }f (!window.applicationData) return;
        }   
            const now = new Date();
        // Update welcome message with personalizationData.filter(app => {
        function updateWelcomeMessage() {(app.deadline);
            const welcomeTitle = document.getElementById('welcomeTitle'); * 60 * 24));
            const welcomeMessage = document.getElementById('welcomeMessage');mitted';
            const userData = window.userData;
            
            if (userData?.name) {ength > 0) {
                welcomeTitle.textContent = `Welcome back, ${userData.name}!`;
            }   const alertText = document.getElementById('alertText');
                
            const questionnaire = userData?.questionnaire;
            if (questionnaire?.intendedMajor && questionnaire?.targetSchools?.length > 0) {
                const major = questionnaire.intendedMajor;w) / (1000 * 60 * 60 * 24));
                const topSchool = questionnaire.targetSchools[0];
                welcomeMessage.textContent = `Ready to advance your ${major} journey at ${topSchool} and other top schools?`;}!`;
            } else if (questionnaire?.intendedMajor) {
                welcomeMessage.textContent = `Let's make your ${questionnaire.intendedMajor} dreams a reality with AI-powered guidance`;
            } else {
                welcomeMessage.textContent = 'Your personalized college application command center powered by AI';
            }date welcome message with personalization
        }unction updateWelcomeMessage() {
            const welcomeTitle = document.getElementById('welcomeTitle');
        // Update trend indicators document.getElementById('welcomeMessage');
        function updateTrends() {ow.userData;
            const applicationsTrend = document.getElementById('applicationsTrend');
            const essaysTrend = document.getElementById('essaysTrend');
            const scholarshipTrend = document.getElementById('scholarshipTrend');
            const progressTrend = document.getElementById('progressTrend');
            
            const recentApplications = window.applicationData?.filter(app => {
                const weekAgo = new Date();r && questionnaire?.targetSchools?.length > 0) {
                weekAgo.setDate(weekAgo.getDate() - 7);or;
                return new Date(app.lastUpdated?.toDate?.() || app.createdAt?.toDate?.() || Date.now()) > weekAgo;
            }).length || 0;age.textContent = `Ready to advance your ${major} journey at ${topSchool} and other top schools?`;
            } else if (questionnaire?.intendedMajor) {
            applicationsTrend.textContent = `+${recentApplications} this week`;ntendedMajor} dreams a reality with AI-powered guidance`;
            essaysTrend.textContent = 'In review';
            scholarshipTrend.textContent = 'New matches';alized college application command center powered by AI';
            progressTrend.textContent = 'On track';
        }

        // Utility functions for extracting test scores
        function extractSATScore(testScores) {
            if (!testScores) return null;ument.getElementById('applicationsTrend');
            const match = testScores.match(/SAT:?\s*(\d+)/i);ysTrend');
            return match ? parseInt(match[1]) : null;entById('scholarshipTrend');
        }   const progressTrend = document.getElementById('progressTrend');
            
        function extractACTScore(testScores) {applicationData?.filter(app => {
            if (!testScores) return null;);
            const match = testScores.match(/ACT:?\s*(\d+)/i);
            return match ? parseInt(match[1]) : null;te?.() || app.createdAt?.toDate?.() || Date.now()) > weekAgo;
        }   }).length || 0;
            
        // ========================================entApplications} this week`;
        // NEW INTERACTIVE FEATURES = 'In review';
        // ========================================ches';
            progressTrend.textContent = 'On track';
        // Streak Tracker
        async function updateStreakTracker() {
            try {y functions for extracting test scores
                if (!window.currentUser) {s) {
                    logger.log('No user logged in, skipping streak tracker');
                    return;estScores.match(/SAT:?\s*(\d+)/i);
                }n match ? parseInt(match[1]) : null;
        }
                const userId = window.currentUser.uid;
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
            const match = testScores.match(/ACT:?\s*(\d+)/i);
                if (!userData) {Int(match[1]) : null;
                    logger.log('No user data found');
                    return;
                }==================================
        // NEW INTERACTIVE FEATURES
                const today = new Date().toDateString();
                const lastLogin = userData?.lastLoginDate;
                const streak = userData?.loginStreak || 0;
        async function updateStreakTracker() {
                let newStreak = streak;
                if (!window.currentUser) {
                if (lastLogin !== today) {gged in, skipping streak tracker');
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayStr = yesterday.toDateString();
                const userId = window.currentUser.uid;
                    if (lastLogin === yesterdayStr) {'users', userId));
                        newStreak = streak + 1;;
                    } else {
                        newStreak = 1;
                    }ogger.log('No user data found');
                    return;
                    await updateDoc(doc(db, 'users', userId), {
                        lastLoginDate: today,
                        loginStreak: newStreakeString();
                    });astLogin = userData?.lastLoginDate;
                const streak = userData?.loginStreak || 0;
                    if (newStreak > streak && newStreak % 7 === 0) {
                        celebrate('üî• Week Streak!', `Amazing! You've logged in ${newStreak} days in a row!`);
                    }
                }f (lastLogin !== today) {
                    const yesterday = new Date();
                if (newStreak >= 3) {(yesterday.getDate() - 1);
                    document.getElementById('streakTracker').style.display = 'flex';
                    document.getElementById('streakDays').textContent = newStreak;
                }   if (lastLogin === yesterdayStr) {
            } catch (error) {reak = streak + 1;
                console.error('Error updating streak:', error);
            }           newStreak = 1;
        }           }

        // Word Counter and Essay Progress, 'users', userId), {
        async function updateWordCounter() {,
            try {       loginStreak: newStreak
                const wordsTodayEl = document.getElementById('wordsToday');
                const wordProgressEl = document.getElementById('wordProgressFill');
                const wordPercentageEl = document.getElementById('wordPercentage');
                        celebrate('üî• Week Streak!', `Amazing! You've logged in ${newStreak} days in a row!`);
                if (!wordsTodayEl || !wordProgressEl || !wordPercentageEl) {
                    console.warn('‚ö†Ô∏è Word counter elements not found');
                    return;
                }f (newStreak >= 3) {
                    document.getElementById('streakTracker').style.display = 'flex';
                if (!window.currentUser) {d('streakDays').textContent = newStreak;
                    wordsTodayEl.textContent = '0';
                    wordProgressEl.style.width = '0%';
                    wordPercentageEl.textContent = '0%';error);
                    return;
                }

                const userId = window.currentUser.uid;
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
                const wordsTodayEl = document.getElementById('wordsToday');
                const today = new Date().toDateString();ntById('wordProgressFill');
                const wordsToday = userData?.wordsWrittenToday || 0;rdPercentage');
                const lastWordUpdate = userData?.lastWordUpdate;
                if (!wordsTodayEl || !wordProgressEl || !wordPercentageEl) {
                const displayWords = (lastWordUpdate === today) ? wordsToday : 0;
                const goal = 500;
                const percentage = Math.min((displayWords / goal) * 100, 100);

                wordsTodayEl.textContent = displayWords;
                wordProgressEl.style.width = percentage + '%';
                wordPercentageEl.textContent = Math.round(percentage) + '%';
                    wordPercentageEl.textContent = '0%';
                if (percentage >= 100 && displayWords > 0) {
                    celebrate('‚úçÔ∏è Writing Goal Met!', 'You crushed your daily writing goal!');
                }
            } catch (error) {= window.currentUser.uid;
                console.error('‚ùå Error updating word counter:', error);
            }   const userData = userDoc.data();
        }
                const today = new Date().toDateString();
        // Document TrackerToday = userData?.wordsWrittenToday || 0;
        async function updateDocumentTracker() {.lastWordUpdate;
            const trackerContainer = document.getElementById('documentTracker');
                const displayWords = (lastWordUpdate === today) ? wordsToday : 0;
            if (!trackerContainer) {
                console.warn('Document tracker container not found');00, 100);
                return;
            }   wordsTodayEl.textContent = displayWords;
                wordProgressEl.style.width = percentage + '%';
            const documents = [l.textContent = Math.round(percentage) + '%';
                { name: 'Transcript', status: 'complete', icon: 'üìÑ' },
                { name: 'Recommendation Letters', status: 'pending', icon: 'üìù', count: '2/3' },
                { name: 'Test Scores', status: 'complete', icon: 'üìä' },daily writing goal!');
                { name: 'Financial Documents', status: 'pending', icon: 'üí∞' },
                { name: 'Portfolio/Resume', status: 'complete', icon: 'üìã' }
            ];  console.error('‚ùå Error updating word counter:', error);
            }
            trackerContainer.innerHTML = documents.map(doc => `
                <div class="document-item">
                    <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
                        <div class="document-status ${doc.status}"></div>
                        <span style="font-size: 1.2rem;">${doc.icon}</span>er');
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary);">${doc.name}</div>
                            ${doc.count ? `<div style="font-size: 0.85rem; color: var(--text-secondary);">${doc.count}</div>` : ''}
                        </div>
                    </div>
                    <span style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                        ${doc.status}
                    </span>anscript', status: 'complete', icon: 'üìÑ' },
                </div>: 'Recommendation Letters', status: 'pending', icon: 'üìù', count: '2/3' },
            `).join('');'Test Scores', status: 'complete', icon: 'üìä' },
        }       { name: 'Financial Documents', status: 'pending', icon: 'üí∞' },
                { name: 'Portfolio/Resume', status: 'complete', icon: 'üìã' }
        // Financial Aid Calculator
        window.calculateEFC = function() {
            const income = parseFloat(document.getElementById('familyIncome').value) || 0;
            const familySize = parseInt(document.getElementById('familySize').value) || 4;
                    <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
            if (income === 0) {ass="document-status ${doc.status}"></div>
                showNotification('Input Required', 'Please enter your family income', 'warning');
                return; <div>
            }               <div style="font-weight: 600; color: var(--text-primary);">${doc.name}</div>
                            ${doc.count ? `<div style="font-size: 0.85rem; color: var(--text-secondary);">${doc.count}</div>` : ''}
            let efc = 0;</div>
            const adjustedIncome = income - (familySize * 6000);
                    <span style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
            if (adjustedIncome > 0) {
                if (adjustedIncome <= 25000) {
                    efc = adjustedIncome * 0.22;
                } else if (adjustedIncome <= 50000) {
                    efc = 5500 + (adjustedIncome - 25000) * 0.25;
                } else {
                    efc = 11750 + (adjustedIncome - 50000) * 0.29;
                }lculateEFC = function() {
            }onst income = parseFloat(document.getElementById('familyIncome').value) || 0;
            const familySize = parseInt(document.getElementById('familySize').value) || 4;
            efc = Math.max(0, Math.round(efc));
            if (income === 0) {
            const resultDiv = document.getElementById('efcResult');ur family income', 'warning');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="calculator-result">
                    <div style="font-size: 0.9rem; opacity: 0.9;">Estimated Family Contribution</div>
                    <h3>$${efc.toLocaleString()}/year</h3>6000);
                    <p style="font-size: 0.85rem; margin-top: 0.5rem; opacity: 0.8;">
                        This is an estimate. Actual EFC may vary based on assets and other factors.
                    </p>stedIncome <= 25000) {
                </div>c = adjustedIncome * 0.22;
            `;  } else if (adjustedIncome <= 50000) {
        };          efc = 5500 + (adjustedIncome - 25000) * 0.25;
                } else {
        // Celebration System50 + (adjustedIncome - 50000) * 0.29;
        function celebrate(title, message, icon = 'üéâ') {
            const modal = document.getElementById('celebrationModal');
            const overlay = document.getElementById('tourOverlay');
            efc = Math.max(0, Math.round(efc));
            document.getElementById('celebrationIcon').textContent = icon;
            document.getElementById('celebrationTitle').textContent = title;
            document.getElementById('celebrationMessage').textContent = message;
            resultDiv.innerHTML = `
            overlay.classList.add('active');t">
            modal.classList.add('active'); 0.9rem; opacity: 0.9;">Estimated Family Contribution</div>
                    <h3>$${efc.toLocaleString()}/year</h3>
            for (let i = 0; i < 50; i++) {.85rem; margin-top: 0.5rem; opacity: 0.8;">
                setTimeout(() => createConfetti(), i * 30); vary based on assets and other factors.
            }       </p>
                </div>
            setTimeout(() => {
                if (modal.classList.contains('active')) {
                    closeCelebration();
                }ation System
            }, 5000);brate(title, message, icon = 'üéâ') {
        }   const modal = document.getElementById('celebrationModal');
            const overlay = document.getElementById('tourOverlay');
        function createConfetti() {
            const confetti = document.createElement('div');Content = icon;
            confetti.className = 'confetti';tionTitle').textContent = title;
            confetti.style.left = Math.random() * window.innerWidth + 'px';sage;
            confetti.style.background = ['#a07bcc', '#2a357a', '#10b981', '#f59e0b', '#ef4444'][Math.floor(Math.random() * 5)];
            confetti.style.animationDelay = Math.random() * 0.5 + 's';
            document.body.appendChild(confetti);

            setTimeout(() => confetti.remove(), 3000);
        }       setTimeout(() => createConfetti(), i * 30);
            }
        window.closeCelebration = function() {
            document.getElementById('celebrationModal').classList.remove('active');
            document.getElementById('tourOverlay').classList.remove('active');
        };          closeCelebration();
                }
        window.closeAllModals = function() {
            if (currentTourStep > 0 && currentTourStep < tourSteps.length) {
                return;
            }ion createConfetti() {
            const confetti = document.createElement('div');
            document.getElementById('celebrationModal')?.classList.remove('active');
            document.getElementById('tourOverlay')?.classList.remove('active');
            document.getElementById('tourSpotlight')?.style && (document.getElementById('tourSpotlight').style.display = 'none');
            document.getElementById('tourTooltip')?.style && (document.getElementById('tourTooltip').style.display = 'none');
            document.body.appendChild(confetti);
            document.querySelectorAll('.celebration-modal').forEach(modal => {
                if (modal.id !== 'celebrationModal') {
                    modal.remove();
                }
            });closeCelebration = function() {
        };  document.getElementById('celebrationModal').classList.remove('active');
            document.getElementById('tourOverlay').classList.remove('active');
        // Interactive Tour System
        let currentTourStep = 0;
        const tourSteps = [ls = function() {
            {f (currentTourStep > 0 && currentTourStep < tourSteps.length) {
                element: '.stats-grid',
                title: 'Application Stats',
                description: 'Track your progress at a glance. See how many schools you\'re applying to, essays completed, and scholarships available.',
                position: 'bottom'd('celebrationModal')?.classList.remove('active');
            },cument.getElementById('tourOverlay')?.classList.remove('active');
            {ocument.getElementById('tourSpotlight')?.style && (document.getElementById('tourSpotlight').style.display = 'none');
                element: '.timeline-section',tip')?.style && (document.getElementById('tourTooltip').style.display = 'none');
                title: 'Your Application Timeline',
                description: 'Never miss a deadline! Check off tasks as you complete them and watch your progress grow.',
                position: 'right''celebrationModal') {
            },      modal.remove();
            {   }
                element: '#aiInsights',
                title: 'AI Insights',
                description: 'Get personalized recommendations based on your profile, deadlines, and application status.',
                position: 'left'em
            },rrentTourStep = 0;
            { tourSteps = [
                element: '.school-match-section',
                title: 'School Recommendations',
                description: 'AI-powered school matches based on your GPA, test scores, and preferences. Click any school to learn more!',
                position: 'bottom'k your progress at a glance. See how many schools you\'re applying to, essays completed, and scholarships available.',
            },  position: 'bottom'
            {,
                element: '.word-counter-widget',
                title: 'Essay Progress Tracker',
                description: 'Set daily writing goals and track your progress. Consistency is key to great essays!',
                position: 'left'ver miss a deadline! Check off tasks as you complete them and watch your progress grow.',
            },  position: 'right'
            {,
                element: '.quick-actions',
                title: 'Quick Actions',
                description: 'Access helpful tools like calendar view, school comparison, and this tour anytime!',
                position: 'left't personalized recommendations based on your profile, deadlines, and application status.',
            }   position: 'left'
        ];  },
            {
        window.startTour = function() {-section',
            currentTourStep = 0;ecommendations',
            document.getElementById('tourOverlay').classList.add('active');test scores, and preferences. Click any school to learn more!',
            showTourStep();bottom'
        };  },
            {
        function showTourStep() {ounter-widget',
            if (currentTourStep >= tourSteps.length) {
                endTour();n: 'Set daily writing goals and track your progress. Consistency is key to great essays!',
                return;n: 'left'
            },
            {
            const step = tourSteps[currentTourStep];
            const element = document.querySelector(step.element);
                description: 'Access helpful tools like calendar view, school comparison, and this tour anytime!',
            if (!element) {left'
                currentTourStep++;
                showTourStep();
                return;
            }w.startTour = function() {
            currentTourStep = 0;
            const rect = element.getBoundingClientRect();ist.add('active');
            const spotlight = document.getElementById('tourSpotlight');
            const tooltip = document.getElementById('tourTooltip');

            spotlight.style.display = 'block';
            spotlight.style.top = (rect.top - 10) + 'px';
            spotlight.style.left = (rect.left - 10) + 'px';
            spotlight.style.width = (rect.width + 20) + 'px';
            spotlight.style.height = (rect.height + 20) + 'px';

            tooltip.style.display = 'block';urStep];
            document.getElementById('tourTitle').textContent = step.title;
            document.getElementById('tourDescription').textContent = step.description;
            document.getElementById('tourProgress').textContent = `${currentTourStep + 1} of ${tourSteps.length}`;
                currentTourStep++;
            if (step.position === 'bottom') {
                tooltip.style.top = (rect.bottom + 20) + 'px';
                tooltip.style.left = rect.left + 'px';
            } else if (step.position === 'right') {
                tooltip.style.top = rect.top + 'px';ct();
                tooltip.style.left = (rect.right + 20) + 'px';tlight');
            } else if (step.position === 'left') {d('tourTooltip');
                tooltip.style.top = rect.top + 'px';
                tooltip.style.left = (rect.left - 370) + 'px';
            }potlight.style.top = (rect.top - 10) + 'px';
            spotlight.style.left = (rect.left - 10) + 'px';
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }   spotlight.style.height = (rect.height + 20) + 'px';

        window.nextTourStep = function() {';
            currentTourStep++;tById('tourTitle').textContent = step.title;
            showTourStep();mentById('tourDescription').textContent = step.description;
        };  document.getElementById('tourProgress').textContent = `${currentTourStep + 1} of ${tourSteps.length}`;

        window.skipTour = function() {tom') {
            endTour();p.style.top = (rect.bottom + 20) + 'px';
        };      tooltip.style.left = rect.left + 'px';
            } else if (step.position === 'right') {
        async function endTour() {= rect.top + 'px';
            document.getElementById('tourOverlay').classList.remove('active');
            document.getElementById('tourSpotlight').style.display = 'none';
            document.getElementById('tourTooltip').style.display = 'none';
            currentTourStep = 0;ft = (rect.left - 370) + 'px';
            }
            if (window.currentUser) {
                try {crollIntoView({ behavior: 'smooth', block: 'center' });
                    await updateDoc(doc(db, 'users', window.currentUser.uid), {
                        tourCompleted: true,
                        tourCompletedAt: new Date()
                    });Step++;
                    console.log('‚úÖ Tour completion saved to Firebase');
                } catch (error) {
                    console.error('Error saving tour completion:', error);
                }ipTour = function() {
            }ndTour();
        };

        // Calendar View Modal() {
        window.openCalendarView = function() {ay').classList.remove('active');
            const modal = document.createElement('div');le.display = 'none';
            modal.className = 'celebration-modal active';display = 'none';
            modal.style.maxWidth = '800px';
            modal.onclick = (e) => e.stopPropagation();
            modal.innerHTML = `ser) {
                <div style="text-align: left;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: var(--accent-color); margin: 0;">Deadline Calendar</h2>
                        <button onclick="this.closest('.celebration-modal').remove(); document.getElementById('tourOverlay').classList.remove('active');"
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">√ó</button>
                    </div>e.log('‚úÖ Tour completion saved to Firebase');
                    <div id="calendarContainer"></div>
                </div>nsole.error('Error saving tour completion:', error);
            `;  }
            }
            document.body.appendChild(modal);
            document.getElementById('tourOverlay').classList.add('active');
            renderCalendar();l
        };ndow.openCalendarView = function() {
            const modal = document.createElement('div');
        function renderCalendar() {bration-modal active';
            const container = document.getElementById('calendarContainer');
            const today = new Date();stopPropagation();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();adline Calendar</h2>
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate(); document.getElementById('tourOverlay').classList.remove('active');"
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">√ó</button>
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
                </div>
            let html = `
                <div style="text-align: center; margin-bottom: 1rem; font-size: 1.2rem; font-weight: 600; color: var(--text-primary);">
                    ${monthNames[currentMonth]} ${currentYear}
                </div>etElementById('tourOverlay').classList.add('active');
                <div class="calendar-grid">
                    ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day =>
                        `<div style="font-weight: 600; color: var(--text-secondary); text-align: center; padding: 0.5rem;">${day}</div>`
                    ).join('')}() {
            `;nst container = document.getElementById('calendarContainer');
            const today = new Date();
            for (let i = 0; i < firstDay; i++) {);
                html += '<div class="calendar-day" style="opacity: 0.3;"></div>';
            }
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            for (let day = 1; day <= daysInMonth; day++) {entMonth + 1, 0).getDate();
                const date = new Date(currentYear, currentMonth, day);
                const hasDeadline = checkIfDeadline(date);rch', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
                html += `
                    <div class="calendar-day ${hasDeadline ? 'has-deadline' : ''}">
                        <strong>${day}</strong> margin-bottom: 1rem; font-size: 1.2rem; font-weight: 600; color: var(--text-primary);">
                    </div>hNames[currentMonth]} ${currentYear}
                `;div>
            }   <div class="calendar-grid">
                    ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day =>
            html += '</div>'; style="font-weight: 600; color: var(--text-secondary); text-align: center; padding: 0.5rem;">${day}</div>`
            container.innerHTML = html;
        }   `;

        function checkIfDeadline(date) {; i++) {
            const targetSchools = window.userData?.questionnaire?.targetSchools || [];
            return targetSchools.some(schoolName => {
                const school = window.schoolDatabase?.[schoolName];
                if (!school) return false;nMonth; day++) {
                const deadline = new Date(school.deadline);onth, day);
                return deadline.toDateString() === date.toDateString();
            });
        }       html += `
                    <div class="calendar-day ${hasDeadline ? 'has-deadline' : ''}">
        // School Comparison Tool{day}</strong>
        window.openCompareSchools = function() {
            const targetSchools = window.userData?.questionnaire?.targetSchools || [];
            }
            if (targetSchools.length === 0) {
                showNotification('No Schools', 'Add schools to your list to compare them', 'info');
                return;nnerHTML = html;
            }

            const modal = document.createElement('div');
            modal.className = 'celebration-modal active';onnaire?.targetSchools || [];
            modal.style.maxWidth = '900px';lName => {
            modal.style.maxHeight = '80vh';lDatabase?.[schoolName];
            modal.style.overflow = 'auto';
            modal.onclick = (e) => e.stopPropagation();ne);
                return deadline.toDateString() === date.toDateString();
            modal.innerHTML = `
                <div style="text-align: left;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: var(--accent-color); margin: 0;">Compare Schools</h2>
                        <button onclick="this.closest('.celebration-modal').remove(); document.getElementById('tourOverlay').classList.remove('active');"
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">√ó</button>
                    </div>
                    <div class="comparison-container">
                        ${targetSchools.slice(0, 4).map(schoolName => {t to compare them', 'info');
                            const school = window.schoolDatabase?.[schoolName];
                            if (!school) return '';
                            return `
                                <div class="comparison-card">
                    <div class="comparison-container">e';
                        ${targetSchools.slice(0, 4).map(schoolName => {
                            const school = window.schoolDatabase?.[schoolName];
                            if (!school) return '';
                            return `.stopPropagation();
                                <div class="comparison-card">
                                    <h3 style="color: var(--accent-color); margin-bottom: 1rem; font-size: 1.1rem;">${schoolName}</h3>
                                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                        <div>; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Acceptance Rate</div>
                                            <div style="font-size: 1.3rem; font-weight: 700; color: ${school.acceptance_rate < 10 ? 'var(--danger-color)' : school.acceptance_rate < 25 ? 'var(--warning-color)' : 'var(--success-color)'};">
                                                ${school.acceptance_rate}%t-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">√ó</button>
                                            </div>
                                        </div>tainer">
                                        <div>(0, 4).map(schoolName => {
                                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Average GPA</div>
                                            <div style="font-size: 1.3rem; font-weight: 700;">${school.avg_gpa}</div>
                                        </div>
                                        <div>omparison-card">
                                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Average SAT</div>
                                            <div style="font-size: 1.3rem; font-weight: 700;">${school.avg_sat}</div>
                                        </div>dow.schoolDatabase?.[schoolName];
                                        <div>rn '';
                                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Location</div>
                                            <div style="font-weight: 600;">${school.location}</div>
                                        </div>"color: var(--accent-color); margin-bottom: 1rem; font-size: 1.1rem;">${schoolName}</h3>
                                        <div>e="display: flex; flex-direction: column; gap: 0.75rem;">
                                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Deadline</div>
                                            <div style="font-weight: 600; color: var(--danger-color);">);">Acceptance Rate</div>
                                                ${new Date(school.deadline).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}anger-color)' : school.acceptance_rate < 25 ? 'var(--warning-color)' : 'var(--success-color)'};">
                                            </div>school.acceptance_rate}%
                                        </div>div>
                                    </div>div>
                                </div>  <div>
                            `;              <div style="font-size: 0.85rem; color: var(--text-secondary);">Average GPA</div>
                        }).join('')}        <div style="font-size: 1.3rem; font-weight: 700;">${school.avg_gpa}</div>
                    </div>              </div>
                </div>                  <div>
            `;                              <div style="font-size: 0.85rem; color: var(--text-secondary);">Average SAT</div>
                                            <div style="font-size: 1.3rem; font-weight: 700;">${school.avg_sat}</div>
            document.body.appendChild(modal);>
            document.getElementById('tourOverlay').classList.add('active');
        };                                  <div style="font-size: 0.85rem; color: var(--text-secondary);">Location</div>
                                            <div style="font-weight: 600;">${school.location}</div>
        // Check if first time user and start tour
        async function checkFirstTimeUser() {
            console.log('üéØ Tour popup disabled by design');-size: 0.85rem; color: var(--text-secondary);">Deadline</div>
            return;                         <div style="font-weight: 600; color: var(--danger-color);">
        }                                       ${new Date(school.deadline).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                                            </div>
        function startTourFromModal() { </div>
            const modal = document.getElementById('tourWelcomeModal');
            if (modal) {        </div>
                modal.style.display = 'none';
            }           }).join('')}
            startTour();v>
        }       </div>
            `;
        async function dismissTourModal() {
            const modal = document.getElementById('tourWelcomeModal');
            if (modal) {ElementById('tourOverlay').classList.add('active');
                modal.style.display = 'none';
            }
            if (window.currentUser) {nd start tour
                try {n checkFirstTimeUser() {
                    await updateDoc(doc(db, 'users', window.currentUser.uid), {
                        tourCompleted: true,
                        tourDismissedAt: new Date()
                    });
                    console.log('‚úÖ Tour marked as completed in Firebase');
                } catch (error) {t.getElementById('tourWelcomeModal');
                    console.error('Error saving tour dismissal:', error);
                }odal.style.display = 'none';
            }
        }   startTour();
        }
        window.startTourFromModal = startTourFromModal;
        window.dismissTourModal = dismissTourModal;
            const modal = document.getElementById('tourWelcomeModal');
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' || e.keyCode === 27) {
                const tourActive = currentTourStep > 0 && currentTourStep < tourSteps.length;
                if (tourActive) {r) {
                    skipTour();
                } else {t updateDoc(doc(db, 'users', window.currentUser.uid), {
                    closeAllModals();: true,
                }       tourDismissedAt: new Date()
            }       });
        });         console.log('‚úÖ Tour marked as completed in Firebase');
                } catch (error) {
        window.toggleTask = function(checkbox) {tour dismissal:', error);
            const taskItem = checkbox.closest('.task-item');
            const taskTitle = taskItem.querySelector('.task-title');
            
            if (checkbox.checked) {
                taskItem.classList.add('completed');al;
                taskTitle.style.textDecoration = 'line-through';
                taskTitle.style.opacity = '0.6';
                showNotification('Task Completed!', 'Great progress on your college journey!', 'success');
            } else {y === 'Escape' || e.keyCode === 27) {
                taskItem.classList.remove('completed');&& currentTourStep < tourSteps.length;
                taskTitle.style.textDecoration = 'none';
                taskTitle.style.opacity = '1';
            }   } else {
        };          closeAllModals();
                }
        window.dismissAlert = function() {
            document.getElementById('alertBanner').classList.remove('show');
        };
        window.toggleTask = function(checkbox) {
        window.showSchoolDetails = function(schoolName, school) {
            const details = ` taskItem.querySelector('.task-title');
                School: ${schoolName}
                Location: ${school.location}
                Acceptance Rate: ${school.acceptance_rate}%
                Average GPA: ${school.avg_gpa} = 'line-through';
                Average SAT: ${school.avg_sat}';
                Tuition: ${school.tuition.toLocaleString()}progress on your college journey!', 'success');
                Ranking: #${school.ranking}
                Deadline: ${new Date(school.deadline).toLocaleDateString()}
            `;  taskTitle.style.textDecoration = 'none';
            showNotification(schoolName, details, 'info');
        };  }
        };
        window.showApplicationTracker = function() {
            showNotification('Application Tracker', `You have ${window.applicationData?.length || 0} applications in progress`, 'info');
        };  document.getElementById('alertBanner').classList.remove('show');
        };
        window.showEssayTracker = function() {
            const essayCount = document.getElementById('essaysCount').textContent;
            showNotification('Essay Tracker', `You have completed ${essayCount} essays and supplements`, 'info');
        };      School: ${schoolName}
                Location: ${school.location}
        window.showScholarshipTracker = function() {_rate}%
            const scholarshipAmount = document.getElementById('scholarshipAmount').textContent;
            showNotification('Scholarship Tracker', `You're eligible for ${scholarshipAmount} in scholarship opportunities`, 'info');
        };      Tuition: ${school.tuition.toLocaleString()}
                Ranking: #${school.ranking}
        window.showProgressAnalytics = function() {e).toLocaleDateString()}
            const progress = document.getElementById('overallProgress').textContent;
            showNotification('Progress Analytics', `You're ${progress} complete with your college applications`, 'info');
        };

        function addChatMessage(message, sender) { {
            const chatMessages = document.getElementById('chatMessages');plicationData?.length || 0} applications in progress`, 'info');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            ow.showEssayTracker = function() {
            const prefix = sender === 'user' ? 'You:' : 'AI Counselor:';xtContent;
            messageDiv.innerHTML = `<strong>${prefix}</strong> ${escapeHtml(message)}`;and supplements`, 'info');
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }   const scholarshipAmount = document.getElementById('scholarshipAmount').textContent;
            showNotification('Scholarship Tracker', `You're eligible for ${scholarshipAmount} in scholarship opportunities`, 'info');
        function addTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message ai typing-indicator';').textContent;
            typingDiv.id = 'typingIndicator';ics', `You're ${progress} complete with your college applications`, 'info');
            typingDiv.innerHTML = `
                <strong>AI Counselor:</strong> 
                <div class="loading"></div>nder) {
            `;nst chatMessages = document.getElementById('chatMessages');
            chatMessages.appendChild(typingDiv);ement('div');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }   
            const prefix = sender === 'user' ? 'You:' : 'AI Counselor:';
        function removeTypingIndicator() {g>${prefix}</strong> ${escapeHtml(message)}`;
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {ld(messageDiv);
                typingIndicator.remove();Messages.scrollHeight;
            }
        }
        function addTypingIndicator() {
        async function saveChatToFirebase(userMessage, aiResponse, contextData) {
            try { typingDiv = document.createElement('div');
                const userId = window.currentUser.uid;ing-indicator';
                const chatData = {Indicator';
                    userId: userId,
                    userMessage: userMessage,> 
                    aiResponse: aiResponse,
                    timestamp: serverTimestamp(),
                    context: contextData,ngDiv);
                    sessionId: getSessionId()ages.scrollHeight;
                };

                await addDoc(collection(db, 'chatHistory'), chatData);
                logger.log('üíæ Enhanced chat data saved');d('typingIndicator');
                typingIndicator) {
            } catch (error) {or.remove();
                console.error('‚ùå Error saving chat:', error);
            }
        }
        async function saveChatToFirebase(userMessage, aiResponse, contextData) {
        function getSessionId() {
            let sessionId = sessionStorage.getItem('chatSessionId');
            if (!sessionId) {a = {
                sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                sessionStorage.setItem('chatSessionId', sessionId);
            }       aiResponse: aiResponse,
            return sessionId;: serverTimestamp(),
        }           context: contextData,
                    sessionId: getSessionId()
        function getErrorMessage(statusCode) {
            const messages = {
                400: '‚ùå I had trouble understanding your message. Could you please rephrase it?',
                401: 'üîê Authentication error. Please try refreshing the page and logging in again.',
                403: 'üö´ Access denied. Your OpenAI API key may need billing setup. Please check your OpenAI account.',
                429: '‚è±Ô∏è Too many requests! I\'m experiencing high demand. Please wait 60 seconds before trying again.',
                500: '‚ö†Ô∏è Server error. I\'m temporarily having technical difficulties. Please try again in a few minutes.',
                502: 'üîß Bad gateway. The AI service is temporarily unavailable. Please try again shortly.',
                503: 'üõ†Ô∏è Service unavailable. The server is undergoing maintenance. Please try again later.',
                504: '‚è∞ Request timeout. The AI is taking too long to respond. Try asking a simpler question.'
            };on getSessionId() {
            return messages[statusCode] || `‚ö†Ô∏è Unexpected error (Code: ${statusCode}). Please try again or contact support if the problem persists.`;
        }   if (!sessionId) {
                sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        window.handleChatKeyPress = function(event) {', sessionId);
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                window.sendChatMessage();
            }
        };nction getErrorMessage(statusCode) {
            const messages = {
        window.toggleChat = function() {derstanding your message. Could you please rephrase it?',
            const chatWidget = document.getElementById('chatWidget');the page and logging in again.',
            const chatToggle = document.getElementById('chatToggle');billing setup. Please check your OpenAI account.',
                429: '‚è±Ô∏è Too many requests! I\'m experiencing high demand. Please wait 60 seconds before trying again.',
            if (chatWidget.classList.contains('open')) {having technical difficulties. Please try again in a few minutes.',
                chatWidget.classList.remove('open'); is temporarily unavailable. Please try again shortly.',
                chatToggle.classList.remove('hidden');ver is undergoing maintenance. Please try again later.',
            } else { '‚è∞ Request timeout. The AI is taking too long to respond. Try asking a simpler question.'
                chatWidget.classList.add('open');
                chatToggle.classList.add('hidden');pected error (Code: ${statusCode}). Please try again or contact support if the problem persists.`;
                document.getElementById('chatInput').focus();
            }
        };ndow.handleChatKeyPress = function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
        function escapeHtml(text) {t();
            const map = {ndChatMessage();
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',nction() {
                "'": '&#039;'= document.getElementById('chatWidget');
            };nst chatToggle = document.getElementById('chatToggle');
            return text.replace(/[&<>"']/g, m => map[m]);
        }   if (chatWidget.classList.contains('open')) {
                chatWidget.classList.remove('open');
        if (document.readyState === 'loading') {den');
            document.addEventListener('DOMContentLoaded', initNavbar);
        } else {chatWidget.classList.add('open');
            initNavbar();e.classList.add('hidden');
        }       document.getElementById('chatInput').focus();
            }
    </script>

    <script>tion escapeHtml(text) {
        // ============================================
        // ENHANCED AI CHAT WITH FULL CONTEXT
        // ============================================
                '>': '&gt;',
        window.sendChatMessage = async function() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('chatSend');
            const message = input.value.trim();> map[m]);
        }
            if (!message) return;
        if (document.readyState === 'loading') {
            if (!window.currentUser) {'DOMContentLoaded', initNavbar);
                showNotification('Authentication Required', 'Please log in to use the AI counselor.', 'warning');
                return;);
            }

            // Disable input during processing
            input.disabled = true;
            sendBtn.disabled = true;
        // ============================================
            // Add user message to chatONTEXT
            addChatMessage(message, 'user');===========
            input.value = '';
        window.sendChatMessage = async function() {
            // Show typing indicatoretElementById('chatInput');
            addTypingIndicator();ent.getElementById('chatSend');
            const message = input.value.trim();
            try {
                // Gather comprehensive context about the user
                const userData = window.userData || {};
                const questionnaire = userData.questionnaire || {};
                const applications = window.applicationData || [];e log in to use the AI counselor.', 'warning');
                return;
                // Build context data
                const contextData = {
                    userName: userData.name || userData.firstName || 'Student',
                    email: userData.email || '',
                    disabled = true;
                    // Academic profile
                    gpa: questionnaire.unweightedGPA || userData.gpa || 'Not provided',
                    testScores: questionnaire.testScores || 'Not provided',
                    satScore: extractSATScore(questionnaire.testScores),
                    actScore: extractACTScore(questionnaire.testScores),
                    typing indicator
                    // Application info
                    targetSchools: questionnaire.targetSchools || [],
                    intendedMajor: questionnaire.intendedMajor || 'Undecided',
                    applicationCount: applications.length,user
                    t userData = window.userData || {};
                    // Progress trackingerData.questionnaire || {};
                    overallProgress: calculateOverallProgress(),];
                    essaysCompleted: parseInt(document.getElementById('essaysCount')?.textContent || '0'),
                    scholarshipPotential: document.getElementById('scholarshipAmount')?.textContent || '$0',
                    t contextData = {
                    // Upcoming deadlinesme || userData.firstName || 'Student',
                    upcomingDeadlines: getUpcomingDeadlines(),
                    
                    // Recent activitye
                    recentApplications: applications.slice(0, 3).map(app => ({rovided',
                        school: app.schoolName,estScores || 'Not provided',
                        status: app.status,re(questionnaire.testScores),
                        deadline: app.deadlinequestionnaire.testScores),
                    })),
                    // Application info
                    // Additional contextonnaire.targetSchools || [],
                    financialAid: questionnaire.financialAid || [],Undecided',
                    extracurriculars: questionnaire.extracurriculars || [],
                    specialConsiderations: questionnaire.specialConsiderations || []
                };  // Progress tracking
                    overallProgress: calculateOverallProgress(),
                console.log('üì§ Sending chat request with full context:', {ysCount')?.textContent || '0'),
                    message: message.substring(0, 50) + '...',yId('scholarshipAmount')?.textContent || '$0',
                    contextKeys: Object.keys(contextData),
                    targetSchools: contextData.targetSchools.length,
                    applicationCount: contextData.applicationCount
                }); 
                    // Recent activity
                // Make API request with full contextslice(0, 3).map(app => ({
                const response = await fetch('/api/chat', {
                    method: 'POST',.status,
                    headers: {ne: app.deadline
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,nnaire.financialAid || [],
                        userProfile: {questionnaire.extracurriculars || [],
                            name: contextData.userName,e.specialConsiderations || []
                            gpa: contextData.gpa,
                            satScore: contextData.satScore,
                            actScore: contextData.actScore,ull context:', {
                            intendedMajor: contextData.intendedMajor,
                            targetSchools: contextData.targetSchools
                        },Schools: contextData.targetSchools.length,
                        questionnaireData: questionnaire,tionCount
                        context: {
                            currentPage: 'dashboard',
                            overallProgress: contextData.overallProgress,
                            applicationCount: contextData.applicationCount,
                            upcomingDeadlines: contextData.upcomingDeadlines
                        }rs: {
                    })  'Content-Type': 'application/json',
                }); },
                    body: JSON.stringify({
                removeTypingIndicator();,
                        userProfile: {
                if (!response.ok) {ontextData.userName,
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = getErrorMessage(response.status);
                            actScore: contextData.actScore,
                    console.error('‚ùå Chat API error:', {ntendedMajor,
                        status: response.status,xtData.targetSchools
                        statusText: response.statusText,
                        error: errorData.error || 'Unknown error'
                    }); context: {
                            currentPage: 'dashboard',
                    addChatMessage(errorMessage, 'ai');a.overallProgress,
                            applicationCount: contextData.applicationCount,
                    // Track errorngDeadlines: contextData.upcomingDeadlines
                    trackEvent('Chat', 'Error', `Status: ${response.status}`);
                    })
                    return;
                }
                removeTypingIndicator();
                const data = await response.json();
                console.log('‚úÖ Chat response received');
                    const errorData = await response.json().catch(() => ({}));
                // Add AI response to chatetErrorMessage(response.status);
                addChatMessage(data.response, 'ai');
                    console.error('‚ùå Chat API error:', {
                // Save conversation to Firebase
                await saveChatToFirebase(message, data.response, contextData);
                        error: errorData.error || 'Unknown error'
                // Track successful interaction
                trackEvent('Chat', 'Message', 'Success');
                    addChatMessage(errorMessage, 'ai');
                // Scroll to bottom
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;.status}`);
                    
            } catch (error) {
                removeTypingIndicator();
                console.error('‚ùå Chat error:', error);
                const data = await response.json();
                addChatMessage(Chat response received');
                    '‚ùå I\'m having trouble connecting right now. Please check your internet connection and try again. If the problem persists, try refreshing the page.',
                    'ai'I response to chat
                );dChatMessage(data.response, 'ai');

                trackEvent('Chat', 'Error', 'Network or Unknown');
            } finally {aveChatToFirebase(message, data.response, contextData);
                // Re-enable input
                input.disabled = false;eraction
                sendBtn.disabled = false;ge', 'Success');
                input.focus();
            }   // Scroll to bottom
        };      const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
        // Helper function to get upcoming deadlines
        function getUpcomingDeadlines() {
            if (!window.applicationData) return [];
                console.error('‚ùå Chat error:', error);
            const now = new Date();
            return window.applicationData
                .map(app => {aving trouble connecting right now. Please check your internet connection and try again. If the problem persists, try refreshing the page.',
                    const deadline = new Date(app.deadline);
                    const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
                    return {
                        school: app.schoolName,twork or Unknown');
                        deadline: app.deadline,
                        daysUntil: daysUntil,
                        status: app.status
                    };n.disabled = false;
                })put.focus();
                .filter(d => d.daysUntil > 0 && d.daysUntil <= 90)
                .sort((a, b) => a.daysUntil - b.daysUntil)
                .slice(0, 5);
        }/ Helper function to get upcoming deadlines
        function getUpcomingDeadlines() {
        // ============================================
        // NOTIFICATION SYSTEM
        // ============================================
            return window.applicationData
        let notificationTimeout;
                    const deadline = new Date(app.deadline);
        window.showNotification = function(title, message, type = 'info') {60 * 60 * 24));
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            const notificationIcon = notification.querySelector('.notification-icon i');
                        status: app.status
            // Clear any existing timeout
            if (notificationTimeout) {
                clearTimeout(notificationTimeout);daysUntil <= 90)
            }   .sort((a, b) => a.daysUntil - b.daysUntil)
                .slice(0, 5);
            // Remove existing show class
            notification.classList.remove('show');
        // ============================================
            // Set contentSTEM
            notificationTitle.textContent = title;=====
            notificationMessage.textContent = message;
        let notificationTimeout;
            // Set icon based on type
            const icons = {tion = function(title, message, type = 'info') {
                success: 'fa-check-circle',etElementById('notification');
                error: 'fa-exclamation-circle',getElementById('notificationTitle');
                warning: 'fa-exclamation-triangle',tElementById('notificationMessage');
                info: 'fa-info-circle'otification.querySelector('.notification-icon i');
            };
            // Clear any existing timeout
            notificationIcon.className = `fas ${icons[type] || icons.info}`;
                clearTimeout(notificationTimeout);
            // Set border color based on type
            const colors = {
                success: 'var(--success-color)',
                error: 'var(--danger-color)',ow');
                warning: 'var(--warning-color)',
                info: 'var(--info-color)'
            };tificationTitle.textContent = title;
            notificationMessage.textContent = message;
            notification.style.borderLeftColor = colors[type] || colors.info;
            // Set icon based on type
            // Show notification
            setTimeout(() => {heck-circle',
                notification.classList.add('show');
            }, 100);ing: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            // Auto-hide after 5 seconds
            notificationTimeout = setTimeout(() => {
                notification.classList.remove('show');type] || icons.info}`;
            }, 5000);
            // Set border color based on type
            // Track notification
            trackEvent('Notification', 'Show', `${type}: ${title}`);
        };      error: 'var(--danger-color)',
                warning: 'var(--warning-color)',
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
            notification.style.borderLeftColor = colors[type] || colors.info;
        // Check if user is online
        function checkOnlineStatus() {
            if (!navigator.onLine) {
                showNotification(sList.add('show');
                    'You\'re Offline',
                    'Some features may not work until you reconnect to the internet.',
                    'warning'r 5 seconds
                );cationTimeout = setTimeout(() => {
            }   notification.classList.remove('show');
        }   }, 5000);

        // Periodically check connection
        setInterval(checkOnlineStatus, 30000); `${type}: ${title}`);
        };
        // ============================================
        // PERFORMANCE MONITORING======================
        // ============================================
        // ============================================
        if (window.performance && window.performance.timing) {
            window.addEventListener('load', function() {
                setTimeout(function() {
                    const timing = window.performance.timing;
                    const loadTime = timing.loadEventEnd - timing.navigationStart;
                    const domReady = timing.domContentLoadedEventEnd - timing.navigationStart;
                    const renderTime = timing.domComplete - timing.domLoading;ernet.',
                    'warning'
                    console.log('üìä Performance Metrics:');
                    console.log(`  Total Load Time: ${loadTime}ms`);
                    console.log(`  DOM Ready: ${domReady}ms`);
                    console.log(`  Render Time: ${renderTime}ms`);
        // Periodically check connection
                    // Track if load is slow);
                    if (loadTime > 5000) {
                        console.warn('‚ö†Ô∏è Slow page load detected');
                        trackEvent('Performance', 'SlowLoad', `${loadTime}ms`);
                    }==================================
                }, 0);
            });dow.performance && window.performance.timing) {
        }   window.addEventListener('load', function() {
                setTimeout(function() {
        // ============================================iming;
        // ERROR BOUNDARY AND RECOVERYiming.loadEventEnd - timing.navigationStart;
        // ============================================oadedEventEnd - timing.navigationStart;
                    const renderTime = timing.domComplete - timing.domLoading;
        window.addEventListener('error', function(event) {
            console.error('üö® Global Error:', { Metrics:');
                message: event.message,l Load Time: ${loadTime}ms`);
                filename: event.filename,ady: ${domReady}ms`);
                lineno: event.lineno,nder Time: ${renderTime}ms`);
                colno: event.colno,
                error: event.errorad is slow
            });     if (loadTime > 5000) {
                        console.warn('‚ö†Ô∏è Slow page load detected');
            // Don't show notification for every error, but log itoadTime}ms`);
            trackEvent('Error', 'Global', event.message);
        });     }, 0);
            });
        window.addEventListener('unhandledrejection', function(event) {
            console.error('üö® Unhandled Promise Rejection:', event.reason);
            trackEvent('Error', 'UnhandledRejection', String(event.reason));
        });ERROR BOUNDARY AND RECOVERY
        // ============================================
        // ============================================
        // KEYBOARD SHORTCUTSer('error', function(event) {
        // ============================================
                message: event.message,
        document.addEventListener('keydown', function(e) {
            // Cmd/Ctrl + K to open chat
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                const chatWidget = document.getElementById('chatWidget');
                if (!chatWidget.classList.contains('open')) {
                    window.toggleChat();or every error, but log it
                }Event('Error', 'Global', event.message);
                document.getElementById('chatInput').focus();
            }
        window.addEventListener('unhandledrejection', function(event) {
            // Cmd/Ctrl + / to start tourromise Rejection:', event.reason);
            if ((e.metaKey || e.ctrlKey) && e.key === '/') {(event.reason));
                e.preventDefault();
                window.startTour();
            }==========================================
        // KEYBOARD SHORTCUTS
            // Escape to close modals==================
            if (e.key === 'Escape') {
                const chatWidget = document.getElementById('chatWidget');
                if (chatWidget.classList.contains('open')) {
                    window.toggleChat(); && e.key === 'k') {
                } else {tDefault();
                    window.closeAllModals();getElementById('chatWidget');
                }f (!chatWidget.classList.contains('open')) {
            }       window.toggleChat();
        });     }
                document.getElementById('chatInput').focus();
        // ============================================
        // DATA REFRESH MECHANISM
        // ============================================
            if ((e.metaKey || e.ctrlKey) && e.key === '/') {
        // Refresh data every 5 minutes
        setInterval(async function() {
            if (window.currentUser && document.visibilityState === 'visible') {
                console.log('üîÑ Refreshing dashboard data...');
                scape to close modals
                try { === 'Escape') {
                    await loadApplicationData();lementById('chatWidget');
                    await calculateRealStats();ns('open')) {
                    generateAIInsights();
                    updateProgressCircle();
                    checkDeadlineAlerts(););
                    
                    console.log('‚úÖ Dashboard data refreshed');
                } catch (error) {
                    console.error('‚ùå Error refreshing data:', error);
                }======================================
            }TA REFRESH MECHANISM
        }, 5 * 60 * 1000); // 5 minutes================

        // ============================================
        // VISIBILITY CHANGE HANDLING{
        // ============================================tyState === 'visible') {
                console.log('üîÑ Refreshing dashboard data...');
        document.addEventListener('visibilitychange', async function() {
            if (document.visibilityState === 'visible' && window.currentUser) {
                console.log('üëÅÔ∏è Page visible again, checking for updates...');
                    await calculateRealStats();
                // Quick refresh on return
                setTimeout(async () => {();
                    try {DeadlineAlerts();
                        await loadApplicationData();
                        await calculateRealStats();efreshed');
                        checkDeadlineAlerts();
                    } catch (error) {Error refreshing data:', error);
                        console.error('Error on visibility refresh:', error);
                    }
                }, 1000);; // 5 minutes
            }
        });============================================
        // VISIBILITY CHANGE HANDLING
        // ============================================
        // INITIAL LOAD COMPLETE
        // ============================================sync function() {
            if (document.visibilityState === 'visible' && window.currentUser) {
        console.log('üéâ Dashboard fully initialized and ready!'); updates...');
        console.log('üìä Features enabled:');
        console.log('  ‚úì Real-time application tracking');
        console.log('  ‚úì AI-powered school recommendations');
        console.log('  ‚úì Personalized timeline with tasks');
        console.log('  ‚úì Context-aware AI chat counselor');
        console.log('  ‚úì Progress analytics');ts();
        console.log('  ‚úì Deadline alerts');();
        console.log('  ‚úì Document tracking');
        console.log('  ‚úì Financial aid calculator');bility refresh:', error);
        console.log('  ‚úì Keyboard shortcuts (Cmd+K, Cmd+/)');
        console.log('  ‚úì Offline support (PWA)');
        console.log('  ‚úì Auto-save and sync');
        });
    </script>
    <script>===========================================
        // ============================================
        // ADDITIONAL HELPER FUNCTIONS=================
        // ============================================
        console.log('üéâ Dashboard fully initialized and ready!');
        // Format dates consistentlybled:');
        function formatDate(dateString) {ation tracking');
            const date = new Date(dateString);ommendations');
            const now = new Date();ed timeline with tasks');
            const diffTime = date - now;I chat counselor');
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        console.log('  ‚úì Deadline alerts');
            if (diffDays < 0) {nt tracking');
                return 'Overdue';l aid calculator');
            } else if (diffDays === 0) {uts (Cmd+K, Cmd+/)');
                return 'Today';e support (PWA)');
            } else if (diffDays === 1) {ync');
                return 'Tomorrow';
            } else if (diffDays <= 7) {
                return `${diffDays} days`;
            } else {===================================
                return date.toLocaleDateString('en-US', { 
                    month: 'short', ===================
                    day: 'numeric',
                    year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
                });rmatDate(dateString) {
            }onst date = new Date(dateString);
        }   const now = new Date();
            const diffTime = date - now;
        // Format numbers with commasl(diffTime / (1000 * 60 * 60 * 24));
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }       return 'Overdue';
            } else if (diffDays === 0) {
        // Validate emailoday';
        function isValidEmail(email) { {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }   } else if (diffDays <= 7) {
                return `${diffDays} days`;
        // Deep clone object
        function deepClone(obj) {aleDateString('en-US', { 
            return JSON.parse(JSON.stringify(obj));
        }           day: 'numeric',
                    year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };on isValidEmail(email) {
        }   return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        // Throttle function
        function throttle(func, limit) {
            let inThrottle;obj) {
            return function(...args) {ingify(obj));
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }imeout;
            };turn function executedFunction(...args) {
        }       const later = () => {
                    clearTimeout(timeout);
        // Export utilities for global use
        window.DashboardUtils = {
            formatDate,meout(timeout);
            formatNumber, setTimeout(later, wait);
            isValidEmail,
            deepClone,
            debounce,
            throttlefunction
        };nction throttle(func, limit) {
            let inThrottle;
        // ============================================
        // FINAL INITIALIZATION CHECKS
        // ============================================
                    inThrottle = true;
        // Check browser compatibilitynThrottle = false, limit);
        function checkBrowserCompatibility() {
            const isCompatible = 
                'fetch' in window &&
                'Promise' in window &&
                'localStorage' in window &&
                'sessionStorage' in window;
            formatDate,
            if (!isCompatible) {
                console.error('‚ùå Browser not fully compatible');
                showNotification(
                    'Browser Compatibility',
                    'Your browser may not support all features. Please update to the latest version.',
                    'warning'
                );
            }==========================================
        }/ FINAL INITIALIZATION CHECKS
        // ============================================
        checkBrowserCompatibility();
        // Check browser compatibility
        // Log dashboard readinesstibility() {
        console.log('‚úÖ Dashboard.html fully loaded and operational');
        console.log('üîê Authentication: Ready');
        console.log('üé® UI: Fully rendered');
        console.log('ü§ñ AI: Connected'); &&
        console.log('üíæ Firebase: Active');
        console.log('üì± PWA: Enabled');
            if (!isCompatible) {
    </script>   console.error('‚ùå Browser not fully compatible');
                showNotification(
    <!-- Add these additional scripts and enhancements after the existing scripts -->
                    'Your browser may not support all features. Please update to the latest version.',
<script>            'warning'
    // ============================================
    // ADVANCED ANALYTICS & TRACKING
    // ============================================

    function trackEvent(category, action, label) {
        try {
            if (typeof gtag !== 'undefined') {
                gtag('event', action, {ully loaded and operational');
                    event_category: category,');
                    event_label: labelered');
                });('ü§ñ AI: Connected');
            }le.log('üíæ Firebase: Active');
            ole.log('üì± PWA: Enabled');
            console.log(`üìä Event tracked: ${category} - ${action} - ${label}`);
        } catch (error) {
            console.error('Error tracking event:', error);
        }Add these additional scripts and enhancements after the existing scripts -->
    }
<script>
    // Track user interactions=====================
    document.addEventListener('click', function(e) {
        const target = e.target.closest('a, button, .school-card, .stat-card');
        if (target) {
            const label = target.textContent?.trim().substring(0, 50) || 'Unknown';
            trackEvent('Interaction', 'Click', label);
        }   if (typeof gtag !== 'undefined') {
    });         gtag('event', action, {
                    event_category: category,
    // ============================================
    // PROGRESSIVE WEB APP (PWA) INSTALL PROMPT
    // ============================================
            
    let deferredPrompt;(`üìä Event tracked: ${category} - ${action} - ${label}`);
    let installBannerShown = false;
            console.error('Error tracking event:', error);
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        rack user interactions
        // Show install banner after 30 seconds (subtle, not intrusive)
        setTimeout(() => {arget.closest('a, button, .school-card, .stat-card');
            if (!installBannerShown && !localStorage.getItem('pwaInstallDismissed')) {
                showInstallBanner();tContent?.trim().substring(0, 50) || 'Unknown';
            }rackEvent('Interaction', 'Click', label);
        }, 30000);
    });

    function showInstallBanner() {=================
        installBannerShown = true;NSTALL PROMPT
        ===========================================
        const banner = document.createElement('div');
        banner.id = 'pwaInstallBanner';
        banner.style.cssText = `se;
            position: fixed;
            bottom: 20px;er('beforeinstallprompt', (e) => {
            right: 20px;();
            background: linear-gradient(135deg, #2a357a 0%, #a07bcc 100%);
            color: white;
            padding: 1rem 1.5rem;ter 30 seconds (subtle, not intrusive)
        setTimeout(() => {
            if (!installBannerShown && !localStorage.getItem('pwaInstallDismissed')) {
                showInstallBanner();
            }
        }, 30000);
    });

    function showInstallBanner() {
        installBannerShown = true;
        
        const banner = document.createElement('div');
        banner.id = 'pwaInstallBanner';
        banner.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2a357a 0%, #a07bcc 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(42, 53, 122, 0.3);
            z-index: 9997;
            display: flex;
            align-items: center;
            gap: 1rem;
            max-width: 350px;
            animation: slideInRight 0.5s ease;
        `;
        
        banner.innerHTML = `
            <div style="flex: 1;">
                <div style="font-weight: 600; margin-bottom: 0.25rem;">üì± Install College Climb</div>
                <div style="font-size: 0.85rem; opacity: 0.9;">Get quick access from your home screen</div>
            </div>
            <button onclick="installPWA()" style="background: white; color: #2a357a; border: none; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                Install
            </button>
            <button onclick="dismissInstallBanner()" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; padding: 0.5rem;">
                √ó
            </button>
        `;
        
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(banner);
    }

    window.installPWA = async function() {
        if (!deferredPrompt) {
            showNotification('Install Not Available', 'PWA installation is not available on this device.', 'info');
            return;
        }

        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        
        if (outcome === 'accepted') {
            console.log('‚úÖ PWA installation accepted');
            trackEvent('PWA', 'Install', 'Accepted');
            showNotification('Installing...', 'College Climb is being installed!', 'success');
        } else {
            console.log('‚ùå PWA installation dismissed');
            trackEvent('PWA', 'Install', 'Dismissed');
        }
        
        deferredPrompt = null;
        dismissInstallBanner();
    };

    window.dismissInstallBanner = function() {
        const banner = document.getElementById('pwaInstallBanner');
        if (banner) {
            banner.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => banner.remove(), 300);
        }
        localStorage.setItem('pwaInstallDismissed', 'true');
        trackEvent('PWA', 'InstallBanner', 'Dismissed');
    };

    const slideOutStyle = document.createElement('style');
    slideOutStyle.textContent = `
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }
    `;
    document.head.appendChild(slideOutStyle);

    // ============================================
    // OFFLINE CACHE & SERVICE WORKER
    // ============================================

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('‚úÖ Service Worker registered:', registration.scope);
                    trackEvent('PWA', 'ServiceWorker', 'Registered');
                })
                .catch(error => {
                    console.error('‚ùå Service Worker registration failed:', error);
                    trackEvent('PWA', 'ServiceWorker', 'Failed');
                });
        });
    }

    // ============================================
    // STARRY BACKGROUND ANIMATION
    // ============================================

    function createStarryBackground() {
        const starryBg = document.getElementById('starryBg');
        if (!starryBg) return;

        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.width = Math.random() * 3 + 'px';
            star.style.height = star.style.width;
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            star.style.animationDuration = (Math.random() * 2 + 2) + 's';
            starryBg.appendChild(star);
        }
    }

    createStarryBackground();

    // ============================================
    // SMART SEARCH FUNCTIONALITY
    // ============================================

    // ADD these helper functions to dashboard.html around line 4800
    // (Right before the chat functionality)

    // Extract SAT score from test scores string
    function extractSATScore(testScores) {
        if (!testScores) return null;
        const match = testScores.match(/SAT:?\s*(\d+)/i);
        return match ? parseInt(match[1]) : null;
    }

    // Extract ACT score from test scores string  
    function extractACTScore(testScores) {
        if (!testScores) return null;
        const match = testScores.match(/ACT:?\s*(\d+)/i);
        return match ? parseInt(match[1]) : null;
    }

    // Track analytics events
    function trackEvent(category, action, label) {
        try {
            if (typeof gtag !== 'undefined') {
                gtag('event', action, {
                    event_category: category,
                    event_label: label
                });
            }
            console.log(`üìä Event tracked: ${category} - ${action} - ${label}`);
        } catch (error) {
            console.error('Error tracking event:', error);
        }
    }

    window.openSmartSearch = function() {
        const modal = document.createElement('div');
        modal.className = 'celebration-modal active';
        modal.style.maxWidth = '600px';
        modal.onclick = (e) => e.stopPropagation();
        
        modal.innerHTML = `
            <div style="text-align: left;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="color: var(--accent-color); margin: 0;">üîç Smart Search</h2>
                    <button onclick="this.closest('.celebration-modal').remove(); document.getElementById('tourOverlay').classList.remove('active');"
                            style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">√ó</button>
                </div>
                <input type="text" 
                       id="smartSearchInput" 
                       placeholder="Search schools, essays, tasks, deadlines..."
                       style="width: 100%; padding: 1rem; border: 2px solid var(--accent-color); border-radius: 12px; font-size: 1rem; margin-bottom: 1rem;"
                       oninput="performSmartSearch(this.value)">
                <div id="smartSearchResults" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        `;

        document.body.appendChild(modal);
        document.getElementById('tourOverlay').classList.add('active');
        setTimeout(() => document.getElementById('smartSearchInput').focus(), 100);
    };

    window.performSmartSearch = function(query) {
        const resultsContainer = document.getElementById('smartSearchResults');
        if (!query || query.length < 2) {
            resultsContainer.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 2rem;">Type to search...</p>';
            return;
        }

        const results = [];
        const lowerQuery = query.toLowerCase();

        // Search target schools
        const targetSchools = window.userData?.questionnaire?.targetSchools || [];
        targetSchools.forEach(school => {
            if (school.toLowerCase().includes(lowerQuery)) {
                results.push({
                    type: 'School',
                    icon: 'üè´',
                    title: school,
                    action: () => openCollegeProfile(school)
                });
            }
        });

        // Search all schools in database
        Object.keys(window.schoolDatabase).forEach(school => {
            if (school.toLowerCase().includes(lowerQuery) && !targetSchools.includes(school)) {
                results.push({
                    type: 'Available School',
                    icon: 'üéì',
                    title: school,
                    action: () => openCollegeProfile(school)
                });
            }
        });

        // Search tasks
        if ('task'.includes(lowerQuery) || 'deadline'.includes(lowerQuery)) {
            results.push({
                type: 'Action',
                icon: '‚úÖ',
                title: 'View All Tasks',
                action: () => {
                    document.querySelector('.task-section')?.scrollIntoView({ behavior: 'smooth' });
                    closeAllModals();
                }
            });
        }

        // Search essays
        if ('essay'.includes(lowerQuery) || 'writing'.includes(lowerQuery)) {
            results.push({
                type: 'Page',
                icon: '‚úçÔ∏è',
                title: 'Essay Coach',
                action: () => window.location.href = 'essaycoach.html'
            });
        }

        // Search scholarships
        if ('scholarship'.includes(lowerQuery) || 'money'.includes(lowerQuery) || 'financial'.includes(lowerQuery)) {
            results.push({
                type: 'Page',
                icon: 'üí∞',
                title: 'Scholarship Finder',
                action: () => window.location.href = 'scholarship.html'
            });
        }

        // Display results
        if (results.length === 0) {
            resultsContainer.innerHTML = `
                <p style="color: var (--text-secondary); text-align: center; padding: 2rem;">
                    No results found for "${query}"
                </p>
            `;
        } else {
            resultsContainer.innerHTML = results.map(result => `
                <div class="search-result-item" 
                     onclick="(${result.action.toString()})(); closeAllModals();"
                     style="padding: 1rem; border-radius: 12px; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.2s; background: var(--secondary-bg); border: 1px solid rgba(160, 123, 204, 0.1);">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 1.5rem;">${result.icon}</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-primary);">${result.title}</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">${result.type}</div>
                        </div>
                        <i class="fas fa-chevron-right" style="color: var(--accent-color);"></i>
                    </div>
                </div>
            `).join('');
        }
    };

    // ============================================
    // KEYBOARD SHORTCUT: CTRL+K FOR SEARCH
    // ============================================

    document.addEventListener('keydown', function(e) {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
            e.preventDefault();
            openSmartSearch();
        }
    });

    // ============================================
    // EXPORT DATA FUNCTIONALITY
    // ============================================

    window.exportDashboardData = async function() {
        try {
            const exportData = {
                user: {
                    name: window.userData?.name,
                    email: window.userData?.email,
                    questionnaire: window.userData?.questionnaire
                },
                applications: window.applicationData || [],
                statistics: {
                    totalApplications: window.applicationData?.length || 0,
                    completedEssays: parseInt(document.getElementById('essaysCount')?.textContent || '0'),
                    overallProgress: parseInt(document.getElementById('overallProgress')?.textContent || '0'),
                    scholarshipValue: document.getElementById('scholarshipAmount')?.textContent
                },
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `college-climb-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('Export Complete', 'Your dashboard data has been downloaded!', 'success');
            trackEvent('Data', 'Export', 'JSON');
        } catch (error) {
            console.error('Export error:', error);
            showNotification('Export Failed', 'Unable to export data. Please try again.', 'error');
        }
    };

    // ============================================
    // PRINT DASHBOARD FUNCTIONALITY
    // ============================================

    window.printDashboard = function() {
        window.print();
        trackEvent('Data', 'Print', 'Dashboard');
    };

    // Add print styles
    const printStyles = document.createElement('style');
    printStyles.textContent = `
        @media print {
            .cc-navbar,
            .chat-widget,
            .chat-toggle,
            .quick-actions,
            .footer,
            .alert-banner,
            .notification,
            #dashboardLoadingOverlay,
            #tourOverlay,
            #tourSpotlight,
            #tourTooltip,
            .celebration-modal {
                display: none !important;
            }

            body {
                background: white !important;
            }

            .dashboard-container {
                margin-top: 0 !important;
            }

            .stat-card,
            .school-card,
            .timeline-item,
            .task-item {
                break-inside: avoid;
            }

            .school-grid,
            .stats-overview {
                display: block !important;
            }

            .stat-card,
            .school-card {
                margin-bottom: 1rem;
                page-break-inside: avoid;
            }
        }
    `;
    document.head.appendChild(printStyles);

    // ============================================
    // ACCESSIBILITY IMPROVEMENTS
    // ============================================

    // Add keyboard navigation for school cards
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') {
            const focusableElements = document.querySelectorAll('a, button, input, .school-card, .stat-card');
            const focused = document.activeElement;
            
            // Ensure focus is visible
            if (focused && focusableElements.length > 0) {
                focused.style.outline = '2px solid var(--accent-color)';
                focused.style.outlineOffset = '2px';
            }
        }
    });

    // Add ARIA labels dynamically
    function enhanceAccessibility() {
        document.querySelectorAll('.stat-card').forEach((card, index) => {
            card.setAttribute('role', 'button');
            card.setAttribute('tabindex', '0');
            card.setAttribute('aria-label', `Statistic card ${index + 1}: ${card.querySelector('.stat-label')?.textContent}`);
        });

        document.querySelectorAll('.school-card').forEach((card, index) => {
            card.setAttribute('role', 'article');
            card.setAttribute('tabindex', '0');
            card.setAttribute('aria-label', `School recommendation ${index + 1}: ${card.querySelector('.school-name')?.textContent}`);
        });

        document.querySelectorAll('.timeline-item').forEach((item, index) => {
            item.setAttribute('role', 'article');
            item.setAttribute('aria-label', `Timeline event ${index + 1}`);
        });
    }

    // Run accessibility enhancements after DOM loads
    setTimeout(enhanceAccessibility, 2000);

    // ============================================
    // AUTO-SAVE FUNCTIONALITY
    // ============================================

    let autoSaveQueue = [];
    let isSaving = false;

    async function autoSaveToFirebase() {
        if (isSaving || autoSaveQueue.length === 0 || !window.currentUser) return;

        isSaving = true;
        const saveData = autoSaveQueue.shift();

        try {
            await window.updateDoc(window.doc(window.db, 'users', window.currentUser.uid), {
                ...saveData,
                lastAutoSave: new Date()
            });
            console.log('üíæ Auto-save complete');
        } catch (error) {
            console.error('Auto-save error:', error);
            autoSaveQueue.unshift(saveData); // Re-queue on error
        } finally {
            isSaving = false;
            if (autoSaveQueue.length > 0) {
                setTimeout(autoSaveToFirebase, 1000);
            }
        }
    }

    window.queueAutoSave = function(data) {
        autoSaveQueue.push(data);
        setTimeout(autoSaveToFirebase, 2000); // Debounce by 2 seconds
    };

    // ============================================
    // REAL-TIME SYNC INDICATOR
    // ============================================

    function showSyncIndicator(status) {
        let indicator = document.getElementById('syncIndicator');
        
        if (!indicator) {
            indicator = document.createElement('div');
            indicator.id = 'syncIndicator';
            indicator.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                padding: 0.5rem 1rem;
                border-radius: 20px;
                font-size: 0.85rem;
                font-weight: 600;
                z-index: 9996;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                transition: all 0.3s ease;
            `;
            document.body.appendChild(indicator);
        }

        if (status === 'syncing') {
            indicator.style.background = 'rgba(59, 130, 246, 0.1)';
            indicator.style.color = '#3b82f6';
            indicator.style.border = '1px solid rgba(59, 130, 246, 0.3)';
            indicator.innerHTML = '<div class="loading" style="width: 12px; height: 12px; border-width: 2px;"></div> Syncing...';
            indicator.style.opacity = '1';
        } else if (status === 'synced') {
            indicator.style.background = 'rgba(16, 185, 129, 0.1)';
            indicator.style.color = '#10b981';
            indicator.style.border = '1px solid rgba(16, 185, 129, 0.3)';
            indicator.innerHTML = '<i class="fas fa-check-circle"></i> Synced';
            indicator.style.opacity = '1';
            setTimeout(() => {
                indicator.style.opacity = '0';
            }, 2000);
        } else if (status === 'error') {
            indicator.style.background = 'rgba(239, 68, 68, 0.1)';
            indicator.style.color = '#ef4444';
            indicator.style.border = '1px solid rgba(239, 68, 68, 0.3)';
            indicator.innerHTML = '<i class="fas fa-exclamation-circle"></i> Sync Error';
            indicator.style.opacity = '1';
            setTimeout(() => {
                indicator.style.opacity = '0';
            }, 3000);
        }
    }

    // Monitor Firebase connection
    if (window.db) {
        window.onSnapshot = window.onSnapshot || function() {};
        // Connection monitoring would go here
    }

    // ============================================
    // CONTEXT MENU FOR SCHOOL CARDS
    // ============================================

    document.addEventListener('contextmenu', function(e) {
        const schoolCard = e.target.closest('.school-card');
        if (schoolCard) {
            e.preventDefault();
            const schoolName = schoolCard.querySelector('.school-name')?.textContent;
            
            const menu = document.createElement('div');
            menu.id = 'contextMenu';
            menu.style.cssText = `
                position: fixed;
                top: ${e.clientY}px;
                left: ${e.clientX}px;
                background: var(--primary-bg);
                border: 1px solid rgba(160, 123, 204, 0.2);
                border-radius: 12px;
                padding: 0.5rem;
                box-shadow: var(--shadow);
                z-index: 10001;
                min-width: 180px;
            `;
            
            menu.innerHTML = `
                <div class="context-menu-item" onclick="openCollegeProfile('${schoolName}'); removeContextMenu();">
                    <i class="fas fa-eye"></i> View Details
                </div>
                <div class="context-menu-item" onclick="addToApplicationList('${schoolName}'); removeContextMenu();">
                    <i class="fas fa-plus"></i> Add to List
                </div>
                <div class="context-menu-item" onclick="compareWithOthers('${schoolName}'); removeContextMenu();">
                    <i class="fas fa-balance-scale"></i> Compare
                </div>
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                .context-menu-item {
                    padding: 0.75rem 1rem;
                    cursor: pointer;
                    border-radius: 8px;
                    transition: all 0.2s;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    color: var(--text-primary);
                }
                .context-menu-item:hover {
                    background: var(--secondary-bg);
                    color: var(--accent-color);
                }
            `;
            if (!document.getElementById('contextMenuStyles')) {
                style.id = 'contextMenuStyles';
                document.head.appendChild(style);
            }
            
            document.body.appendChild(menu);
            
            setTimeout(() => {
                document.addEventListener('click', removeContextMenu);
            }, 0);
        }
    });

    window.removeContextMenu = function() {
        const menu = document.getElementById('contextMenu');
        if (menu) menu.remove();
        document.removeEventListener('click', removeContextMenu);
    };

    window.compareWithOthers = function(schoolName) {
        sessionStorage.setItem('compareSchool', schoolName);
        openCompareSchools();
    };

    // ============================================
    // FINAL SYSTEM CHECKS
    // ============================================

    console.log('üéØ Running final system checks...');

    // Verify all critical elements
    const criticalElements = [
        'chatWidget',
        'chatToggle',
        'applicationTimeline',
        'schoolGrid',
        'aiInsights',
        'taskList',
        'progressCircle'
    ];

    criticalElements.forEach(id => {
        const element = document.getElementById(id);
        if (!element) {
            console.warn(`‚ö†Ô∏è Critical element missing: ${id}`);
        } else {
            console.log(`‚úÖ ${id} found`);
        }
    });

    // Verify Firebase connection
    if (window.auth && window.db) {
        console.log('‚úÖ Firebase connected');
    } else {
        console.error('‚ùå Firebase connection issue');
    }

    // Verify service worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.ready.then(() => {
            console.log('‚úÖ Service Worker ready');
        });
    }

    // Log completion
    console.log('');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log('üéâ COLLEGE CLIMB DASHBOARD FULLY LOADED');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log('‚ú® All systems operational');
    console.log('üì± PWA: Enabled');
    console.log('üî• Firebase: Connected');
    console.log('ü§ñ AI: Ready');
    console.log('üíæ Auto-save: Active');
    console.log('‚å®Ô∏è  Keyboard shortcuts: Enabled');
    console.log('‚ôø Accessibility: Enhanced');
    console.log('üìä Analytics: Tracking');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log('');
</script>

<style>
    /* Additional responsive improvements */
    @media (max-width: 768px) {
        #pwaInstallBanner {
            left: 10px !important;
            right: 10px !important;
            bottom: 10px !important;
            max-width: none !important;
        }

        #contextMenu {
            max-width: calc(100vw - 40px) !important;
        }
    }

    /* Smooth scrolling for all links */
    html {
        scroll-behavior: smooth;
    }

    /* Focus visible for accessibility */
    *:focus-visible {
        outline: 2px solid var(--accent-color);
        outline-offset: 2px;
    }

    /* Reduced motion for accessibility */
    @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }
</style>
</body>
</html>y-bg);
            border-top-color: var(--accent-color);
            animation: cc-spin 1s linear infinite;{
        }   box-shadow: 0 0 0 3px rgba(160, 123, 204, 0.4);
            border-color: var(--accent-color);
        @keyframes cc-spin {
            to { transform: rotate(360deg); }
        }data-theme="dark"] .cc-profile-dropdown.open .cc-user-avatar {
            box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.5);
        /* Active state indicator */
        .cc-profile-dropdown.open .cc-user-avatar {
            box-shadow: 0 0 0 3px rgba(160, 123, 204, 0.4);
            border-color: var(--accent-color);
        }  ============================================ */

        [data-theme="dark"] .cc-profile-dropdown.open .cc-user-avatar {
            box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.5);
        }   top: 0;
            left: 0;
        /* Main Profile Container */
        .profile-container {
            margin-top: 100px;
            padding: 2rem;
            max-width: 1200px;y 0.3s ease;
            margin-left: auto;
            margin-right: auto;
            min-height: calc(100vh - 200px);
        }   opacity: 1;
        }
        /* Profile Header */
        .profile-header {
            background: var(--gradient);
            background-size: 200% 200%;255, 0.8);
            animation: gradientShift 8s ease-in-out infinite;
            border-radius: 24px;s infinite ease-in-out;
            padding: 3rem 2rem;
            text-align: center;
            margin-bottom: 3rem;
            box-shadow: var(--shadow);ransform: scale(0.8); }
            color: white;: 1; transform: scale(1.2); }
            position: relative;
            overflow: hidden;
        }* Enhanced Dashboard Container */
        .dashboard-container {
        .profile-header::before {
            content: '';m;
            position: absolute;
            top: -50%;t: auto;
            left: -50%;t: auto;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }   background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #a07bcc 100%);
            border-radius: 32px;
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }   box-shadow: 
                0 25px 50px rgba(42, 53, 122, 0.15),
        @keyframes rotate {rgba(160, 123, 204, 0.2),
            0% { transform: rotate(0deg); }, 255, 0.2);
            100% { transform: rotate(360deg); }
        }   position: relative;
            overflow: hidden;
        .profile-photo-container {(255, 255, 255, 0.1);
            position: relative;
            display: inline-block;
            margin-bottom: 1.5rem;
            z-index: 2;;
        }   position: absolute;
            top: 0;
        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;t(circle at 20% 80%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
            border: 4px solid rgba(255, 255, 255, 0.3);(255, 255, 255, 0.1) 0%, transparent 50%),
            transition: all 0.3s ease; at 40% 40%, rgba(160, 123, 204, 0.3) 0%, transparent 50%);
            cursor: pointer;none;
        }

        .profile-photo:hover {
            transform: scale(1.05);, 5vw, 3.5rem);
            border-color: rgba(255, 255, 255, 0.6);
        }   margin-bottom: 1rem;
            position: relative;
        .profile-photo-upload {
            position: absolute;20px rgba(0, 0, 0, 0.3);
            bottom: 5px;ng: -0.02em;
            right: 5px;: 1.1;
            background: var(--accent-color);
            color: white;
            border: none;p {
            border-radius: 50%;
            width: 45px;5;
            height: 45px;ative;
            cursor: pointer;
            display: flex;px;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem; 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: 3px solid white;
        }alert-banner {
            background: linear-gradient(135deg, var(--warning-color), #ff6b35);
        .profile-photo-upload:hover:not([disabled]) {
            transform: scale(1.1);
            background: white;x;
            color: var(--accent-color);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }   align-items: center;
            justify-content: space-between;
        .profile-photo-upload:disabled {ease;
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }   display: flex;
        }
        .file-upload-input {
            display: none !important;
            position: absolute;ranslateY(-20px); opacity: 0; }
            left: -9999px;: translateY(0); opacity: 1; }
            opacity: 0;
            pointer-events: none;
        }* Enhanced Statistics with Real Data */
        .stats-overview {
        .profile-name {id;
            font-size: 2.5rem;mns: repeat(auto-fit, minmax(280px, 1fr));
            font-weight: 700;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 2;
        }stat-card {
            background: var(--primary-bg);
        .profile-email {s: 24px;
            font-size: 1.2rem;
            opacity: 0.9;ar(--shadow);
            position: relative;s ease;
            z-index: 2;nter;
        }   border: 1px solid rgba(160, 123, 204, 0.1);
            position: relative;
        /* Profile Content Grid */
        .profile-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;';
            margin-bottom: 3rem;
        }   top: 0;
            left: 0;
        .profile-section {
            background: var(--primary-bg);
            border-radius: 20px;adient);
            padding: 2rem;ight 0.3s ease;
            box-shadow: var(--shadow);
            border: 1px solid rgba(160, 123, 204, 0.1);
            transition: all 0.3s ease;
        }   height: 8px;
        }
        .profile-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(42, 53, 122, 0.15);
        }   box-shadow: 0 25px 60px rgba(42, 53, 122, 0.2);
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;-between;
            display: flex; 1.5rem;
            align-items: center;
            gap: 0.5rem;
        }stat-icon {
            width: 60px;
        .form-group {0px;
            margin-bottom: 1.5rem;
        }   background: var(--gradient);
            display: flex;
        .form-label {ms: center;
            display: block;: center;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem; rgba(160, 123, 204, 0.3);
            font-size: 0.95rem;
        }
        .stat-trend {
        .form-input {flex;
            width: 100%; center;
            padding: 0.75rem 1rem;
            border: 2px solid rgba(160, 123, 204, 0.2);
            border-radius: 12px;
            background: var(--secondary-bg);
            color: var(--text-primary);
            font-size: 1rem;(16, 185, 129, 0.1);
            transition: all 0.3s ease;);
            outline: none;
        }
        .stat-value {
        .form-input:focus {;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(160, 123, 204, 0.1);
            background: var(--primary-bg);
        }   line-height: 1;
        }
        .form-textarea {
            min-height: 120px;
            resize: vertical;-secondary);
        }   font-size: 1rem;
            font-weight: 500;
        .form-select {tom: 1rem;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23a07bcc'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1rem;ndary);
            padding-right: 3rem;
        }

        .btn {anced Dashboard Grid */
            padding: 0.75rem 1.5rem;
            border: none;;
            border-radius: 12px;s: 2fr 1fr;
            font-weight: 600;
            font-size: 1rem;rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;var(--primary-bg);
            text-decoration: none;
            justify-content: center;
        }   box-shadow: var(--shadow);
            border: 1px solid rgba(160, 123, 204, 0.1);
        .btn-primary {tom: 2rem;
            background: var(--gradient);
            color: white;
        }match-header {
            display: flex;
        .btn-primary:hover { space-between;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--secondary-bg);
            color: var(--text-primary);
            border: 2px solid rgba(160, 123, 204, 0.2);
        }   display: flex;
            align-items: center;
        .btn-secondary:hover {
            border-color: var(--accent-color);
            background: var(--primary-bg);
        }ai-badge {
            background: var(--gradient);
        .btn-danger {ite;
            background: var(--danger-color);
            color: white;: 20px;
        }   font-size: 0.8rem;
            font-weight: 600;
        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Questionnaire Section */
        .questionnaire-full {
            grid-column: 1 / -1;s: repeat(auto-fit, minmax(300px, 1fr));
        }   gap: 1.5rem;
        }
        .questionnaire-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;s: 16px;
            margin-top: 1rem;
        }   border: 1px solid rgba(160, 123, 204, 0.1);
            transition: all 0.3s ease;
        .question-group {ative;
            background: var(--secondary-bg);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid rgba(160, 123, 204, 0.1);
        }   border-color: var (--accent-color);
            box-shadow: 0 8px 25px rgba(160, 123, 204, 0.15);
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;olute;
            margin-top: 0.5rem;
        }   right: 1rem;
            background: var(--accent-color);
        .checkbox-item {;
            display: flex;m;
            align-items: center;
            gap: 0.5rem;.8rem;
            padding: 0.5rem;;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }   align-items: center;
            justify-content: center;
        .checkbox-item:hover {
            background: var(--primary-bg);
        }school-name {
            font-size: 1.2rem;
        .checkbox-item input[type="checkbox"] {
            width: 18px;--text-primary);
            height: 18px;: 0.5rem;
            accent-color: var(--accent-color);
        }
        .school-details {
        .checkbox-item label {
            cursor: pointer;column;
            font-size: 0.9rem;
        }   margin-bottom: 1rem;
        }
        /* Success/Error Messages */
        .message {tail {
            padding: 1rem 1.5rem;
            border-radius: 12px;ce-between;
            margin-bottom: 1.5rem;
            font-weight: 500;;
            display: none;
        }
        .detail-label {
        .message.success {ext-secondary);
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }   font-weight: 600;
            color: var (--text-primary);
        .message.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }   background: var(--primary-bg);
            border-radius: 24px;
        /* Loading States */
        .loading {adow: var(--shadow);
            opacity: 0.6;olid rgba(160, 123, 204, 0.1);
            pointer-events: none;
            position: relative;
        }
        .panel-header {
        .loading::after {: 2rem;
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;relative;
            width: 20px;m 0;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }   top: 0;
            bottom: 0;
        @keyframes spin {
            to { transform: rotate(360deg); }
        }   transform: translateX(-50%);
        }
        /* Footer */
        .footer {-item {
            background: var(--gradient);
            padding: 3rem 0;rem;
            text-align: center;
            margin-top: 4rem;er;
            color: white;
            position: relative;
            overflow: hidden;ild(odd) {
        }   flex-direction: row;
        }
        .footer::before {
            content: '';th-child(even) {
            position: absolute;-reverse;
            top: -50%;
            left: -50%;
            width: 200%;t {
            height: 200%;ar(--secondary-bg);
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }   border: 1px solid rgba(160, 123, 204, 0.1);
            width: 45%;
        .footer-content {ative;
            max-width: 1200px;3s ease;
            margin: 0 auto;
            display: flex;
            align-items: center;{
            justify-content: space-between;
            gap: 2rem;: 0 8px 25px rgba(160, 123, 204, 0.15);
            flex-wrap: wrap;
            padding: 0 2rem;
            position: relative;
            z-index: 2;bsolute;
        }   left: 50%;
            transform: translateX(-50%);
        .footer-logo {x;
            height: 60px;
            width: 60px;var(--gradient);
            border-radius: 12px;
            overflow: hidden;
        }   align-items: center;
            justify-content: center;
        .footer-logo img {
            width: 100%;.2rem;
            height: 100%; 4px 15px rgba(160, 123, 204, 0.3);
            object-fit: contain;
            filter: brightness(0) invert(1);
        }
        .timeline-date {
        .footer-text { 0.9rem;
            font-size: 1.1rem;
            opacity: 0.9;accent-color);
            flex: 1;ottom: 0.5rem;
            text-align: center;
            font-weight: 500;
        }timeline-title {
            font-size: 1.2rem;
        .footer-socials {700;
            display: flex;ext-primary);
            gap: 1rem;tom: 0.5rem;
        }

        .footer-socials a {on {
            display: flex;ext-secondary);
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }   gap: 2rem;
        }
        .footer-socials a:hover {
            transform: translateY(-5px) scale(1.1);
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
        }   border-radius: 24px;
            padding: 2rem;
        .footer-socials a img {hadow);
            height: 24px;olid rgba(160, 123, 204, 0.1);
            width: 24px;
            filter: invert(1);
        }task-list {
            display: flex;
        /* Responsive Design */umn;
        @media (max-width: 1024px) {
            .profile-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }isplay: flex;
            align-items: center;
            .questionnaire-grid {
                grid-template-columns: 1fr;
            }ackground: var (--secondary-bg);
            border-radius: 12px;
            .navbar {px solid rgba(160, 123, 204, 0.1);
                padding: 1rem 1.5rem;;
            }
        }
        .task-item:hover {
        @media (max-width: 768px) {px);
            .navbar {lor: var (--accent-color);
                padding: 1rem;
                flex-wrap: wrap;
            }-checkbox {
            width: 20px;
            .nav-links {;
                gap: 1rem;var(--accent-color);
                font-size: 0.9rem;
            }
            k-content {
            .logo {;
                width: 40px;
                height: 40px;
            }-title {
            font-weight: 600;
            .brand-text h1, .brand-text h2 {
                font-size: 1.2rem;;
            }
            
            .profile-container {
                padding: 1rem;
                margin-top: 80px;ondary);
            }
            
            .profile-header {
                padding: 2rem 1.5rem;
                margin-bottom: 2rem;
            }order-radius: 50%;
            background: var(--warning-color);
            .profile-photo {
                width: 120px;
                height: 120px;background: var(--danger-color); }
            }-priority.medium { background: var(--warning-color); }
            k-priority.low { background: var(--success-color); }
            .profile-name {
                font-size: 2rem;cle */
            }ress-circle {
            width: 140px;
            .profile-email {
                font-size: 1rem;
            }argin: 0 auto 2rem;
            
            .profile-section {
            transform: scale(1.1);
                   color: var(--accent-color);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }   align-items: center;
            justify-content: space-between;
        .profile-photo-upload:disabled {ease;
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }   display: flex;
        }
        .file-upload-input {
            display: none !important;
            position: absolute;ranslateY(-20px); opacity: 0; }
            left: -9999px;: translateY(0); opacity: 1; }
            opacity: 0;
            pointer-events: none;
        }* Enhanced Statistics with Real Data */
        .stats-overview {
        .profile-name {id;
            font-size: 2.5rem;mns: repeat(auto-fit, minmax(280px, 1fr));
            font-weight: 700;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 2;
        }stat-card {
            background: var(--primary-bg);
        .profile-email {s: 24px;
            font-size: 1.2rem;
            opacity: 0.9;ar(--shadow);
            position: relative;s ease;
            z-index: 2;nter;
        }   border: 1px solid rgba(160, 123, 204, 0.1);
            position: relative;
        /* Profile Content Grid */
        .profile-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;';
            margin-bottom: 3rem;
        }   top: 0;
            left: 0;
        .profile-section {
            background: var(--primary-bg);
            border-radius: 20px;adient);
            padding: 2rem;ight 0.3s ease;
            box-shadow: var(--shadow);
            border: 1px solid rgba(160, 123, 204, 0.1);
            transition: all 0.3s ease;
        }   height: 8px;
        }
        .profile-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(42, 53, 122, 0.15);
        }   box-shadow: 0 25px 60px rgba(42, 53, 122, 0.2);
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;-between;
            display: flex; 1.5rem;
            align-items: center;
            gap: 0.5rem;
        }stat-icon {
            width: 60px;
        .form-group {0px;
            margin-bottom: 1.5rem;
        }   background: var(--gradient);
            display: flex;
        .form-label {ms: center;
            display: block;: center;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem; rgba(160, 123, 204, 0.3);
            font-size: 0.95rem;
        }
        .stat-trend {
        .form-input {flex;
            width: 100%; center;
            padding: 0.75rem 1rem;
            border: 2px solid rgba(160, 123, 204, 0.2);
            border-radius: 12px;
            background: var(--secondary-bg);
            color: var(--text-primary);
            font-size: 1rem;(16, 185, 129, 0.1);
            transition: all 0.3s ease;);
            outline: none;
        }
        .stat-value {
        .form-input:focus {;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(160, 123, 204, 0.1);
            background: var(--primary-bg);
        }   line-height: 1;
        }
        .form-textarea {
            min-height: 120px;
            resize: vertical;-secondary);
        }   font-size: 1rem;
            font-weight: 500;
        .form-select {tom: 1rem;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23a07bcc'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1rem;ndary);
            padding-right: 3rem;
        }

        .btn {anced Dashboard Grid */
            padding: 0.75rem 1.5rem;
            border: none;;
            border-radius: 12px;s: 2fr 1fr;
            font-weight: 600;
            font-size: 1rem;rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;var(--primary-bg);
            text-decoration: none;
            justify-content: center;
        }   box-shadow: var(--shadow);
            border: 1px solid rgba(160, 123, 204, 0.1);
        .btn-primary {tom: 2rem;
            background: var(--gradient);
            color: white;
        }match-header {
            display: flex;
        .btn-primary:hover { space-between;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--secondary-bg);
            color: var(--text-primary);
            border: 2px solid rgba(160, 123, 204, 0.2);
        }   display: flex;
            align-items: center;
        .btn-secondary:hover {
            border-color: var(--accent-color);
            background: var(--primary-bg);
        }ai-badge {
            background: var(--gradient);
        .btn-danger {ite;
            background: var(--danger-color);
            color: white;: 20px;
        }   font-size: 0.8rem;
            font-weight: 600;
        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Questionnaire Section */
        .questionnaire-full {
            grid-column: 1 / -1;s: repeat(auto-fit, minmax(300px, 1fr));
        }   gap: 1.5rem;
        }
        .questionnaire-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;s: 16px;
            margin-top: 1rem;
        }   border: 1px solid rgba(160, 123, 204, 0.1);
            transition: all 0.3s ease;
        .question-group {ative;
            background: var(--secondary-bg);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid rgba(160, 123, 204, 0.1);
        }   border-color: var (--accent-color);
            box-shadow: 0 8px 25px rgba(160, 123, 204, 0.15);
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;olute;
            margin-top: 0.5rem;
        }   right: 1rem;
            background: var(--accent-color);
        .checkbox-item {;
            display: flex;m;
            align-items: center;
            gap: 0.5rem;.8rem;
            padding: 0.5rem;;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }   align-items: center;
            justify-content: center;
        .checkbox-item:hover {
            background: var(--primary-bg);
        }school-name {
            font-size: 1.2rem;
        .checkbox-item input[type="checkbox"] {
            width: 18px;--text-primary);
            height: 18px;: 0.5rem;
            accent-color: var(--accent-color);
        }
        .school-details {
        .checkbox-item label {
            cursor: pointer;column;
            font-size: 0.9rem;
        }   margin-bottom: 1rem;
        }
        /* Success/Error Messages */
        .message {tail {
            padding: 1rem 1.5rem;
            border-radius: 12px;ce-between;
            margin-bottom: 1.5rem;
            font-weight: 500;;
            display: none;
        }
        .detail-label {
        .message.success {ext-secondary);
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }   font-weight: 600;
            color: var (--text-primary);
        .message.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }   background: var(--primary-bg);
            border-radius: 24px;
        /* Loading States */
        .loading {adow: var(--shadow);
            opacity: 0.6;olid rgba(160, 123, 204, 0.1);
            pointer-events: none;
            position: relative;
        }
        .panel-header {
        .loading::after {: 2rem;
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;relative;
            width: 20px;m 0;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }   top: 0;
            bottom: 0;
        @keyframes spin {
            to { transform: rotate(360deg); }
        }   transform: translateX(-50%);
        }
        /* Footer */
        .footer {-item {
            background: var(--gradient);
            padding: 3rem 0;rem;
            text-align: center;
            margin-top: 4rem;er;
            color: white;
            position: relative;
            overflow: hidden;ild(odd) {
        }   flex-direction: row;
        }
        .footer::before {
            content: '';th-child(even) {
            position: absolute;-reverse;
            top: -50%;
            left: -50%;
            width: 200%;t {
            height: 200%;ar(--secondary-bg);
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }   border: 1px solid rgba(160, 123, 204, 0.1);
            width: 45%;
        .footer-content {ative;
            max-width: 1200px;3s ease;
            margin: 0 auto;
            display: flex;
            align-items: center;{
            justify-content: space-between;
            gap: 2rem;: 0 8px 25px rgba(160, 123, 204, 0.15);
            flex-wrap: wrap;
            padding: 0 2rem;
            position: relative;
            z-index: 2;bsolute;
        }   left: 50%;
            transform: translateX(-50%);
        .footer-logo {x;
            height: 60px;
            width: 60px;var(--gradient);
            border-radius: 12px;
            overflow: hidden;
        }   align-items: center;
            justify-content: center;
        .footer-logo img {
            width: 100%;.2rem;
            height: 100%; 4px 15px rgba(160, 123, 204, 0.3);
            object-fit: contain;
            filter: brightness(0) invert(1);
        }
        .timeline-date {
        .footer-text { 0.9rem;
            font-size: 1.1rem;
            opacity: 0.9;accent-color);
            flex: 1;ottom: 0.5rem;
            text-align: center;
            font-weight: 500;
        }timeline-title {
            font-size: 1.2rem;
        .footer-socials {700;
            display: flex;ext-primary);
            gap: 1rem;tom: 0.5rem;
        }

        .footer-socials a {on {
            display: flex;ext-secondary);
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }   gap: 2rem;
        }
        .footer-socials a:hover {
            transform: translateY(-5px) scale(1.1);
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
        }   border-radius: 24px;
            padding: 2rem;
        .footer-socials a img {hadow);
            height: 24px;olid rgba(160, 123, 204, 0.1);
            width: 24px;
            filter: invert(1);
        }task-list {
            display: flex;
        /* Responsive Design */umn;
        @media (max-width: 1024px) {
            .profile-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }isplay: flex;
            align-items: center;
            .questionnaire-grid {
                grid-template-columns: 1fr;
            }ackground: var (--secondary-bg);
            border-radius: 12px;
            .navbar {px solid rgba(160, 123, 204, 0.1);
                padding: 1rem 1.5rem;;
            }
        }
        .task-item:hover {
        @media (max-width: 768px) {px);
            .navbar {lor: var (--accent-color);
                padding: 1rem;
                flex-wrap: wrap;
            }-checkbox {
            width: 20px;
            .nav-links {;
                gap: 1rem;var(--accent-color);
                font-size: 0.9rem;
            }
            k-content {
            .logo {;
                width: 40px;
                height: 40px;
            }-title {
            font-weight: 600;
            .brand-text h1, .brand-text h2 {
                font-size: 1.2rem;;
            }
            
            .profile-container {
                padding: 1rem;
                margin-top: 80px;ondary);
            }
            
            .profile-header {
                padding: 2rem 1.5rem;
                margin-bottom: 2rem;
            }order-radius: 50%;
            background: var(--warning-color);
            .profile-photo {
                width: 120px;
                height: 120px;background: var(--danger-color); }
            }-priority.medium { background: var(--warning-color); }
            k-priority.low { background: var(--success-color); }
            .profile-name {
                font-size: 2rem;cle */
            }ress-circle {
            width: 140px;
            .profile-email {
                font-size: 1rem;
            }argin: 0 auto 2rem;
            
            .profile-section {
                padding: 1.5rem;
            }idth: 100%;
            height: 100%;
            .questionnaire-grid {deg);
                gap: 1rem;
            }
            gress-circle-bg {
            .checkbox-group {
                grid-template-columns: 1fr;);
            }troke-width: 8;
            
            .footer-content {
                flex-direction: column;
                text-align: center;
                gap: 1.5rem;cent-color);
            }troke-width: 8;
        }   stroke-linecap: round;
            transition: stroke-dashoffset 2s ease;
        @media (max-width: 480px) {
            .navbar {
                padding: 0.75rem;
            }osition: absolute;
            top: 50%;
            .nav-links {
                gap: 0.5rem;late(-50%, -50%);
                font-size: 0.8rem;
            }
            
            .profile-container {centage" id="progressText">0%</div>
                padding: 0.75rem;
                margin-top: 70px;
            }olor: var(--text-secondary);
            font-weight: 500;
            .profile-header {
                padding: 1.5rem 1rem;
                margin-bottom: 1.5rem;
            }-widget {
            position: fixed;
            .profile-photo {
                width: 100px;
                height: 100px;
            }eight: 600px;
            background: var(--primary-bg);
            .profile-name {24px;
                font-size: 1.5rem;ow);
            }order: 1px solid rgba(160, 123, 204, 0.1);
            z-index: 1000;
            .section-title {lateY(100vh);
                font-size: 1.2rem;ubic-bezier(0.4, 0, 0.2, 1);
            }verflow: hidden;
            
            .btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;0);
            }
        }
        .chat-header {
        /* Animations */var(--gradient);
        .fade-in-up {ite;
            opacity: 0;5rem;
            transform: translateY(30px);
            transition: all 0.6s ease;ween;
        }   align-items: center;
        }
        .fade-in-up.visible {
            opacity: 1;
            transform: translateY(0);
        }   display: flex;
            align-items: center;
        /* File Upload Styling */
        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }   height: 8px;
            background: var(--success-color);
        .file-upload-input {0%;
            position: absolute; infinite;
            left: -9999px;
        }
        @keyframes pulse {
        .file-upload-button {y: 1; }
            background: var(--accent-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }   font-size: 1.5rem;
            cursor: pointer;
        .file-upload-button:hover {.2s ease;
            background: #8b5fbf;
            transform: translateY(-2px);
        }chat-close:hover {
    </style>transform: rotate(90deg);
</head> }
<body data-theme="dark">
    <div class="starry-bg" id="starryBg"></div>
            height: 400px;
    <!-- Navigation --> auto;
    <nav class="cc-navbar">;
        <a href="index.html" class="cc-logo-section">
            <div class="cc-logo">n;
                <img id="navbarLogo" src="images/whiteclearcc.png" alt="College Climb Logo">
            </div>
            <div class="cc-brand-text">
                <h1>College</h1>
                <h2>Climb</h2>
            </div>g: 1rem;
        </a>border-radius: 16px;
        <div class="cc-nav-right">
            <button class="cc-theme-toggle" id="themeToggle">‚òÄÔ∏è</button>
            <div class="cc-profile-dropdown" id="profileDropdown">
                <button class="cc-profile-button" id="profileButton">
                    <div class="cc-profile-loading" id="profileLoading"></div>
                    <img id="navUserAvatar" class="cc-user-avatar" src="images/default-avatar.svg" alt="Profile" style="display: none;">
                </button>
                <div class="cc-dropdown-menu" id="dropdownMenu">
                    <div class="cc-dropdown-header" id="dropdownHeader">
                        <div class="cc-dropdown-welcome">Welcome Back</div>
                        <div class="cc-dropdown-name" id="dropdownName">Loading...</div>
                        <div class="cc-dropdown-email" id="dropdownEmail"></div>
                    </div>r(--secondary-bg);
                    <a href="profile.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">üë§</span>
                        <span>My Profile</span>4, 0.1);
                    </a>m-left-radius: 4px;
                    <a href="myapp.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">üìö</span>
                        <span>My Applications</span>
                    </a>rem;
                    <a href="dashboard.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">üìä</span>
                        <span>Dashboard</span>
                    </a> center;
                    <a href="testprep.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">üìö</span>
                        <span>Test Prep</span>
                    </a>
                    <a href="essaycoach.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">‚úçÔ∏è</span>
                        <span>Essay Coach</span>
                    </a>var(--secondary-bg);
                    <a href="settings.html" class="cc-dropdown-link">
                        <span class="cc-dropdown-link-icon">‚öôÔ∏è</span>
                        <span>Settings</span>
                    </a>all 0.3s ease;
                    <div class="cc-dropdown-divider"></div>
                    <a href="#" class="cc-dropdown-link cc-logout-link" id="logoutBtn">
                        <span class="cc-dropdown-link-icon">üö™</span>
                        <span>Logout</span>r);
                    </a>0 0 0 3px rgba(160, 123, 204, 0.1);
                </div>
            </div>
        </div>send {
    </nav>  width: 44px;
            height: 44px;
    <!-- Main Profile Container -->
    <div class="profile-container">ent);
        <!-- Profile Header -->
        <div class="profile-header fade-in-up">
            <div class="profile-photo-container">
                <img id="profilePhoto" src="images/default-avatar.svg" alt="Profile Photo" class="profile-photo">
                <button class="profile-photo-upload" onclick="document.getElementById('photoUpload').click()" type="button">
                    üì∑ntent: center;
                </button>ll 0.3s ease;
                <input type="file" id="photoUpload" class="file-upload-input" accept="image/*" style="display: none;">
            </div>
            t-send:hover {
            <!-- Add visible upload button as well -->
            <div style="margin-top: 1rem; margin-bottom: 1rem;">
                <button class="btn btn-secondary" onclick="document.getElementById('photoUpload').click()" type="button">
                    üì∑ Change Profile Photo
                </button>
            </div>: not-allowed;
            transform: none;
            <h1 class="profile-name" id="profileName">Loading...</h1>
            <p class="profile-email" id="profileEmail">Loading...</p>
        </div>t Toggle Button */
        .chat-toggle {
        <!-- Success/Error Messages -->
        <div id="successMessage" class="message success">
            ‚úÖ Profile updated successfully!
        </div>dth: 60px;
        <div id="errorMessage" class="message error">
            ‚ùå Something went wrong. Please try again.
        </div>ckground: var (--gradient);
            color: white;
        <!-- Profile Content -->
        <div class="profile-content fade-in-up">
            <!-- Personal Information -->
            <div class="profile-section">
                <h2 class="section-title">üë§ Personal Information</h2>
                sition: all 0.3s ease;
                <!-- Profile Photo Upload Section -->
                <div class="form-group">
                    <label class="form-label">Profile Photo</label>
                    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                        <div style="position: relative;">
                            <img id="profilePhotoPreview" src="images/default-avatar.svg" alt="Profile Preview" 
                                 style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent-color);">
                        </div>);
                        <div>
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('photoUpload').click()">
                                üì∑ Choose Photo
                            </button>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                Supported: JPG, PNG, GIF, WebP (Max 10MB)
                            </p>
                        </div>rgba(160, 123, 204, 0.3);
                    </div> 50%;
                    <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                </div> spin 1s ease-in-out infinite;
                
                <form id="personalInfoForm">
                    <div class="form-group">
                        <label class="form-label" for="displayName">Display Name</label>
                        <input type="text" id="displayName" class="form-input" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="phoneNumber">Phone Number</label>
                        <input type="tel" id="phoneNumber" class="form-input" placeholder="(555) 123-4567">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="dateOfBirth">Date of Birth</label>
                        <input type="date" id="dateOfBirth" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="location">Location</label>
                        <input type="text" id="location" class="form-input" placeholder="City, State">
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
                </form> var(--primary-bg);
            </div>-radius: 8px;
            border: 1px solid rgba(160, 123, 204, 0.1);
            <!-- Academic Information -->
            <div class="profile-section">
                <h2 class="section-title">üéì Academic Information</h2>
                <form id="academicInfoForm">
                    <div class="form-group">
                        <label class="form-label" for="currentGrade">Current Grade Level</label>
                        <select id="currentGrade" class="form-input form-select">
                            <option value="">Select Grade</option>
                            <option value="9">9th Grade (Freshman)</option>
                            <option value="10">10th Grade (Sophomore)</option>
                            <option value="11">11th Grade (Junior)</option>
                            <option value="12">12th Grade (Senior)</option>
                            <option value="college">College Student</option>
                            <option value="graduate">Graduate Student</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="currentSchool">Current School</label>
                        <input type="text" id="currentSchool" class="form-input" placeholder="School name">
                    </div>r;
                    <div class="form-group">
                        <label class="form-label" for="gpa">GPA</label>
                        <input type="number" id="gpa" class="form-input" step="0.01" min="0" max="4.0" placeholder="3.50">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="graduationYear">Expected Graduation Year</label>
                        <input type="number" id="graduationYear" class="form-input" min="2024" max="2030" placeholder="2025">
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
                </form>tion: line-through;
            </div>y: 0.7;
        </div>

        <!-- Current Questionnaire Data Display -->
        <div class="profile-section questionnaire-full fade-in-up" id="currentQuestionnaireDisplay" style="display: none;">
            <h2 class="section-title">üìã Your College Profile Summary</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                Here's a summary of your college preferences and information. You can update this data in the section below.
            </p>ground: var(--accent-color);
            <div id="questionnaireDataDisplay" class="questionnaire-grid">
                <!-- Data will be populated by JavaScript -->
            </div>ize: 0.85rem;
        </div>nt-weight: 600;
            margin-right: 0.5rem;
        <!-- Questionnaire Section -->
        <div class="profile-section questionnaire-full fade-in-up">
            <h2 class="section-title">üìã Update College Questionnaire</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                Fill out or update your college preferences to get personalized recommendations and AI assistance.
            </p>
            <form id="questionnaireForm">
                <div class="questionnaire-grid">
                    <!-- Basic Information -->
                    <div class="question-group">
                        <label class="form-label" for="currentGradeLevel">Current Grade Level</label>
                        <select id="currentGradeLevel" class="form-input form-select">
                            <option value="">Select your current grade</option>
                            <option value="9th">9th Grade (Freshman)</option>
                            <option value="10th">10th Grade (Sophomore)</option>
                            <option value="11th">11th Grade (Junior)</option>
                            <option value="12th">12th Grade (Senior)</option>
                            <option value="gap-year">Gap Year</option>
                            <option value="college">College Student</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
            font-size: 1.5rem;
                    <div class="question-group">
                        <label class="form-label" for="expectedGraduation">Expected High School Graduation Year</label>
                        <select id="expectedGraduation" class="form-input form-select">
                            <option value="">Select year</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                            <option value="2029">2029</option>
                            <option value="2030">2030</option>
                        </select> 68, 68, 0.05);
                    </div>

                    <!-- Academic Performance -->
                    <div class="question-group">or);
                        <label class="form-label" for="currentGPA">Current GPA (if known)</label>
                        <select id="currentGPA" class="form-input form-select">
                            <option value="">Select GPA range</option>
                            <option value="4.0+">4.0+ (A+)</option>
                            <option value="3.7-3.99">3.7-3.99 (A-/A)</option>
                            <option value="3.3-3.69">3.3-3.69 (B+/A-)</option>
                            <option value="3.0-3.29">3.0-3.29 (B)</option>
                            <option value="2.7-2.99">2.7-2.99 (B-)</option>
                            <option value="2.3-2.69">2.3-2.69 (C+/B-)</option>
                            <option value="2.0-2.29">2.0-2.29 (C)</option>
                            <option value="below-2.0">Below 2.0</option>
                            <option value="not-sure">Not sure/Don't know</option>
                        </select>
                    </div>
            height: 100%;
                    <div class="question-group">
                        <label class="form-label" for="satScore" style="font-size: 0.85rem; margin-bottom: 0.25rem;">SAT Score</label>
                        <select id="satScore" class="form-input form-select">
                            <option value="">Not taken/Don't know</option>
                            <option value="1600">1600 (Perfect)</option>
                            <option value="1500-1590">1500-1590</option>
                            <option value="1400-1490">1400-1490</option>
                            <option value="1300-1390">1300-1390</option>
                            <option value="1200-1290">1200-1290</option>
                            <option value="1100-1190">1100-1190</option>
                            <option value="1000-1090">1000-1090</option>
                            <option value="900-990">900-990</option>
                            <option value="below-900">Below 900</option>
                        </select>
                    </div>0 0 9999px rgba(0, 0, 0, 0.7);
                    <div class="question-group">
                        <label class="form-label" for="actScore" style="font-size: 0.85rem; margin-bottom: 0.25rem;">ACT Score</label>
                        <select id="actScore" class="form-input form-select">
                            <option value="">Not taken/Don't know</option>
                            <option value="36">36 (Perfect)</option>
                            <option value="34-35">34-35</option>
                            <option value="32-33">32-33</option>
                            <option value="30-31">30-31</option>
                            <option value="28-29">28-29</option>
                            <option value="26-27">26-27</option>
                            <option value="24-25">24-25</option>
                            <option value="22-23">22-23</option>
                            <option value="20-21">20-21</option>
                            <option value="below-20">Below 20</option>
                        </select>
                    </div>
        [data-theme="dark"] .tour-tooltip {
                    <!-- College Preferences -->
                    <div class="question-group">
                        <label class="form-label">What types of colleges interest you most?</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">px); }
                                <input type="checkbox" id="public-universities" name="collegeTypes" value="public-universities">
                                <label for="public-universities">Public Universities</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="private-universities" name="collegeTypes" value="private-universities">
                                <label for="private-universities">Private Universities</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="liberal-arts-colleges" name="collegeTypes" value="liberal-arts-colleges">
                                <label for="liberal-arts-colleges">Liberal Arts Colleges</label>
                            </div>ndary);
                            <div class="checkbox-item">
                                <input type="checkbox" id="community-colleges" name="collegeTypes" value="community-colleges">
                                <label for="community-colleges">Community Colleges</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="historically-black" name="collegeTypes" value="historically-black">
                                <label for="historically-black">Historically Black Colleges (HBCUs)</label>
                            </div>-between;
                            <div class="checkbox-item">
                                <input type="checkbox" id="women-colleges" name="collegeTypes" value="women-colleges">
                                <label for="women-colleges">Women's Colleges</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="technical-schools" name="collegeTypes" value="technical-schools">
                                <label for="technical-schools">Technical/Trade Schools</label>
                            </div>
                        </div>on */
                    </div> {
            position: fixed;
                    <div class="question-group">
                        <label class="form-label" for="collegeSize">Preferred College Size</label>
                        <select id="collegeSize" class="form-input form-select">
                            <option value="">No preference</option>
                            <option value="very-small">Very Small (Under 1,000 students)</option>
                            <option value="small">Small (1,000-5,000 students)</option>
                            <option value="medium">Medium (5,000-15,000 students)</option>
                            <option value="large">Large (15,000-30,000 students)</option>
                            <option value="very-large">Very Large (30,000+ students)</option>
                        </select>
                    </div>ansform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
                    <div class="question-group">
                        <label class="form-label" for="locationPreference">Location Preference</label>
                        <select id="locationPreference" class="form-input form-select">
                            <option value="">No preference</option>
                            <option value="hometown">Close to home (within 2 hours)</option>
                            <option value="in-state">Anywhere in my state</option>
                            <option value="regional">Regional (neighboring states)</option>
                            <option value="national">Anywhere in the US</option>
                            <option value="international">Open to international schools</option>
                        </select>
                    </div>m;
            margin-bottom: 1rem;
                    <div class="question-group"> alternate;
                        <label class="form-label" for="campusSetting">Campus Setting Preference</label>
                        <select id="campusSetting" class="form-input form-select">
                            <option value="">No preference</option>
                            <option value="urban">Urban (in a city)</option>
                            <option value="suburban">Suburban</option>
                            <option value="small-town">Small town</option>
                            <option value="rural">Rural</option>
                        </select>
                    </div>d;
            width: 10px;
                    <!-- Academic Interests -->
                    <div class="question-group">
                        <label class="form-label">Academic Areas of Interest</label>
                        <div class="checkbox-group">ards;
                            <div class="checkbox-item">
                                <input type="checkbox" id="agriculture" name="academicInterests" value="agriculture">
                                <label for="agriculture">Agriculture & Natural Resources</label>
                            </div>
                            <div class="checkbox-item">deg);
                                <input type="checkbox" id="architecture" name="academicInterests" value="architecture">
                                <label for="architecture">Architecture & Planning</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="arts" name="academicInterests" value="arts">
                                <label for="arts">Arts & Design</label>
                            </div>dient(135deg, #f59e0b 0%, #ef4444 100%);
                            <div class="checkbox-item">
                                <input type="checkbox" id="business" name="academicInterests" value="business">
                                <label for="business">Business & Entrepreneurship</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="communications" name="academicInterests" value="communications">
                                <label for="communications">Communications & Media</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="computer-science" name="academicInterests" value="computer-science">
                                <label for="computer-science">Computer Science & IT</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="education" name="academicInterests" value="education">
                                <label for="education">Education</label>
                            </div>;
                            <div class="checkbox-item">
                                <input type="checkbox" id="engineering" name="academicInterests" value="engineering">
                                <label for="engineering">Engineering</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="health-sciences" name="academicInterests" value="health-sciences">
                                <label for="health-sciences">Health Sciences & Medicine</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="humanities" name="academicInterests" value="humanities">
                                <label for="humanities">Humanities & Literature</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="languages" name="academicInterests" value="languages">
                                <label for="languages">Languages & Linguistics</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="law" name="academicInterests" value="law">
                                <label for="law">Law & Legal Studies</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mathematics" name="academicInterests" value="mathematics">
                                <label for="mathematics">Mathematics & Statistics</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="physical-sciences" name="academicInterests" value="physical-sciences">
                                <label for="physical-sciences">Physical Sciences</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="psychology" name="academicInterests" value="psychology">
                                <label for="psychology">Psychology</label>
                            </div>
                            <div class="checkbox-item">cent-color), var(--success-color));
                                <input type="checkbox" id="social-sciences" name="academicInterests" value="social-sciences">
                                <label for="social-sciences">Social Sciences</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theology" name="academicInterests" value="theology">
                                <label for="theology">Theology & Religious Studies</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="undecided" name="academicInterests" value="undecided">
                                <label for="undecided">Undecided/Exploring</label>
                            </div>
                        </div>p {
                    </div> 1rem;
        }
                    <!-- Career Goals -->
                    <div class="question-group">
                        <label class="form-label">Career Goals & Interests</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="entrepreneur" name="careerGoals" value="entrepreneur">
                                <label for="entrepreneur">Start my own business</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="corporate" name="careerGoals" value="corporate">
                                <label for="corporate">Work in corporate America</label>
                            </div>(160, 123, 204, 0.2);
                            <div class="checkbox-item">
                                <input type="checkbox" id="nonprofit" name="careerGoals" value="nonprofit">
                                <label for="nonprofit">Work for a nonprofit</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="government" name="careerGoals" value="government">
                                <label for="government">Government service</label>
                            </div>ient);
                            <div class="checkbox-item">
                                <input type="checkbox" id="research" name="careerGoals" value="research">
                                <label for="research">Research & Academia</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="healthcare" name="careerGoals" value="healthcare">
                                <label for="healthcare">Healthcare professional</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="education-career" name="careerGoals" value="education-career">
                                <label for="education-career">Teaching/Education</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="arts-career" name="careerGoals" value="arts-career">
                                <label for="arts-career">Creative arts</label>
                            </div> repeat(auto-fit, minmax(250px, 1fr));
                            <div class="checkbox-item">
                                <input type="checkbox" id="unsure-career" name="careerGoals" value="unsure-career">
                                <label for="unsure-career">Still exploring options</label>
                            </div>
                        </div>
                    </div>r(--secondary-bg);
            padding: 1.5rem;
                    <!-- Extracurricular Activities -->
                    <div class="question-group">, 0.1);
                        <label class="form-label">Extracurricular Activities & Interests</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="varsity-sports" name="extracurriculars" value="varsity-sports">
                                <label for="varsity-sports">Varsity Sports</label>
                            </div>cent-color);
                            <div class="checkbox-item">
                                <input type="checkbox" id="club-sports" name="extracurriculars" value="club-sports">
                                <label for="club-sports">Club/Intramural Sports</label>
                            </div>{
                            <div class="checkbox-item">
                                <input type="checkbox" id="performing-arts" name="extracurriculars" value="performing-arts">
                                <label for="performing-arts">Performing Arts (Theater, Music, Dance)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="visual-arts" name="extracurriculars" value="visual-arts">
                                <label for="visual-arts">Visual Arts</label>
                            </div> repeat(7, 1fr);
                            <div class="checkbox-item">
                                <input type="checkbox" id="student-government" name="extracurriculars" value="student-government">
                                <label for="student-government">Student Government/Leadership</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="academic-clubs" name="extracurriculars" value="academic-clubs">
                                <label for="academic-clubs">Academic Clubs & Competitions</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="volunteer-work" name="extracurriculars" value="volunteer-work">
                                <label for="volunteer-work">Volunteer Work & Community Service</label>
                            </div>r;
                            <div class="checkbox-item">
                                <input type="checkbox" id="part-time-job" name="extracurriculars" value="part-time-job">
                                <label for="part-time-job">Part-time Job/Work Experience</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="research-projects" name="extracurriculars" value="research-projects">
                                <label for="research-projects">Research Projects</label>
                            </div>nt-color);
                            <div class="checkbox-item">
                                <input type="checkbox" id="internships" name="extracurriculars" value="internships">
                                <label for="internships">Internships</label>
                            </div>
                        </div>line {
                    </div>ba(239, 68, 68, 0.1);
            border: 2px solid var(--danger-color);
                    <!-- Financial Considerations -->
                    <div class="question-group">
                        <label class="form-label" for="budgetRange">Annual College Budget</label>
                        <select id="budgetRange" class="form-input form-select">
                            <option value="">Prefer not to say</option>
                            <option value="under-10k">Under $10,000</option>
                            <option value="10k-20k">$10,000 - $20,000</option>
                            <option value="20k-30k">$20,000 - $30,000</option>
                            <option value="30k-40k">$30,000 - $40,000</option>
                            <option value="40k-50k">$40,000 - $50,000</option>
                            <option value="50k-60k">$50,000 - $60,000</option>
                            <option value="60k-70k">$60,000 - $70,000</option>
                            <option value="over-70k">Over $70,000</option>
                        </select>
                    </div>
            align-items: center;
                    <div class="question-group">
                        <label class="form-label">Financial Aid Considerations</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="need-aid" name="financialAid" value="need-aid">
                                <label for="need-aid">Will need financial aid</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="merit-scholarships" name="financialAid" value="merit-scholarships">
                                <label for="merit-scholarships">Interested in merit scholarships</label>
                            </div>ary-bg);
                            <div class="checkbox-item">
                                <input type="checkbox" id="athletic-scholarships" name="financialAid" value="athletic-scholarships">
                                <label for="athletic-scholarships">Interested in athletic scholarships</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="work-study" name="financialAid" value="work-study">
                                <label for="work-study">Open to work-study programs</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="student-loans" name="financialAid" value="student-loans">
                                <label for="student-loans">Willing to take student loans</label>
                            </div>
                        </div>
                    </div>ending {
            background: var(--warning-color);
                    <!-- Special Considerations -->
                    <div class="question-group">
                        <label class="form-label">Special Considerations</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="first-generation" name="specialConsiderations" value="first-generation">
                                <label for="first-generation">First-generation college student</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="accessibility-needs" name="specialConsiderations" value="accessibility-needs">
                                <label for="accessibility-needs">Accessibility accommodations needed</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="learning-differences" name="specialConsiderations" value="learning-differences">
                                <label for="learning-differences">Learning differences support needed</label>
                            </div>);
                            <div class="checkbox-item">
                                <input type="checkbox" id="religious-affiliation" name="specialConsiderations" value="religious-affiliation">
                                <label for="religious-affiliation">Prefer religiously affiliated schools</label>
                            </div>(--accent-color);
                            <div class="checkbox-item">
                                <input type="checkbox" id="lgbtq-friendly" name="specialConsiderations" value="lgbtq-friendly">
                                <label for="lgbtq-friendly">LGBTQ+ friendly campus important</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="diverse-campus" name="specialConsiderations" value="diverse-campus">
                                <label for="diverse-campus">Diverse campus community important</label>
                            </div>ient);
                        </div>
                    </div>em 0.75rem;
                </div>ius: 20px;
            font-size: 0.75rem;
                <!-- Additional Questions -->
                <div class="form-group" style="margin-top: 2rem;">
                    <label class="form-label" for="collegeWorries">What worries you most about the college application process?</label>
                    <textarea id="collegeWorries" class="form-input form-textarea" 
                              placeholder="Share any concerns or anxieties you have about applying to college..."></textarea>
                </div> {
            position: fixed;
                <div class="form-group">
                    <label class="form-label" for="additionalInfo">Additional Information</label>
                    <textarea id="additionalInfo" class="form-input form-textarea" 
                              placeholder="Anything else you'd like us to know about your college preferences or goals?"></textarea>
                </div>
            z-index: 100;
                <div style="text-align: center; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary">üíæ Update Questionnaire</button>
                    <button type="button" class="btn btn-secondary" onclick="resetQuestionnaire()">üîÑ Reset to Defaults</button>
                </div>ions {
            </form>tom: 1rem;
        </div>  right: 1rem;
            }
        <!-- Account Management -->
        <div class="profile-section fade-in-up" style="margin-top: 2rem;">
            <h2 class="section-title">‚öôÔ∏è Account Management</h2>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="changePassword()">üîê Change Password</button>
                <button class="btn btn-secondary" onclick="downloadData()">üì• Download My Data</button>
                <button class="btn btn-danger" onclick="deleteAccount()">üóëÔ∏è Delete Account</button>
            </div>tooltip {
        </div>  max-width: 90%;
    </div>      left: 5% !important;
                right: 5%;
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">
                <img src="images/whiteclearcc.png" alt="College Climb Logo">
            </div>
            <div class="footer-text">
                &copy; 2025 College Climb. All rights reserved. Empowering students to reach new heights.
            </div>id-template-columns: 1fr;
            <div class="footer-socials">
                <a href="https://instagram.com/" target="_blank" aria-label="Instagram">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram">
                </a> 0.25rem;
                <a href="https://x.com/" target="_blank" aria-label="X (Twitter)">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg" alt="X">
                </a>card-actions {
                <a href="https://tiktok.com/" target="_blank" aria-label="TikTok">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok">
                </a>
                <a href="https://youtube.com/" target="_blank" aria-label="YouTube">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/youtube.svg" alt="YouTube">
                </a>
            </div>
        </div>
    </footer>k-action-btn {
            width: 60px;
    <!-- Firebase & JavaScript -->
    <script type="module"> 50%;
        // Import Firebase modulesient);
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut, updatePassword, deleteUser, EmailAuthProvider, reauthenticateWithCredential } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-storage.js';
            box-shadow: 0 4px 20px rgba(160, 123, 204, 0.4);
        // Firebase configurationease;
        const firebaseConfig = {
            apiKey: "AIzaSyDqL5ZoTKp36sk8J5TxuHn_y6ji4i9h20s",
            authDomain: "collegeclimb-ai.firebaseapp.com",
            projectId: "collegeclimb-ai",
            storageBucket: "collegeclimb-ai.firebasestorage.app",
            messagingSenderId: "187139654658",
            appId: "1:187139654658:web:4a6cf4c43095f03212931b",
            measurementId: "G-E0B2RQM9XS"60, 123, 204, 0.6);
        };

        // Initialize Firebase */
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
            max-width: 400px;
        console.log('üî• Firebase initialized successfully');
            background: var(--primary-bg);
        // Global variables16px;
        let currentUser = null;hadow);
        let currentUserData = null;var(--accent-color);
            z-index: 1001;
        // Auth state managementX(120%);
        onAuthStateChanged(auth, async (user) => { 0, 0.2, 1);
            console.log('üë§ Auth state changed:', user ? `User: ${user.email}` : 'No user');
            
            if (user) {how {
                currentUser = user;);
                updateAuthUI(user);
                await loadUserProfile(user);
                await loadUserData(user.uid);
                lay: flex;
                // Test storage connection
                setTimeout(testStorageConnection, 1000);
            } else {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
            }idth: 40px;
        }); height: 40px;
            border-radius: 50%;
        // Update navbar UI(--gradient);
        function updateAuthUI(user) {
            const navUserAvatar = document.getElementById('navUserAvatar');
            const profileLoading = document.getElementById('profileLoading');
            const dropdownName = document.getElementById('dropdownName');
            const dropdownEmail = document.getElementById('dropdownEmail');
        }
            if (user) {
                // Hide loading spinner
                if (profileLoading) profileLoading.style.display = 'none';
            color: var(--text-primary);
                // Show avatar5rem;
                if (navUserAvatar) {
                    if (currentUserData && currentUserData.profilePhotoURL) {
                        navUserAvatar.src = currentUserData.profilePhotoURL;
                    }: 0.9rem;
                    navUserAvatar.style.display = 'block';
                }

                // Update dropdown header
                if (dropdownName) {
                    dropdownName.textContent = (currentUserData && currentUserData.name)
                        ? currentUserData.name
                        : user.displayName || user.email.split('@')[0];
                }n-top: 4rem;
                if (dropdownEmail) {
                    dropdownEmail.textContent = user.email;
                }low: hidden;
            } else {
                // Show loading
                if (profileLoading) profileLoading.style.display = 'block';
                if (navUserAvatar) navUserAvatar.style.display = 'none';
            }osition: absolute;
        }   top: -50%;
            left: -50%;
        // Dropdown toggle functionality
        const profileButton = document.getElementById('profileButton');
        const profileDropdown = document.getElementById('profileDropdown');ransparent 70%);
        const dropdownMenu = document.getElementById('dropdownMenu');
        }
        if (profileButton && dropdownMenu) {
            profileButton.addEventListener('click', (e) => {
                e.stopPropagation();deg); }
                dropdownMenu.classList.toggle('show');
                profileDropdown.classList.toggle('open');
            });
        .footer-content {
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!profileDropdown.contains(e.target)) {
                    dropdownMenu.classList.remove('show');
                    profileDropdown.classList.remove('open');
                }2rem;
            });x-wrap: wrap;
            padding: 0 2rem;
            // Close dropdown when clicking a link
            dropdownMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    dropdownMenu.classList.remove('show');
                    profileDropdown.classList.remove('open');
                }); 60px;
            });th: 60px;
        }   border-radius: 12px;
            overflow: hidden;
        // Load user profile data
        async function loadUserProfile(user) {
            try {ogo img {
                const profileName = document.getElementById('profileName');
                const profileEmail = document.getElementById('profileEmail');
                ct-fit: contain;
                if (profileEmail) profileEmail.textContent = user.email;
                if (profileName) profileName.textContent = user.displayName || user.email.split('@')[0];
            } catch (error) {
                console.error('‚ùå Error loading user profile:', error);
            }ont-size: 1.1rem;
        }   opacity: 0.9;
            flex: 1;
        // Load user data from Firestore
        async function loadUserData(userId) {
            try {
                const userDoc = await getDoc(doc(db, 'users', userId));
                socials {
                if (userDoc.exists()) {
                    currentUserData = userDoc.data();
                    populateFormFields(currentUserData);
                } else {
                    // Create default user document
                    currentUserData = {
                        email: currentUser.email,
                        name: currentUser.displayName || '',
                        createdAt: new Date()
                    };px;
                    await setDoc(doc(db, 'users', userId), currentUserData);
                }r-radius: 50%;
                // Always update navbar/dropdown after loading user data
                updateAuthUI(currentUser);
            } catch (error) {
                console.error('‚ùå Error loading user data:', error);
                showMessage('Error loading profile data. Please refresh the page.', 'error');
            }ransform: translateY(-5px) scale(1.1);
        }   background: rgba(255, 255, 255, 0.3);
        }
        // Populate form fields with user data
        function populateFormFields(userData) {
            // Personal Information
            if (userData.name) document.getElementById('displayName').value = userData.name;
            if (userData.phone) document.getElementById('phoneNumber').value = userData.phone;
            if (userData.dateOfBirth) document.getElementById('dateOfBirth').value = userData.dateOfBirth;
            if (userData.location) document.getElementById('location').value = userData.location;
        /* Responsive Design */
            // Academic Information{
            if (userData.currentGrade) document.getElementById('currentGrade').value = userData.currentGrade;
            if (userData.currentSchool) document.getElementById('currentSchool').value = userData.currentSchool;
            if (userData.gpa) document.getElementById('gpa').value = userData.gpa;
            if (userData.graduationYear) document.getElementById('graduationYear').value = userData.graduationYear;
            .school-grid {
            // Profile Photo - Update all photo elements
            if (userData.profilePhotoURL) {
                const photoElements = [
                    document.getElementById('profilePhoto'),
                    document.getElementById('profilePhotoPreview'),
                    document.getElementById('navUserAvatar')
                ];dding: 0.75rem 1rem;
                
                photoElements.forEach(element => {
                    if (element) {
                        element.src = userData.profilePhotoURL;
                        if (element.id === 'navUserAvatar') {
                            element.style.display = 'block';
                        }
                    }-text h1,
                });nd-text h2 {
            }   font-size: 1.2rem;
            }
            // Update profile name display
            if (userData.name) {
                document.getElementById('profileName').textContent = userData.name;
            }   height: 38px;
                font-size: 1rem;
            // Questionnaire data
            if (userData.questionnaire) {
                populateQuestionnaire(userData.questionnaire);
            }   width: 40px;
        }       height: 40px;
            }
        // Populate questionnaire fields - ENHANCED VERSION
        function populateQuestionnaire(questionnaire) {
            console.log('üìã Populating questionnaire with data:', questionnaire);
                right: -0.5rem;
            // Single select fields from questions.html
            const questionFields = {
                'currentGradeLevel': questionnaire.currentGradeLevel,
                'expectedGraduation': questionnaire.expectedGraduation || questionnaire.graduationYear,
                'currentGPA': questionnaire.currentGPA || questionnaire.unweightedGPA,
                'satScore': questionnaire.satScore,.expectedGraduation || questionnaire.graduationYear,.expectedGraduation || questionnaire.graduationYear,
                'actScore': questionnaire.actScore,GPA || questionnaire.unweightedGPA,GPA || questionnaire.unweightedGPA,
                'collegeSize': questionnaire.collegeSize,
                'locationPreference': questionnaire.locationPreference,
                'campusSetting': questionnaire.campusSetting,
                'budgetRange': questionnaire.budgetRangetionPreference,tionPreference,
            };  'campusSetting': questionnaire.campusSetting,  'campusSetting': questionnaire.campusSetting,elcome-section {
                'budgetRange': questionnaire.budgetRange    'budgetRange': questionnaire.budgetRange    padding: 2rem 1.5rem;
            // Populate single select fields
            Object.entries(questionFields).forEach(([fieldId, value]) => {
                if (value) {le select fieldsle select fields{
                    const element = document.getElementById(fieldId); => { => {
                    if (element) {
                        element.value = value;etElementById(fieldId);etElementById(fieldId);
                        console.log(`‚úÖ Populated ${fieldId} with:`, value);
                    }   element.value = value;   element.value = value;d {
                }       console.log(`‚úÖ Populated ${fieldId} with:`, value);       console.log(`‚úÖ Populated ${fieldId} with:`, value);adding: 2rem;
            });     }     }
                }                }
            // Handle questionnaire data that needs mapping to profile fields
            if (questionnaire.applicationTimeline) {
                const element = document.getElementById('expectedGraduation');
                if (element && !element.value) {e && !questionnaire.expectedGraduation) {e && !questionnaire.expectedGraduation) {
                    // Try to extract year from application timelineduation');duation');
                    const yearMatch = questionnaire.applicationTimeline.match(/\d{4}/);
                    if (yearMatch) {= questionnaire.applicationTimeline.match(/\d{4}/);= questionnaire.applicationTimeline.match(/\d{4}/);
                        element.value = yearMatch[0];
                    }   element.value = yearMatch[0];   element.value = yearMatch[0]; 20px;
                }       console.log('‚úÖ Mapped timeline to graduation year:', yearMatch[0]);       console.log('‚úÖ Mapped timeline to graduation year:', yearMatch[0]);
            }       }       }
                }                }            .timeline-item {
            // Map intended major to academic interests
            if (questionnaire.intendedMajor) {
                const majorToInterestMap = {NG (from questions.html testScores field)NG (from questions.html testScores field)
                    'Computer Science': 'computer-science',naire.testScores === 'string') {naire.testScores === 'string') {
                    'Engineering': 'engineering',cores:', questionnaire.testScores);cores:', questionnaire.testScores);
                    'Business': 'business',
                    'Medicine/Pre-Med': 'health-sciences',
                    'Biology': 'physical-sciences',Scores.match(/SAT:?\s*(\d+)/i);Scores.match(/SAT:?\s*(\d+)/i);
                    'Psychology': 'psychology',
                    'English': 'humanities',t(satMatch[1]);t(satMatch[1]);
                    'Mathematics': 'mathematics',etElementById('satScore');etElementById('satScore');
                    'Physics': 'physical-sciences',alue) {alue) {
                    'Chemistry': 'physical-sciences',
                    'Economics': 'social-sciences',nge = '1600';nge = '1600';
                    'Political Science': 'social-sciences', = '1500-1590'; = '1500-1590';
                    'Art': 'arts',atScore >= 1400) satRange = '1400-1490';atScore >= 1400) satRange = '1400-1490';
                    'Music': 'arts',Score >= 1300) satRange = '1300-1390';Score >= 1300) satRange = '1300-1390';rem;
                    'History': 'humanities'= 1200) satRange = '1200-1290';= 1200) satRange = '1200-1290';
                };      else if (satScore >= 1100) satRange = '1100-1190';      else if (satScore >= 1100) satRange = '1100-1190';
                        else if (satScore >= 1000) satRange = '1000-1090';        else if (satScore >= 1000) satRange = '1000-1090';logo {
                const mappedInterest = majorToInterestMap[questionnaire.intendedMajor];
                if (mappedInterest) { = 'below-900'; = 'below-900';
                    const checkbox = document.querySelector(`input[name="academicInterests"][value="${mappedInterest}"]`);
                    if (checkbox) {value = satRange;value = satRange;
                        checkbox.checked = true;T ${satScore} to range:`, satRange);T ${satScore} to range:`, satRange);
                    }-text h2 {
                }ont-size: 1.1rem;
            }      
                // Extract ACT score                // Extract ACT score
            // Handle test scores from questions.htmlores.match(/ACT:?\s*(\d+)/i);ores.match(/ACT:?\s*(\d+)/i);
            if (questionnaire.testScores) {
                // Parse test scores string like "SAT: 1450, ACT: 32"
                const satMatch = questionnaire.testScores.match(/SAT:?\s*(\d+)/i);
                const actMatch = questionnaire.testScores.match(/ACT:?\s*(\d+)/i);
                        let actRange = '';        let actRange = '';dropdown-menu::before {
                if (satMatch) {Score >= 36) actRange = '36';Score >= 36) actRange = '36';
                    const satScore = parseInt(satMatch[1]); '34-35'; '34-35';
                    const satElement = document.getElementById('satScore');
                    if (satElement && !satElement.value) {= '30-31';= '30-31';
                        // Map score to range28) actRange = '28-29';28) actRange = '28-29';
                        if (satScore >= 1600) satElement.value = '1600';
                        else if (satScore >= 1500) satElement.value = '1500-1590';
                        else if (satScore >= 1400) satElement.value = '1400-1490';
                        else if (satScore >= 1300) satElement.value = '1300-1390';
                        else if (satScore >= 1200) satElement.value = '1200-1290';
                        else if (satScore >= 1100) satElement.value = '1100-1190';
                        else if (satScore >= 1000) satElement.value = '1000-1090';
                        else if (satScore >= 900) satElement.value = '900-990';nge);nge);
                        else satElement.value = 'below-900';
                    }-accent-color);
                }: 4px;
                
                if (actMatch) {major to academic interestsmajor to academic interests
                    const actScore = parseInt(actMatch[1]);
                    const actElement = document.getElementById('actScore');endedMajor);endedMajor);
                    if (actElement && !actElement.value) {
                        // Map score to range
                        if (actScore >= 36) actElement.value = '36';
                        else if (actScore >= 34) actElement.value = '34-35';
                        else if (actScore >= 32) actElement.value = '32-33';
                        else if (actScore >= 30) actElement.value = '30-31';
                        else if (actScore >= 28) actElement.value = '28-29';
                        else if (actScore >= 26) actElement.value = '26-27';
                        else if (actScore >= 24) actElement.value = '24-25';
                        else if (actScore >= 22) actElement.value = '22-23';
                        else if (actScore >= 20) actElement.value = '20-21';
                        else actElement.value = 'below-20';
                    }Economics': 'social-sciences',Economics': 'social-sciences',s="cc-logo">
                }   'Political Science': 'social-sciences',   'Political Science': 'social-sciences',img id="ccNavbarLogo" src="images/whiteclearcc.png" alt="College Climb Logo">
            }       'Art': 'arts',       'Art': 'arts',/div>
                    'Music': 'arts',                    'Music': 'arts',            <div class="cc-brand-text">
            // Checkbox groups from profile form
            const checkboxGroups = [
                'collegeTypes', 'academicInterests', 'careerGoals', 'extracurriculars', 
                'financialAid', 'specialConsiderations'
            ];    
                const mappedInterest = majorToInterestMap[questionnaire.intendedMajor];    const mappedInterest = majorToInterestMap[questionnaire.intendedMajor]; Right Side Navigation -->
            checkboxGroups.forEach(group => {
                if (questionnaire[group] && Array.isArray(questionnaire[group])) {nterests"][value="${mappedInterest}"]`);nterests"][value="${mappedInterest}"]`);
                    questionnaire[group].forEach(value => {ia-label="Toggle theme">
                        const checkbox = document.querySelector(`input[name="${group}"][value="${value}"]`);
                        if (checkbox) {Auto-selected academic interest: ${mappedInterest}`);Auto-selected academic interest: ${mappedInterest}`);
                            checkbox.checked = true;
                            console.log(`‚úÖ Checked ${group}:`, value);
                        }ccProfileDropdown">
                    });
                } Checkbox groups (from both questions.html and profile.html) Checkbox groups (from both questions.html and profile.html)   <!-- Loading state initially -->
            });st checkboxGroups = [st checkboxGroups = [     <div class="cc-profile-loading" id="ccProfileLoading"></div>
                'collegeTypes',                 'collegeTypes',                     
            // Textarea fieldsests', ests', le content (hidden initially) -->
            if (questionnaire.collegeWorries) {
                const element = document.getElementById('collegeWorries');
                if (element) element.value = questionnaire.collegeWorries;
            }   'specialConsiderations'   'specialConsiderations'   </div>
            ];];
            if (questionnaire.additionalInfo) {
                const element = document.getElementById('additionalInfo');
                if (element) element.value = questionnaire.additionalInfo;oup])) {oup])) {
            }       console.log(`‚úÖ Processing ${group}:`, questionnaire[group]);       console.log(`‚úÖ Processing ${group}:`, questionnaire[group]);       <div class="cc-dropdown-header" id="ccDropdownHeader">
                    questionnaire[group].forEach(value => {                    questionnaire[group].forEach(value => {                        <div class="cc-dropdown-welcome">Hello,</div>
            console.log('üìã Questionnaire population completed');input[name="${group}"][value="${value}"]`);input[name="${group}"][value="${value}"]`);ownName">Guest</div>
                        if (checkbox) {                        if (checkbox) {                        <div class="cc-dropdown-email" id="ccDropdownEmail"></div>
            // Also display the questionnaire data in read-only view
            displayQuestionnaireData(questionnaire);
        }           });           });           <!-- Navigation Links -->
                }                }                    <a href="dashboard.html" class="cc-dropdown-link">
        // Display questionnaire data in read-only format
        function displayQuestionnaireData(questionnaire) {
            const displayContainer = document.getElementById('questionnaireDataDisplay');
            const displaySection = document.getElementById('currentQuestionnaireDisplay');
                const element = document.getElementById('collegeWorries');                const element = document.getElementById('collegeWorries');                    <a href="testprep.html" class="cc-dropdown-link">
            if (!questionnaire || Object.keys(questionnaire).length === 0) {
                if (displaySection) displaySection.style.display = 'none';
                return;
            }f (questionnaire.additionalInfo) {f (questionnaire.additionalInfo) {
                const element = document.getElementById('additionalInfo');                const element = document.getElementById('additionalInfo');                    <a href="essaycoach.html" class="cc-dropdown-link">
            if (displaySection) displaySection.style.display = 'block';fo;fo;
            if (!displayContainer) return;
                    </a>
            const data = [];e summarye summary
            displayQuestionnaireData(questionnaire);            displayQuestionnaireData(questionnaire);                    <a href="scholarship.html" class="cc-dropdown-link">
            // Basic Infonk-icon">üí∞</span>
            if (questionnaire.currentGradeLevel) {n complete');n complete');
                data.push({ label: 'Current Grade', value: questionnaire.currentGradeLevel });
            }
            if (questionnaire.expectedGraduation || questionnaire.graduationYear) {
                data.push({ label: 'Expected Graduation', value: questionnaire.expectedGraduation || questionnaire.graduationYear });
            }onst displayContainer = document.getElementById('questionnaireDataDisplay');onst displayContainer = document.getElementById('questionnaireDataDisplay');           <span>Documents</span>
            if (questionnaire.applicationTimeline) {ntById('currentQuestionnaireDisplay');ntById('currentQuestionnaireDisplay');
                data.push({ label: 'Application Timeline', value: questionnaire.applicationTimeline });
            }f (!questionnaire || Object.keys(questionnaire).length === 0) {f (!questionnaire || Object.keys(questionnaire).length === 0) {       <a href="profile.html" class="cc-dropdown-link">
                if (displaySection) displaySection.style.display = 'none';                if (displaySection) displaySection.style.display = 'none';                        <span class="cc-dropdown-link-icon">üë§</span>
            // Academic Performance
            if (questionnaire.currentGPA || questionnaire.unweightedGPA) {
                data.push({ label: 'GPA', value: questionnaire.currentGPA || questionnaire.unweightedGPA });
            }f (displaySection) displaySection.style.display = 'block';f (displaySection) displaySection.style.display = 'block';       <!-- Divider -->
            if (questionnaire.weightedGPA) {der"></div>
                data.push({ label: 'Weighted GPA', value: questionnaire.weightedGPA });
            }onst data = [];onst data = [];       <!-- Logout -->
            if (questionnaire.testScores) {
                data.push({ label: 'Test Scores', value: questionnaire.testScores });
            }f (questionnaire.currentGradeLevel) {f (questionnaire.currentGradeLevel) {           <span>Logout</span>
            if (questionnaire.satScore) {nt Grade', value: questionnaire.currentGradeLevel });nt Grade', value: questionnaire.currentGradeLevel });
                data.push({ label: 'SAT Score', value: questionnaire.satScore });
            }f (questionnaire.expectedGraduation || questionnaire.graduationYear) {f (questionnaire.expectedGraduation || questionnaire.graduationYear) {/div>
            if (questionnaire.actScore) {ted Graduation', value: questionnaire.expectedGraduation || questionnaire.graduationYear });ted Graduation', value: questionnaire.expectedGraduation || questionnaire.graduationYear });
                data.push({ label: 'ACT Score', value: questionnaire.actScore });
            }f (questionnaire.applicationTimeline) {f (questionnaire.applicationTimeline) {
                data.push({ label: 'Application Timeline', value: questionnaire.applicationTimeline });                data.push({ label: 'Application Timeline', value: questionnaire.applicationTimeline });    <!-- Loading Overlay -->
            // College Preferences0; width: 100%; height: 100%; background: rgba(42, 53, 122, 0.95); backdrop-filter: blur(10px); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease;">
            if (questionnaire.collegeSize) {
                data.push({ label: 'Preferred College Size', value: questionnaire.collegeSize });
            }f (questionnaire.currentGPA || questionnaire.unweightedGPA) {f (questionnaire.currentGPA || questionnaire.unweightedGPA) {h2 style="color: white; font-size: 1.5rem; margin-bottom: 0.5rem;">Loading Your Dashboard</h2>
            if (questionnaire.locationPreference) {estionnaire.currentGPA || questionnaire.unweightedGPA });estionnaire.currentGPA || questionnaire.unweightedGPA });8); font-size: 1rem;" id="loadingStatusText">Preparing your personalized experience...</p>
                data.push({ label: 'Location Preference', value: questionnaire.locationPreference });
            }f (questionnaire.weightedGPA) {f (questionnaire.weightedGPA) {
            if (questionnaire.campusSetting) {PA', value: questionnaire.weightedGPA });PA', value: questionnaire.weightedGPA });
                data.push({ label: 'Campus Setting', value: questionnaire.campusSetting });
            }f (questionnaire.testScores) {f (questionnaire.testScores) {rames spin {
            if (questionnaire.budgetRange) {res', value: questionnaire.testScores });res', value: questionnaire.testScores });}
                data.push({ label: 'Budget Range', value: questionnaire.budgetRange });
            }f (questionnaire.satScore) {f (questionnaire.satScore) {
                data.push({ label: 'SAT Score', value: questionnaire.satScore });                data.push({ label: 'SAT Score', value: questionnaire.satScore });        #dashboardLoadingOverlay.fade-out {
            // Interests
            if (questionnaire.intendedMajor) {
                data.push({ label: 'Intended Major', value: questionnaire.intendedMajor });
            }
            if (questionnaire.targetSchools && questionnaire.targetSchools.length > 0) {
                data.push({ label: 'Target Schools', value: questionnaire.targetSchools.join(', ') });
            }f (questionnaire.collegeSize) {f (questionnaire.collegeSize) {questionnairePromptModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); z-index: 10000; align-items: center; justify-content: center;">
                data.push({ label: 'Preferred College Size', value: questionnaire.collegeSize });                data.push({ label: 'Preferred College Size', value: questionnaire.collegeSize });        <div style="background: white; border-radius: 20px; padding: 3rem; max-width: 500px; margin: 2rem; text-align: center; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
            // Checkbox arrays</div>
            if (questionnaire.collegeTypes && questionnaire.collegeTypes.length > 0) {
                data.push({ label: 'College Types', value: questionnaire.collegeTypes.map(v => v.replace(/-/g, ' ')).join(', ') }); 2-3 minutes!</p>
            }div style="display: flex; gap: 1rem; justify-content: center;">
            if (questionnaire.academicInterests && questionnaire.academicInterests.length > 0) {t-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s;">
                data.push({ label: 'Academic Interests', value: questionnaire.academicInterests.map(v => v.replace(/-/g, ' ')).join(', ') });
            }   </button>
            if (questionnaire.careerGoals && questionnaire.careerGoals.length > 0) {size: 1rem; cursor: pointer; transition: background 0.2s;">
                data.push({ label: 'Career Goals', value: questionnaire.careerGoals.map(v => v.replace(/-/g, ' ')).join(', ') });
            }   </button>
            if (questionnaire.extracurriculars && questionnaire.extracurriculars.length > 0) {
                data.push({ label: 'Extracurriculars', value: questionnaire.extracurriculars.map(v => v.replace(/-/g, ' ')).join(', ') });
            }f (questionnaire.intendedMajor) {f (questionnaire.intendedMajor) {
            if (questionnaire.financialAid && questionnaire.financialAid.length > 0) {r });r });
                data.push({ label: 'Financial Aid', value: questionnaire.financialAid.map(v => v.replace(/-/g, ' ')).join(', ') });
            }f (questionnaire.targetSchools && questionnaire.targetSchools.length > 0) {f (questionnaire.targetSchools && questionnaire.targetSchools.length > 0) {tourWelcomeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); z-index: 10000; align-items: center; justify-content: center;">
            if (questionnaire.specialConsiderations && questionnaire.specialConsiderations.length > 0) {ext-align: center; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: modalPop 0.3s ease;">
                data.push({ label: 'Special Considerations', value: questionnaire.specialConsiderations.map(v => v.replace(/-/g, ' ')).join(', ') });
            }margin-bottom: 1rem; font-size: 1.8rem;">Welcome to Your Dashboard!</h2>
            // Checkbox arrays            // Checkbox arrays            <p style="color: #666; margin-bottom: 2rem; line-height: 1.6;">Let us show you around! This quick tour will help you discover all the powerful features available to help with your college applications.</p>
            // Text areasaire.collegeTypes && questionnaire.collegeTypes.length > 0) {aire.collegeTypes && questionnaire.collegeTypes.length > 0) {isplay: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            if (questionnaire.collegeWorries) {es', value: questionnaire.collegeTypes.map(v => v.replace(/-/g, ' ')).join(', ') });es', value: questionnaire.collegeTypes.map(v => v.replace(/-/g, ' ')).join(', ') });odal()" style="background: linear-gradient(135deg, #2a357a 0%, #a07bcc 100%); color: white; border: none; padding: 1rem 2rem; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 12px rgba(160, 123, 204, 0.3);">
                data.push({ label: 'College Worries', value: questionnaire.collegeWorries, isLong: true });
            }f (questionnaire.academicInterests && questionnaire.academicInterests.length > 0) {f (questionnaire.academicInterests && questionnaire.academicInterests.length > 0) {   </button>
            if (questionnaire.additionalInfo) {terests', value: questionnaire.academicInterests.map(v => v.replace(/-/g, ' ')).join(', ') });terests', value: questionnaire.academicInterests.map(v => v.replace(/-/g, ' ')).join(', ') });al()" style="background: #f0f0f0; color: #666; border: none; padding: 1rem 2rem; border-radius: 12px; font-size: 1rem; cursor: pointer; transition: background 0.2s;">
                data.push({ label: 'Additional Info', value: questionnaire.additionalInfo, isLong: true });
            }f (questionnaire.careerGoals && questionnaire.careerGoals.length > 0) {f (questionnaire.careerGoals && questionnaire.careerGoals.length > 0) {   </button>
                data.push({ label: 'Career Goals', value: questionnaire.careerGoals.map(v => v.replace(/-/g, ' ')).join(', ') });                data.push({ label: 'Career Goals', value: questionnaire.careerGoals.map(v => v.replace(/-/g, ' ')).join(', ') });            </div>
            // Application status
            if (questionnaire.applicationStarted) {uestionnaire.extracurriculars.length > 0) {uestionnaire.extracurriculars.length > 0) {
                data.push({ label: 'Application Started', value: questionnaire.applicationStarted }); v.replace(/-/g, ' ')).join(', ') }); v.replace(/-/g, ' ')).join(', ') });
            }
            if (questionnaire.essayStarted) { questionnaire.financialAid.length > 0) { questionnaire.financialAid.length > 0) {
                data.push({ label: 'Essay Started', value: questionnaire.essayStarted });(v => v.replace(/-/g, ' ')).join(', ') });(v => v.replace(/-/g, ' ')).join(', ') });
            }00% { transform: scale(1); opacity: 1; }
            if (questionnaire.resumeStarted) {tions && questionnaire.specialConsiderations.length > 0) {tions && questionnaire.specialConsiderations.length > 0) {
                data.push({ label: 'Resume Started', value: questionnaire.resumeStarted });nsiderations.map(v => v.replace(/-/g, ' ')).join(', ') });nsiderations.map(v => v.replace(/-/g, ' ')).join(', ') });
            }
    <!-- Main Dashboard -->
            // Build HTML-container" style="opacity: 0; transition: opacity 0.5s ease;">
            let html = '';ire.collegeWorries) {ire.collegeWorries) {-->
            data.forEach(item => { 'College Worries', value: questionnaire.collegeWorries, isLong: true }); 'College Worries', value: questionnaire.collegeWorries, isLong: true });id="alertBanner">
                if (item.isLong) {
                    html += `.additionalInfo) {.additionalInfo) { fa-exclamation-triangle"></i>
                        <div class="question-group" style="grid-column: 1 / -1;">onalInfo, isLong: true });onalInfo, isLong: true });
                            <div class="form-label">${item.label}</div>
                            <div style="padding: 1rem; background: var(--primary-bg); border-radius: 8px; white-space: pre-wrap; color: var(--text-primary);">
                                ${item.value}
                            </div>icationStarted) {icationStarted) {
                        </div>bel: 'Application Started', value: questionnaire.applicationStarted });bel: 'Application Started', value: questionnaire.applicationStarted });
                    `;
                } else {naire.essayStarted) {naire.essayStarted) {tion -->
                    html += `abel: 'Essay Started', value: questionnaire.essayStarted });abel: 'Essay Started', value: questionnaire.essayStarted });ection">
                        <div class="question-group">
                            <div class="form-label">${item.label}</div>
                            <div style="padding: 0.75rem; background: var(--primary-bg); border-radius: 8px; color: var(--text-primary); text-transform: capitalize;">
                                ${item.value}
                            </div>
                        </div>
                    `; ''; '';="stat-card" onclick="showApplicationTracker()">
                }forEach(item => {forEach(item => {div class="stat-header">
            }); if (item.isLong) { if (item.isLong) {     <div class="stat-icon"><i class="fas fa-graduation-cap"></i></div>
                    html += `                    html += `                    <div class="stat-trend">
            displayContainer.innerHTML = html;roup" style="grid-column: 1 / -1;">roup" style="grid-column: 1 / -1;">-up"></i>
        }                   <div class="form-label">${item.label}</div>                   <div class="form-label">${item.label}</div>               <span id="applicationsTrend">+2 this week</span>
                            <div style="padding: 1rem; background: var(--primary-bg); border-radius: 8px; white-space: pre-wrap; color: var(--text-primary);">                            <div style="padding: 1rem; background: var(--primary-bg); border-radius: 8px; white-space: pre-wrap; color: var(--text-primary);">                    </div>
        // Update the questionnaire form handler to merge with existing data
        document.getElementById('questionnaireForm').addEventListener('submit', async (e) => {
            e.preventDefault();label">College Applications</div>
                    `;        `;    <div class="stat-description">
            try { else { else {   Track your application progress across all target schools
                const questionnaireData = {
                    // Single select fieldsn-group">n-group">
                    currentGradeLevel: document.getElementById('currentGradeLevel').value,
                    expectedGraduation: document.getElementById('expectedGraduation').value,der-radius: 8px; color: var(--text-primary); text-transform: capitalize;">der-radius: 8px; color: var(--text-primary); text-transform: capitalize;">
                    currentGPA: document.getElementById('currentGPA').value,
                    satScore: document.getElementById('satScore').value,
                    actScore: document.getElementById('actScore').value,
                    collegeSize: document.getElementById('collegeSize').value,
                    locationPreference: document.getElementById('locationPreference').value,
                    campusSetting: document.getElementById('campusSetting').value,
                    budgetRange: document.getElementById('budgetRange').value,
                    ontainer.innerHTML = html;ontainer.innerHTML = html; class="stat-value" id="essaysCount">0</div>
                    // Checkbox groups
                    collegeTypes: Array.from(document.querySelectorAll('input[name="collegeTypes"]:checked')).map(cb => cb.value),
                    academicInterests: Array.from(document.querySelectorAll('input[name="academicInterests"]:checked')).map(cb => cb.value),
                    careerGoals: Array.from(document.querySelectorAll('input[name="careerGoals"]:checked')).map(cb => cb.value),
                    extracurriculars: Array.from(document.querySelectorAll('input[name="extracurriculars"]:checked')).map(cb => cb.value),
                    financialAid: Array.from(document.querySelectorAll('input[name="financialAid"]:checked')).map(cb => cb.value),
                    specialConsiderations: Array.from(document.querySelectorAll('input[name="specialConsiderations"]:checked')).map(cb => cb.value),
                    t questionnaireData = {t questionnaireData = { class="stat-header">
                    // Textarea fieldsieldsieldscon"><i class="fas fa-trophy"></i></div>
                    collegeWorries: document.getElementById('collegeWorries').value,value,value,
                    additionalInfo: document.getElementById('additionalInfo').value,).value,).value,
                    currentGPA: document.getElementById('currentGPA').value,currentGPA: document.getElementById('currentGPA').value,    <span id="scholarshipTrend">$5K potential</span>
                    // Metadataocument.getElementById('satScore').value,ocument.getElementById('satScore').value,
                    updatedAt: new Date().toISOString(),ctScore').value,ctScore').value,
                    updatedFrom: 'profile'getElementById('collegeSize').value,getElementById('collegeSize').value,="scholarshipAmount">$0</div>
                };  locationPreference: document.getElementById('locationPreference').value,  locationPreference: document.getElementById('locationPreference').value,iv class="stat-label">Scholarship Value</div>
                    campusSetting: document.getElementById('campusSetting').value,                    campusSetting: document.getElementById('campusSetting').value,                <div class="stat-description">
                // Merge with existing questionnaire data to preserve questions.html data
                const currentDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const existingData = currentDoc.exists() ? currentDoc.data() : {};
                const existingQuestionnaire = existingData.questionnaire || {};ame="collegeTypes"]:checked')).map(cb => cb.value),ame="collegeTypes"]:checked')).map(cb => cb.value),
                    academicInterests: Array.from(document.querySelectorAll('input[name="academicInterests"]:checked')).map(cb => cb.value),                    academicInterests: Array.from(document.querySelectorAll('input[name="academicInterests"]:checked')).map(cb => cb.value),            <div class="stat-card" onclick="showProgressAnalytics()">
                // Merge the data, with profile updates taking precedenceput[name="careerGoals"]:checked')).map(cb => cb.value),put[name="careerGoals"]:checked')).map(cb => cb.value),
                const mergedQuestionnaire = { ...existingQuestionnaire, ...questionnaireData };rriculars"]:checked')).map(cb => cb.value),rriculars"]:checked')).map(cb => cb.value),
                    financialAid: Array.from(document.querySelectorAll('input[name="financialAid"]:checked')).map(cb => cb.value),                    financialAid: Array.from(document.querySelectorAll('input[name="financialAid"]:checked')).map(cb => cb.value),                    <div class="stat-trend">
                await updateDoc(doc(db, 'users', currentUser.uid), {SelectorAll('input[name="specialConsiderations"]:checked')).map(cb => cb.value),SelectorAll('input[name="specialConsiderations"]:checked')).map(cb => cb.value),
                    questionnaire: mergedQuestionnaire,
                    questionnaireUpdated: new Date(),
                    profileQuestionnaireCompleted: trueById('collegeWorries').value,ById('collegeWorries').value,
                }); additionalInfo: document.getElementById('additionalInfo').value, additionalInfo: document.getElementById('additionalInfo').value,v class="stat-value" id="overallProgress">0%</div>
                                                        <div class="stat-label">Overall Progress</div>
                // Update currentUserData for immediate use
                if (!currentUserData.questionnaire) currentUserData.questionnaire = {};
                Object.assign(currentUserData.questionnaire, mergedQuestionnaire);
                };                };            </div>
                // Refresh the display
                displayQuestionnaireData(mergedQuestionnaire);reserve questions.html datareserve questions.html data
                const currentDoc = await getDoc(doc(db, 'users', currentUser.uid));                const currentDoc = await getDoc(doc(db, 'users', currentUser.uid));        <!-- AI School Matching Section -->
                showMessage('Questionnaire updated successfully!', 'success'); {}; {};
                const existingQuestionnaire = existingData.questionnaire || {};                const existingQuestionnaire = existingData.questionnaire || {};            <div class="match-header">
                // Scroll to the top to show the updated summary
                document.getElementById('currentQuestionnaireDisplay').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (error) {uestionnaire = { ...existingQuestionnaire, ...questionnaireData };uestionnaire = { ...existingQuestionnaire, ...questionnaireData }; Recommendations
                console.error('‚ùå Error updating questionnaire:', error);
                showMessage('Failed to update questionnaire. Please try again.', 'error');
            }       questionnaire: mergedQuestionnaire,       questionnaire: mergedQuestionnaire,       <i class="fas fa-robot"></i>
        });         questionnaireUpdated: new Date(),         questionnaireUpdated: new Date(),         Powered by AI
                    profileQuestionnaireCompleted: true                    profileQuestionnaireCompleted: true                </div>
        // Profile photo upload handler
        document.getElementById('photoUpload').addEventListener('change', async (e) => {
            const file = e.target.files[0];or immediate useor immediate useted by JavaScript -->
            if (!file) return;erData.questionnaire) currentUserData.questionnaire = {};erData.questionnaire) currentUserData.questionnaire = {};
                Object.assign(currentUserData.questionnaire, mergedQuestionnaire);                Object.assign(currentUserData.questionnaire, mergedQuestionnaire);            <div style="text-align: center; margin-top: 2rem;">
            // Validate file typedisplay: inline-flex;">
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {stionnaire);stionnaire);
                showMessage('Please upload a valid image file (JPG, PNG, GIF, or WebP)', 'error');
                e.target.value = ''; // Reset file inputsage('Questionnaire updated successfully!', 'success');sage('Questionnaire updated successfully!', 'success');
                return;
            }                // Scroll to the top to show the updated summary                // Scroll to the top to show the updated summary        <!-- Main Dashboard Grid -->
rentQuestionnaireDisplay').scrollIntoView({ behavior: 'smooth', block: 'start' });rentQuestionnaireDisplay').scrollIntoView({ behavior: 'smooth', block: 'start' });
            // Validate file size (10MB max)
            if (file.size > 10 * 1024 * 1024) {
                showMessage('Image size must be less than 10MB', 'error');sage('Failed to update questionnaire. Please try again.', 'error');sage('Failed to update questionnaire. Please try again.', 'error');ass="panel-header">
                e.target.value = ''; // Reset file input       <h2 class="panel-title">
                return;        });        });                        <i class="fas fa-calendar-alt"></i>
            }

            try {) => {) => {
                // Update all upload buttons to show loading statet.files[0];t.files[0];eLoading" style="text-align: center; padding: 2rem; display: none;">
                const uploadButtons = document.querySelectorAll('.profile-photo-upload, button:contains("Choose Photo")');
                uploadButtons.forEach(btn => {
                    btn.disabled = true;lidate file typelidate file type/div>
                    if (btn.classList.contains('profile-photo-upload')) {            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];                <div class="timeline" id="applicationTimeline">
                        btn.textContent = '‚è≥';ype)) {ype)) {l be populated by JavaScript -->
                    } else {
                        btn.textContent = '‚è≥ Uploading...';return;return;v>
                    }
                });

                console.log('üì§ Starting photo upload...');
showMessage('Image size must be less than 10MB', 'error');showMessage('Image size must be less than 10MB', 'error');<div class="streak-tracker" id="streakTracker" style="display: none;">
                // Delete old photo if exists
                if (currentUserData?.profilePhotoURL) {
                    try {
                        const oldPhotoRef = ref(storage, currentUserData.profilePhotoURL);{{        <p>Keep logging in daily to maintain your streak</p>
                        await deleteObject(oldPhotoRef);
                        console.log('‚úÖ Old photo deleted');hoto-upload');hoto-upload');
                    } catch (err) {
                        console.log('‚ÑπÔ∏è No old photo to delete or already deleted');
                    } uploadBtn.textContent = '‚è≥'; uploadBtn.textContent = '‚è≥';v class="task-section">
                }}}    <div class="panel-header">

                // Create unique filenameenceenceas fa-pen"></i>
                const timestamp = Date.now();tos/${currentUser.uid}/${Date.now()}_${file.name}`);tos/${currentUser.uid}/${Date.now()}_${file.name}`);
                const filename = `${timestamp}_${file.name.replace(/[^a-zA-Z0-9.]/g, '_')}`;
                const storageRef = ref(storage, `profile-photos/${currentUser.uid}/${filename}`);
                nsole.log('üì§ Uploading photo to Firebase Storage...');nsole.log('üì§ Uploading photo to Firebase Storage...');  <div class="word-counter-widget">
                // Upload file with metadataconst snapshot = await uploadBytes(storageRef, file);const snapshot = await uploadBytes(storageRef, file);        <div class="word-counter-header">
                const metadata = {essfully');essfully');r(--text-secondary); font-size: 0.9rem;">Words Written Today</span>
                    contentType: file.type,t: 700; color: var(--accent-color);" id="wordsToday">0</span>
                    customMetadata: {
                        uploadedBy: currentUser.uid,shot.ref);shot.ref);
                        uploadedAt: new Date().toISOString()loadURL);loadURL);id="wordProgressFill" style="width: 0%"></div>
                    }
                };date Firestore with new photo URLdate Firestore with new photo URL   <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-secondary);">
it updateDoc(doc(db, 'users', currentUser.uid), {it updateDoc(doc(db, 'users', currentUser.uid), {         <span>Goal: <strong id="wordGoal">500</strong> words/day</span>
                const snapshot = await uploadBytes(storageRef, file, metadata);    profilePhotoURL: downloadURL,    profilePhotoURL: downloadURL,            <span id="wordPercentage">0%</span>
                console.log('‚úÖ Photo uploaded successfully');new Date()new Date()
                ne-flex; justify-content: center;">
                // Get download URL            ‚úçÔ∏è Write Essays
                const downloadURL = await getDownloadURL(snapshot.ref);ts immediatelyts immediately
                console.log('‚úÖ Download URL obtained:', downloadURL);nts = [nts = [
                ofilePhoto'),ofilePhoto'),
                // Update FirestoreilePhotoPreview'),ilePhotoPreview'),
                await updateDoc(doc(db, 'users', currentUser.uid), {   document.getElementById('navUserAvatar')   document.getElementById('navUserAvatar')!-- Task Management -->
                    profilePhotoURL: downloadURL,];];<div class="task-section">
                    profilePhotoPath: snapshot.ref.fullPath,
                    profilePhotoUpdated: new Date().forEach(element => {.forEach(element => {lass="panel-title">
                });
                
                console.log('‚úÖ Firestore updated with new photo URL');        if (element.id === 'navUserAvatar') {        if (element.id === 'navUserAvatar') {        </h3>
display = 'block';display = 'block';
                // Update ALL photo elements on the page
                const photoElements = {y JavaScript -->
                    'profilePhoto': downloadURL,
                    'profilePhotoPreview': downloadURL,
                    'navUserAvatar': downloadURL/ Update currentUserData/ Update currentUserData
                };   currentUserData.profilePhotoURL = downloadURL;   currentUserData.profilePhotoURL = downloadURL;   <!-- Progress Overview -->
                               <div class="task-section">
                Object.entries(photoElements).forEach(([id, url]) => {                // Re-enable upload button                // Re-enable upload button                    <div class="panel-header">
                    const element = document.getElementById(id);n) {n) {class="panel-title">
                    if (element) {alse;alse;fa-chart-pie"></i>
                        element.src = url;
                        if (id === 'navUserAvatar') {
                            element.style.display = 'block';
                        } successfully!', 'success'); successfully!', 'success');
                        console.log(`‚úÖ Updated ${id}`);
                    }o:', error);o:', error);ircle-bg" cx="70" cy="70" r="60"></circle>
                });ge('Failed to upload photo. Please try again.', 'error');ge('Failed to upload photo. Please try again.', 'error');   <circle class="progress-circle-fill" cx="70" cy="70" r="60" 
                                             stroke-dasharray="377" stroke-dashoffset="377" id="progressCircle"></circle>
                // Update currentUserData       // Re-enable upload button       // Re-enable upload button               </svg>
                currentUserData.profilePhotoURL = downloadURL;                const uploadBtn = document.querySelector('.profile-photo-upload');                const uploadBtn = document.querySelector('.profile-photo-upload');                        <div class="progress-text">
                currentUserData.profilePhotoPath = snapshot.ref.fullPath;>
                abel">Complete</div>
                // Reset file input
                e.target.value = '';
                
                // Show success message       Keep going! You're making great progress.
                showMessage('Profile photo updated successfully!', 'success');
                        // Utility functions        // Utility functions                </div>
            } catch (error) {
                console.error('‚ùå Error uploading photo:', error);rrorMessage' : 'successMessage');rrorMessage' : 'successMessage');
                
                let errorMessage = 'Failed to upload photo. ';                messageEl.textContent = text;                messageEl.textContent = text;                    <div class="panel-header">
                if (error.code === 'storage/unauthorized') {
                    errorMessage += 'You don\'t have permission to upload files.';
                } else if (error.code === 'storage/canceled') {
                    errorMessage += 'Upload was canceled.';);); </h3>
                } else if (error.code === 'storage/unknown') {       </div>
                    errorMessage += 'An unknown error occurred. Please check your internet connection.';        }        }                    <div id="aiInsights" style="display: flex; flex-direction: column; gap: 1rem;">
                } else {pulated here -->
                    errorMessage += 'Please try again.';
                }
                estionnaire to default values?')) {estionnaire to default values?')) {
                showMessage(errorMessage, 'error');
                e.target.value = ''; // Reset file inputQuestionnaire reset. Don\'t forget to save your changes!', 'success');Questionnaire reset. Don\'t forget to save your changes!', 'success');ask-section">
                
            } finally {
                // Re-enable all upload buttonsas fa-calculator"></i>
                const uploadButtons = document.querySelectorAll('.profile-photo-upload, button:contains("Uploading")');ndow.changePassword = async function() {ndow.changePassword = async function() {                  Quick EFC Estimate
                uploadButtons.forEach(btn => {            const currentPassword = prompt('Enter your current password:');            const currentPassword = prompt('Enter your current password:');                        </h3>
                    btn.disabled = false;
                    if (btn.classList.contains('profile-photo-upload')) {
                        btn.textContent = 'üì∑';ters):');ters):');
                    } else {ength < 6) {ength < 6) {yIncome">Family Income ($)</label>
                        btn.textContent = 'üì∑ Choose Photo';alert('Password must be at least 6 characters long.');alert('Password must be at least 6 characters long.');            <input type="number" id="familyIncome" placeholder="75000" min="0">
                    }
                });
            }
        });familySize" placeholder="4" min="1" max="10">
d);d);
        // Utility functionsthenticateWithCredential(currentUser, credential);thenticateWithCredential(currentUser, credential);utton class="btn btn-primary" onclick="calculateEFC()" style="width: 100%;">
        function showMessage(text, type) {entUser, newPassword);entUser, newPassword);ected Contribution
            const messageEl = document.getElementById(type === 'error' ? 'errorMessage' : 'successMessage');showMessage('Password updated successfully!', 'success');showMessage('Password updated successfully!', 'success');        </button>
            if (messageEl) {
                messageEl.textContent = text;('‚ùå Error changing password:', error);('‚ùå Error changing password:', error);
                messageEl.style.display = 'block';ck your current password.', 'error');ck your current password.', 'error');
                setTimeout(() => {
                    messageEl.style.display = 'none';- Document Tracker -->
                }, 5000);sk-section">
            }        window.downloadData = async function() {        window.downloadData = async function() {                    <div class="panel-header">
        }

        // Global functions for account management
        window.resetQuestionnaire = function() {                                                        </h3>
            if (confirm('Are you sure you want to reset your questionnaire to default values?')) {{ type: 'application/json' });{ type: 'application/json' });
                document.getElementById('questionnaireForm').reset();eateObjectURL(blob);eateObjectURL(blob);entTracker">
                showMessage('Questionnaire reset. Don\'t forget to save your changes!', 'success');                const a = document.createElement('a');                const a = document.createElement('a');                        <!-- Document items will be populated here -->
            }.href = url;.href = url;   </div>
        };on`;on`;

        window.changePassword = async function() {URL.revokeObjectURL(url);URL.revokeObjectURL(url);
            const currentPassword = prompt('Enter your current password:');
            if (!currentPassword) return;ss');ss');
tch (error) {tch (error) {ction Buttons -->
            const newPassword = prompt('Enter your new password (minimum 6 characters):'); downloading data:', error); downloading data:', error);
            if (!newPassword || newPassword.length < 6) {d data. Please try again.', 'error');d data. Please try again.', 'error');ck="startTour()" title="Take Tour">
                alert('Password must be at least 6 characters long.');fas fa-question"></i>
                return;
            }
= async function() {= async function() {calendar"></i>
            try {account deletion:');account deletion:');
                const credential = EmailAuthProvider.credential(currentUser.email, currentPassword);
                await reauthenticateWithCredential(currentUser, credential);ale"></i>
                await updatePassword(currentUser, newPassword);  const password = prompt('Enter your password to confirm:');  const password = prompt('Enter your password to confirm:');button>
                showMessage('Password updated successfully!', 'success');            if (!password) return;            if (!password) return;    </div>
            } catch (error) {
                console.error('‚ùå Error changing password:', error);
                showMessage('Failed to change password. Please check your current password.', 'error');l = EmailAuthProvider.credential(currentUser.email, password);l = EmailAuthProvider.credential(currentUser.email, password);d="tourOverlay" onclick="closeAllModals()"></div>
            }                await reauthenticateWithCredential(currentUser, credential);                await reauthenticateWithCredential(currentUser, credential);    <div class="tour-spotlight" id="tourSpotlight" style="display: none;"></div>
        };r-tooltip" id="tourTooltip" style="display: none;" onclick="event.stopPropagation()">
om Firestoreom Firestore
        window.downloadData = async function() {
            try {
                const userData = await getDoc(doc(db, 'users', currentUser.uid));
                const data = userData.data();
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });ert('Account deleted successfully. You will be redirected to the home page.');ert('Account deleted successfully. You will be redirected to the home page.');utton class="btn btn-primary" onclick="nextTourStep()">Next</button>
                const url = URL.createObjectURL(blob);                window.location.href = 'index.html';                window.location.href = 'index.html';            </div>
                const a = document.createElement('a');
                a.href = url;                console.error('‚ùå Error deleting account:', error);                console.error('‚ùå Error deleting account:', error);    </div>
                a.download = `college-climb-data-${new Date().toISOString().split('T')[0]}.json`;lete account. Please check your password.', 'error');lete account. Please check your password.', 'error');
                a.click();
                URL.revokeObjectURL(url);        };        };    <div class="celebration-modal" id="celebrationModal" onclick="event.stopPropagation()">
                
                showMessage('Data downloaded successfully!', 'success');
            } catch (error) {        document.getElementById('personalInfoForm').addEventListener('submit', async (e) => {        document.getElementById('personalInfoForm').addEventListener('submit', async (e) => {        <p id="celebrationMessage" style="color: var(--text-secondary); margin-bottom: 1.5rem;">You've reached a milestone!</p>
                console.error('‚ùå Error downloading data:', error);mary" onclick="closeCelebration()">Awesome!</button>
                showMessage('Failed to download data. Please try again.', 'error');
            }            try {            try {
        };
ument.getElementById('displayName').value,ument.getElementById('displayName').value,id="chatWidget">
        window.deleteAccount = async function() {
            const confirmation = prompt('Type "DELETE" to confirm account deletion:');
            if (confirmation !== 'DELETE') return;       location: document.getElementById('location').value,       location: document.getElementById('location').value,   <i class="fas fa-robot"></i>
         personalInfoUpdated: new Date()         personalInfoUpdated: new Date()     AI College Counselor
            const password = prompt('Enter your password to confirm:');                };                };                <div class="online-indicator"></div>
            if (!password) return;

            try {
                const credential = EmailAuthProvider.credential(currentUser.email, password);                // Update currentUserData                // Update currentUserData            </button>
                await reauthenticateWithCredential(currentUser, credential);bject.assign(currentUserData, personalData);bject.assign(currentUserData, personalData);
                
                // Delete user data from Firestore
                await deleteDoc(doc(db, 'users', currentUser.uid));name;name;
                ay?
                // Delete user account
                await deleteUser(currentUser);
                
                alert('Account deleted successfully. You will be redirected to the home page.');                showMessage('Personal information updated successfully!', 'success');                showMessage('Personal information updated successfully!', 'success');        <div class="chat-input-container">
                window.location.href = 'index.html';
            } catch (error) {                console.error('‚ùå Error updating personal info:', error);                console.error('‚ùå Error updating personal info:', error);                   placeholder="Ask about deadlines, essays, scholarships..." 
                console.error('‚ùå Error deleting account:', error);date personal information. Please try again.', 'error');date personal information. Please try again.', 'error');KeyPress(event)">
                showMessage('Failed to delete account. Please check your password.', 'error');
            }        });        });                <i class="fas fa-paper-plane"></i>
        };
 Handler Handler
        // Personal Info Form Handlerbmit', async (e) => {bmit', async (e) => {
        document.getElementById('personalInfoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
 try { try { class="chat-toggle" id="chatToggle" onclick="toggleChat()">
            try {                const academicData = {                const academicData = {        <i class="fas fa-comments"></i>
                const personalData = {e: document.getElementById('currentGrade').value,e: document.getElementById('currentGrade').value,
                    name: document.getElementById('displayName').value,
                    phone: document.getElementById('phoneNumber').value,nt.getElementById('gpa').value,nt.getElementById('gpa').value,-->
                    dateOfBirth: document.getElementById('dateOfBirth').value,   graduationYear: document.getElementById('graduationYear').value,   graduationYear: document.getElementById('graduationYear').value,otification" id="notification">
                    location: document.getElementById('location').value,ted: new Date()ted: new Date()tent">
                    personalInfoUpdated: new Date()
                };
uid), academicData);uid), academicData);
                await updateDoc(doc(db, 'users', currentUser.uid), personalData);xt">
     // Update currentUserData     // Update currentUserData     <h4 id="notificationTitle">Notification</h4>
                // Update currentUserData                Object.assign(currentUserData, academicData);                Object.assign(currentUserData, academicData);                <p id="notificationMessage">This is a notification message</p>
                Object.assign(currentUserData, personalData);
ss');ss');
                // Update profile name display
                document.getElementById('profileName').textContent = personalData.name;;;
ge('Failed to update academic information. Please try again.', 'error');ge('Failed to update academic information. Please try again.', 'error');
                // Update navbar
                updateAuthUI(currentUser);

                showMessage('Personal information updated successfully!', 'success');
            } catch (error) {ElementById('logoutBtn').addEventListener('click', async (e) => {ElementById('logoutBtn').addEventListener('click', async (e) => {
                console.error('‚ùå Error updating personal info:', error);
                showMessage('Failed to update personal information. Please try again.', 'error');
            }
        });   window.location.href = 'index.html';   window.location.href = 'index.html';div class="footer-socials">
ram">
        // Academic Info Form Handler;;mple-icons/simple-icons/icons/instagram.svg" alt="Instagram">
        document.getElementById('academicInfoForm').addEventListener('submit', async (e) => { } }     </a>
            e.preventDefault();        });        });                <a href="https://x.com/" target="_blank" rel="noopener" aria-label="X (Twitter)">

            try {
                const academicData = {themeToggle').addEventListener('click', () => {themeToggle').addEventListener('click', () => {tiktok.com/" target="_blank" rel="noopener" aria-label="TikTok">
                    currentGrade: document.getElementById('currentGrade').value,ody;ody;://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok">
                    currentSchool: document.getElementById('currentSchool').value,'themeToggle');'themeToggle');
                    gpa: document.getElementById('gpa').value,heme;heme;ref="https://youtube.com/" target="_blank" rel="noopener" aria-label="YouTube">
                    graduationYear: document.getElementById('graduationYear').value, 'dark') { 'dark') {net/gh/simple-icons/simple-icons/icons/youtube.svg" alt="YouTube">
                    academicInfoUpdated: new Date()   newTheme = 'light';   newTheme = 'light';   </a>
                };       body.setAttribute('data-theme', 'light');       body.setAttribute('data-theme', 'light');   </div>
                themeToggle.textContent = 'üåô';                themeToggle.textContent = 'üåô';        </div>
                await updateDoc(doc(db, 'users', currentUser.uid), academicData);

                // Update currentUserData
                Object.assign(currentUserData, academicData);

                showMessage('Academic information updated successfully!', 'success');            localStorage.setItem('theme', newTheme);            localStorage.setItem('theme', newTheme);        import logger from './js/logger.js';
            } catch (error) {me); // <-- Add this lineme); // <-- Add this line
                console.error('‚ùå Error updating academic info:', error);
                showMessage('Failed to update academic information. Please try again.', 'error');
            }e) {e) {'https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js';
        });            const logoImg = document.getElementById('navbarLogo');            const logoImg = document.getElementById('navbarLogo');        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js';
, orderBy, serverTimestamp, deleteDoc, updateDoc, onSnapshot, increment } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js';
        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async (e) => {iteclearcc.png';iteclearcc.png';
            e.preventDefault();
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('‚ùå Error signing out:', error);e loade load8",
            } savedTheme = localStorage.getItem('theme') || 'dark'; savedTheme = localStorage.getItem('theme') || 'dark';ppId: "1:187139654658:web:4a6cf4c43095f03212931b",
        });ocument.body.setAttribute('data-theme', savedTheme);ocument.body.setAttribute('data-theme', savedTheme);   measurementId: "G-E0B2RQM9XS"
        document.getElementById('themeToggle').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';        document.getElementById('themeToggle').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';        };
        // Theme toggle functionalitygo(savedTheme); // <-- Add this linego(savedTheme); // <-- Add this line
        document.getElementById('themeToggle').addEventListener('click', () => {        // Initialize Firebase
            const body = document.body;kgroundkgroundzeApp(firebaseConfig);
            const themeToggle = document.getElementById('themeToggle');
            let newTheme;= document.getElementById('starryBg');= document.getElementById('starryBg');tore(app);
            if (body.getAttribute('data-theme') === 'dark') {
                newTheme = 'light';
                body.setAttribute('data-theme', 'light');            for (let i = 0; i < numberOfStars; i++) {            for (let i = 0; i < numberOfStars; i++) {        window.auth = auth;
                themeToggle.textContent = 'üåô';
            } else {
                newTheme = 'dark';om() * 100 + '%';om() * 100 + '%';
                body.setAttribute('data-theme', 'dark');;;
                themeToggle.textContent = '‚òÄÔ∏è';tar.style.width = Math.random() * 3 + 1 + 'px';tar.style.width = Math.random() * 3 + 1 + 'px';g('üî• Enhanced Firebase Dashboard initialized');
            } star.style.height = star.style.width; star.style.height = star.style.width;
            localStorage.setItem('theme', newTheme);nimationDelay = Math.random() * 3 + 's';nimationDelay = Math.random() * 3 + 's';===========================
            updateNavbarLogo(newTheme); // <-- Add this line                starryBg.appendChild(star);                starryBg.appendChild(star);        // NAVBAR FUNCTIONALITY
        });
        }        }
        function updateNavbarLogo(theme) {
            const logoImg = document.getElementById('navbarLogo');        createStars();        createStars();
            if (!logoImg) return;
            if (theme === 'dark') {
                logoImg.src = 'images/whiteclearcc.png';erverOptions = {erverOptions = { savedTheme = localStorage.getItem('theme') || 'dark';
            } else {
                logoImg.src = 'images/blackcc.png';
            }
        }

        // Initialize theme and logo on page loads.forEach(entry => {s.forEach(entry => {utton(theme) {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.body.setAttribute('data-theme', savedTheme);
        document.getElementById('themeToggle').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';   }   }   themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        updateNavbarLogo(savedTheme); // <-- Add this line   });   });   }
serverOptions);serverOptions);
        // Create starry background
        function createStars() { document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el)); document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el)); function updateLogo(theme) {



















































</html></body>    </script>        }            }                showMessage('Storage service unavailable. Please refresh the page.', 'error');                console.error('‚ùå Firebase Storage connection failed:', error);            } catch (error) {                console.log('‚úÖ Firebase Storage connection successful');                await deleteObject(testRef);                await uploadBytes(testRef, testBlob);                const testBlob = new Blob(['test'], { type: 'text/plain' });                const testRef = ref(storage, 'test-connection.txt');            try {        async function testStorageConnection() {        // Test Firebase Storage connection        console.log('‚úÖ Profile page initialized successfully');        document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el));        }, observerOptions);            });                }                    entry.target.classList.add('visible');                if (entry.isIntersecting) {                       entries.forEach(entry => {        const observer = new IntersectionObserver((entries) => {        };            rootMargin: '0px 0px -50px 0px'            threshold: 0.1,        const observerOptions = {        // Scroll animations        createStars();        }            }                starryBg.appendChild(star);                star.style.animationDelay = Math.random() * 3 + 's';                star.style.height = star.style.width;                star.style.width = Math.random() * 3 + 1 + 'px';                star.style.top = Math.random() * 100 + '%';                star.style.left = Math.random() * 100 + '%';                star.className = 'star';                const star = document.createElement('div');            for (let i = 0; i < numberOfStars; i++) {            const numberOfStars = 100;            const starryBg = document.getElementById('starryBg');


















</html></body>    </script>        }            }                showMessage('Storage service unavailable. Please refresh the page.', 'error');                console.error('‚ùå Firebase Storage connection failed:', error);            } catch (error) {                console.log('‚úÖ Firebase Storage connection successful');                await deleteObject(testRef);                await uploadBytes(testRef, testBlob);                const testBlob = new Blob(['test'], { type: 'text/plain' });                const testRef = ref(storage, 'test-connection.txt');            try {        async function testStorageConnection() {        // Test Firebase Storage connection        console.log('‚úÖ Profile page initialized successfully');


















</html></body>    </script>        }            }                showMessage('Storage service unavailable. Please refresh the page.', 'error');                console.error('‚ùå Firebase Storage connection failed:', error);            } catch (error) {                console.log('‚úÖ Firebase Storage connection successful');                await deleteObject(testRef);                await uploadBytes(testRef, testBlob);                const testBlob = new Blob(['test'], { type: 'text/plain' });                const testRef = ref(storage, 'test-connection.txt');            try {        async function testStorageConnection() {        // Test Firebase Storage connection        console.log('‚úÖ Profile page initialized successfully');            const logo = document.getElementById('ccNavbarLogo');
            if (logo) {
                logo.src = theme === 'dark' ? 'images/whiteclearcc.png' : 'images/blackcc.png';
            }
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
            updateLogo(newTheme);
        }

        // Dropdown Management
        function toggleDropdown() {
            const dropdown = document.getElementById('ccDropdownMenu');
            const container = document.getElementById('ccProfileDropdown');
            
            if (dropdown && container) {
                const isOpen = dropdown.classList.contains('show');
                if (isOpen) {
                    closeDropdown();
                } else {
                    openDropdown();
                }
            }
        }

        function openDropdown() {
            const dropdown = document.getElementById('ccDropdownMenu');
            const container = document.getElementById('ccProfileDropdown');
            
            if (dropdown && container) {
                dropdown.classList.add('show');
                container.classList.add('open');
            }
        }

        function closeDropdown() {
            const dropdown = document.getElementById('ccDropdownMenu');
            const container = document.getElementById('ccProfileDropdown');
            
            if (dropdown && container) {
                dropdown.classList.remove('show');
                container.classList.remove('open');
            }
        }

        // Load User Data from Firestore
        async function loadNavbarUserData(userId) {
            try {
                const userDoc = await getDoc(doc(db, 'users', userId));
                
                if (userDoc.exists()) {
                    currentUserData = userDoc.data();
                    updateNavbarUI(auth.currentUser);
                } else {
                    currentUserData = {
                        email: auth.currentUser.email,
                        name: auth.currentUser.displayName || ''
                    };
                    updateNavbarUI(auth.currentUser);
                }
            } catch (error) {
                console.error('Error loading navbar user data:', error);
                currentUserData = {
                    email: auth.currentUser.email,
                    name: auth.currentUser.displayName || ''
                };
                updateNavbarUI(auth.currentUser);
            }
        }

        // Update Navbar UI with User Info
        function updateNavbarUI(user) {
            const profileLoading = document.getElementById('ccProfileLoading');
            const profileContent = document.getElementById('ccProfileContent');
            const userAvatar = document.getElementById('ccUserAvatar');
            const profileName = document.getElementById('ccProfileName');
            const dropdownName = document.getElementById('ccDropdownName');
            const dropdownEmail = document.getElementById('ccDropdownEmail');

            if (!user) {
                if (!window.location.pathname.includes('login.html') && 
                    !window.location.pathname.includes('signup.html') &&
                    !window.location.pathname.includes('index.html') &&
                    !window.location.pathname.includes('about.html') &&
                    !window.location.pathname.includes('pricing.html')) {
                    window.location.href = 'login.html';
                }
                return;
            }

            if (profileLoading) profileLoading.style.display = 'none';
            if (profileContent) profileContent.style.display = 'flex';

            if (userAvatar && currentUserData?.profilePhotoURL) {
                userAvatar.src = currentUserData.profilePhotoURL;
            } else if (userAvatar) {
                userAvatar.src = 'images/default-avatar.svg';
            }

            const displayName = currentUserData?.name || user.displayName || user.email.split('@')[0];
            if (profileName) profileName.textContent = displayName;
            if (dropdownName) dropdownName.textContent = displayName;

            if (dropdownEmail) dropdownEmail.textContent = user.email;
        }

        // Logout Function
        async function handleLogout(e) {
            e.preventDefault();
            closeDropdown();
            
            try {
                await signOut(auth);
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Error signing out:', error);
                alert('Error signing out. Please try again.');
            }
        }

        // Event Listeners
        function initEventListeners() {
            const themeToggle = document.getElementById('ccThemeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleTheme);
            }

            const profileButton = document.getElementById('ccProfileButton');
            if (profileButton) {
                profileButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleDropdown();
                });
            }

            const logoutBtn = document.getElementById('ccLogoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }

            document.addEventListener('click', (e) => {
                const dropdown = document.getElementById('ccProfileDropdown');
                if (dropdown && !dropdown.contains(e.target)) {
                    closeDropdown();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeDropdown();
                }
            });
        }

        // Initialize Navbar
        function initNavbar() {
            logger.log('üéØ Initializing College Climb Navbar...');
            
            initTheme();
            
            initEventListeners();
            
            logger.log('‚úÖ Navbar initialized successfully!');
        }

        // Export for global access
        window.CollegeClimbNavbar = {
            toggleTheme,
            openDropdown,
            closeDropdown,
            refresh: () => {
                if (auth.currentUser) {
                    loadNavbarUserData(auth.currentUser.uid);
                }
            }
        };

        // ============================================
        // DASHBOARD FUNCTIONALITY
        // ============================================

        // School database with comprehensive data
        window.schoolDatabase = {
            'Harvard University': {
                acceptance_rate: 3.4,
                avg_gpa: 4.18,
                avg_sat: 1520,
                avg_act: 34,
                tuition: 54269,
                location: 'Cambridge, MA',
                type: 'Private',
                ranking: 2,
                deadline: '2025-01-01'
            },
            'Stanford University': {
                acceptance_rate: 3.9,
                avg_gpa: 4.16,
                avg_sat: 1505,
                avg_act: 33,
                tuition: 56169,
                location: 'Stanford, CA',
                type: 'Private',
                ranking: 3,
                deadline: '2025-01-01'
            },
            'MIT': {
                acceptance_rate: 6.7,
                avg_gpa: 4.17,
                avg_sat: 1535,
                avg_act: 35,
                tuition: 53790,
                location: 'Cambridge, MA',
                type: 'Private',
                ranking: 1,
                deadline: '2025-01-01'
            },
            'UC Berkeley': {
                acceptance_rate: 14.5,
                avg_gpa: 4.0,
                avg_sat: 1415,
                avg_act: 31,
                tuition: 14312,
                location: 'Berkeley, CA',
                type: 'Public',
                ranking: 4,
                deadline: '2024-11-30'
            },
            'Yale University': {
                acceptance_rate: 4.6,
                avg_gpa: 4.14,
                avg_sat: 1515,
                avg_act: 34,
                tuition: 59950,
                location: 'New Haven, CT',
                type: 'Private',
                ranking: 5,
                deadline: '2025-01-01'
            }
        };

        // Function to fetch college data from API if not in database
        async function getCollegeData(collegeName) {
            if (window.schoolDatabase[collegeName]) {
                return window.schoolDatabase[collegeName];
            }

            try {
                const response = await fetch(`/api/college-search?name=${encodeURIComponent(collegeName)}&per_page=1`);

                if (!response.ok) {
                    logger.warn(`Failed to fetch data for ${collegeName}`);
                    return null;
                }

                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    const college = data.results[0];

                    const collegeData = {
                        acceptance_rate: college.admissionRate ? (college.admissionRate * 100) : 10.0,
                        avg_sat: college.avgSAT || 1200,
                        avg_act: college.avgACT || 25,
                        tuition: college.outOfStateTuition || college.inStateTuition || 50000,
                        location: `${college.city}, ${college.state}`,
                        type: college.inStateTuition && college.outOfStateTuition && (college.inStateTuition < college.outOfStateTuition) ? 'Public' : 'Private',
                        deadline: '2025-01-01',
                        website: college.website
                    };

                    window.schoolDatabase[collegeName] = collegeData;
                    logger.log(`‚úÖ Fetched and cached data for ${collegeName}`);

                    return collegeData;
                }
            } catch (error) {
                logger.error('Error fetching college data:', error);
            }

            return {
                acceptance_rate: 10.0,
                avg_gpa: 3.8,
                avg_sat: 1200,
                avg_act: 25,
                tuition: 50000,
                location: 'Unknown',
                type: 'Unknown',
                deadline: '2025-01-01'
            };
        }

        window.getCollegeData = getCollegeData;

        // Offline Detection
        let isOnline = navigator.onLine;
        let offlineBanner = null;

        function showOfflineBanner() {
            if (offlineBanner) return;

            offlineBanner = document.createElement('div');
            offlineBanner.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                color: white;
                padding: 1rem 2rem;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
                z-index: 9998;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                font-weight: 500;
                animation: slideDown 0.3s ease;
            `;
            offlineBanner.innerHTML = `
                <i class="fas fa-wifi-slash"></i>
                <span>You're offline. Some features may not work.</span>
            `;

            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(offlineBanner);
        }

        function hideOfflineBanner() {
            if (offlineBanner) {
                offlineBanner.remove();
                offlineBanner = null;
            }
        }

        window.addEventListener('online', () => {
            isOnline = true;
            hideOfflineBanner();
            showNotification('Success', 'You\'re back online!', 'success');
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            showOfflineBanner();
        });

        if (!isOnline) {
            showOfflineBanner();
        }

        // Auth state management
        onAuthStateChanged(auth, async (user) => {
            logger.log('üë§ Auth state changed:', user ? `User: ${user.email}` : 'No user');

            if (user) {
                document.body.classList.add("logged-in");
                window.currentUser = user;
                await loadUserData(user);
                await loadNavbarUserData(user.uid);
                await initializeDashboard();
            } else {
                document.body.classList.remove("logged-in");
                window.location.href = 'login.html';
            }
        });

        // Load comprehensive user data
        async function loadUserData(user) {
            try {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                
                if (userDoc.exists()) {
                    window.userData = userDoc.data();
                    logger.log('üìä User data loaded:', window.userData);
                    updateWelcomeMessage();
                } else {
                    window.userData = {
                        email: user.email,
                        name: user.displayName || user.email.split('@')[0],
                        createdAt: serverTimestamp(),
                        lastLogin: serverTimestamp()
                    };
                    await setDoc(doc(db, 'users', user.uid), window.userData);
                }
            } catch (error) {
                console.error('‚ùå Error loading user data:', error);
                showNotification('Error', 'Failed to load user data. Please refresh the page.', 'error');
            }
        }

        // Update loading status
        function updateLoadingStatus(message) {
            const statusText = document.getElementById('loadingStatusText');
            if (statusText) {
                statusText.textContent = message;
            }
        }

        // Hide loading overlay
        function hideLoadingOverlay() {
            const overlay = document.getElementById('dashboardLoadingOverlay');
            const container = document.querySelector('.dashboard-container');

            if (overlay) {
                overlay.classList.add('fade-out');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 500);
            }

            if (container) {
                container.style.opacity = '1';
            }
        }

        // Check if user has completed questionnaire
        async function checkQuestionnaireCompletion() {
            console.log('üìã Questionnaire popup disabled by design');
            return true;
        }

        // Navigate to questionnaire
        function goToQuestionnaire() {
            window.location.href = 'questions.html';
        }

        // Navigate to profile
        function goToProfile() {
            window.location.href = 'profile.html';
        }

        // Dismiss questionnaire prompt permanently
        async function dismissQuestionnairePrompt() {
            const modal = document.getElementById('questionnairePromptModal');
            if (modal) {
                modal.style.display = 'none';
            }

            if (window.currentUser) {
                try {
                    await updateDoc(doc(db, 'users', window.currentUser.uid), {
                        questionnairePromptDismissed: true,
                        questionnairePromptDismissedAt: new Date()
                    });
                    console.log('‚úÖ Questionnaire prompt permanently dismissed in Firebase');
                } catch (error) {
                    console.error('Error saving questionnaire prompt dismissal:', error);
                }
            }
        }

        window.goToQuestionnaire = goToQuestionnaire;
        window.goToProfile = goToProfile;
        window.dismissQuestionnairePrompt = dismissQuestionnairePrompt;

        // Initialize dashboard with real data
        async function initializeDashboard() {
            try {
                updateLoadingStatus('Loading your data...');

                await loadApplicationData();

                updateLoadingStatus('Calculating your progress...');

                await calculateRealStats();

                updateLoadingStatus('Generating recommendations...');

                generateSchoolRecommendations();
                createApplicationTimeline();

                updateLoadingStatus('Loading your tasks...');

                loadTasks();
                updateProgressCircle();
                checkDeadlineAlerts();
                generateAIInsights();

                updateLoadingStatus('Almost ready...');

                setTimeout(() => {
                    updateStreakTracker().catch(err => console.error('Streak tracker error:', err));
                    updateWordCounter().catch(err => console.error('Word counter error:', err));
                    updateDocumentTracker().catch(err => console.error('Document tracker error:', err));
                }, 1000);

                setTimeout(() => {
                    hideLoadingOverlay();
                }, 1500);

            } catch (error) {
                console.error('‚ùå Error initializing dashboard:', error);
                hideLoadingOverlay();
                showNotification('Error', 'Failed to load dashboard data. Please refresh the page.', 'error');
            }
        }

        // Load real application data
        async function loadApplicationData() {
            try {
                const userId = window.currentUser.uid;
                
                const targetSchools = window.userData?.questionnaire?.targetSchools || [];
                
                if (targetSchools.length === 0) {
                    await createDefaultApplications(userId);
                }
                
                const appsQuery = query(
                    collection(db, 'applications'),
                    where('userId', '==', userId)
                );
                
                const querySnapshot = await getDocs(appsQuery);
                window.applicationData = [];
                
                querySnapshot.forEach((doc) => {
                    window.applicationData.push({ id: doc.id, ...doc.data() });
                });
                
                logger.log('üìã Application data loaded:', window.applicationData);
                
            } catch (error) {
                console.error('‚ùå Error loading application data:', error);
            }
        }

        // Create applications based on user's target schools
        async function createDefaultApplications(userId) {
            const targetSchools = window.userData?.questionnaire?.targetSchools || [
                'Harvard University', 'Stanford University', 'MIT', 'UC Berkeley', 'Yale University'
            ];
            
            const statusOptions = ['not-started', 'in-progress', 'submitted', 'completed'];
            
            for (const schoolName of targetSchools) {
                const schoolData = window.schoolDatabase[schoolName] || {
                    deadline: '2025-01-01',
                    acceptance_rate: 10.0,
                    avg_gpa: 3.8
                };
                
                const randomStatus = statusOptions[Math.floor(Math.random() * statusOptions.length)];
                
                await addDoc(collection(db, 'applications'), {
                    userId: userId,
                    schoolName: schoolName,
                    deadline: schoolData.deadline,
                    status: randomStatus,
                    createdAt: serverTimestamp(),
                    essayCount: Math.floor(Math.random() * 5) + 1,
                    supplementsComplete: Math.random() > 0.5,
                    recommendationsCount: Math.floor(Math.random() * 4),
                    lastUpdated: serverTimestamp()
                });
            }
            
            logger.log('üìù Created default applications for target schools');
        }

        // Calculate real statistics from user data
        async function calculateRealStats() {
            try {
                const userId = window.currentUser.uid;
                
                const applicationCount = window.applicationData?.length || 0;
                document.getElementById('applicationsCount').textContent = applicationCount;
                
                let essayCount = 0;
                if (window.applicationData) {
                    essayCount = window.applicationData.reduce((total, app) => {
                        return total + (app.essayCount || 0);
                    }, 0);
                }
                if (window.userData?.questionnaire?.essayText || window.userData?.questionnaire?.essayFileURL) {
                    essayCount += 1;
                }
                document.getElementById('essaysCount').textContent = essayCount;
                
                const scholarshipValue = calculateScholarshipPotential();
                document.getElementById('scholarshipAmount').textContent = `$${Math.round(scholarshipValue / 1000)}K`;
                
                const overallProgress = calculateOverallProgress();
                document.getElementById('overallProgress').textContent = `${overallProgress}%`;
                
                updateTrends();
                
                logger.log('üìä Real stats calculated and displayed');
                
            } catch (error) {
                console.error('‚ùå Error calculating stats:', error);
            }
        }

        // Calculate scholarship potential based on user profile
        function calculateScholarshipPotential() {
            let baseAmount = 5000;
            
            const questionnaire = window.userData?.questionnaire;
            if (!questionnaire) return baseAmount;
            
            const gpa = parseFloat(questionnaire.unweightedGPA || window.userData.gpa || 3.0);
            if (gpa >= 3.8) baseAmount += 15000;
            else if (gpa >= 3.5) baseAmount += 10000;
            else if (gpa >= 3.0) baseAmount += 5000;
            
            const satScore = extractSATScore(questionnaire.testScores);
            const actScore = extractACTScore(questionnaire.testScores);
            
            if (satScore >= 1450 || actScore >= 32) baseAmount += 20000;
            else if (satScore >= 1350 || actScore >= 29) baseAmount += 12000;
            else if (satScore >= 1250 || actScore >= 26) baseAmount += 8000;
            
            if (questionnaire.financialAid?.includes('need-aid')) {
                baseAmount += 25000;
            }
            
            if (questionnaire.specialConsiderations?.includes('first-generation')) {
                baseAmount += 10000;
            }
            
            if (questionnaire.extracurriculars?.includes('student-government')) {
                baseAmount += 5000;
            }
            
            return Math.min(baseAmount, 75000);
        }

        // Calculate overall progress
        function calculateOverallProgress() {
            if (!window.applicationData || window.applicationData.length === 0) {
                return 0;
            }
            
            let totalTasks = 0;
            let completedTasks = 0;
            
            window.applicationData.forEach(app => {
                totalTasks += 5;
                
                if (app.status === 'submitted' || app.status === 'completed') {
                    completedTasks += 5;
                } else if (app.status === 'in-progress') {
                    completedTasks += 2;
                } else if (app.status === 'not-started') {
                    completedTasks += 0;
                }
            });
            
            totalTasks += 1;
            if (window.userData?.questionnaire) {
                completedTasks += 1;
            }
            
            return Math.round((completedTasks / totalTasks) * 100);
        }

        // Generate AI-powered school recommendations
        function generateSchoolRecommendations() {
            const schoolGrid = document.getElementById('schoolGrid');
            schoolGrid.innerHTML = '';
            
            const userProfile = window.userData?.questionnaire || {};
            const userGPA = parseFloat(userProfile.unweightedGPA || 3.5);
            const userSAT = extractSATScore(userProfile.testScores) || 1200;
            
            const targetSchools = userProfile.targetSchools || Object.keys(window.schoolDatabase).slice(0, 5);
            
            targetSchools.forEach(schoolName => {
                const school = window.schoolDatabase[schoolName];
                if (!school) {
                    console.warn(`School not found in database: ${schoolName}`);
                    return;
                }
                
                const matchPercentage = calculateMatchPercentage(userGPA, userSAT, school);
                
                const schoolCard = createSchoolCard(schoolName, school, matchPercentage);
                schoolGrid.appendChild(schoolCard);
            });
        }

        // Calculate how well user matches with school
        function calculateMatchPercentage(userGPA, userSAT, school) {
            let score = 0;
            
            const gpaRatio = userGPA / school.avg_gpa;
            score += Math.min(gpaRatio * 40, 40);
            
            const satRatio = userSAT / school.avg_sat;
            score += Math.min(satRatio * 35, 35);
            
            if (school.acceptance_rate > 10) score += 25;
            else if (school.acceptance_rate > 5) score += 15;
            else score += 10;
            
            return Math.min(Math.round(score), 95);
        }

        // Create school card element
        function createSchoolCard(schoolName, school, matchPercentage) {
            const card = document.createElement('div');
            card.className = 'school-card';
            card.style.cursor = 'pointer';
            card.style.position = 'relative';

            let matchColor = '#ef4444';
            let matchLabel = 'Reach';
            if (matchPercentage >= 75) {
                matchColor = '#10b981';
                matchLabel = 'Safety';
            } else if (matchPercentage >= 60) {
                matchColor = '#f59e0b';
                matchLabel = 'Target';
            }

            card.innerHTML = `
                <div class="match-percentage" style="background-color: ${matchColor}">
                    ${matchPercentage}%
                    <div style="font-size: 0.7rem; margin-top: 0.1rem;">${matchLabel}</div>
                </div>
                <h3 class="school-name">${schoolName}</h3>
                <div class="school-details">
                    <div class="school-detail">
                        <span class="detail-label">Acceptance Rate</span>
                        <span class="detail-value">${school.acceptance_rate}%</span>
                    </div>
                    <div class="school-detail">
                        <span class="detail-label">Avg GPA</span>
                        <span class="detail-value">${school.avg_gpa}</span>
                    </div>
                    <div class="school-detail">
                        <span class="detail-label">Avg SAT</span>
                        <span class="detail-value">${school.avg_sat}</span>
                    </div>
                    <div class="school-detail">
                        <span class="detail-label">Location</span>
                        <span class="detail-value">${school.location}</span>
                    </div>
                    <div class="school-detail">
                        <span class="detail-label">Deadline</span>
                        <span class="detail-value">${new Date(school.deadline).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
                    </div>
                </div>
                <div class="school-card-actions" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(160, 123, 204, 0.1); display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button class="btn btn-primary view-profile-btn" style="flex: 1; padding: 0.6rem 1rem; font-size: 0.85rem;">
                        View Profile
                    </button>
                    <button class="btn btn-secondary add-to-list-btn" style="padding: 0.6rem 1rem; font-size: 0.85rem;">
                        ‚ûï Add
                    </button>
                </div>
            `;

            const viewProfileBtn = card.querySelector('.view-profile-btn');
            const addToListBtn = card.querySelector('.add-to-list-btn');

            viewProfileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                openCollegeProfile(schoolName);
            });

            addToListBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                addToApplicationList(schoolName);
            });

            card.addEventListener('click', () => showSchoolDetails(schoolName, school, matchPercentage));
            return card;
        }

        // Create application timeline
        async function createApplicationTimeline() {
            const timeline = document.getElementById('applicationTimeline');
            const loadingEl = document.getElementById('timelineLoading');

            if (!timeline) {
                console.error('‚ùå Timeline element not found');
                return;
            }

            timeline.innerHTML = '';
            if (loadingEl) loadingEl.style.display = 'block';

            try {
                const targetSchools = window.userData?.questionnaire?.targetSchools || [];
                
                if (!targetSchools || targetSchools.length === 0) {
                    if (loadingEl) loadingEl.style.display = 'none';
                    timeline.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            <i class="fas fa-calendar-plus" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <p style="font-size: 1.1rem;">No target schools yet!</p>
                            <p style="margin-top: 0.5rem;">Add schools in your profile to see your personalized timeline.</p>
                            <a href="profile.html" class="btn btn-primary" style="margin-top: 1rem; text-decoration: none; display: inline-flex;">
                                üìù Update Profile
                            </a>
                        </div>
                    `;
                    return;
                }

                const timelineItems = [];

                for (const schoolName of targetSchools) {
                    let schoolData = window.schoolDatabase[schoolName];
                    
                    if (!schoolData) {
                        schoolData = await getCollegeData(schoolName);
                    }

                    if (!schoolData) {
                        console.warn(`‚ö†Ô∏è Could not load data for ${schoolName}`);
                        continue;
                    }

                    const deadline = new Date(schoolData.deadline);
                    const now = new Date();
                    const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));

                    const milestones = [
                        {
                            date: new Date(deadline.getTime() - (60 * 24 * 60 * 60 * 1000)),
                            title: `Start ${schoolName} Application`,
                            description: 'Begin working on your application materials',
                            tasks: [
                                { id: `${schoolName}-start`, text: 'Create account on college portal', completed: false },
                                { id: `${schoolName}-requirements`, text: 'Review all application requirements', completed: false },
                                { id: `${schoolName}-essay-topics`, text: 'Read essay prompts and brainstorm ideas', completed: false }
                            ],
                            status: daysUntil > 60 ? 'upcoming' : daysUntil > 0 ? 'in-progress' : 'overdue'
                        },
                        {
                            date: new Date(deadline.getTime() - (30 * 24 * 60 * 60 * 1000)),
                            title: `${schoolName} Essays & Writing`,
                            description: 'Complete all required essays and personal statements',
                            tasks: [
                                { id: `${schoolName}-personal-statement`, text: 'Draft personal statement', completed: false },
                                { id: `${schoolName}-supplements`, text: 'Write supplemental essays', completed: false },
                                { id: `${schoolName}-essay-review`, text: 'Get essays reviewed and edited', completed: false }
                            ],
                            status: daysUntil > 30 ? 'upcoming' : daysUntil > 0 ? 'in-progress' : 'overdue'
                        },
                        {
                            date: deadline,
                            title: `${schoolName} Submission Deadline`,
                            description: `Final deadline: ${deadline.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`,
                            tasks: [
                                { id: `${schoolName}-submit`, text: 'Submit application before deadline', completed: false },
                                { id: `${schoolName}-confirm`, text: 'Verify submission confirmation email', completed: false },
                                { id: `${schoolName}-portal`, text: 'Check application portal for missing items', completed: false }
                            ],
                            status: daysUntil > 0 ? 'deadline' : 'overdue',
                            isDeadline: true
                        }
                    ];

                    timelineItems.push(...milestones.map(m => ({
                        ...m,
                        school: schoolName,
                        daysUntil: Math.ceil((m.date - now) / (1000 * 60 * 60 * 24))
                    })));
                }

                timelineItems.sort((a, b) => a.date - b.date);
                const savedTasks = await loadTimelineTasks();

                timelineItems.slice(0, 12).forEach((item, index) => {
                    if (savedTasks[item.school]) {
                        item.tasks = item.tasks.map(task => ({
                            ...task,
                            completed: savedTasks[item.school][task.id] || false
                        }));
                    }

                    const timelineItem = createEnhancedTimelineItem(item, index);
                    timeline.appendChild(timelineItem);
                });

                if (loadingEl) loadingEl.style.display = 'none';

            } catch (error) {
                console.error('‚ùå Error creating timeline:', error);
                if (loadingEl) loadingEl.style.display = 'none';
                timeline.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--danger-color);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <p>Failed to load timeline. Please refresh the page.</p>
                    </div>
                `;
            }
        }

        function createEnhancedTimelineItem(event, index) {
            const item = document.createElement('div');
            item.className = 'timeline-item';

            let statusColor = event.isDeadline ? 'var(--danger-color)' :
                            event.status === 'in-progress' ? 'var(--warning-color)' : 'var(--info-color)';
            let statusIcon = event.isDeadline ? 'fas fa-flag-checkered' :
                           event.status === 'in-progress' ? 'fas fa-tasks' : 'fas fa-clock';

            const completedTasks = event.tasks.filter(t => t.completed).length;
            const totalTasks = event.tasks.length;
            const completionPercentage = Math.round((completedTasks / totalTasks) * 100);
            const isFullyCompleted = completedTasks === totalTasks;

            const tasksHTML = event.tasks.map(task => `
                <div class="timeline-task ${task.completed ? 'completed' : ''}" data-task-id="${task.id}" data-school="${event.school}">
                    <input type="checkbox"
                           class="timeline-task-checkbox"
                           ${task.completed ? 'checked' : ''}
                           onchange="toggleTimelineTask('${event.school}', '${task.id}', this.checked)">
                    <span class="timeline-task-text">${task.text}</span>
                </div>
            `).join('');

            item.innerHTML = `
                <div class="timeline-content ${isFullyCompleted ? 'completed' : ''}">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <span class="timeline-school-tag">
                            <i class="fas fa-university"></i>
                            ${event.school}
                        </span>
                        ${event.daysUntil >= 0 ?
                            `<span style="font-size: 0.85rem; color: ${event.daysUntil <= 7 ? 'var(--danger-color)' : 'var(--text-secondary)'}; font-weight: 600;">
                                ${event.daysUntil} days left
                            </span>` :
                            `<span style="font-size: 0.85rem; color: var(--danger-color); font-weight: 600;">
                                Overdue
                            </span>`
                        }
                    </div>
                    <div class="timeline-date">${event.date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</div>
                    <div class="timeline-title">${event.title}</div>
                    <div class="timeline-description">${event.description}</div>
                    <div style="margin-top: 1rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.85rem; color: var(--text-secondary); font-weight: 600;">Tasks to Complete:</span>
                        <span style="font-size: 0.85rem; color: ${isFullyCompleted ? 'var(--success-color)' : 'var(--accent-color)'}; font-weight: 700;">
                            ${completedTasks}/${totalTasks} Complete (${completionPercentage}%)
                        </span>
                    </div>
                    <div class="timeline-checklist">
                        ${tasksHTML}
                    </div>
                </div>
                <div class="timeline-icon" style="background: ${statusColor}">
                    <i class="${statusIcon}"></i>
                </div>
            `;

            return item;
        }

        async function loadTimelineTasks() {
            try {
                const userId = window.currentUser.uid;
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
                return userData?.timelineTasks || {};
            } catch (error) {
                console.error('Error loading timeline tasks:', error);
                return {};
            }
        }

        window.toggleTimelineTask = async function(school, taskId, completed) {
            try {
                const userId = window.currentUser.uid;
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
                const timelineTasks = userData?.timelineTasks || {};

                if (!timelineTasks[school]) {
                    timelineTasks[school] = {};
                }

                timelineTasks[school][taskId] = completed;

                await updateDoc(doc(db, 'users', userId), {
                    timelineTasks: timelineTasks,
                    lastTimelineUpdate: new Date()
                });

                const taskElement = document.querySelector(`[data-task-id="${taskId}"][data-school="${school}"]`);
                if (taskElement) {
                    if (completed) {
                        taskElement.classList.add('completed');
                    } else {
                        taskElement.classList.remove('completed');
                    }
                }

                const timelineContent = taskElement.closest('.timeline-content');
                const allTasks = timelineContent.querySelectorAll('.timeline-task');
                const allCompleted = Array.from(allTasks).every(t => t.classList.contains('completed'));

                if (allCompleted) {
                    timelineContent.classList.add('completed');
                    showNotification('Great Progress!', 'All tasks completed for this milestone!', 'success');
                } else {
                    timelineContent.classList.remove('completed');
                }

                updateProgressCircle();

            } catch (error) {
                console.error('Error toggling timeline task:', error);
                showNotification('Error', 'Failed to update task. Please try again.', 'error');
            }
        };

        // Load and display tasks
        function loadTasks() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            const tasks = generatePersonalizedTasks();
            
            tasks.forEach(task => {
                const taskItem = createTaskItem(task);
                taskList.appendChild(taskItem);
            });
        }

        // Generate personalized tasks based on user data
        function generatePersonalizedTasks() {
            const tasks = [];
            const questionnaire = window.userData?.questionnaire || {};
            const applications = window.applicationData || [];
            
            if (applications.some(app => app.status === 'not-started')) {
                tasks.push({
                    title: 'Complete college applications',
                    due: 'Due in 15 days',
                    priority: 'high',
                    completed: false
                });
            }
            
            if (!questionnaire.essayText && !questionnaire.essayFileURL) {
                tasks.push({
                    title: 'Write personal statement',
                    due: 'Due in 10 days',
                tasks.push({re.resumeStarted || questionnaire.resumeStarted === 'no') {
                    due: 'Due in 7 days', for applications',
                    priority: 'medium',
                }); completed: false
            }
                    due: 'Due in 30 days', application',naire.resumeStarted === 'no') {
                    priority: 'high',m() > 0.5 letters',
                    completed: falseesume for applications',
                });stionnaire.financialAid?.includes('need-aid')) {
            }       priority: 'medium',
                    completed: false
            tasks.push({
                title: 'Schedule college interviews',
                due: 'Due in 25 days',
                priority: 'low',
                completed: Math.random() > 0.7 letters',
            }); due: 'Due in 20 days',
                priority: 'medium',
            return tasks.slice(0, 5);m() > 0.5
        }   });
            
        // Create task item elementcialAid?.includes('need-aid')) {
        function createTaskItem(task) {
            const item = document.createElement('div');,
            item.className = 'task-item';,
            if (task.completed) item.classList.add('completed');
                    completed: false
            item.innerHTML = `
                <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} 
                       onchange="toggleTask(this)">
                <div class="task-content">
                    <div class="task-title" style="${task.completed ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${task.title}</div>
                    <div class="task-due">${task.due}</div>
                </div>ty: 'low',
                <div class="task-priority ${task.priority}"></div>
            `;;
            
            return item;.slice(0, 5);
        }

        // Update progress circle with real data
        function updateProgressCircle() {
            const progress = calculateOverallProgress();
            const circumference = 2 * Math.PI * 60;
            const offset = circumference - (progress / 100) * circumference;
            
            const progressCircle = document.getElementById('progressCircle');
            const progressText = document.getElementById('progressText');eted ? 'checked' : ''} 
                       onchange="toggleTask(this)">
            if (progressCircle && progressText) {
                progressCircle.style.strokeDashoffset = offset;eted ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${task.title}</div>
                progressText.textContent = `${progress}%`;>
                </div>
                setTimeout(() => {riority ${task.priority}"></div>
                    progressCircle.style.transition = 'stroke-dashoffset 2s ease-in-out';
                }, 500);
            }eturn item;
        }

        // AI Insights Generation with real data
        async function generateAIInsights() {
            const insightsContainer = document.getElementById('aiInsights');
            if (!insightsContainer) { Math.PI * 60;
                console.warn('‚ö†Ô∏è AI Insights container not found');mference;
                return;
            }onst progressCircle = document.getElementById('progressCircle');
            const progressText = document.getElementById('progressText');
            insightsContainer.innerHTML = '<div class="loading"></div>';
            if (progressCircle && progressText) {
            try {rogressCircle.style.strokeDashoffset = offset;
                const insights = [];tent = `${progress}%`;
                const now = new Date();
                const targetSchools = window.userData?.questionnaire?.targetSchools || [];
                const userName = window.userData?.name || window.userData?.firstName || 'there';
                }, 500);
                insights.push({
                    icon: 'üëã',
                    text: `Welcome ${userName}! Here are your personalized insights.`,
                    type: 'positive'
                });ion generateAIInsights() {
            const insightsContainer = document.getElementById('aiInsights');
                let hasDeadlines = false;
                for (const schoolName of targetSchools) {t found');
                    let school = window.schoolDatabase?.[schoolName];
                    
                    if (!school) {
                        school = await getCollegeData(schoolName);div>';
                    }
            try {
                    if (school) {[];
                        const deadline = new Date(school.deadline);
                        const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
                const userName = window.userData?.name || window.userData?.firstName || 'there';
                        if (daysUntil > 0 && daysUntil <= 30) {
                            hasDeadlines = true;
                            insights.push({
                                icon: '‚è∞',ame}! Here are your personalized insights.`,
                                text: `${schoolName} deadline in ${daysUntil} days! ${daysUntil <= 7 ? 'Urgent action needed.' : 'Start preparing now.'}`,
                                type: daysUntil <= 7 ? 'urgent' : 'warning'
                            });
                        }adlines = false;
                    }const schoolName of targetSchools) {
                }   let school = window.schoolDatabase?.[schoolName];
                    
                const userGPA = parseFloat(window.userData?.questionnaire?.unweightedGPA || window.userData?.gpa || 0);
                if (userGPA >= 3.8) {t getCollegeData(schoolName);
                    insights.push({
                        icon: 'üåü',
                        text: `Your ${userGPA.toFixed(2)} GPA is excellent! You're competitive for highly selective schools.`,
                        type: 'positive' new Date(school.deadline);
                    }); const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
                } else if (userGPA >= 3.5) {
                    insights.push({il > 0 && daysUntil <= 30) {
                        icon: 'üìö',lines = true;
                        text: `Your ${userGPA.toFixed(2)} GPA is strong. Apply to a mix of reach and target schools.`,
                        type: 'normal''‚è∞',
                    });         text: `${schoolName} deadline in ${daysUntil} days! ${daysUntil <= 7 ? 'Urgent action needed.' : 'Start preparing now.'}`,
                } else if (userGPA > 0) {sUntil <= 7 ? 'urgent' : 'warning'
                    insights.push({
                        icon: 'üí™',
                        text: `GPA: ${userGPA.toFixed(2)}. Emphasize your strengths in extracurriculars and essays!`,
                        type: 'normal'
                    });
                }onst userGPA = parseFloat(window.userData?.questionnaire?.unweightedGPA || window.userData?.gpa || 0);
                if (userGPA >= 3.8) {
                const progress = calculateOverallProgress();
                if (progress >= 75) {
                    insights.push({ ${userGPA.toFixed(2)} GPA is excellent! You're competitive for highly selective schools.`,
                        icon: 'üöÄ',tive'
                        text: `${progress}% complete! You're on track. Keep up the momentum!`,
                        type: 'positive'5) {
                    });ights.push({
                } else if (progress >= 50) {
                    insights.push({ ${userGPA.toFixed(2)} GPA is strong. Apply to a mix of reach and target schools.`,
                        icon: '‚è≥',mal'
                        text: `${progress}% done. Good progress! Stay focused on timeline tasks.`,
                        type: 'normal') {
                    });ights.push({
                } else if (progress > 0) {
                    insights.push({ ${userGPA.toFixed(2)}. Emphasize your strengths in extracurriculars and essays!`,
                        icon: '‚ö°',mal'
                        text: `${progress}% complete. Time to accelerate! Focus on timeline tasks.`,
                        type: 'urgent'
                    });
                }onst progress = calculateOverallProgress();
                if (progress >= 75) {
                const questionnaire = window.userData?.questionnaire || {};
                if (!questionnaire.intendedMajor) {
                    insights.push({ogress}% complete! You're on track. Keep up the momentum!`,
                        icon: 'üìù',tive'
                        text: 'Add your intended major to get better school recommendations.',
                        type: 'normal' 50) {
                    });ights.push({
                }       icon: '‚è≥',
                        text: `${progress}% done. Good progress! Stay focused on timeline tasks.`,
                if (targetSchools.length === 0) {
                    insights.push({
                        icon: 'üè´', > 0) {
                        text: 'Add target schools to start tracking deadlines and building your timeline!',
                        type: 'urgent'
                    }); text: `${progress}% complete. Time to accelerate! Focus on timeline tasks.`,
                } else if (targetSchools.length < 5) {
                    insights.push({
                        icon: 'üìã',
                        text: `You have ${targetSchools.length} schools. Consider adding more (8-12 recommended).`,
                        type: 'normal'window.userData?.questionnaire || {};
                    });estionnaire.intendedMajor) {
                }   insights.push({
                        icon: 'üìù',
                insightsContainer.innerHTML = insights.slice(0, 6).map(insight => `ndations.',
                    <div class="insight-card ${insight.type}">
                        <div class="insight-icon">${insight.icon}</div>
                        <div class="insight-text">${insight.text}</div>
                    </div>
                `).join('');hools.length === 0) {
                    insights.push({
            } catch (error) { 'üè´',
                console.error('‚ùå Error generating insights:', error);eadlines and building your timeline!',
                insightsContainer.innerHTML = `
                    <div class="insight-card">
                        <div class="insight-icon">‚ö†Ô∏è</div>
                        <div class="insight-text">Unable to load insights. Please refresh the page.</div>
                    </div>on: 'üìã',
                `;      text: `You have ${targetSchools.length} schools. Consider adding more (8-12 recommended).`,
            }           type: 'normal'
        }           });
                }
        // College Profile Navigation
        window.openCollegeProfile = function(schoolName) {ce(0, 6).map(insight => `
            sessionStorage.setItem('selectedCollege', schoolName);
            window.location.href = `collegesearch.html?college=${encodeURIComponent(schoolName)}`;
        };              <div class="insight-text">${insight.text}</div>
                    </div>
        // Add School to Application List
        window.addToApplicationList = async function(schoolName) {
            try {ch (error) {
                const userId = window.currentUser.uid;ghts:', error);
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
                const questionnaire = userData?.questionnaire || {};
                        <div class="insight-text">Unable to load insights. Please refresh the page.</div>
                let targetSchools = questionnaire.targetSchools || [];
                `;
                if (targetSchools.includes(schoolName)) {
                    showNotification('Already Added', `${schoolName} is already in your application list!`, 'info');
                    return;
                }e Profile Navigation
        window.openCollegeProfile = function(schoolName) {
                targetSchools.push(schoolName);lege', schoolName);
            window.location.href = `collegesearch.html?college=${encodeURIComponent(schoolName)}`;
                await updateDoc(doc(db, 'users', userId), {
                    'questionnaire.targetSchools': targetSchools,
                    lastUpdated: new Date()
                });oApplicationList = async function(schoolName) {
            try {
                if (!window.userData.questionnaire) window.userData.questionnaire = {};
                window.userData.questionnaire.targetSchools = targetSchools;
                const userData = userDoc.data();
                showNotification('School Added!', `${schoolName has been added to your application list!`, 'success');

                setTimeout(() => {= questionnaire.targetSchools || [];
                    createApplicationTimeline();
                }, 1000);tSchools.includes(schoolName)) {
                    showNotification('Already Added', `${schoolName} is already in your application list!`, 'info');
            } catch (error) {
                console.error('Error adding school:', error);
                showNotification('Error', 'Failed to add school. Please try again.', 'error');
            }   targetSchools.push(schoolName);
        };
                await updateDoc(doc(db, 'users', userId), {
        // Check for upcoming deadlines and show alertsetSchools,
        function checkDeadlineAlerts() {e()
            if (!window.applicationData) return;
            
            const now = new Date();a.questionnaire) window.userData.questionnaire = {};
            const urgentDeadlines = window.applicationData.filter(app => {s;
                const deadline = new Date(app.deadline);
                const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24)); application list!`, 'success');
                return daysUntil <= 7 && daysUntil > 0 && app.status !== 'submitted';
            }); setTimeout(() => {
                    createApplicationTimeline();
            if (urgentDeadlines.length > 0) {
                const alertBanner = document.getElementById('alertBanner');
                const alertText = document.getElementById('alertText');
                console.error('Error adding school:', error);
                const school = urgentDeadlines[0];to add school. Please try again.', 'error');
                const deadline = new Date(school.deadline);
                const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
                
                alertText.textContent = `${school.schoolName} application due in ${daysUntil} day${daysUntil !== 1 ? 's' : ''}!`;
                alertBanner.classList.add('show');
            }f (!window.applicationData) return;
        }   
            const now = new Date();
        // Update welcome message with personalizationData.filter(app => {
        function updateWelcomeMessage() {(app.deadline);
            const welcomeTitle = document.getElementById('welcomeTitle'); * 60 * 24));
            const welcomeMessage = document.getElementById('welcomeMessage');mitted';
            const userData = window.userData;
            
            if (userData?.name) {ength > 0) {
                welcomeTitle.textContent = `Welcome back, ${userData.name}!`;
            }   const alertText = document.getElementById('alertText');
                
            const questionnaire = userData?.questionnaire;
            if (questionnaire?.intendedMajor && questionnaire?.targetSchools?.length > 0) {
                const major = questionnaire.intendedMajor;w) / (1000 * 60 * 60 * 24));
                const topSchool = questionnaire.targetSchools[0];
                welcomeMessage.textContent = `Ready to advance your ${major} journey at ${topSchool} and other top schools?`;}!`;
            } else if (questionnaire?.intendedMajor) {
                welcomeMessage.textContent = `Let's make your ${questionnaire.intendedMajor} dreams a reality with AI-powered guidance`;
            } else {
                welcomeMessage.textContent = 'Your personalized college application command center powered by AI';
            }date welcome message with personalization
        }unction updateWelcomeMessage() {
            const welcomeTitle = document.getElementById('welcomeTitle');
        // Update trend indicators document.getElementById('welcomeMessage');
        function updateTrends() {ow.userData;
            const applicationsTrend = document.getElementById('applicationsTrend');
            const essaysTrend = document.getElementById('essaysTrend');
            const scholarshipTrend = document.getElementById('scholarshipTrend');
            const progressTrend = document.getElementById('progressTrend');
            
            const recentApplications = window.applicationData?.filter(app => {
                const weekAgo = new Date();r && questionnaire?.targetSchools?.length > 0) {
                weekAgo.setDate(weekAgo.getDate() - 7);or;
                return new Date(app.lastUpdated?.toDate?.() || app.createdAt?.toDate?.() || Date.now()) > weekAgo;
            }).length || 0;age.textContent = `Ready to advance your ${major} journey at ${topSchool} and other top schools?`;
            } else if (questionnaire?.intendedMajor) {
            applicationsTrend.textContent = `+${recentApplications} this week`;ntendedMajor} dreams a reality with AI-powered guidance`;
            essaysTrend.textContent = 'In review';
            scholarshipTrend.textContent = 'New matches';alized college application command center powered by AI';
            progressTrend.textContent = 'On track';
        }

        // Utility functions for extracting test scores
        function extractSATScore(testScores) {
            if (!testScores) return null;ument.getElementById('applicationsTrend');
            const match = testScores.match(/SAT:?\s*(\d+)/i);ysTrend');
            return match ? parseInt(match[1]) : null;entById('scholarshipTrend');
        }   const progressTrend = document.getElementById('progressTrend');
            
        function extractACTScore(testScores) {applicationData?.filter(app => {
            if (!testScores) return null;);
            const match = testScores.match(/ACT:?\s*(\d+)/i);
            return match ? parseInt(match[1]) : null;te?.() || app.createdAt?.toDate?.() || Date.now()) > weekAgo;
        }   }).length || 0;
            
        // ========================================entApplications} this week`;
        // NEW INTERACTIVE FEATURES = 'In review';
        // ========================================ches';
            progressTrend.textContent = 'On track';
        // Streak Tracker
        async function updateStreakTracker() {
            try {y functions for extracting test scores
                if (!window.currentUser) {s) {
                    logger.log('No user logged in, skipping streak tracker');
                    return;estScores.match(/SAT:?\s*(\d+)/i);
                }n match ? parseInt(match[1]) : null;
        }
                const userId = window.currentUser.uid;
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
            const match = testScores.match(/ACT:?\s*(\d+)/i);
                if (!userData) {Int(match[1]) : null;
                    logger.log('No user data found');
                    return;
                }==================================
        // NEW INTERACTIVE FEATURES
                const today = new Date().toDateString();
                const lastLogin = userData?.lastLoginDate;
                const streak = userData?.loginStreak || 0;
        async function updateStreakTracker() {
                let newStreak = streak;
                if (!window.currentUser) {
                if (lastLogin !== today) {gged in, skipping streak tracker');
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayStr = yesterday.toDateString();
                const userId = window.currentUser.uid;
                    if (lastLogin === yesterdayStr) {'users', userId));
                        newStreak = streak + 1;;
                    } else {
                        newStreak = 1;
                    }ogger.log('No user data found');
                    return;
                    await updateDoc(doc(db, 'users', userId), {
                        lastLoginDate: today,
                        loginStreak: newStreakeString();
                    });astLogin = userData?.lastLoginDate;
                const streak = userData?.loginStreak || 0;
                    if (newStreak > streak && newStreak % 7 === 0) {
                        celebrate('üî• Week Streak!', `Amazing! You've logged in ${newStreak} days in a row!`);
                    }
                }f (lastLogin !== today) {
                    const yesterday = new Date();
                if (newStreak >= 3) {(yesterday.getDate() - 1);
                    document.getElementById('streakTracker').style.display = 'flex';
                    document.getElementById('streakDays').textContent = newStreak;
                }   if (lastLogin === yesterdayStr) {
            } catch (error) {reak = streak + 1;
                console.error('Error updating streak:', error);
            }           newStreak = 1;
        }           }

        // Word Counter and Essay Progress, 'users', userId), {
        async function updateWordCounter() {,
            try {       loginStreak: newStreak
                const wordsTodayEl = document.getElementById('wordsToday');
                const wordProgressEl = document.getElementById('wordProgressFill');
                const wordPercentageEl = document.getElementById('wordPercentage');
                        celebrate('üî• Week Streak!', `Amazing! You've logged in ${newStreak} days in a row!`);
                if (!wordsTodayEl || !wordProgressEl || !wordPercentageEl) {
                    console.warn('‚ö†Ô∏è Word counter elements not found');
                    return;
                }f (newStreak >= 3) {
                    document.getElementById('streakTracker').style.display = 'flex';
                if (!window.currentUser) {d('streakDays').textContent = newStreak;
                    wordsTodayEl.textContent = '0';
                    wordProgressEl.style.width = '0%';
                    wordPercentageEl.textContent = '0%';error);
                    return;
                }

                const userId = window.currentUser.uid;
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
                const wordsTodayEl = document.getElementById('wordsToday');
                const today = new Date().toDateString();ntById('wordProgressFill');
                const wordsToday = userData?.wordsWrittenToday || 0;rdPercentage');
                const lastWordUpdate = userData?.lastWordUpdate;
                if (!wordsTodayEl || !wordProgressEl || !wordPercentageEl) {
                const displayWords = (lastWordUpdate === today) ? wordsToday : 0;
                const goal = 500;
                const percentage = Math.min((displayWords / goal) * 100, 100);

                wordsTodayEl.textContent = displayWords;
                wordProgressEl.style.width = percentage + '%';
                wordPercentageEl.textContent = Math.round(percentage) + '%';
                    wordPercentageEl.textContent = '0%';
                if (percentage >= 100 && displayWords > 0) {
                    celebrate('‚úçÔ∏è Writing Goal Met!', 'You crushed your daily writing goal!');
                }
            } catch (error) {= window.currentUser.uid;
                console.error('‚ùå Error updating word counter:', error);
            }   const userData = userDoc.data();
        }
                const today = new Date().toDateString();
        // Document TrackerToday = userData?.wordsWrittenToday || 0;
        async function updateDocumentTracker() {.lastWordUpdate;
            const trackerContainer = document.getElementById('documentTracker');
                const displayWords = (lastWordUpdate === today) ? wordsToday : 0;
            if (!trackerContainer) {
                console.warn('Document tracker container not found');00, 100);
                return;
            }   wordsTodayEl.textContent = displayWords;
                wordProgressEl.style.width = percentage + '%';
            const documents = [l.textContent = Math.round(percentage) + '%';
                { name: 'Transcript', status: 'complete', icon: 'üìÑ' },
                { name: 'Recommendation Letters', status: 'pending', icon: 'üìù', count: '2/3' },
                { name: 'Test Scores', status: 'complete', icon: 'üìä' },daily writing goal!');
                { name: 'Financial Documents', status: 'pending', icon: 'üí∞' },
                { name: 'Portfolio/Resume', status: 'complete', icon: 'üìã' }
            ];  console.error('‚ùå Error updating word counter:', error);
            }
            trackerContainer.innerHTML = documents.map(doc => `
                <div class="document-item">
                    <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
                        <div class="document-status ${doc.status}"></div>
                        <span style="font-size: 1.2rem;">${doc.icon}</span>er');
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary);">${doc.name}</div>
                            ${doc.count ? `<div style="font-size: 0.85rem; color: var(--text-secondary);">${doc.count}</div>` : ''}
                        </div>
                    </div>
                    <span style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                        ${doc.status}
                    </span>anscript', status: 'complete', icon: 'üìÑ' },
                </div>: 'Recommendation Letters', status: 'pending', icon: 'üìù', count: '2/3' },
            `).join('');'Test Scores', status: 'complete', icon: 'üìä' },
        }       { name: 'Financial Documents', status: 'pending', icon: 'üí∞' },
                { name: 'Portfolio/Resume', status: 'complete', icon: 'üìã' }
        // Financial Aid Calculator
        window.calculateEFC = function() {
            const income = parseFloat(document.getElementById('familyIncome').value) || 0;
            const familySize = parseInt(document.getElementById('familySize').value) || 4;
                    <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
            if (income === 0) {ass="document-status ${doc.status}"></div>
                showNotification('Input Required', 'Please enter your family income', 'warning');
                return; <div>
            }               <div style="font-weight: 600; color: var(--text-primary);">${doc.name}</div>
                            ${doc.count ? `<div style="font-size: 0.85rem; color: var(--text-secondary);">${doc.count}</div>` : ''}
            let efc = 0;</div>
            const adjustedIncome = income - (familySize * 6000);
                    <span style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
            if (adjustedIncome > 0) {
                if (adjustedIncome <= 25000) {
                    efc = adjustedIncome * 0.22;
                } else if (adjustedIncome <= 50000) {
                    efc = 5500 + (adjustedIncome - 25000) * 0.25;
                } else {
                    efc = 11750 + (adjustedIncome - 50000) * 0.29;
                }lculateEFC = function() {
            }onst income = parseFloat(document.getElementById('familyIncome').value) || 0;
            const familySize = parseInt(document.getElementById('familySize').value) || 4;
            efc = Math.max(0, Math.round(efc));
            if (income === 0) {
            const resultDiv = document.getElementById('efcResult');ur family income', 'warning');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="calculator-result">
                    <div style="font-size: 0.9rem; opacity: 0.9;">Estimated Family Contribution</div>
                    <h3>$${efc.toLocaleString()}/year</h3>6000);
                    <p style="font-size: 0.85rem; margin-top: 0.5rem; opacity: 0.8;">
                        This is an estimate. Actual EFC may vary based on assets and other factors.
                    </p>stedIncome <= 25000) {
                </div>c = adjustedIncome * 0.22;
            `;  } else if (adjustedIncome <= 50000) {
        };          efc = 5500 + (adjustedIncome - 25000) * 0.25;
                } else {
        // Celebration System50 + (adjustedIncome - 50000) * 0.29;
        function celebrate(title, message, icon = 'üéâ') {
            const modal = document.getElementById('celebrationModal');
            const overlay = document.getElementById('tourOverlay');
            efc = Math.max(0, Math.round(efc));
            document.getElementById('celebrationIcon').textContent = icon;
            document.getElementById('celebrationTitle').textContent = title;
            document.getElementById('celebrationMessage').textContent = message;
            resultDiv.innerHTML = `
            overlay.classList.add('active');t">
            modal.classList.add('active'); 0.9rem; opacity: 0.9;">Estimated Family Contribution</div>
                    <h3>$${efc.toLocaleString()}/year</h3>
            for (let i = 0; i < 50; i++) {.85rem; margin-top: 0.5rem; opacity: 0.8;">
                setTimeout(() => createConfetti(), i * 30); vary based on assets and other factors.
            }       </p>
                </div>
            setTimeout(() => {
                if (modal.classList.contains('active')) {
                    closeCelebration();
                }ation System
            }, 5000);brate(title, message, icon = 'üéâ') {
        }   const modal = document.getElementById('celebrationModal');
            const overlay = document.getElementById('tourOverlay');
        function createConfetti() {
            const confetti = document.createElement('div');Content = icon;
            confetti.className = 'confetti';tionTitle').textContent = title;
            confetti.style.left = Math.random() * window.innerWidth + 'px';sage;
            confetti.style.background = ['#a07bcc', '#2a357a', '#10b981', '#f59e0b', '#ef4444'][Math.floor(Math.random() * 5)];
            confetti.style.animationDelay = Math.random() * 0.5 + 's';
            document.body.appendChild(confetti);

            setTimeout(() => confetti.remove(), 3000);
        }       setTimeout(() => createConfetti(), i * 30);
            }
        window.closeCelebration = function() {
            document.getElementById('celebrationModal').classList.remove('active');
            document.getElementById('tourOverlay').classList.remove('active');
        };          closeCelebration();
                }
        window.closeAllModals = function() {
            if (currentTourStep > 0 && currentTourStep < tourSteps.length) {
                return;
            }ion createConfetti() {
            const confetti = document.createElement('div');
            document.getElementById('celebrationModal')?.classList.remove('active');
            document.getElementById('tourOverlay')?.classList.remove('active');
            document.getElementById('tourSpotlight')?.style && (document.getElementById('tourSpotlight').style.display = 'none');
            document.getElementById('tourTooltip')?.style && (document.getElementById('tourTooltip').style.display = 'none');
            document.body.appendChild(confetti);
            document.querySelectorAll('.celebration-modal').forEach(modal => {
                if (modal.id !== 'celebrationModal') {
                    modal.remove();
                }
            });closeCelebration = function() {
        };  document.getElementById('celebrationModal').classList.remove('active');
            document.getElementById('tourOverlay').classList.remove('active');
        // Interactive Tour System
        let currentTourStep = 0;
        const tourSteps = [ls = function() {
            {f (currentTourStep > 0 && currentTourStep < tourSteps.length) {
                element: '.stats-grid',
                title: 'Application Stats',
                description: 'Track your progress at a glance. See how many schools you\'re applying to, essays completed, and scholarships available.',
                position: 'bottom'd('celebrationModal')?.classList.remove('active');
            },cument.getElementById('tourOverlay')?.classList.remove('active');
            {ocument.getElementById('tourSpotlight')?.style && (document.getElementById('tourSpotlight').style.display = 'none');
                element: '.timeline-section',tip')?.style && (document.getElementById('tourTooltip').style.display = 'none');
                title: 'Your Application Timeline',
                description: 'Never miss a deadline! Check off tasks as you complete them and watch your progress grow.',
                position: 'right''celebrationModal') {
            },      modal.remove();
            {   }
                element: '#aiInsights',
                title: 'AI Insights',
                description: 'Get personalized recommendations based on your profile, deadlines, and application status.',
                position: 'left'em
            },rrentTourStep = 0;
            { tourSteps = [
                element: '.school-match-section',
                title: 'School Recommendations',
                description: 'AI-powered school matches based on your GPA, test scores, and preferences. Click any school to learn more!',
                position: 'bottom'k your progress at a glance. See how many schools you\'re applying to, essays completed, and scholarships available.',
            },  position: 'bottom'
            {,
                element: '.word-counter-widget',
                title: 'Essay Progress Tracker',
                description: 'Set daily writing goals and track your progress. Consistency is key to great essays!',
                position: 'left'ver miss a deadline! Check off tasks as you complete them and watch your progress grow.',
            },  position: 'right'
            {,
                element: '.quick-actions',
                title: 'Quick Actions',
                description: 'Access helpful tools like calendar view, school comparison, and this tour anytime!',
                position: 'left't personalized recommendations based on your profile, deadlines, and application status.',
            }   position: 'left'
        ];  },
            {
        window.startTour = function() {-section',
            currentTourStep = 0;ecommendations',
            document.getElementById('tourOverlay').classList.add('active');test scores, and preferences. Click any school to learn more!',
            showTourStep();bottom'
        };  },
            {
        function showTourStep() {ounter-widget',
            if (currentTourStep >= tourSteps.length) {
                endTour();n: 'Set daily writing goals and track your progress. Consistency is key to great essays!',
                return;n: 'left'
            },
            {
            const step = tourSteps[currentTourStep];
            const element = document.querySelector(step.element);
                description: 'Access helpful tools like calendar view, school comparison, and this tour anytime!',
            if (!element) {left'
                currentTourStep++;
                showTourStep();
                return;
            }w.startTour = function() {
            currentTourStep = 0;
            const rect = element.getBoundingClientRect();ist.add('active');
            const spotlight = document.getElementById('tourSpotlight');
            const tooltip = document.getElementById('tourTooltip');

            spotlight.style.display = 'block';
            spotlight.style.top = (rect.top - 10) + 'px';
            spotlight.style.left = (rect.left - 10) + 'px';
            spotlight.style.width = (rect.width + 20) + 'px';
            spotlight.style.height = (rect.height + 20) + 'px';

            tooltip.style.display = 'block';urStep];
            document.getElementById('tourTitle').textContent = step.title;
            document.getElementById('tourDescription').textContent = step.description;
            document.getElementById('tourProgress').textContent = `${currentTourStep + 1} of ${tourSteps.length}`;
                currentTourStep++;
            if (step.position === 'bottom') {
                tooltip.style.top = (rect.bottom + 20) + 'px';
                tooltip.style.left = rect.left + 'px';
            } else if (step.position === 'right') {
                tooltip.style.top = rect.top + 'px';ct();
                tooltip.style.left = (rect.right + 20) + 'px';tlight');
            } else if (step.position === 'left') {d('tourTooltip');
                tooltip.style.top = rect.top + 'px';
                tooltip.style.left = (rect.left - 370) + 'px';
            }potlight.style.top = (rect.top - 10) + 'px';
            spotlight.style.left = (rect.left - 10) + 'px';
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }   spotlight.style.height = (rect.height + 20) + 'px';

        window.nextTourStep = function() {';
            currentTourStep++;tById('tourTitle').textContent = step.title;
            showTourStep();mentById('tourDescription').textContent = step.description;
        };  document.getElementById('tourProgress').textContent = `${currentTourStep + 1} of ${tourSteps.length}`;

        window.skipTour = function() {tom') {
            endTour();p.style.top = (rect.bottom + 20) + 'px';
        };      tooltip.style.left = rect.left + 'px';
            } else if (step.position === 'right') {
        async function endTour() {= rect.top + 'px';
            document.getElementById('tourOverlay').classList.remove('active');
            document.getElementById('tourSpotlight').style.display = 'none';
            document.getElementById('tourTooltip').style.display = 'none';
            currentTourStep = 0;ft = (rect.left - 370) + 'px';
            }
            if (window.currentUser) {
                try {crollIntoView({ behavior: 'smooth', block: 'center' });
                    await updateDoc(doc(db, 'users', window.currentUser.uid), {
                        tourCompleted: true,
                        tourCompletedAt: new Date()
                    });Step++;
                    console.log('‚úÖ Tour completion saved to Firebase');
                } catch (error) {
                    console.error('Error saving tour completion:', error);
                }ipTour = function() {
            }ndTour();
        };

        // Calendar View Modal() {
        window.openCalendarView = function() {ay').classList.remove('active');
            const modal = document.createElement('div');le.display = 'none';
            modal.className = 'celebration-modal active';display = 'none';
            modal.style.maxWidth = '800px';
            modal.onclick = (e) => e.stopPropagation();
            modal.innerHTML = `ser) {
                <div style="text-align: left;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: var(--accent-color); margin: 0;">Deadline Calendar</h2>
                        <button onclick="this.closest('.celebration-modal').remove(); document.getElementById('tourOverlay').classList.remove('active');"
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">√ó</button>
                    </div>e.log('‚úÖ Tour completion saved to Firebase');
                    <div id="calendarContainer"></div>
                </div>nsole.error('Error saving tour completion:', error);
            `;  }
            }
            document.body.appendChild(modal);
            document.getElementById('tourOverlay').classList.add('active');
            renderCalendar();l
        };ndow.openCalendarView = function() {
            const modal = document.createElement('div');
        function renderCalendar() {bration-modal active';
            const container = document.getElementById('calendarContainer');
            const today = new Date();stopPropagation();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();adline Calendar</h2>
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate(); document.getElementById('tourOverlay').classList.remove('active');"
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">√ó</button>
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
                </div>
            let html = `
                <div style="text-align: center; margin-bottom: 1rem; font-size: 1.2rem; font-weight: 600; color: var(--text-primary);">
                    ${monthNames[currentMonth]} ${currentYear}
                </div>etElementById('tourOverlay').classList.add('active');
                <div class="calendar-grid">
                    ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day =>
                        `<div style="font-weight: 600; color: var(--text-secondary); text-align: center; padding: 0.5rem;">${day}</div>`
                    ).join('')}() {
            `;nst container = document.getElementById('calendarContainer');
            const today = new Date();
            for (let i = 0; i < firstDay; i++) {);
                html += '<div class="calendar-day" style="opacity: 0.3;"></div>';
            }
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            for (let day = 1; day <= daysInMonth; day++) {entMonth + 1, 0).getDate();
                const date = new Date(currentYear, currentMonth, day);
                const hasDeadline = checkIfDeadline(date);rch', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
                html += `
                    <div class="calendar-day ${hasDeadline ? 'has-deadline' : ''}">
                        <strong>${day}</strong> margin-bottom: 1rem; font-size: 1.2rem; font-weight: 600; color: var(--text-primary);">
                    </div>hNames[currentMonth]} ${currentYear}
                `;div>
            }   <div class="calendar-grid">
                    ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day =>
            html += '</div>'; style="font-weight: 600; color: var(--text-secondary); text-align: center; padding: 0.5rem;">${day}</div>`
            container.innerHTML = html;
        }   `;

        function checkIfDeadline(date) {; i++) {
            const targetSchools = window.userData?.questionnaire?.targetSchools || [];
            return targetSchools.some(schoolName => {
                const school = window.schoolDatabase?.[schoolName];
                if (!school) return false;nMonth; day++) {
                const deadline = new Date(school.deadline);onth, day);
                return deadline.toDateString() === date.toDateString();
            });
        }       html += `
                    <div class="calendar-day ${hasDeadline ? 'has-deadline' : ''}">
        // School Comparison Tool{day}</strong>
        window.openCompareSchools = function() {
            const targetSchools = window.userData?.questionnaire?.targetSchools || [];
            }
            if (targetSchools.length === 0) {
                showNotification('No Schools', 'Add schools to your list to compare them', 'info');
                return;nnerHTML = html;
            }

            const modal = document.createElement('div');
            modal.className = 'celebration-modal active';onnaire?.targetSchools || [];
            modal.style.maxWidth = '900px';lName => {
            modal.style.maxHeight = '80vh';lDatabase?.[schoolName];
            modal.style.overflow = 'auto';
            modal.onclick = (e) => e.stopPropagation();ne);
                return deadline.toDateString() === date.toDateString();
            modal.innerHTML = `
                <div style="text-align: left;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: var(--accent-color); margin: 0;">Compare Schools</h2>
                        <button onclick="this.closest('.celebration-modal').remove(); document.getElementById('tourOverlay').classList.remove('active');"
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">√ó</button>
                    </div>
                    <div class="comparison-container">
                        ${targetSchools.slice(0, 4).map(schoolName => {t to compare them', 'info');
                            const school = window.schoolDatabase?.[schoolName];
                            if (!school) return '';
                            return `
                                <div class="comparison-card">
                    <div class="comparison-container">e';
                        ${targetSchools.slice(0, 4).map(schoolName => {
                            const school = window.schoolDatabase?.[schoolName];
                            if (!school) return '';
                            return `.stopPropagation();
                                <div class="comparison-card">
                                    <h3 style="color: var(--accent-color); margin-bottom: 1rem; font-size: 1.1rem;">${schoolName}</h3>
                                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                        <div>; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Acceptance Rate</div>
                                            <div style="font-size: 1.3rem; font-weight: 700; color: ${school.acceptance_rate < 10 ? 'var(--danger-color)' : school.acceptance_rate < 25 ? 'var(--warning-color)' : 'var(--success-color)'};">
                                                ${school.acceptance_rate}%t-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">√ó</button>
                                            </div>
                                        </div>tainer">
                                        <div>(0, 4).map(schoolName => {
                                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Average GPA</div>
                                            <div style="font-size: 1.3rem; font-weight: 700;">${school.avg_gpa}</div>
                                        </div>
                                        <div>omparison-card">
                                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Average SAT</div>
                                            <div style="font-size: 1.3rem; font-weight: 700;">${school.avg_sat}</div>
                                        </div>dow.schoolDatabase?.[schoolName];
                                        <div>rn '';
                                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Location</div>
                                            <div style="font-weight: 600;">${school.location}</div>
                                        </div>"color: var(--accent-color); margin-bottom: 1rem; font-size: 1.1rem;">${schoolName}</h3>
                                        <div>e="display: flex; flex-direction: column; gap: 0.75rem;">
                                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Deadline</div>
                                            <div style="font-weight: 600; color: var(--danger-color);">);">Acceptance Rate</div>
                                                ${new Date(school.deadline).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}anger-color)' : school.acceptance_rate < 25 ? 'var(--warning-color)' : 'var(--success-color)'};">
                                            </div>school.acceptance_rate}%
                                        </div>div>
                                    </div>div>
                                </div>  <div>
                            `;              <div style="font-size: 0.85rem; color: var(--text-secondary);">Average GPA</div>
                        }).join('')}        <div style="font-size: 1.3rem; font-weight: 700;">${school.avg_gpa}</div>
                    </div>              </div>
                </div>                  <div>
            `;                              <div style="font-size: 0.85rem; color: var(--text-secondary);">Average SAT</div>
                                            <div style="font-size: 1.3rem; font-weight: 700;">${school.avg_sat}</div>
            document.body.appendChild(modal);>
            document.getElementById('tourOverlay').classList.add('active');
        };                                  <div style="font-size: 0.85rem; color: var(--text-secondary);">Location</div>
                                            <div style="font-weight: 600;">${school.location}</div>
        // Check if first time user and start tour
        async function checkFirstTimeUser() {
            console.log('üéØ Tour popup disabled by design');-size: 0.85rem; color: var(--text-secondary);">Deadline</div>
            return;                         <div style="font-weight: 600; color: var(--danger-color);">
        }                                       ${new Date(school.deadline).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                                            </div>
        function startTourFromModal() { </div>
            const modal = document.getElementById('tourWelcomeModal');
            if (modal) {        </div>
                modal.style.display = 'none';
            }           }).join('')}
            startTour();v>
        }       </div>
            `;
        async function dismissTourModal() {
            const modal = document.getElementById('tourWelcomeModal');
            if (modal) {ElementById('tourOverlay').classList.add('active');
                modal.style.display = 'none';
            }
            if (window.currentUser) {nd start tour
                try {n checkFirstTimeUser() {
                    await updateDoc(doc(db, 'users', window.currentUser.uid), {
                        tourCompleted: true,
                        tourDismissedAt: new Date()
                    });
                    console.log('‚úÖ Tour marked as completed in Firebase');
                } catch (error) {t.getElementById('tourWelcomeModal');
                    console.error('Error saving tour dismissal:', error);
                }odal.style.display = 'none';
            }
        }   startTour();
        }
        window.startTourFromModal = startTourFromModal;
        window.dismissTourModal = dismissTourModal;
            const modal = document.getElementById('tourWelcomeModal');
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' || e.keyCode === 27) {
                const tourActive = currentTourStep > 0 && currentTourStep < tourSteps.length;
                if (tourActive) {r) {
                    skipTour();
                } else {t updateDoc(doc(db, 'users', window.currentUser.uid), {
                    closeAllModals();: true,
                }       tourDismissedAt: new Date()
            }       });
        });         console.log('‚úÖ Tour marked as completed in Firebase');
                } catch (error) {
        window.toggleTask = function(checkbox) {tour dismissal:', error);
            const taskItem = checkbox.closest('.task-item');
            const taskTitle = taskItem.querySelector('.task-title');
            
            if (checkbox.checked) {
                taskItem.classList.add('completed');al;
                taskTitle.style.textDecoration = 'line-through';
                taskTitle.style.opacity = '0.6';
                showNotification('Task Completed!', 'Great progress on your college journey!', 'success');
            } else {y === 'Escape' || e.keyCode === 27) {
                taskItem.classList.remove('completed');&& currentTourStep < tourSteps.length;
                taskTitle.style.textDecoration = 'none';
                taskTitle.style.opacity = '1';
            }   } else {
        };          closeAllModals();
                }
        window.dismissAlert = function() {
            document.getElementById('alertBanner').classList.remove('show');
        };
        window.toggleTask = function(checkbox) {
        window.showSchoolDetails = function(schoolName, school) {
            const details = ` taskItem.querySelector('.task-title');
                School: ${schoolName}
                Location: ${school.location}
                Acceptance Rate: ${school.acceptance_rate}%
                Average GPA: ${school.avg_gpa} = 'line-through';
                Average SAT: ${school.avg_sat}';
                Tuition: ${school.tuition.toLocaleString()}progress on your college journey!', 'success');
                Ranking: #${school.ranking}
                Deadline: ${new Date(school.deadline).toLocaleDateString()}
            `;  taskTitle.style.textDecoration = 'none';
            showNotification(schoolName, details, 'info');
        };  }
        };
        window.showApplicationTracker = function() {
            showNotification('Application Tracker', `You have ${window.applicationData?.length || 0} applications in progress`, 'info');
        };  document.getElementById('alertBanner').classList.remove('show');
        };
        window.showEssayTracker = function() {
            const essayCount = document.getElementById('essaysCount').textContent;
            showNotification('Essay Tracker', `You have completed ${essayCount} essays and supplements`, 'info');
        };      School: ${schoolName}
                Location: ${school.location}
        window.showScholarshipTracker = function() {_rate}%
            const scholarshipAmount = document.getElementById('scholarshipAmount').textContent;
            showNotification('Scholarship Tracker', `You're eligible for ${scholarshipAmount} in scholarship opportunities`, 'info');
        };      Tuition: ${school.tuition.toLocaleString()}
                Ranking: #${school.ranking}
        window.showProgressAnalytics = function() {e).toLocaleDateString()}
            const progress = document.getElementById('overallProgress').textContent;
            showNotification('Progress Analytics', `You're ${progress} complete with your college applications`, 'info');
        };

        function addChatMessage(message, sender) { {
            const chatMessages = document.getElementById('chatMessages');plicationData?.length || 0} applications in progress`, 'info');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            ow.showEssayTracker = function() {
            const prefix = sender === 'user' ? 'You:' : 'AI Counselor:';xtContent;
            messageDiv.innerHTML = `<strong>${prefix}</strong> ${escapeHtml(message)}`;and supplements`, 'info');
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }   const scholarshipAmount = document.getElementById('scholarshipAmount').textContent;
            showNotification('Scholarship Tracker', `You're eligible for ${scholarshipAmount} in scholarship opportunities`, 'info');
        function addTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message ai typing-indicator';').textContent;
            typingDiv.id = 'typingIndicator';ics', `You're ${progress} complete with your college applications`, 'info');
            typingDiv.innerHTML = `
                <strong>AI Counselor:</strong> 
                <div class="loading"></div>nder) {
            `;nst chatMessages = document.getElementById('chatMessages');
            chatMessages.appendChild(typingDiv);ement('div');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }   
            const prefix = sender === 'user' ? 'You:' : 'AI Counselor:';
        function removeTypingIndicator() {g>${prefix}</strong> ${escapeHtml(message)}`;
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {ld(messageDiv);
                typingIndicator.remove();Messages.scrollHeight;
            }
        }
        function addTypingIndicator() {
        async function saveChatToFirebase(userMessage, aiResponse, contextData) {
            try { typingDiv = document.createElement('div');
                const userId = window.currentUser.uid;ing-indicator';
                const chatData = {Indicator';
                    userId: userId,
                    userMessage: userMessage,> 
                    aiResponse: aiResponse,
                    timestamp: serverTimestamp(),
                    context: contextData,ngDiv);
                    sessionId: getSessionId()ages.scrollHeight;
                };

                await addDoc(collection(db, 'chatHistory'), chatData);
                logger.log('üíæ Enhanced chat data saved');d('typingIndicator');
                typingIndicator) {
            } catch (error) {or.remove();
                console.error('‚ùå Error saving chat:', error);
            }
        }
        async function saveChatToFirebase(userMessage, aiResponse, contextData) {
        function getSessionId() {
            let sessionId = sessionStorage.getItem('chatSessionId');
            if (!sessionId) {a = {
                sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                sessionStorage.setItem('chatSessionId', sessionId);
            }       aiResponse: aiResponse,
            return sessionId;: serverTimestamp(),
        }           context: contextData,
                    sessionId: getSessionId()
        function getErrorMessage(statusCode) {
            const messages = {
                400: '‚ùå I had trouble understanding your message. Could you please rephrase it?',
                401: 'üîê Authentication error. Please try refreshing the page and logging in again.',
                403: 'üö´ Access denied. Your OpenAI API key may need billing setup. Please check your OpenAI account.',
                429: '‚è±Ô∏è Too many requests! I\'m experiencing high demand. Please wait 60 seconds before trying again.',
                500: '‚ö†Ô∏è Server error. I\'m temporarily having technical difficulties. Please try again in a few minutes.',
                502: 'üîß Bad gateway. The AI service is temporarily unavailable. Please try again shortly.',
                503: 'üõ†Ô∏è Service unavailable. The server is undergoing maintenance. Please try again later.',
                504: '‚è∞ Request timeout. The AI is taking too long to respond. Try asking a simpler question.'
            };on getSessionId() {
            return messages[statusCode] || `‚ö†Ô∏è Unexpected error (Code: ${statusCode}). Please try again or contact support if the problem persists.`;
        }   if (!sessionId) {
                sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        window.handleChatKeyPress = function(event) {', sessionId);
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                window.sendChatMessage();
            }
        };nction getErrorMessage(statusCode) {
            const messages = {
        window.toggleChat = function() {derstanding your message. Could you please rephrase it?',
            const chatWidget = document.getElementById('chatWidget');the page and logging in again.',
            const chatToggle = document.getElementById('chatToggle');billing setup. Please check your OpenAI account.',
                429: '‚è±Ô∏è Too many requests! I\'m experiencing high demand. Please wait 60 seconds before trying again.',
            if (chatWidget.classList.contains('open')) {having technical difficulties. Please try again in a few minutes.',
                chatWidget.classList.remove('open'); is temporarily unavailable. Please try again shortly.',
                chatToggle.classList.remove('hidden');ver is undergoing maintenance. Please try again later.',
            } else { '‚è∞ Request timeout. The AI is taking too long to respond. Try asking a simpler question.'
                chatWidget.classList.add('open');
                chatToggle.classList.add('hidden');pected error (Code: ${statusCode}). Please try again or contact support if the problem persists.`;
                document.getElementById('chatInput').focus();
            }
        };ndow.handleChatKeyPress = function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
        function escapeHtml(text) {t();
            const map = {ndChatMessage();
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',nction() {
                "'": '&#039;'= document.getElementById('chatWidget');
            };nst chatToggle = document.getElementById('chatToggle');
            return text.replace(/[&<>"']/g, m => map[m]);
        }   if (chatWidget.classList.contains('open')) {
                chatWidget.classList.remove('open');
        if (document.readyState === 'loading') {den');
            document.addEventListener('DOMContentLoaded', initNavbar);
        } else {chatWidget.classList.add('open');
            initNavbar();e.classList.add('hidden');
        }       document.getElementById('chatInput').focus();
            }
    </script>

    <script>tion escapeHtml(text) {
        // ============================================
        // ENHANCED AI CHAT WITH FULL CONTEXT
        // ============================================
                '>': '&gt;',
        window.sendChatMessage = async function() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('chatSend');
            const message = input.value.trim();> map[m]);
        }
            if (!message) return;
        if (document.readyState === 'loading') {
            if (!window.currentUser) {'DOMContentLoaded', initNavbar);
                showNotification('Authentication Required', 'Please log in to use the AI counselor.', 'warning');
                return;);
            }

            // Disable input during processing
            input.disabled = true;
            sendBtn.disabled = true;
        // ============================================
            // Add user message to chatONTEXT
            addChatMessage(message, 'user');===========
            input.value = '';
        window.sendChatMessage = async function() {
            // Show typing indicatoretElementById('chatInput');
            addTypingIndicator();ent.getElementById('chatSend');
            const message = input.value.trim();
            try {
                // Gather comprehensive context about the user
                const userData = window.userData || {};
                const questionnaire = userData.questionnaire || {};
                const applications = window.applicationData || [];e log in to use the AI counselor.', 'warning');
                return;
                // Build context data
                const contextData = {
                    userName: userData.name || userData.firstName || 'Student',
                    email: userData.email || '',
                    disabled = true;
                    // Academic profile
                    gpa: questionnaire.unweightedGPA || userData.gpa || 'Not provided',
                    testScores: questionnaire.testScores || 'Not provided',
                    satScore: extractSATScore(questionnaire.testScores),
                    actScore: extractACTScore(questionnaire.testScores),
                    typing indicator
                    // Application info
                    targetSchools: questionnaire.targetSchools || [],
                    intendedMajor: questionnaire.intendedMajor || 'Undecided',
                    applicationCount: applications.length,user
                    t userData = window.userData || {};
                    // Progress trackingerData.questionnaire || {};
                    overallProgress: calculateOverallProgress(),];
                    essaysCompleted: parseInt(document.getElementById('essaysCount')?.textContent || '0'),
                    scholarshipPotential: document.getElementById('scholarshipAmount')?.textContent || '$0',
                    t contextData = {
                    // Upcoming deadlinesme || userData.firstName || 'Student',
                    upcomingDeadlines: getUpcomingDeadlines(),
                    
                    // Recent activitye
                    recentApplications: applications.slice(0, 3).map(app => ({rovided',
                        school: app.schoolName,estScores || 'Not provided',
                        status: app.status,re(questionnaire.testScores),
                        deadline: app.deadlinequestionnaire.testScores),
                    })),
                    // Application info
                    // Additional contextonnaire.targetSchools || [],
                    financialAid: questionnaire.financialAid || [],Undecided',
                    extracurriculars: questionnaire.extracurriculars || [],
                    specialConsiderations: questionnaire.specialConsiderations || []
                };  // Progress tracking
                    overallProgress: calculateOverallProgress(),
                console.log('üì§ Sending chat request with full context:', {ysCount')?.textContent || '0'),
                    message: message.substring(0, 50) + '...',yId('scholarshipAmount')?.textContent || '$0',
                    contextKeys: Object.keys(contextData),
                    targetSchools: contextData.targetSchools.length,
                    applicationCount: contextData.applicationCount
                }); 
                    // Recent activity
                // Make API request with full contextslice(0, 3).map(app => ({
                const response = await fetch('/api/chat', {
                    method: 'POST',.status,
                    headers: {ne: app.deadline
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,nnaire.financialAid || [],
                        userProfile: {questionnaire.extracurriculars || [],
                            name: contextData.userName,e.specialConsiderations || []
                            gpa: contextData.gpa,
                            satScore: contextData.satScore,
                            actScore: contextData.actScore,ull context:', {
                            intendedMajor: contextData.intendedMajor,
                            targetSchools: contextData.targetSchools
                        },Schools: contextData.targetSchools.length,
                        questionnaireData: questionnaire,tionCount
                        context: {
                            currentPage: 'dashboard',
                            overallProgress: contextData.overallProgress,
                            applicationCount: contextData.applicationCount,
                            upcomingDeadlines: contextData.upcomingDeadlines
                        }rs: {
                    })  'Content-Type': 'application/json',
                }); },
                    body: JSON.stringify({
                removeTypingIndicator();,
                        userProfile: {
                if (!response.ok) {ontextData.userName,
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = getErrorMessage(response.status);
                            actScore: contextData.actScore,
                    console.error('‚ùå Chat API error:', {ntendedMajor,
                        status: response.status,xtData.targetSchools
                        statusText: response.statusText,
                        error: errorData.error || 'Unknown error'
                    }); context: {
                            currentPage: 'dashboard',
                    addChatMessage(errorMessage, 'ai');a.overallProgress,
                            applicationCount: contextData.applicationCount,
                    // Track errorngDeadlines: contextData.upcomingDeadlines
                    trackEvent('Chat', 'Error', `Status: ${response.status}`);
                    })
                    return;
                }
                removeTypingIndicator();
                const data = await response.json();
                console.log('‚úÖ Chat response received');
                    const errorData = await response.json().catch(() => ({}));
                // Add AI response to chatetErrorMessage(response.status);
                addChatMessage(data.response, 'ai');
                    console.error('‚ùå Chat API error:', {
                // Save conversation to Firebase
                await saveChatToFirebase(message, data.response, contextData);
                        error: errorData.error || 'Unknown error'
                // Track successful interaction
                trackEvent('Chat', 'Message', 'Success');
                    addChatMessage(errorMessage, 'ai');
                // Scroll to bottom
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;.status}`);
                    
            } catch (error) {
                removeTypingIndicator();
                console.error('‚ùå Chat error:', error);
                const data = await response.json();
                addChatMessage(Chat response received');
                    '‚ùå I\'m having trouble connecting right now. Please check your internet connection and try again. If the problem persists, try refreshing the page.',
                    'ai'I response to chat
                );dChatMessage(data.response, 'ai');

                trackEvent('Chat', 'Error', 'Network or Unknown');
            } finally {aveChatToFirebase(message, data.response, contextData);
                // Re-enable input
                input.disabled = false;eraction
                sendBtn.disabled = false;ge', 'Success');
                input.focus();
            }   // Scroll to bottom
        };      const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
        // Helper function to get upcoming deadlines
        function getUpcomingDeadlines() {
            if (!window.applicationData) return [];
                console.error('‚ùå Chat error:', error);
            const now = new Date();
            return window.applicationData
                .map(app => {aving trouble connecting right now. Please check your internet connection and try again. If the problem persists, try refreshing the page.',
                    const deadline = new Date(app.deadline);
                    const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
                    return {
                        school: app.schoolName,twork or Unknown');
                        deadline: app.deadline,
                        daysUntil: daysUntil,
                        status: app.status
                    };n.disabled = false;
                })put.focus();
                .filter(d => d.daysUntil > 0 && d.daysUntil <= 90)
                .sort((a, b) => a.daysUntil - b.daysUntil)
                .slice(0, 5);
        }/ Helper function to get upcoming deadlines
        function getUpcomingDeadlines() {
        // ============================================
        // NOTIFICATION SYSTEM
        // ============================================
            return window.applicationData
        let notificationTimeout;
                    const deadline = new Date(app.deadline);
        window.showNotification = function(title, message, type = 'info') {60 * 60 * 24));
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            const notificationIcon = notification.querySelector('.notification-icon i');
                        status: app.status
            // Clear any existing timeout
            if (notificationTimeout) {
                clearTimeout(notificationTimeout);daysUntil <= 90)
            }   .sort((a, b) => a.daysUntil - b.daysUntil)
                .slice(0, 5);
            // Remove existing show class
            notification.classList.remove('show');
        // ============================================
            // Set contentSTEM
            notificationTitle.textContent = title;=====
            notificationMessage.textContent = message;
        let notificationTimeout;
            // Set icon based on type
            const icons = {tion = function(title, message, type = 'info') {
                success: 'fa-check-circle',etElementById('notification');
                error: 'fa-exclamation-circle',getElementById('notificationTitle');
                warning: 'fa-exclamation-triangle',tElementById('notificationMessage');
                info: 'fa-info-circle'otification.querySelector('.notification-icon i');
            };
            // Clear any existing timeout
            notificationIcon.className = `fas ${icons[type] || icons.info}`;
                clearTimeout(notificationTimeout);
            // Set border color based on type
            const colors = {
                success: 'var(--success-color)',
                error: 'var(--danger-color)',ow');
                warning: 'var(--warning-color)',
                info: 'var(--info-color)'
            };tificationTitle.textContent = title;
            notificationMessage.textContent = message;
            notification.style.borderLeftColor = colors[type] || colors.info;
            // Set icon based on type
            // Show notification
            setTimeout(() => {heck-circle',
                notification.classList.add('show');
            }, 100);ing: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            // Auto-hide after 5 seconds
            notificationTimeout = setTimeout(() => {
                notification.classList.remove('show');type] || icons.info}`;
            }, 5000);
            // Set border color based on type
            // Track notification
            trackEvent('Notification', 'Show', `${type}: ${title}`);
        };      error: 'var(--danger-color)',
                warning: 'var(--warning-color)',
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
            notification.style.borderLeftColor = colors[type] || colors.info;
        // Check if user is online
        function checkOnlineStatus() {
            if (!navigator.onLine) {
                showNotification(sList.add('show');
                    'You\'re Offline',
                    'Some features may not work until you reconnect to the internet.',
                    'warning'r 5 seconds
                );cationTimeout = setTimeout(() => {
            }   notification.classList.remove('show');
        }   }, 5000);

        // Periodically check connection
        setInterval(checkOnlineStatus, 30000); `${type}: ${title}`);
        };
        // ============================================
        // PERFORMANCE MONITORING======================
        // ============================================
        // ============================================
        if (window.performance && window.performance.timing) {
            window.addEventListener('load', function() {
                setTimeout(function() {
                    const timing = window.performance.timing;
                    const loadTime = timing.loadEventEnd - timing.navigationStart;
                    const domReady = timing.domContentLoadedEventEnd - timing.navigationStart;
                    const renderTime = timing.domComplete - timing.domLoading;ernet.',
                    'warning'
                    console.log('üìä Performance Metrics:');
                    console.log(`  Total Load Time: ${loadTime}ms`);
                    console.log(`  DOM Ready: ${domReady}ms`);
                    console.log(`  Render Time: ${renderTime}ms`);
        // Periodically check connection
                    // Track if load is slow);
                    if (loadTime > 5000) {
                        console.warn('‚ö†Ô∏è Slow page load detected');
                        trackEvent('Performance', 'SlowLoad', `${loadTime}ms`);
                    }==================================
                }, 0);
            });dow.performance && window.performance.timing) {
        }   window.addEventListener('load', function() {
                setTimeout(function() {
        // ============================================iming;
        // ERROR BOUNDARY AND RECOVERYiming.loadEventEnd - timing.navigationStart;
        // ============================================oadedEventEnd - timing.navigationStart;
                    const renderTime = timing.domComplete - timing.domLoading;
        window.addEventListener('error', function(event) {
            console.error('üö® Global Error:', { Metrics:');
                message: event.message,l Load Time: ${loadTime}ms`);
                filename: event.filename,ady: ${domReady}ms`);
                lineno: event.lineno,nder Time: ${renderTime}ms`);
                colno: event.colno,
                error: event.errorad is slow
            });     if (loadTime > 5000) {
                        console.warn('‚ö†Ô∏è Slow page load detected');
            // Don't show notification for every error, but log itoadTime}ms`);
            trackEvent('Error', 'Global', event.message);
        });     }, 0);
            });
        window.addEventListener('unhandledrejection', function(event) {
            console.error('üö® Unhandled Promise Rejection:', event.reason);
            trackEvent('Error', 'UnhandledRejection', String(event.reason));
        });ERROR BOUNDARY AND RECOVERY
        // ============================================
        // ============================================
        // KEYBOARD SHORTCUTSer('error', function(event) {
        // ============================================
                message: event.message,
        document.addEventListener('keydown', function(e) {
            // Cmd/Ctrl + K to open chat
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                const chatWidget = document.getElementById('chatWidget');
                if (!chatWidget.classList.contains('open')) {
                    window.toggleChat();or every error, but log it
                }Event('Error', 'Global', event.message);
                document.getElementById('chatInput').focus();
            }
        window.addEventListener('unhandledrejection', function(event) {
            // Cmd/Ctrl + / to start tourromise Rejection:', event.reason);
            if ((e.metaKey || e.ctrlKey) && e.key === '/') {(event.reason));
                e.preventDefault();
                window.startTour();
            }==========================================
        // KEYBOARD SHORTCUTS
            // Escape to close modals==================
            if (e.key === 'Escape') {
                const chatWidget = document.getElementById('chatWidget');
                if (chatWidget.classList.contains('open')) {
                    window.toggleChat(); && e.key === 'k') {
                } else {tDefault();
                    window.closeAllModals();getElementById('chatWidget');
                }f (!chatWidget.classList.contains('open')) {
            }       window.toggleChat();
        });     }
                document.getElementById('chatInput').focus();
        // ============================================
        // DATA REFRESH MECHANISM
        // ============================================
            if ((e.metaKey || e.ctrlKey) && e.key === '/') {
        // Refresh data every 5 minutes
        setInterval(async function() {
            if (window.currentUser && document.visibilityState === 'visible') {
                console.log('üîÑ Refreshing dashboard data...');
                scape to close modals
                try { === 'Escape') {
                    await loadApplicationData();lementById('chatWidget');
                    await calculateRealStats();ns('open')) {
                    generateAIInsights();
                    updateProgressCircle();
                    checkDeadlineAlerts(););
                    
                    console.log('‚úÖ Dashboard data refreshed');
                } catch (error) {
                    console.error('‚ùå Error refreshing data:', error);
                }======================================
            }TA REFRESH MECHANISM
        }, 5 * 60 * 1000); // 5 minutes================

        // ============================================
        // VISIBILITY CHANGE HANDLING{
        // ============================================tyState === 'visible') {
                console.log('üîÑ Refreshing dashboard data...');
        document.addEventListener('visibilitychange', async function() {
            if (document.visibilityState === 'visible' && window.currentUser) {
                console.log('üëÅÔ∏è Page visible again, checking for updates...');
                    await calculateRealStats();
                // Quick refresh on return
                setTimeout(async () => {();
                    try {DeadlineAlerts();
                        await loadApplicationData();
                        await calculateRealStats();efreshed');
                        checkDeadlineAlerts();
                    } catch (error) {Error refreshing data:', error);
                        console.error('Error on visibility refresh:', error);
                    }
                }, 1000);; // 5 minutes
            }
        });============================================
        // VISIBILITY CHANGE HANDLING
        // ============================================
        // INITIAL LOAD COMPLETE
        // ============================================sync function() {
            if (document.visibilityState === 'visible' && window.currentUser) {
        console.log('üéâ Dashboard fully initialized and ready!'); updates...');
        console.log('üìä Features enabled:');
        console.log('  ‚úì Real-time application tracking');
        console.log('  ‚úì AI-powered school recommendations');
        console.log('  ‚úì Personalized timeline with tasks');
        console.log('  ‚úì Context-aware AI chat counselor');
        console.log('  ‚úì Progress analytics');ts();
        console.log('  ‚úì Deadline alerts');();
        console.log('  ‚úì Document tracking');
        console.log('  ‚úì Financial aid calculator');bility refresh:', error);
        console.log('  ‚úì Keyboard shortcuts (Cmd+K, Cmd+/)');
        console.log('  ‚úì Offline support (PWA)');
        console.log('  ‚úì Auto-save and sync');
        });
    </script>
    <script>===========================================
        // ============================================
        // ADDITIONAL HELPER FUNCTIONS=================
        // ============================================
        console.log('üéâ Dashboard fully initialized and ready!');
        // Format dates consistentlybled:');
        function formatDate(dateString) {ation tracking');
            const date = new Date(dateString);ommendations');
            const now = new Date();ed timeline with tasks');
            const diffTime = date - now;I chat counselor');
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        console.log('  ‚úì Deadline alerts');
            if (diffDays < 0) {nt tracking');
                return 'Overdue';l aid calculator');
            } else if (diffDays === 0) {uts (Cmd+K, Cmd+/)');
                return 'Today';e support (PWA)');
            } else if (diffDays === 1) {ync');
                return 'Tomorrow';
            } else if (diffDays <= 7) {
                return `${diffDays} days`;
            } else {===================================
                return date.toLocaleDateString('en-US', { 
                    month: 'short', ===================
                    day: 'numeric',
                    year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
                });rmatDate(dateString) {
            }onst date = new Date(dateString);
        }   const now = new Date();
            const diffTime = date - now;
        // Format numbers with commasl(diffTime / (1000 * 60 * 60 * 24));
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }       return 'Overdue';
            } else if (diffDays === 0) {
        // Validate emailoday';
        function isValidEmail(email) { {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }   } else if (diffDays <= 7) {
                return `${diffDays} days`;
        // Deep clone object
        function deepClone(obj) {aleDateString('en-US', { 
            return JSON.parse(JSON.stringify(obj));
        }           day: 'numeric',
                    year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };on isValidEmail(email) {
        }   return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        // Throttle function
        function throttle(func, limit) {
            let inThrottle;obj) {
            return function(...args) {ingify(obj));
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }imeout;
            };turn function executedFunction(...args) {
        }       const later = () => {
                    clearTimeout(timeout);
        // Export utilities for global use
        window.DashboardUtils = {
            formatDate,meout(timeout);
            formatNumber, setTimeout(later, wait);
            isValidEmail,
            deepClone,
            debounce,
            throttlefunction
        };nction throttle(func, limit) {
            let inThrottle;
        // ============================================
        // FINAL INITIALIZATION CHECKS
        // ============================================
                    inThrottle = true;
        // Check browser compatibilitynThrottle = false, limit);
        function checkBrowserCompatibility() {
            const isCompatible = 
                'fetch' in window &&
                'Promise' in window &&
                'localStorage' in window &&
                'sessionStorage' in window;
            formatDate,
            if (!isCompatible) {
                console.error('‚ùå Browser not fully compatible');
                showNotification(
                    'Browser Compatibility',
                    'Your browser may not support all features. Please update to the latest version.',
                    'warning'
                );
            }==========================================
        }/ FINAL INITIALIZATION CHECKS
        // ============================================
        checkBrowserCompatibility();
        // Check browser compatibility
        // Log dashboard readinesstibility() {
        console.log('‚úÖ Dashboard.html fully loaded and operational');
        console.log('üîê Authentication: Ready');
        console.log('üé® UI: Fully rendered');
        console.log('ü§ñ AI: Connected'); &&
        console.log('üíæ Firebase: Active');
        console.log('üì± PWA: Enabled');
            if (!isCompatible) {
    </script>   console.error('‚ùå Browser not fully compatible');
                showNotification(
    <!-- Add these additional scripts and enhancements after the existing scripts -->
                    'Your browser may not support all features. Please update to the latest version.',
<script>            'warning'
    // ============================================
    // ADVANCED ANALYTICS & TRACKING
    // ============================================

    function trackEvent(category, action, label) {
        try {
            if (typeof gtag !== 'undefined') {
                gtag('event', action, {ully loaded and operational');
                    event_category: category,');
                    event_label: labelered');
                });('ü§ñ AI: Connected');
            }le.log('üíæ Firebase: Active');
            ole.log('üì± PWA: Enabled');
            console.log(`üìä Event tracked: ${category} - ${action} - ${label}`);
        } catch (error) {
            console.error('Error tracking event:', error);
        }Add these additional scripts and enhancements after the existing scripts -->
    }
<script>
    // Track user interactions=====================
    document.addEventListener('click', function(e) {
        const target = e.target.closest('a, button, .school-card, .stat-card');
        if (target) {
            const label = target.textContent?.trim().substring(0, 50) || 'Unknown';
            trackEvent('Interaction', 'Click', label);
        }   if (typeof gtag !== 'undefined') {
    });         gtag('event', action, {
                    event_category: category,
    // ============================================
    // PROGRESSIVE WEB APP (PWA) INSTALL PROMPT
    // ============================================
            
    let deferredPrompt;(`üìä Event tracked: ${category} - ${action} - ${label}`);
    let installBannerShown = false;
            console.error('Error tracking event:', error);
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        rack user interactions
        // Show install banner after 30 seconds (subtle, not intrusive)
        setTimeout(() => {arget.closest('a, button, .school-card, .stat-card');
            if (!installBannerShown && !localStorage.getItem('pwaInstallDismissed')) {
                showInstallBanner();tContent?.trim().substring(0, 50) || 'Unknown';
            }rackEvent('Interaction', 'Click', label);
        }, 30000);
    });

    function showInstallBanner() {=================
        installBannerShown = true;NSTALL PROMPT
        ===========================================
        const banner = document.createElement('div');
        banner.id = 'pwaInstallBanner';
        banner.style.cssText = `se;
            position: fixed;
            bottom: 20px;er('beforeinstallprompt', (e) => {
            right: 20px;();
            background: linear-gradient(135deg, #2a357a 0%, #a07bcc 100%);
            color: white;
            padding: 1rem 1.5rem;ter 30 seconds (subtle, not intrusive)
        setTimeout(() => {
            if (!installBannerShown && !localStorage.getItem('pwaInstallDismissed')) {
                showInstallBanner();
            }
        }, 30000);
    });

    function showInstallBanner() {
        installBannerShown = true;
        
        const banner = document.createElement('div');
        banner.id = 'pwaInstallBanner';
        banner.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2a357a 0%, #a07bcc 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(42, 53, 122, 0.3);
            z-index: 9997;
            display: flex;
            align-items: center;
            gap: 1rem;
            max-width: 350px;
            animation: slideInRight 0.5s ease;
        `;
        
        banner.innerHTML = `
            <div style="flex: 1;">
                <div style="font-weight: 600; margin-bottom: 0.25rem;">üì± Install College Climb</div>
                <div style="font-size: 0.85rem; opacity: 0.9;">Get quick access from your home screen</div>
            </div>
            <button onclick="installPWA()" style="background: white; color: #2a357a; border: none; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                Install
            </button>
            <button onclick="dismissInstallBanner()" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; padding: 0.5rem;">
                √ó
            </button>
        `;
        
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(banner);
    }

    window.installPWA = async function() {
        if (!deferredPrompt) {
            showNotification('Install Not Available', 'PWA installation is not available on this device.', 'info');
            return;
        }

        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        
        if (outcome === 'accepted') {
            console.log('‚úÖ PWA installation accepted');
            trackEvent('PWA', 'Install', 'Accepted');
            showNotification('Installing...', 'College Climb is being installed!', 'success');
        } else {
            console.log('‚ùå PWA installation dismissed');
            trackEvent('PWA', 'Install', 'Dismissed');
        }
        
        deferredPrompt = null;
        dismissInstallBanner();
    };

    window.dismissInstallBanner = function() {
        const banner = document.getElementById('pwaInstallBanner');
        if (banner) {
            banner.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => banner.remove(), 300);
        }
        localStorage.setItem('pwaInstallDismissed', 'true');
        trackEvent('PWA', 'InstallBanner', 'Dismissed');
    };

    const slideOutStyle = document.createElement('style');
    slideOutStyle.textContent = `
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }
    `;
    document.head.appendChild(slideOutStyle);

    // ============================================
    // OFFLINE CACHE & SERVICE WORKER
    // ============================================

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('‚úÖ Service Worker registered:', registration.scope);
                    trackEvent('PWA', 'ServiceWorker', 'Registered');
                })
                .catch(error => {
                    console.error('‚ùå Service Worker registration failed:', error);
                    trackEvent('PWA', 'ServiceWorker', 'Failed');
                });
        });
    }

    // ============================================
    // STARRY BACKGROUND ANIMATION
    // ============================================

    function createStarryBackground() {
        const starryBg = document.getElementById('starryBg');
        if (!starryBg) return;

        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.width = Math.random() * 3 + 'px';
            star.style.height = star.style.width;
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            star.style.animationDuration = (Math.random() * 2 + 2) + 's';
            starryBg.appendChild(star);
        }
    }

    createStarryBackground();

    // ============================================
    // SMART SEARCH FUNCTIONALITY
    // ============================================

    // ADD these helper functions to dashboard.html around line 4800
    // (Right before the chat functionality)

    // Extract SAT score from test scores string
    function extractSATScore(testScores) {
        if (!testScores) return null;
        const match = testScores.match(/SAT:?\s*(\d+)/i);
        return match ? parseInt(match[1]) : null;
    }

    // Extract ACT score from test scores string  
    function extractACTScore(testScores) {
        if (!testScores) return null;
        const match = testScores.match(/ACT:?\s*(\d+)/i);
        return match ? parseInt(match[1]) : null;
    }

    // Track analytics events
    function trackEvent(category, action, label) {
        try {
            if (typeof gtag !== 'undefined') {
                gtag('event', action, {
                    event_category: category,
                    event_label: label
                });
            }
            console.log(`üìä Event tracked: ${category} - ${action} - ${label}`);
        } catch (error) {
            console.error('Error tracking event:', error);
        }
    }

    window.openSmartSearch = function() {
        const modal = document.createElement('div');
        modal.className = 'celebration-modal active';
        modal.style.maxWidth = '600px';
        modal.onclick = (e) => e.stopPropagation();
        
        modal.innerHTML = `
            <div style="text-align: left;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="color: var(--accent-color); margin: 0;">üîç Smart Search</h2>
                    <button onclick="this.closest('.celebration-modal').remove(); document.getElementById('tourOverlay').classList.remove('active');"
                            style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">√ó</button>
                </div>
                <input type="text" 
                       id="smartSearchInput" 
                       placeholder="Search schools, essays, tasks, deadlines..."
                       style="width: 100%; padding: 1rem; border: 2px solid var(--accent-color); border-radius: 12px; font-size: 1rem; margin-bottom: 1rem;"
                       oninput="performSmartSearch(this.value)">
                <div id="smartSearchResults" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        `;

        document.body.appendChild(modal);
        document.getElementById('tourOverlay').classList.add('active');
        setTimeout(() => document.getElementById('smartSearchInput').focus(), 100);
    };

    window.performSmartSearch = function(query) {
        const resultsContainer = document.getElementById('smartSearchResults');
        if (!query || query.length < 2) {
            resultsContainer.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 2rem;">Type to search...</p>';
            return;
        }

        const results = [];
        const lowerQuery = query.toLowerCase();

        // Search target schools
        const targetSchools = window.userData?.questionnaire?.targetSchools || [];
        targetSchools.forEach(school => {
            if (school.toLowerCase().includes(lowerQuery)) {
                results.push({
                    type: 'School',
                    icon: 'üè´',
                    title: school,
                    action: () => openCollegeProfile(school)
                });
            }
        });

        // Search all schools in database
        Object.keys(window.schoolDatabase).forEach(school => {
            if (school.toLowerCase().includes(lowerQuery) && !targetSchools.includes(school)) {
                results.push({
                    type: 'Available School',
                    icon: 'üéì',
                    title: school,
                    action: () => openCollegeProfile(school)
                });
            }
        });

        // Search tasks
        if ('task'.includes(lowerQuery) || 'deadline'.includes(lowerQuery)) {
            results.push({
                type: 'Action',
                icon: '‚úÖ',
                title: 'View All Tasks',
                action: () => {
                    document.querySelector('.task-section')?.scrollIntoView({ behavior: 'smooth' });
                    closeAllModals();
                }
            });
        }

        // Search essays
        if ('essay'.includes(lowerQuery) || 'writing'.includes(lowerQuery)) {
            results.push({
                type: 'Page',
                icon: '‚úçÔ∏è',
                title: 'Essay Coach',
                action: () => window.location.href = 'essaycoach.html'
            });
        }

        // Search scholarships
        if ('scholarship'.includes(lowerQuery) || 'money'.includes(lowerQuery) || 'financial'.includes(lowerQuery)) {
            results.push({
                type: 'Page',
                icon: 'üí∞',
                title: 'Scholarship Finder',
                action: () => window.location.href = 'scholarship.html'
            });
        }

        // Display results
        if (results.length === 0) {
            resultsContainer.innerHTML = `
                <p style="color: var (--text-secondary); text-align: center; padding: 2rem;">
                    No results found for "${query}"
                </p>
            `;
        } else {
            resultsContainer.innerHTML = results.map(result => `
                <div class="search-result-item" 
                     onclick="(${result.action.toString()})(); closeAllModals();"
                     style="padding: 1rem; border-radius: 12px; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.2s; background: var(--secondary-bg); border: 1px solid rgba(160, 123, 204, 0.1);">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 1.5rem;">${result.icon}</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-primary);">${result.title}</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">${result.type}</div>
                        </div>
                        <i class="fas fa-chevron-right" style="color: var(--accent-color);"></i>
                    </div>
                </div>
            `).join('');
        }
    };

    // ============================================
    // KEYBOARD SHORTCUT: CTRL+K FOR SEARCH
    // ============================================

    document.addEventListener('keydown', function(e) {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
            e.preventDefault();
            openSmartSearch();
        }
    });

    // ============================================
    // EXPORT DATA FUNCTIONALITY
    // ============================================

    window.exportDashboardData = async function() {
        try {
            const exportData = {
                user: {
                    name: window.userData?.name,
                    email: window.userData?.email,
                    questionnaire: window.userData?.questionnaire
                },
                applications: window.applicationData || [],
                statistics: {
                    totalApplications: window.applicationData?.length || 0,
                    completedEssays: parseInt(document.getElementById('essaysCount')?.textContent || '0'),
                    overallProgress: parseInt(document.getElementById('overallProgress')?.textContent || '0'),
                    scholarshipValue: document.getElementById('scholarshipAmount')?.textContent
                },
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `college-climb-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('Export Complete', 'Your dashboard data has been downloaded!', 'success');
            trackEvent('Data', 'Export', 'JSON');
        } catch (error) {
            console.error('Export error:', error);
            showNotification('Export Failed', 'Unable to export data. Please try again.', 'error');
        }
    };

    // ============================================
    // PRINT DASHBOARD FUNCTIONALITY
    // ============================================

    window.printDashboard = function() {
        window.print();
        trackEvent('Data', 'Print', 'Dashboard');
    };

    // Add print styles
    const printStyles = document.createElement('style');
    printStyles.textContent = `
        @media print {
            .cc-navbar,
            .chat-widget,
            .chat-toggle,
            .quick-actions,
            .footer,
            .alert-banner,
            .notification,
            #dashboardLoadingOverlay,
            #tourOverlay,
            #tourSpotlight,
            #tourTooltip,
            .celebration-modal {
                display: none !important;
            }

            body {
                background: white !important;
            }

            .dashboard-container {
                margin-top: 0 !important;
            }

            .stat-card,
            .school-card,
            .timeline-item,
            .task-item {
                break-inside: avoid;
            }

            .school-grid,
            .stats-overview {
                display: block !important;
            }

            .stat-card,
            .school-card {
                margin-bottom: 1rem;
                page-break-inside: avoid;
            }
        }
    `;
    document.head.appendChild(printStyles);

    // ============================================
    // ACCESSIBILITY IMPROVEMENTS
    // ============================================

    // Add keyboard navigation for school cards
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') {
            const focusableElements = document.querySelectorAll('a, button, input, .school-card, .stat-card');
            const focused = document.activeElement;
            
            // Ensure focus is visible
            if (focused && focusableElements.length > 0) {
                focused.style.outline = '2px solid var(--accent-color)';
                focused.style.outlineOffset = '2px';
            }
        }
    });

    // Add ARIA labels dynamically
    function enhanceAccessibility() {
        document.querySelectorAll('.stat-card').forEach((card, index) => {
            card.setAttribute('role', 'button');
            card.setAttribute('tabindex', '0');
            card.setAttribute('aria-label', `Statistic card ${index + 1}: ${card.querySelector('.stat-label')?.textContent}`);
        });

        document.querySelectorAll('.school-card').forEach((card, index) => {
            card.setAttribute('role', 'article');
            card.setAttribute('tabindex', '0');
            card.setAttribute('aria-label', `School recommendation ${index + 1}: ${card.querySelector('.school-name')?.textContent}`);
        });

        document.querySelectorAll('.timeline-item').forEach((item, index) => {
            item.setAttribute('role', 'article');
            item.setAttribute('aria-label', `Timeline event ${index + 1}`);
        });
    }

    // Run accessibility enhancements after DOM loads
    setTimeout(enhanceAccessibility, 2000);

    // ============================================
    // AUTO-SAVE FUNCTIONALITY
    // ============================================

    let autoSaveQueue = [];
    let isSaving = false;

    async function autoSaveToFirebase() {
        if (isSaving || autoSaveQueue.length === 0 || !window.currentUser) return;

        isSaving = true;
        const saveData = autoSaveQueue.shift();

        try {
            await window.updateDoc(window.doc(window.db, 'users', window.currentUser.uid), {
                ...saveData,
                lastAutoSave: new Date()
            });
            console.log('üíæ Auto-save complete');
        } catch (error) {
            console.error('Auto-save error:', error);
            autoSaveQueue.unshift(saveData); // Re-queue on error
        } finally {
            isSaving = false;
            if (autoSaveQueue.length > 0) {
                setTimeout(autoSaveToFirebase, 1000);
            }
        }
    }

    window.queueAutoSave = function(data) {
        autoSaveQueue.push(data);
        setTimeout(autoSaveToFirebase, 2000); // Debounce by 2 seconds
    };

    // ============================================
    // REAL-TIME SYNC INDICATOR
    // ============================================

    function showSyncIndicator(status) {
        let indicator = document.getElementById('syncIndicator');
        
        if (!indicator) {
            indicator = document.createElement('div');
            indicator.id = 'syncIndicator';
            indicator.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                padding: 0.5rem 1rem;
                border-radius: 20px;
                font-size: 0.85rem;
                font-weight: 600;
                z-index: 9996;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                transition: all 0.3s ease;
            `;
            document.body.appendChild(indicator);
        }

        if (status === 'syncing') {
            indicator.style.background = 'rgba(59, 130, 246, 0.1)';
            indicator.style.color = '#3b82f6';
            indicator.style.border = '1px solid rgba(59, 130, 246, 0.3)';
            indicator.innerHTML = '<div class="loading" style="width: 12px; height: 12px; border-width: 2px;"></div> Syncing...';
            indicator.style.opacity = '1';
        } else if (status === 'synced') {
            indicator.style.background = 'rgba(16, 185, 129, 0.1)';
            indicator.style.color = '#10b981';
            indicator.style.border = '1px solid rgba(16, 185, 129, 0.3)';
            indicator.innerHTML = '<i class="fas fa-check-circle"></i> Synced';
            indicator.style.opacity = '1';
            setTimeout(() => {
                indicator.style.opacity = '0';
            }, 2000);
        } else if (status === 'error') {
            indicator.style.background = 'rgba(239, 68, 68, 0.1)';
            indicator.style.color = '#ef4444';
            indicator.style.border = '1px solid rgba(239, 68, 68, 0.3)';
            indicator.innerHTML = '<i class="fas fa-exclamation-circle"></i> Sync Error';
            indicator.style.opacity = '1';
            setTimeout(() => {
                indicator.style.opacity = '0';
            }, 3000);
        }
    }

    // Monitor Firebase connection
    if (window.db) {
        window.onSnapshot = window.onSnapshot || function() {};
        // Connection monitoring would go here
    }

    // ============================================
    // CONTEXT MENU FOR SCHOOL CARDS
    // ============================================

    document.addEventListener('contextmenu', function(e) {
        const schoolCard = e.target.closest('.school-card');
        if (schoolCard) {
            e.preventDefault();
            const schoolName = schoolCard.querySelector('.school-name')?.textContent;
            
            const menu = document.createElement('div');
            menu.id = 'contextMenu';
            menu.style.cssText = `
                position: fixed;
                top: ${e.clientY}px;
                left: ${e.clientX}px;
                background: var(--primary-bg);
                border: 1px solid rgba(160, 123, 204, 0.2);
                border-radius: 12px;
                padding: 0.5rem;
                box-shadow: var(--shadow);
                z-index: 10001;
                min-width: 180px;
            `;
            
            menu.innerHTML = `
                <div class="context-menu-item" onclick="openCollegeProfile('${schoolName}'); removeContextMenu();">
                    <i class="fas fa-eye"></i> View Details
                </div>
                <div class="context-menu-item" onclick="addToApplicationList('${schoolName}'); removeContextMenu();">
                    <i class="fas fa-plus"></i> Add to List
                </div>
                <div class="context-menu-item" onclick="compareWithOthers('${schoolName}'); removeContextMenu();">
                    <i class="fas fa-balance-scale"></i> Compare
                </div>
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                .context-menu-item {
                    padding: 0.75rem 1rem;
                    cursor: pointer;
                    border-radius: 8px;
                    transition: all 0.2s;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    color: var(--text-primary);
                }
                .context-menu-item:hover {
                    background: var(--secondary-bg);
                    color: var(--accent-color);
                }
            `;
            if (!document.getElementById('contextMenuStyles')) {
                style.id = 'contextMenuStyles';
                document.head.appendChild(style);
            }
            
            document.body.appendChild(menu);
            
            setTimeout(() => {
                document.addEventListener('click', removeContextMenu);
            }, 0);
        }
    });

    window.removeContextMenu = function() {
        const menu = document.getElementById('contextMenu');
        if (menu) menu.remove();
        document.removeEventListener('click', removeContextMenu);
    };

    window.compareWithOthers = function(schoolName) {
        sessionStorage.setItem('compareSchool', schoolName);
        openCompareSchools();
    };

    // ============================================
    // FINAL SYSTEM CHECKS
    // ============================================

    console.log('üéØ Running final system checks...');

    // Verify all critical elements
    const criticalElements = [
        'chatWidget',
        'chatToggle',
        'applicationTimeline',
        'schoolGrid',
        'aiInsights',
        'taskList',
        'progressCircle'
    ];

    criticalElements.forEach(id => {
        const element = document.getElementById(id);
        if (!element) {
            console.warn(`‚ö†Ô∏è Critical element missing: ${id}`);
        } else {
            console.log(`‚úÖ ${id} found`);
        }
    });

    // Verify Firebase connection
    if (window.auth && window.db) {
        console.log('‚úÖ Firebase connected');
    } else {
        console.error('‚ùå Firebase connection issue');
    }

    // Verify service worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.ready.then(() => {
            console.log('‚úÖ Service Worker ready');
        });
    }

    // Log completion
    console.log('');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log('üéâ COLLEGE CLIMB DASHBOARD FULLY LOADED');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log('‚ú® All systems operational');
    console.log('üì± PWA: Enabled');
    console.log('üî• Firebase: Connected');
    console.log('ü§ñ AI: Ready');
    console.log('üíæ Auto-save: Active');
    console.log('‚å®Ô∏è  Keyboard shortcuts: Enabled');
    console.log('‚ôø Accessibility: Enhanced');
    console.log('üìä Analytics: Tracking');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log('');
</script>

<style>
    /* Additional responsive improvements */
    @media (max-width: 768px) {
        #pwaInstallBanner {
            left: 10px !important;
            right: 10px !important;
            bottom: 10px !important;
            max-width: none !important;
        }

        #contextMenu {
            max-width: calc(100vw - 40px) !important;
        }
    }

    /* Smooth scrolling for all links */
    html {
        scroll-behavior: smooth;
    }

    /* Focus visible for accessibility */
    *:focus-visible {
        outline: 2px solid var(--accent-color);
        outline-offset: 2px;
    }

    /* Reduced motion for accessibility */
    @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }
</style>
</body>
</html>